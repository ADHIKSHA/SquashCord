!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(zd){"use strict";try{!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a,e=t(zd),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}(_e=a=a||{})[_e.DEBUG=0]="DEBUG",_e[_e.VERBOSE=1]="VERBOSE",_e[_e.INFO=2]="INFO",_e[_e.WARN=3]="WARN",_e[_e.ERROR=4]="ERROR",_e[_e.SILENT=5]="SILENT";function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=c[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var o={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},u=a.INFO,c=((Ee={})[a.DEBUG]="log",Ee[a.VERBOSE]="log",Ee[a.INFO]="info",Ee[a.WARN]="warn",Ee[a.ERROR]="error",Ee),h=(Object.defineProperty(l.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in a))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),l.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(l.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),l.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.DEBUG],t)),this._logHandler.apply(this,s([this,a.DEBUG],t))},l.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.VERBOSE],t)),this._logHandler.apply(this,s([this,a.VERBOSE],t))},l.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.INFO],t)),this._logHandler.apply(this,s([this,a.INFO],t))},l.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.WARN],t)),this._logHandler.apply(this,s([this,a.WARN],t))},l.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,a.ERROR],t)),this._logHandler.apply(this,s([this,a.ERROR],t))},l);function l(t){this.name=t,this._logLevel=u,this._logHandler=i,this._userLogHandler=null}function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var p,d="FirebaseError",v=(n(m,p=Error),m);function m(t,e,n){e=p.call(this,e)||this;return e.code=t,e.customData=n,e.name=d,Object.setPrototypeOf(e,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,w.prototype.create),e}var w=(b.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(_,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new v(o,t,i)},b);function b(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var _=/\{\$([^}]+)}/g,E=function(t,e){return(E=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function T(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var I,A="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},S={},N=A||self;function D(){}function C(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function R(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var k="closure_uid_"+(1e9*Math.random()>>>0),L=0;function O(t,e,n){return t.call.apply(t.bind,arguments)}function P(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?O:P).apply(null,arguments)}function x(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function V(){return Date.now()}function U(t,o){function e(){}e.prototype=o.prototype,t.X=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function F(){this.j=this.j,this.i=this.i}F.prototype.j=!1,F.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,k)&&t[k]||(t[k]=++L))},F.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},j=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(){return Array.prototype.concat.apply([],arguments)}function G(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var H,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function W(t,e){return-1!=t.indexOf(e)}function z(t,e){return t<e?-1:e<t?1:0}t:{var X=N.navigator;if(X){X=X.userAgent;if(X){H=X;break t}}H=""}function Y(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function J(t){var e,n={};for(e in t)n[e]=t[e];return n}var $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<$.length;i++)e=$[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function tt(t){return tt[" "](t),t}tt[" "]=D;var et,nt=W(H,"Opera"),rt=W(H,"Trident")||W(H,"MSIE"),it=W(H,"Edge"),ot=it||rt,st=W(H,"Gecko")&&!(W(H.toLowerCase(),"webkit")&&!W(H,"Edge"))&&!(W(H,"Trident")||W(H,"MSIE"))&&!W(H,"Edge"),at=W(H.toLowerCase(),"webkit")&&!W(H,"Edge");function ut(){var t=N.document;return t?t.documentMode:void 0}t:{var ct="",ht=(ht=H,st?/rv:([^\);]+)(\)|;)/.exec(ht):it?/Edge\/([\d\.]+)/.exec(ht):rt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ht):at?/WebKit\/(\S+)/.exec(ht):nt?/(?:Version)[ \/]?(\S+)/.exec(ht):void 0);if(ht&&(ct=ht?ht[1]:""),rt){ht=ut();if(null!=ht&&ht>parseFloat(ct)){et=String(ht);break t}}et=ct}var lt={};function ft(a){return t=a,e=function(){for(var t=0,e=Q(String(et)).split("."),n=Q(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=z(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||z(0==o[2].length,0==s[2].length)||z(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=lt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var pt=N.document&&rt&&(ut()||parseInt(et,10))||void 0,dt=!rt||9<=Number(pt),yt=rt&&!ft("9"),gt=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{N.addEventListener("test",D,e),N.removeEventListener("test",D,e)}catch(t){}return t}();function vt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(vt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{tt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:wt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}vt.prototype.b=function(){this.defaultPrevented=!0},U(mt,vt);var wt={2:"touch",3:"pen",4:"mouse"};mt.prototype.b=function(){mt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,yt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var bt="closure_listenable_"+(1e6*Math.random()|0),_t=0;function Et(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++_t,this.Y=this.Z=!1}function Tt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function It(t){this.src=t,this.a={},this.b=0}function At(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=q(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(Tt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function St(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}It.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=St(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Et(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Nt="closure_lm_"+(1e6*Math.random()|0),Dt={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Vt(r);return e&&e[bt]?e.wa(n,r,R(i)?!!i.capture:!!i,o):Rt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Vt(n),t&&t[bt]?t.va(e,n,R(r)?!!r.capture:!!r,i):Rt(t,e,n,!1,r,i)}function Rt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=R(i)?!!i.capture:!!i;if(s&&!dt)return null;var a,u,c=Mt(t);if(c||(t[Nt]=c=new It(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(a=Pt,r=u=dt?function(t){return a.call(u.src,u.listener,t)}:function(t){if(!(t=a.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)void 0===(i=!gt?s:i)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Lt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function kt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[bt]?At(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Lt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Mt(e))?(At(n,t),0==n.b&&(n.src=null,e[Nt]=null)):Tt(t)))}function Lt(t){return t in Dt?Dt[t]:Dt[t]="on"+t}function Ot(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&kt(t),n.call(r,e)}function Pt(t,e){if(t.Y)return!0;if(dt)return Ot(t,new mt(e,this));if(!e)t:{e=["window","event"];for(var n=N,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ot(t,e=new mt(e,this))}function Mt(t){return(t=t[Nt])instanceof It?t:null}var xt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Vt(e){return"function"==typeof e?e:(e[xt]||(e[xt]=function(t){return e.handleEvent(t)}),e[xt])}function Ut(){F.call(this),this.c=new It(this),(this.J=this).C=null}function Ft(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new vt(e,t):e instanceof vt?e.target=e.target||t:(s=e,Z(e=new vt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=qt(o,r,!0,e)&&s;if(s=qt(o=e.a=t,r,!0,e)&&s,s=qt(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=qt(o=e.a=n[i],r,!1,e)&&s}function qt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.Y&&u.capture==n&&(s=u.listener,a=u.ca||u.src,u.Z&&At(t.c,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}U(Ut,F),Ut.prototype[bt]=!0,(I=Ut.prototype).addEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},I.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=R(i)?!!i.capture:!!i,r=Vt(r),e&&e[bt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=St(s=e.a[n],r,i,o))&&(Tt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Mt(e))&&(n=e.a[n.toString()],(r=(e=-1)<(e=n?St(n,r,i,o):e)?n[e]:null)&&kt(r))}(this,t,e,n,r)},I.G=function(){if(Ut.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Tt(n[r]);delete e.a[t],e.b--}}this.C=null},I.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},I.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var jt=N.JSON.stringify;function Bt(){this.b=this.a=null}var Gt,Kt=(Ht.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Ht(function(){return new Qt},function(t){t.reset()}));function Ht(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Qt(){this.next=this.b=this.a=null}function Wt(t,e){var n;Gt||(n=N.Promise.resolve(void 0),Gt=function(){n.then(Yt)}),zt||(Gt(),zt=!0),Xt.add(t,e)}Bt.prototype.add=function(t,e){var n=Kt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Qt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var zt=!(Qt.prototype.reset=function(){this.next=this.b=this.a=null}),Xt=new Bt;function Yt(){for(var t,e;n=e=void 0,n=null,(e=Xt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){N.setTimeout(function(){throw t},0)}(t)}var n=Kt;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}zt=!1}function Jt(t,e){Ut.call(this),this.b=t||1,this.a=e||N,this.f=M(this.Za,this),this.g=V()}function $t(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==typeof t)n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:N.setTimeout(t,e||0)}U(Jt,Ut),(I=Jt.prototype).aa=!1,I.M=null,I.Za=function(){var t;this.aa&&(0<(t=V()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ft(this,"tick"),this.aa&&($t(this),this.start())))},I.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=V())},I.G=function(){Jt.X.G.call(this),$t(this),delete this.a};var te,ee,ne,re=(E(ee=oe,ne=te=F),ee.prototype=null===ne?Object.create(ne):(ie.prototype=ne.prototype,new ie),oe.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},oe.prototype.G=function(){te.prototype.G.call(this),this.a&&(N.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},oe);function ie(){this.constructor=ee}function oe(t,e){var n=te.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function se(t){F.call(this),this.b=t,this.a={}}U(se,F);var ae=[];function ue(t,e,n,r){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ce(t){Y(t.a,function(t,e){this.a.hasOwnProperty(e)&&kt(t)},t),t.a={}}function he(){this.a=!0}function le(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return jt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}se.prototype.G=function(){se.X.G.call(this),ce(this)},se.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},he.prototype.info=function(){};var fe={},pe=null;function de(){return pe=pe||new Ut}function ye(t){vt.call(this,fe.Fa,t)}function ge(t){var e=de();Ft(e,new ye(e))}function ve(t,e){vt.call(this,fe.STAT_EVENT,t),this.stat=e}function me(t){var e=de();Ft(e,new ve(e,t))}function we(t){vt.call(this,fe.Ga,t)}function be(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){t()},e)}fe.Fa="serverreachability",U(ye,vt),fe.STAT_EVENT="statevent",U(ve,vt),fe.Ga="timingevent",U(we,vt);var _e={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Ee={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Te(){}function Ie(t){var e;return e=!(e=t.a)?t.a={}:e}function Ae(){}Te.prototype.a=null;A={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function Se(){vt.call(this,"d")}function Ne(){vt.call(this,"c")}function De(){}function Ce(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new se(this),this.P=ke,t=ot?125:void 0,this.R=new Jt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}U(Se,vt),U(Ne,vt),U(De,Te);var Re=new De,ke=45e3,Le={},Oe={};function Pe(t,e,n){t.H=1,t.i=en(Xe(e)),t.j=n,t.I=!0,Me(t,null)}function Me(t,e){t.u=V(),Ve(t),t.l=Xe(t.i);var s,a,u,c,h,l,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),yn(n.b,"t",r),t.D=0,t.a=ur(t.g,t.g.C?e:null),0<t.O&&(t.F=new re(M(t.Ca,t,t.a),t.O)),ue(t.J,t.a,"readystatechange",t.Xa),e=t.B?J(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ge(1),s=t.c,a=t.m,u=t.l,c=t.f,h=t.S,l=t.j,s.info(function(){if(s.a)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function xe(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var a=(a=n,o=i=void 0,i=(r=t).D,-1==(o=a.indexOf("\n",i))?Oe:(i=Number(a.substring(i,o)),isNaN(i)?Le:(o+=1)+i>a.length?Oe:(a=a.substr(o,i),r.D=o+i,a)));if(a==Oe){4==e&&(t.h=4,me(14),s=!1),le(t.c,t.f,null,"[Incomplete Response]");break}if(a==Le){t.h=4,me(15),le(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}le(t.c,t.f,a,null),Be(t,a)}4==e&&0==n.length&&(t.h=1,me(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),tr(e),e.F=!0,me(11))):(le(t.c,t.f,n,"[Invalid Chunked Response]"),je(t),qe(t))}function Ve(t){t.T=V()+t.P,Ue(t,t.P)}function Ue(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=be(M(t.Va,t),e)}function Fe(t){t.o&&(N.clearTimeout(t.o),t.o=null)}function qe(t){0==t.g.v||t.A||rr(t.g,t)}function je(t){Fe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,$t(t.R),ce(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Be(t,e){try{var n,r,i,o,s,a=t.g;if(0!=a.v&&(a.a==t||En(a.b,t)))if(a.I=t.N,!t.C&&En(a.b,t)&&3==a.v){try{var u=a.ka.a.parse(e)}catch(t){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){t:if(!a.j){if(a.a){if(!(a.a.u+3e3<t.u))break t;nr(a),Hn(a)}Zn(a),me(18)}}else a.oa=c[1],0<a.oa-a.P&&c[2]<37500&&a.H&&0==a.o&&!a.m&&(a.m=be(M(a.Sa,a),6e3));if(_n(a.b)<=1&&a.ea){try{a.ea()}catch(t){}a.ea=void 0}}else or(a,11)}else if(!t.C&&a.a!=t||nr(a),!K(e))for(e=u=a.ka.a.parse(e),u=0;u<e.length;u++)c=e[u],a.P=c[0],c=c[1],2==a.v?"c"==c[0]?(a.J=c[1],a.ga=c[2],null!=(r=c[3])&&(a.ha=r,a.c.info("VER="+a.ha)),null!=(o=c[4])&&(a.pa=o,a.c.info("SVER="+a.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,a.D=n,a.c.info("backChannelRequestTimeoutMs_="+n)),n=a,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(W(r,"spdy")||W(r,"quic")||W(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(Tn(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,tn(n.B,n.A,s))),a.v=3,a.f&&a.f.ta(),a.U&&(a.N=V()-t.u,a.c.info("Handshake RTT: "+a.N+"ms")),i=t,(n=a).la=ar(n,n.C?n.ga:null,n.fa),i.C?(In(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Fe(o),Ve(o)),n.a=i):$n(n),0<a.g.length&&zn(a)):"stop"!=c[0]&&"close"!=c[0]||or(a,7):3==a.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?or(a,7):Kn(a):"noop"!=c[0]&&a.f&&a.f.sa(c),a.o=0);ge(4)}catch(t){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||"string"==typeof t)j(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(C(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ke(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ke)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Qe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(I=Ce.prototype).setTimeout=function(t){this.P=t},I.Xa=function(t){t=t.target;var e=this.F;e&&3==qn(t)?e.f():this.Ca(t)},I.Ca=function(t){try{if(t==this.a)t:{var e=qn(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!ot&&!this.a.$())){this.A||4!=e||7==n||ge(8==n||r<=0?3:2),Fe(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,r=this.c,u=this.m,c=this.l,h=this.f,l=this.S,f=e,p=i,r.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+l+"]: "+u+"\n"+c+"\n"+f+" "+p}),this.b){if(this.U&&!this.C){e:{if(this.a){var s=this.a;if((s=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,me(12),je(this),qe(this);break t}le(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Be(this,a)}this.I?(xe(this,e,o),ot&&this.b&&3==e&&(ue(this.J,this.R,"tick",this.Wa),this.R.start())):(le(this.c,this.f,o,null),Be(this,o)),4==e&&je(this),this.b&&!this.A&&(4==e?rr(this.g,this):(this.b=!1,Ve(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,me(12)):(this.h=0,me(13)),je(this),qe(this)}}}catch(t){}var u,c,h,l,f,p},I.Wa=function(){var t,e;this.a&&(t=qn(this.a),e=this.a.$(),this.D<e.length&&(Fe(this),xe(this,t,e),this.b&&4!=t&&Ve(this)))},I.cancel=function(){this.A=!0,je(this)},I.Va=function(){this.o=null;var t,e,n=V();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(ge(3),me(17)),je(this),this.h=2,qe(this)):Ue(this,this.T-n)},(I=Ke.prototype).K=function(){He(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},I.L=function(){return He(this),this.a.concat()},I.get=function(t,e){return Qe(this.b,t)?this.b[t]:e},I.set=function(t,e){Qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},I.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var We=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ze(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof ze?(this.a=void 0!==e?e:t.a,Ye(this,t.f),this.j=t.j,Je(this,t.c),$e(this,t.h),this.g=t.g,e=t.b,(n=new ln).c=e.c,e.a&&(n.a=new Ke(e.a),n.b=e.b),Ze(this,n),this.i=t.i):t&&(n=String(t).match(We))?(this.a=!!e,Ye(this,n[1]||"",!0),this.j=nn(n[2]||""),Je(this,n[3]||"",!0),$e(this,n[4]),this.g=nn(n[5]||"",!0),Ze(this,n[6]||"",!0),this.i=nn(n[7]||"")):(this.a=!!e,this.b=new ln(null,this.a))}function Xe(t){return new ze(t)}function Ye(t,e,n){t.f=n?nn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Je(t,e,n){t.c=n?nn(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ze(t,e,n){var r,i;e instanceof ln?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(fn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),yn(this,n,t))},r)),r.f=i):(n||(e=rn(e,cn)),t.b=new ln(e,t.a))}function tn(t,e,n){t.b.set(e,n)}function en(t){return tn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^V()).toString(36)),t}function nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,on),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function on(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(rn(e,sn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(rn(e,sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(rn(n,"/"==n.charAt(0)?un:an,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",rn(n,hn)),t.join("")};var sn=/[#\/\?@]/g,an=/[#\?:]/g,un=/[#\?]/g,cn=/[#\?@]/g,hn=/#/g;function ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function fn(n){n.a||(n.a=new Ke,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function pn(t,e){fn(t),e=gn(t,e),Qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Qe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&He(t)))}function dn(t,e){return fn(t),e=gn(t,e),Qe(t.a.b,e)}function yn(t,e,n){pn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),G(n)),t.b+=n.length)}function gn(t,e){return e=String(e),e=t.f?e.toLowerCase():e}(I=ln.prototype).add=function(t,e){fn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},I.forEach=function(n,r){fn(this),this.a.forEach(function(t,e){j(t,function(t){n.call(r,t,e,this)},this)},this)},I.L=function(){fn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},I.K=function(t){fn(this);var e=[];if("string"==typeof t)dn(this,t)&&(e=B(e,this.a.get(gn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},I.set=function(t,e){return fn(this),this.c=null,dn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},I.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},I.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var vn=function(t,e){this.b=t,this.a=e};function mn(t){this.g=t||wn,t=N.PerformanceNavigationTiming?0<(t=N.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(N.ia&&N.ia.ya&&N.ia.ya()&&N.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var wn=10;function bn(t){return t.b||t.a&&t.a.size>=t.f}function _n(t){return t.b?1:t.a?t.a.size:0}function En(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Tn(t,e){t.a?t.a.add(e):t.b=e}function In(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function An(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return G(t.c);var r=t.c;try{for(var i=T(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Sn(){}function Nn(){this.a=new Sn}function Dn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}mn.prototype.cancel=function(){var e,t;if(this.c=An(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=T(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Sn.prototype.stringify=function(t){return N.JSON.stringify(t,void 0)},Sn.prototype.parse=function(t){return N.JSON.parse(t,void 0)};var Cn=N.JSON.parse;function Rn(t){Ut.call(this),this.headers=new Ke,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=kn,this.D=this.F=!1}U(Rn,Ut);var kn="",Ln=/^https?$/i,On=["POST","PUT"];function Pn(t){return"content-type"==t.toLowerCase()}function Mn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,xn(t),Un(t)}function xn(t){t.u||(t.u=!0,Ft(t,"complete"),Ft(t,"error"))}function Vn(t){if(t.b&&void 0!==S&&(!t.s[1]||4!=qn(t)||2!=t.W()))if(t.l&&4==qn(t))Zt(t.za,0,t);else if(Ft(t,"readystatechange"),4==qn(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}(e=s)||((n=0===o)&&(!(i=String(t.B).match(We)[1]||null)&&N.self&&N.self.location&&(i=(r=N.self.location.protocol).substr(0,r.length-1)),n=!Ln.test(i?i.toLowerCase():"")),e=n);if(e)Ft(t,"complete"),Ft(t,"success");else{t.h=6;try{var a=2<qn(t)?t.a.statusText:""}catch(o){a=""}t.f=a+" ["+t.W()+"]",xn(t)}}finally{Un(t)}}}function Un(t,e){if(t.a){Fn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||Ft(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Fn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(N.clearTimeout(t.m),t.m=null)}function qn(t){return t.a?t.a.readyState:0}function jn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",Y(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):tn(t,e,n))}function Bn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.pa=0,this.g=[],this.c=new he,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=Bn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=Bn("baseRetryDelayMs",5e3,t),this.Ra=Bn("retryDelaySeedMs",1e4,t),this.Ma=Bn("forwardChannelMaxRetries",2,t),this.ma=Bn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new mn(t&&t.concurrentRequestLimit),this.ka=new Nn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Kn(t){var e,n;Qn(t),3==t.v&&(e=t.R++,tn(n=Xe(t.B),"SID",t.J),tn(n,"RID",e),tn(n,"TYPE","terminate"),Yn(t,n),(e=new Ce(t,t.c,e,void 0)).H=2,e.i=en(Xe(n)),n=!1,!(n=N.navigator&&N.navigator.sendBeacon?N.navigator.sendBeacon(e.i.toString(),""):n)&&N.Image&&((new Image).src=e.i,n=!0),n||(e.a=ur(e.g,null),e.a.ba(e.i)),e.u=V(),Ve(e)),sr(t)}function Hn(t){t.a&&(tr(t),t.a.cancel(),t.a=null)}function Qn(t){Hn(t),t.j&&(N.clearTimeout(t.j),t.j=null),nr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&N.clearTimeout(t.h),t.h=null)}function Wn(t,e){t.g.push(new vn(t.Oa++,e)),3==t.v&&zn(t)}function zn(t){bn(t.b)||t.h||(t.h=!0,Wt(t.Ba,t),t.u=0)}function Xn(t,e){var n=e?e.f:t.R++,r=Xe(t.B);tn(r,"SID",t.J),tn(r,"RID",n),tn(r,"AID",t.P),Yn(t,r),t.i&&t.l&&jn(r,t.i,t.l),n=new Ce(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Jn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Tn(t.b,n),Pe(n,r,e)}function Yn(t,n){t.f&&Ge({},function(t,e){tn(n,e,t)})}function Jn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?M(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{!function(t,r,e){var i=e||"";try{Ge(t,function(t,e){var n=t;R(t)&&(n=jt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function $n(t){t.a||t.j||(t.T=1,Wt(t.Aa,t),t.o=0)}function Zn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=be(M(t.Aa,t),ir(t,t.o)),t.o++,1)}function tr(t){null!=t.s&&(N.clearTimeout(t.s),t.s=null)}function er(t){t.a=new Ce(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Xe(t.la);tn(e,"RID","rpc"),tn(e,"SID",t.J),tn(e,"CI",t.H?"0":"1"),tn(e,"AID",t.P),Yn(t,e),tn(e,"TYPE","xmlhttp"),t.i&&t.l&&jn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=en(Xe(e)),n.j=null,n.I=!0,Me(n,t)}function nr(t){null!=t.m&&(N.clearTimeout(t.m),t.m=null)}function rr(t,e){var n,r,i,o=null;if(t.a==e){nr(t),tr(t),t.a=null;var s=2}else{if(!En(t.b,e))return;o=e.s,In(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=V()-e.u,n=t.u,Ft(s=de(),new we(s)),zn(t)):$n(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,_n((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=be(M(r.Ba,r,i),ir(r,r.u)),r.u++,0))))&&(2!=s||!Zn(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:or(t,5);break;case 4:or(t,10);break;case 3:or(t,6);break;default:or(t,2)}}function ir(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function or(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=M(t.Ya,t),r||(r=new ze("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Ye(r,"https"),en(r)),n=r.toString(),r=o,o=new he,N.Image?((i=new Image).onload=x(Dn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=x(Dn,o,i,"TestLoadImage: error",!1,r),i.onabort=x(Dn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=x(Dn,o,i,"TestLoadImage: timeout",!1,r),N.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):me(2),t.v=0,t.f&&t.f.ra(e),sr(t),Qn(t)}function sr(t){t.v=0,t.I=-1,t.f&&(0==An(t.b).length&&0==t.g.length||(t.b.c.length=0,G(t.g),t.g.length=0),t.f.qa())}function ar(t,e,n){var r,i,o,s,a,u=(s=n)instanceof ze?Xe(s):new ze(s,void 0);return""!=u.c?(e&&Je(u,e+"."+u.c),$e(u,u.h)):(a=N.location,r=a.protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new ze(null,void 0),r&&Ye(a,r),i&&Je(a,i),o&&$e(a,o),s&&(a.g=s),u=a),t.V&&Y(t.V,function(t,e){tn(u,e,t)}),e=t.A,n=t.na,e&&n&&tn(u,e,n),tn(u,"VER",t.ha),Yn(t,u),u}function ur(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Rn(t.Na)).F=t.C,e}function cr(){}function hr(){if(rt&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function lr(t,e){Ut.call(this),this.a=new Gn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new dr(this)}function fr(t){Se.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pr(){Ne.call(this),this.status=1}function dr(t){this.a=t}(I=Rn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Ie(this.H):Ie(Re),this.a.onreadystatechange=M(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Mn(this,t)}t=n||"";var i,o=new Ke(this.headers);r&&Ge(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Pn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=N.FormData&&t instanceof N.FormData,0<=q(On,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Fn(this),0<this.o&&((this.D=(i=this.a,rt&&ft(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=M(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Mn(this,t)}},I.xa=function(){void 0!==S&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ft(this,"timeout"),this.abort(8))},I.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ft(this,"complete"),Ft(this,"abort"),Un(this))},I.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Un(this,!0)),Rn.X.G.call(this)},I.za=function(){this.j||(this.A||this.l||this.g?Vn(this):this.Ua())},I.Ua=function(){Vn(this)},I.W=function(){try{return 2<qn(this)?this.a.status:-1}catch(t){return-1}},I.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},I.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Cn(e)}},I.ua=function(){return this.h},I.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(I=Gn.prototype).ha=8,I.v=1,I.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ce(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Z(r=J(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Jn(this,n,e),tn(i=Xe(this.B),"RID",t),tn(i,"CVER",22),this.A&&tn(i,"X-HTTP-Session-Id",this.A),Yn(this,i),this.i&&r&&jn(i,this.i,r),Tn(this.b,n),this.Ia&&tn(i,"TYPE","init"),this.da?(tn(i,"$req",e),tn(i,"SID","null"),n.U=!0,Pe(n,i,null)):Pe(n,i,e),this.v=2}}else 3==this.v&&(t?Xn(this,t):0==this.g.length||bn(this.b)||Xn(this))},I.Aa=function(){var t;this.j=null,er(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=be(M(this.Ta,this),t))},I.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,me(10),Hn(this),er(this))},I.Sa=function(){null!=this.m&&(this.m=null,Hn(this),Zn(this),me(19))},I.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),me(2)):(this.c.info("Failed to ping google.com"),me(1))},(I=cr.prototype).ta=function(){},I.sa=function(){},I.ra=function(){},I.qa=function(){},I.Ja=function(){},hr.prototype.a=function(t,e){return new lr(t,e)},U(lr,Ut),lr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;me(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=ar(t,null,t.fa),zn(t)},lr.prototype.close=function(){Kn(this.a)},lr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Wn(this.a,e)):this.l?((e={}).__data__=jt(t),Wn(this.a,e)):Wn(this.a,t)},lr.prototype.G=function(){this.a.f=null,delete this.f,Kn(this.a),delete this.a,lr.X.G.call(this)},U(fr,Se),U(pr,Ne),U(dr,cr),dr.prototype.ta=function(){Ft(this.a,"a")},dr.prototype.sa=function(t){Ft(this.a,new fr(t))},dr.prototype.ra=function(t){Ft(this.a,new pr)},dr.prototype.qa=function(){Ft(this.a,"b")},hr.prototype.createWebChannel=hr.prototype.a,lr.prototype.send=lr.prototype.h,lr.prototype.open=lr.prototype.g,_e.NO_ERROR=0,_e.TIMEOUT=8,_e.HTTP_ERROR=6,Ee.COMPLETE="complete",(Ae.EventType=A).OPEN="a",A.CLOSE="b",A.ERROR="c",A.MESSAGE="d",Ut.prototype.listen=Ut.prototype.va,Rn.prototype.listenOnce=Rn.prototype.wa,Rn.prototype.getLastError=Rn.prototype.Qa,Rn.prototype.getLastErrorCode=Rn.prototype.ua,Rn.prototype.getStatus=Rn.prototype.W,Rn.prototype.getResponseJson=Rn.prototype.Pa,Rn.prototype.getResponseText=Rn.prototype.$,Rn.prototype.send=Rn.prototype.ba;var yr=de,gr=_e,vr=Ee,mr=fe,wr=10,br=11,_r=Ae,Er=Rn,Tr=(Ir.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},Ir.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},Ir);function Ir(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Tr.o=-1;var Ar=new h("@firebase/firestore");function Sr(){return Ar.logLevel}function Nr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=a.DEBUG&&(e=n.map(Rr),Ar.debug.apply(Ar,s(["Firestore (8.3.1): "+t],e)))}function Dr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=a.ERROR&&(e=n.map(Rr),Ar.error.apply(Ar,s(["Firestore (8.3.1): "+t],e)))}function Cr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Ar.logLevel<=a.WARN&&(e=n.map(Rr),Ar.warn.apply(Ar,s(["Firestore (8.3.1): "+t],e)))}function Rr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function kr(t){t="FIRESTORE (8.3.1) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t);throw Dr(t),new Error(t)}function Lr(t){t||kr()}var Or=(Pr.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Pr);function Pr(){}function Mr(t,e){return t<e?-1:e<t?1:0}function xr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Vr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Ur(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Fr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function qr(t){return null==t}function jr(t){return 0===t&&1/t==-1/0}var Br,Gr,Kr,Hr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Qr=(n(ri,Kr=Error),ri),Ee=(Object.defineProperty(ni.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),ni.prototype.isEqual=function(t){return 0===ni.comparator(this,t)},ni.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ni?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},ni.prototype.limit=function(){return this.offset+this.length},ni.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},ni.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},ni.prototype.firstSegment=function(){return this.segments[this.offset]},ni.prototype.lastSegment=function(){return this.get(this.length-1)},ni.prototype.get=function(t){return this.segments[this.offset+t]},ni.prototype.isEmpty=function(){return 0===this.length},ni.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ni.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ni.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ni.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},ni.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ni),Wr=(n(ei,Gr=Ee),ei.prototype.construct=function(t,e,n){return new ei(t,e,n)},ei.prototype.canonicalString=function(){return this.toArray().join("/")},ei.prototype.toString=function(){return this.canonicalString()},ei.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new ei(n)},ei.emptyPath=function(){return new ei([])},ei),zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Xr=(n(ti,Br=Ee),ti.prototype.construct=function(t,e,n){return new ti(t,e,n)},ti.isValidIdentifier=function(t){return zr.test(t)},ti.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!ti.isValidIdentifier(t)?"`"+t+"`":t}).join(".")},ti.prototype.toString=function(){return this.canonicalString()},ti.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},ti.keyField=function(){return new ti(["__name__"])},ti.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Qr(Hr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Qr(Hr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Qr(Hr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ti(e)},ti.emptyPath=function(){return new ti([])},ti),Yr=(Zr.fromPath=function(t){return new Zr(Wr.fromString(t))},Zr.fromName=function(t){return new Zr(Wr.fromString(t).popFirst(5))},Zr.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Zr.prototype.isEqual=function(t){return null!==t&&0===Wr.comparator(this.path,t.path)},Zr.prototype.toString=function(){return this.path.toString()},Zr.comparator=function(t,e){return Wr.comparator(t.path,e.path)},Zr.isDocumentKey=function(t){return t.length%2==0},Zr.fromSegments=function(t){return new Zr(new Wr(t.slice()))},Zr),Jr=($r.fromBase64String=function(t){return new $r(atob(t))},$r.fromUint8Array=function(t){return new $r(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},$r.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},$r.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},$r.prototype.approximateByteSize=function(){return 2*this.binaryString.length},$r.prototype.compareTo=function(t){return Mr(this.binaryString,t.binaryString)},$r.prototype.isEqual=function(t){return this.binaryString===t.binaryString},$r);function $r(t){this.binaryString=t}function Zr(t){this.path=t}function ti(){return null!==Br&&Br.apply(this,arguments)||this}function ei(){return null!==Gr&&Gr.apply(this,arguments)||this}function ni(t,e,n){void 0===e?e=0:e>t.length&&kr(),void 0===n?n=t.length-e:n>t.length-e&&kr(),this.segments=t,this.offset=e,this.len=n}function ri(t,e){var n=this;return(n=Kr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Jr.EMPTY_BYTE_STRING=new Jr("");var ii=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oi(t){if(Lr(!!t),"string"!=typeof t)return{seconds:si(t.seconds),nanos:si(t.nanos)};var e=0,n=ii.exec(t);Lr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function si(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ai(t){return"string"==typeof t?Jr.fromBase64String(t):Jr.fromUint8Array(t)}var ui=(ci.now=function(){return ci.fromMillis(Date.now())},ci.fromDate=function(t){return ci.fromMillis(t.getTime())},ci.fromMillis=function(t){var e=Math.floor(t/1e3);return new ci(e,1e6*(t-1e3*e))},ci.prototype.toDate=function(){return new Date(this.toMillis())},ci.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ci.prototype._compareTo=function(t){return this.seconds===t.seconds?Mr(this.nanoseconds,t.nanoseconds):Mr(this.seconds,t.seconds)},ci.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ci.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ci.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},ci.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ci);function ci(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Qr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function hi(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function li(t){t=oi(t.mapValue.fields.__local_write_time__.timestampValue);return new ui(t.seconds,t.nanos)}function fi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?hi(t)?4:10:kr()}function pi(r,i){var t,e,n=fi(r);if(n!==fi(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return li(r).isEqual(li(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=oi(r.timestampValue),t=oi(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,ai(r.bytesValue).isEqual(ai(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,si((e=r).geoPointValue.latitude)===si(t.geoPointValue.latitude)&&si(e.geoPointValue.longitude)===si(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return si(t.integerValue)===si(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=si(t.doubleValue),e=si(e.doubleValue);return t===e?jr(t)===jr(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return xr(r.arrayValue.values||[],i.arrayValue.values||[],pi);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(Vr(e)!==Vr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!pi(e[t],n[t])))return!1;return!0}();default:return kr()}}function di(t,e){return void 0!==(t.values||[]).find(function(t){return pi(t,e)})}function yi(t,e){var n,r,i,o=fi(t),s=fi(e);if(o!==s)return Mr(o,s);switch(o){case 0:return 0;case 1:return Mr(t.booleanValue,e.booleanValue);case 2:return r=e,i=si(t.integerValue||t.doubleValue),r=si(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return gi(t.timestampValue,e.timestampValue);case 4:return gi(li(t),li(e));case 5:return Mr(t.stringValue,e.stringValue);case 6:return function(t,e){t=ai(t),e=ai(e);return t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Mr(n[i],r[i]);if(0!==o)return o}return Mr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=Mr(si(n.latitude),si(i.latitude)))?r:Mr(si(n.longitude),si(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=yi(n[i],r[i]);if(o)return o}return Mr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Mr(r[s],o[s]);if(0!==a)return a;a=yi(n[r[s]],i[o[s]]);if(0!==a)return a}return Mr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw kr()}}function gi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Mr(t,e);var n=oi(t),t=oi(e),e=Mr(n.seconds,t.seconds);return 0!==e?e:Mr(n.nanos,t.nanos)}function vi(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=oi(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ai(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,Yr.fromName(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):kr();var e}(t)}function mi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function wi(t){return t&&"integerValue"in t}function bi(t){return!!t&&"arrayValue"in t}function _i(t){return t&&"nullValue"in t}function Ei(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ti(t){return t&&"mapValue"in t}var Ii,Ai,Si,h=function(t,e){this.key=t,this.version=e},Ni=(n(Oi,Si=h),Oi.prototype.field=function(t){return this.objectValue.field(t)},Oi.prototype.data=function(){return this.objectValue},Oi.prototype.toProto=function(){return this.objectValue.proto},Oi.prototype.isEqual=function(t){return t instanceof Oi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.objectValue.isEqual(t.objectValue)},Oi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Oi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Oi),Di=(n(Li,Ai=h),Li.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Li.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Li.prototype.isEqual=function(t){return t instanceof Li&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Li),Ci=(n(ki,Ii=h),ki.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ki.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),ki.prototype.isEqual=function(t){return t instanceof ki&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ki),Ri=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ki(){return null!==Ii&&Ii.apply(this,arguments)||this}function Li(t,e,n){var r=this;return(r=Ai.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Oi(t,e,n,r){var i=this;return(i=Si.call(this,t,e)||this).objectValue=n,i.hasLocalMutations=!!r.hasLocalMutations,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Pi(t,e,n,r,i,o,s){return new Ri(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Mi(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.canonicalString()+t.op.toString()+vi(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.canonicalString()+t.dir}).join(","),qr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=ho(e.startAt)),e.endAt&&(t+="|ub:",t+=ho(e.endAt)),e.h=t),e.h}function xi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!pi(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!po(t.startAt,e.startAt)&&po(t.endAt,e.endAt)}function Vi(t){return Yr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ui,Fi=(n(qi,Ui=function(){}),qi.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Ki(t,e,n):"array-contains"===e?new eo(t,n):"in"===e?new no(t,n):"not-in"===e?new ro(t,n):"array-contains-any"===e?new io(t,n):new qi(t,e,n)},qi.l=function(t,e,n){return new("in"===e?Hi:Qi)(t,n)},qi.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this.m(yi(t,this.value)):null!==t&&fi(this.value)===fi(t)&&this.m(yi(t,this.value))},qi.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return kr()}},qi.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},qi);function qi(t,e,n){var r=this;return(r=Ui.call(this)||this).field=t,r.op=e,r.value=n,r}var ji,Bi,Gi,Ki=(n(Xi,Gi=Fi),Xi.prototype.matches=function(t){t=Yr.comparator(t.key,this.key);return this.m(t)},Xi),Hi=(n(zi,Bi=Fi),zi.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},zi),Qi=(n(Wi,ji=Fi),Wi.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Wi);function Wi(t,e){var n=this;return(n=ji.call(this,t,"not-in",e)||this).keys=Yi(0,e),n}function zi(t,e){var n=this;return(n=Bi.call(this,t,"in",e)||this).keys=Yi(0,e),n}function Xi(t,e,n){var r=this;return(r=Gi.call(this,t,e,n)||this).key=Yr.fromName(n.referenceValue),r}function Yi(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return Yr.fromName(t.referenceValue)})}var Ji,$i,Zi,to,eo=(n(co,to=Fi),co.prototype.matches=function(t){t=t.field(this.field);return bi(t)&&di(t.arrayValue,this.value)},co),no=(n(uo,Zi=Fi),uo.prototype.matches=function(t){t=t.field(this.field);return null!==t&&di(this.value.arrayValue,t)},uo),ro=(n(ao,$i=Fi),ao.prototype.matches=function(t){if(di(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!di(this.value.arrayValue,t)},ao),io=(n(so,Ji=Fi),so.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!bi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return di(e.value.arrayValue,t)})},so),oo=function(t,e){this.position=t,this.before=e};function so(t,e){return Ji.call(this,t,"array-contains-any",e)||this}function ao(t,e){return $i.call(this,t,"not-in",e)||this}function uo(t,e){return Zi.call(this,t,"in",e)||this}function co(t,e){return to.call(this,t,"array-contains",e)||this}function ho(t){return(t.before?"b":"a")+":"+t.position.map(vi).join(",")}var lo=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function fo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?Yr.comparator(Yr.fromName(s.referenceValue),n.key):yi(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function po(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!pi(t.position[n],e.position[n]))return!1;return!0}var yo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function go(t){return new yo(t)}function vo(t){return!qr(t.limit)&&"F"===t.limitType}function mo(t){return!qr(t.limit)&&"L"===t.limitType}function wo(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function bo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function _o(t){return null!==t.collectionGroup}function Eo(t){var e=t;if(null===e.p){e.p=[];var n=bo(e),t=wo(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new lo(n)),e.p.push(new lo(Xr.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new lo(Xr.keyField(),n)))}}return e.p}function To(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Pi(e.path,e.collectionGroup,Eo(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Eo(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new lo(o.field,s))}var a=e.endAt?new oo(e.endAt.position,!e.endAt.before):null,t=e.startAt?new oo(e.startAt.position,!e.startAt.before):null;e.T=Pi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function Io(t,e,n){return new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ao(t,e){return xi(To(t),To(e))&&t.limitType===e.limitType}function So(t){return Mi(To(t))+"|lt:"+t.limitType}function No(t){return"Query(target="+(e=To(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.canonicalString()+" "+t.op+" "+vi(t.value)}).join(", ")+"]"),qr(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+ho(e.startAt)),e.endAt&&(n+=", endAt: "+ho(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function Do(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Yr.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||fo(t.startAt,Eo(t),n))&&(!t.endAt||!fo(t.endAt,Eo(t),n)));var e,n}function Co(a){return function(t,e){for(var n=!1,r=0,i=Eo(a);r<i.length;r++){var o=i[r],s=function(t,r,e){var n=t.field.isKeyField()?Yr.comparator(r.key,e.key):function(t,e){var n=r.field(t),t=e.field(t);return null!==n&&null!==t?yi(n,t):kr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return kr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}var Ro=(Vo.fromTimestamp=function(t){return new Vo(t)},Vo.min=function(){return new Vo(new ui(0,0))},Vo.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Vo.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Vo.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Vo.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Vo.prototype.toTimestamp=function(){return this.timestamp},Vo),ko=(xo.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},xo.prototype.isEqual=function(t){return xr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},xo),Lo=(Mo.empty=function(){return new Mo({mapValue:{}})},Mo.prototype.field=function(t){if(t.isEmpty())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ti(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},Mo.prototype.isEqual=function(t){return pi(this.proto,t.proto)},Mo),Oo=(Po.prototype.set=function(t,e){return this.R(t,e),this},Po.prototype.delete=function(t){return this.R(t,null),this},Po.prototype.R=function(t,e){for(var n=this.A,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===fi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.lastSegment(),e)},Po.prototype.v=function(){var t=this.P(Xr.emptyPath(),this.A);return null!=t?new Lo(t):this.I},Po.prototype.P=function(r,t){var i=this,o=!1,e=this.I.field(r),s=Ti(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.P(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Po);function Po(t){void 0===t&&(t=Lo.empty()),this.I=t,this.A=new Map}function Mo(t){this.proto=t}function xo(t){(this.fields=t).sort(Xr.comparator)}function Vo(t){this.timestamp=t}function Uo(t,e){if(t.V){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jr(e)?"-0":e}}function Fo(t){return{integerValue:""+t}}function qo(t,e){return"number"==typeof(n=e)&&Number.isInteger(n)&&!jr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER?Fo(e):Uo(t,e);var n}Ee=function(){this._=void 0};function jo(t,e){return t instanceof ts?wi(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var Bo,Go,Ko=(n(Wo,Go=Ee),Wo),Ho=(n(Qo,Bo=Ee),Qo);function Qo(t){var e=this;return(e=Bo.call(this)||this).elements=t,e}function Wo(){return null!==Go&&Go.apply(this,arguments)||this}function zo(t,e){for(var n=rs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return pi(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var Xo,Yo=(n(Jo,Xo=Ee),Jo);function Jo(t){var e=this;return(e=Xo.call(this)||this).elements=t,e}function $o(t,e){for(var n=rs(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!pi(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Zo,ts=(n(es,Zo=Ee),es);function es(t,e){var n=this;return(n=Zo.call(this)||this).D=t,n.S=e,n}function ns(t){return si(t.integerValue||t.doubleValue)}function rs(t){return bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function is(t,e){this.field=t,this.transform=e}function os(t,e){this.version=t,this.transformResults=e}var ss=(as.none=function(){return new as},as.exists=function(t){return new as(void 0,t)},as.updateTime=function(t){return new as(t)},Object.defineProperty(as.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),as.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},as);function as(t,e){this.updateTime=t,this.exists=e}function us(t,e){return void 0!==t.updateTime?e instanceof Ni&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Ni}h=function(){};function cs(t,e,n){return t instanceof ds?function(t,e,n){if(!us(t.precondition,e))return e;var r=t.value,n=bs(t.fieldTransforms,n,e),r=_s(t.fieldTransforms,r,n),e=ls(e);return new Ni(t.key,e,r,{hasLocalMutations:!0})}(t,e,n):t instanceof ys?function(t,e,n){if(!us(t.precondition,e))return e;var r=ls(e),e=ms(t,e,bs(t.fieldTransforms,n,e));return new Ni(t.key,r,e,{hasLocalMutations:!0})}(t,e,n):(e=e,us((t=t).precondition,e)?new Di(t.key,Ro.min()):e)}function hs(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&xr(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Ho&&e instanceof Ho||t instanceof Yo&&e instanceof Yo?xr(t.elements,e.elements,pi):t instanceof ts&&e instanceof ts?pi(t.S,e.S):t instanceof Ko&&e instanceof Ko)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function ls(t){return t instanceof Ni?t.version:Ro.min()}var fs,ps,ds=(n(vs,ps=h),vs),ys=(n(gs,fs=h),gs);function gs(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=fs.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function vs(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=ps.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function ms(t,e,n){var r,i,o;return i=t,e=r=e instanceof Ni?e.data():Lo.empty(),o=new Oo(e),i.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(null!==(e=i.data.field(t))?o.set(t,e):o.delete(t))}),r=o.v(),_s(t.fieldTransforms,r,n)}function ws(t,e,n){var r=[];Lr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=null;e instanceof Ni&&(a=e.field(o.field)),r.push((o=s,s=a,a=n[i],o instanceof Ho?zo(o,s):o instanceof Yo?$o(o,s):a))}return r}function bs(t,e,n){for(var r,i=[],o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=null;n instanceof Ni&&(c=n.field(a.field)),i.push((r=c,a=e,c=void 0,(u=u)instanceof Ko?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof Ho?zo(u,r):u instanceof Yo?$o(u,r):(u=jo(c=u,r),r=ns(u)+ns(c.S),wi(u)&&wi(c.S)?Fo(r):Uo(c.D,r))))}return i}function _s(t,e,n){for(var r=new Oo(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.v()}function Es(t){this.count=t}var Ts,Is,As,Ss=(n(Cs,As=h),Cs),Ns=(n(Ds,Is=h),Ds);function Ds(t,e){var n=this;return(n=Is.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Cs(t,e){var n=this;return(n=As.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Rs(t){switch(t){case Hr.OK:return kr(),0;case Hr.CANCELLED:case Hr.UNKNOWN:case Hr.DEADLINE_EXCEEDED:case Hr.RESOURCE_EXHAUSTED:case Hr.INTERNAL:case Hr.UNAVAILABLE:case Hr.UNAUTHENTICATED:return;case Hr.INVALID_ARGUMENT:case Hr.NOT_FOUND:case Hr.ALREADY_EXISTS:case Hr.PERMISSION_DENIED:case Hr.FAILED_PRECONDITION:case Hr.ABORTED:case Hr.OUT_OF_RANGE:case Hr.UNIMPLEMENTED:case Hr.DATA_LOSS:return 1;default:return kr(),0}}function ks(t){if(void 0===t)return Dr("GRPC error has no .code"),Hr.UNKNOWN;switch(t){case Ts.OK:return Hr.OK;case Ts.CANCELLED:return Hr.CANCELLED;case Ts.UNKNOWN:return Hr.UNKNOWN;case Ts.DEADLINE_EXCEEDED:return Hr.DEADLINE_EXCEEDED;case Ts.RESOURCE_EXHAUSTED:return Hr.RESOURCE_EXHAUSTED;case Ts.INTERNAL:return Hr.INTERNAL;case Ts.UNAVAILABLE:return Hr.UNAVAILABLE;case Ts.UNAUTHENTICATED:return Hr.UNAUTHENTICATED;case Ts.INVALID_ARGUMENT:return Hr.INVALID_ARGUMENT;case Ts.NOT_FOUND:return Hr.NOT_FOUND;case Ts.ALREADY_EXISTS:return Hr.ALREADY_EXISTS;case Ts.PERMISSION_DENIED:return Hr.PERMISSION_DENIED;case Ts.FAILED_PRECONDITION:return Hr.FAILED_PRECONDITION;case Ts.ABORTED:return Hr.ABORTED;case Ts.OUT_OF_RANGE:return Hr.OUT_OF_RANGE;case Ts.UNIMPLEMENTED:return Hr.UNIMPLEMENTED;case Ts.DATA_LOSS:return Hr.DATA_LOSS;default:return kr()}}(Ee=Ts=Ts||{})[Ee.OK=0]="OK",Ee[Ee.CANCELLED=1]="CANCELLED",Ee[Ee.UNKNOWN=2]="UNKNOWN",Ee[Ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ee[Ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ee[Ee.NOT_FOUND=5]="NOT_FOUND",Ee[Ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ee[Ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ee[Ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ee[Ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ee[Ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ee[Ee.ABORTED=10]="ABORTED",Ee[Ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ee[Ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ee[Ee.INTERNAL=13]="INTERNAL",Ee[Ee.UNAVAILABLE=14]="UNAVAILABLE",Ee[Ee.DATA_LOSS=15]="DATA_LOSS";var Ls=(Vs.prototype.insert=function(t,e){return new Vs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ps.BLACK,null,null))},Vs.prototype.remove=function(t){return new Vs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ps.BLACK,null,null))},Vs.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Vs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Vs.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Vs.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Vs.prototype.minKey=function(){return this.root.minKey()},Vs.prototype.maxKey=function(){return this.root.maxKey()},Vs.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Vs.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},Vs.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Vs.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Vs.prototype.getIterator=function(){return new Os(this.root,null,this.comparator,!1)},Vs.prototype.getIteratorFrom=function(t){return new Os(this.root,t,this.comparator,!1)},Vs.prototype.getReverseIterator=function(){return new Os(this.root,null,this.comparator,!0)},Vs.prototype.getReverseIteratorFrom=function(t){return new Os(this.root,t,this.comparator,!0)},Vs),Os=(xs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},xs.prototype.hasNext=function(){return 0<this.nodeStack.length},xs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},xs),Ps=(Ms.prototype.copy=function(t,e,n,r,i){return new Ms(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ms.prototype.isEmpty=function(){return!1},Ms.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},Ms.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},Ms.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},Ms.prototype.minKey=function(){return this.min().key},Ms.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},Ms.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},Ms.prototype.removeMin=function(){if(this.left.isEmpty())return Ms.EMPTY;var t=this;return(t=(t=!t.left.isRed()&&!t.left.left.isRed()?t.moveRedLeft():t).copy(null,null,null,t.left.removeMin(),null)).fixUp()},Ms.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=!(r.left.isEmpty()||r.left.isRed()||r.left.left.isRed())?r.moveRedLeft():r).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=!((r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed())?r.moveRedRight():r).key)){if(r.right.isEmpty())return Ms.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},Ms.prototype.isRed=function(){return this.color},Ms.prototype.fixUp=function(){var t=this;return t=(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},Ms.prototype.moveRedLeft=function(){var t=this.colorFlip();return t=t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},Ms.prototype.moveRedRight=function(){var t=this.colorFlip();return t=t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},Ms.prototype.rotateLeft=function(){var t=this.copy(null,null,Ms.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ms.prototype.rotateRight=function(){var t=this.copy(null,null,Ms.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ms.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ms.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},Ms.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw kr();if(this.right.isRed())throw kr();var t=this.left.check();if(t!==this.right.check())throw kr();return t+(this.isRed()?0:1)},Ms);function Ms(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ms.RED,this.left=null!=r?r:Ms.EMPTY,this.right=null!=i?i:Ms.EMPTY,this.size=this.left.size+1+this.right.size}function xs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Vs(t,e){this.comparator=t,this.root=e||Ps.EMPTY}function Us(){this.size=0}Ps.EMPTY=null,Ps.RED=!0,Ps.BLACK=!1,Ps.EMPTY=(Object.defineProperty(Us.prototype,"key",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Us.prototype,"value",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Us.prototype,"color",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Us.prototype,"left",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Object.defineProperty(Us.prototype,"right",{get:function(){throw kr()},enumerable:!1,configurable:!0}),Us.prototype.copy=function(t,e,n,r,i){return this},Us.prototype.insert=function(t,e,n){return new Ps(t,e)},Us.prototype.remove=function(t,e){return this},Us.prototype.isEmpty=function(){return!0},Us.prototype.inorderTraversal=function(t){return!1},Us.prototype.reverseTraversal=function(t){return!1},Us.prototype.minKey=function(){return null},Us.prototype.maxKey=function(){return null},Us.prototype.isRed=function(){return!1},Us.prototype.checkMaxDepth=function(){return!0},Us.prototype.check=function(){return 0},new Us);var Fs=(Gs.prototype.has=function(t){return null!==this.data.get(t)},Gs.prototype.first=function(){return this.data.minKey()},Gs.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Gs.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Gs.prototype.indexOf=function(t){return this.data.indexOf(t)},Gs.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Gs.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Gs.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Gs.prototype.firstAfterOrEqual=function(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null},Gs.prototype.getIterator=function(){return new qs(this.data.getIterator())},Gs.prototype.getIteratorFrom=function(t){return new qs(this.data.getIteratorFrom(t))},Gs.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Gs.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Gs.prototype.isEmpty=function(){return this.data.isEmpty()},Gs.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Gs.prototype.isEqual=function(t){if(!(t instanceof Gs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Gs.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Gs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Gs.prototype.copy=function(t){var e=new Gs(this.comparator);return e.data=t,e},Gs),qs=(Bs.prototype.getNext=function(){return this.iter.getNext().key},Bs.prototype.hasNext=function(){return this.iter.hasNext()},Bs),js=new Ls(Yr.comparator);function Bs(t){this.iter=t}function Gs(t){this.comparator=t,this.data=new Ls(this.comparator)}var Ks=new Ls(Yr.comparator);var Hs=new Ls(Yr.comparator);var Qs=new Fs(Yr.comparator);function Ws(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Qs,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var zs=new Fs(Mr);var Xs=(oa.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,Ys.createSynthesizedTargetChangeForCurrentChange(t,e)),new oa(Ro.min(),n,zs,js,Ws())},oa),Ys=(ia.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new ia(Jr.EMPTY_BYTE_STRING,e,Ws(),Ws(),Ws())},ia),Js=function(t,e,n,r){this.C=t,this.removedTargetIds=e,this.key=n,this.N=r},$s=function(t,e){this.targetId=t,this.$=e},Zs=function(t,e,n,r){void 0===n&&(n=Jr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ta=(Object.defineProperty(ra.prototype,"current",{get:function(){return this.M},enumerable:!1,configurable:!0}),Object.defineProperty(ra.prototype,"resumeToken",{get:function(){return this.k},enumerable:!1,configurable:!0}),Object.defineProperty(ra.prototype,"B",{get:function(){return 0!==this.F},enumerable:!1,configurable:!0}),Object.defineProperty(ra.prototype,"q",{get:function(){return this.L},enumerable:!1,configurable:!0}),ra.prototype.U=function(t){0<t.approximateByteSize()&&(this.L=!0,this.k=t)},ra.prototype.K=function(){var n=Ws(),r=Ws(),i=Ws();return this.O.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:kr()}}),new Ys(this.k,this.M,n,r,i)},ra.prototype.W=function(){this.L=!1,this.O=aa()},ra.prototype.j=function(t,e){this.L=!0,this.O=this.O.insert(t,e)},ra.prototype.G=function(t){this.L=!0,this.O=this.O.remove(t)},ra.prototype.H=function(){this.F+=1},ra.prototype.J=function(){--this.F},ra.prototype.Y=function(){this.L=!0,this.M=!0},ra),ea=(na.prototype.st=function(t){for(var e=0,n=t.C;e<n.length;e++){var r=n[e];t.N instanceof Ni?this.it(r,t.N):t.N instanceof Di&&this.rt(r,t.key,t.N)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.rt(r,t.key,t.N)},na.prototype.ot=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ct(t);switch(n.state){case 0:r.at(t)&&e.U(n.resumeToken);break;case 1:e.J(),e.B||e.W(),e.U(n.resumeToken);break;case 2:e.J(),e.B||r.removeTarget(t);break;case 3:r.at(t)&&(e.Y(),e.U(n.resumeToken));break;case 4:r.at(t)&&(r.ut(t),e.U(n.resumeToken));break;default:kr()}})},na.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Z.forEach(function(t,e){r.at(e)&&n(e)})},na.prototype.ht=function(t){var e=t.targetId,n=t.$.count,t=this.lt(e);t&&(Vi(t=t.target)?0===n?(t=new Yr(t.path),this.rt(e,t,new Di(t,Ro.min()))):Lr(1===n):this.ft(e)!==n&&(this.ut(e),this.nt=this.nt.add(e)))},na.prototype.dt=function(r){var i=this,o=new Map;this.Z.forEach(function(t,e){var n=i.lt(e);n&&(t.current&&Vi(n.target)&&(n=new Yr(n.target.path),null!==i.tt.get(n)||i.wt(e,n)||i.rt(e,n,new Di(n,r))),t.q&&(o.set(e,t.K()),t.W()))});var s=Ws();this.et.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){t=i.lt(t);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new Xs(r,o,this.nt,this.tt,s);return this.tt=js,this.et=sa(),this.nt=new Fs(Mr),t},na.prototype.it=function(t,e){var n;this.at(t)&&(n=this.wt(t,e.key)?2:0,this.ct(t).j(e.key,n),this.tt=this.tt.insert(e.key,e),this.et=this.et.insert(e.key,this._t(e.key).add(t)))},na.prototype.rt=function(t,e,n){var r;this.at(t)&&(r=this.ct(t),this.wt(t,e)?r.j(e,1):r.G(e),this.et=this.et.insert(e,this._t(e).delete(t)),n&&(this.tt=this.tt.insert(e,n)))},na.prototype.removeTarget=function(t){this.Z.delete(t)},na.prototype.ft=function(t){var e=this.ct(t).K();return this.X.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},na.prototype.H=function(t){this.ct(t).H()},na.prototype.ct=function(t){var e=this.Z.get(t);return e||(e=new ta,this.Z.set(t,e)),e},na.prototype._t=function(t){var e=this.et.get(t);return e||(e=new Fs(Mr),this.et=this.et.insert(t,e)),e},na.prototype.at=function(t){var e=null!==this.lt(t);return e||Nr("WatchChangeAggregator","Detected inactive target",t),e},na.prototype.lt=function(t){var e=this.Z.get(t);return e&&e.B?null:this.X.yt(t)},na.prototype.ut=function(e){var n=this;this.Z.set(e,new ta),this.X.getRemoteKeysForTarget(e).forEach(function(t){n.rt(e,t,null)})},na.prototype.wt=function(t,e){return this.X.getRemoteKeysForTarget(t).has(e)},na);function na(t){this.X=t,this.Z=new Map,this.tt=js,this.et=sa(),this.nt=new Fs(Mr)}function ra(){this.F=0,this.O=aa(),this.k=Jr.EMPTY_BYTE_STRING,this.M=!1,this.L=!0}function ia(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function oa(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function sa(){return new Ls(Yr.comparator)}function aa(){return new Ls(Yr.comparator)}var ua={asc:"ASCENDING",desc:"DESCENDING"},ca={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ha=function(t,e){this.databaseId=t,this.V=e};function la(t,e){return t.V?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function fa(t,e){return t.V?e.toBase64():e.toUint8Array()}function pa(t){return Lr(!!t),Ro.fromTimestamp((t=oi(t),new ui(t.seconds,t.nanos)))}function da(t,e){return new Wr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function ya(t){t=Wr.fromString(t);return Lr(ka(t)),t}function ga(t,e){return da(t.databaseId,e.path)}function va(t,e){e=ya(e);if(e.get(1)!==t.databaseId.projectId)throw new Qr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Qr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new Yr(ba(e))}function ma(t,e){return da(t.databaseId,e)}function wa(t){return new Wr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ba(t){return Lr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function _a(t,e,n){return{name:ga(t,e),fields:n.proto.mapValue.fields}}function Ea(t,e){var n,r,i;if(e instanceof ds)n={update:_a(t,e.key,e.value)};else if(e instanceof Ss)n={delete:ga(t,e.key)};else if(e instanceof ys)n={update:_a(t,e.key,e.data),updateMask:(i=e.fieldMask,r=[],i.fields.forEach(function(t){return r.push(t.canonicalString())}),{fieldPaths:r})};else{if(!(e instanceof Ns))return kr();n={verify:ga(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Ko)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ho)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof Yo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof ts)return{fieldPath:t.field.canonicalString(),increment:e.S};throw kr()})),e.precondition.isNone||(n.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:(e=t,t=i.updateTime,la(e,t.toTimestamp()))}:void 0!==i.exists?{exists:i.exists}:kr()),n}function Ta(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ma(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ma(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(Ei(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NAN"}};if(_i(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Ei(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NOT_NAN"}};if(_i(t.value))return{unaryFilter:{field:Na(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Na(t.field),op:(e=t.op,ca[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Na((t=t).field),direction:(t=t.dir,ua[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.V||qr(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Aa(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Aa(e.endAt)),n}function Ia(t){var e=4===(o=ya(t.parent)).length?Wr.emptyPath():ba(o),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Lr(1===r),(s=n.from[0]).allDescendants?i=s.collectionId:e=e.child(s.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[Ra(t)]:void 0!==t.fieldFilter?[Ca(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):kr():[]}(n.where));t=[];n.orderBy&&(t=n.orderBy.map(function(t){return new lo(Da((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));r=null;n.limit&&(r=qr(a="object"==typeof(a=n.limit)?a.value:a)?null:a);var s=null;n.startAt&&(s=Sa(n.startAt));var a=null;return n.endAt&&(a=Sa(n.endAt)),new yo(e,i,t,o,r,"F",s,a)}function Aa(t){return{before:t.before,values:t.position}}function Sa(t){var e=!!t.before,t=t.values||[];return new oo(t,e)}function Na(t){return{fieldPath:t.canonicalString()}}function Da(t){return Xr.fromServerFormat(t.fieldPath)}function Ca(t){return Fi.create(Da(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return kr()}}(),t.fieldFilter.value)}function Ra(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Da(t.unaryFilter.field);return Fi.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=Da(t.unaryFilter.field);return Fi.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Da(t.unaryFilter.field);return Fi.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Da(t.unaryFilter.field);return Fi.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return kr()}}function ka(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var h=(Ma.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},Ma.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},Ma),La=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},Oa=(Pa.prototype.catch=function(t){return this.next(void 0,t)},Pa.prototype.next=function(r,i){var o=this;return this.callbackAttached&&kr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new Pa(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},Pa.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Pa.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof Pa?e:Pa.resolve(e)}catch(t){return Pa.reject(t)}},Pa.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Pa.resolve(e)},Pa.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):Pa.reject(e)},Pa.resolve=function(n){return new Pa(function(t,e){t(n)})},Pa.reject=function(n){return new Pa(function(t,e){e(n)})},Pa.waitFor=function(t){return new Pa(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Pa.or=function(t){for(var n=Pa.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?Pa.resolve(t):e()})}(r[e]);return n},Pa.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},Pa);function Pa(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function Ma(){this.onCommittedListeners=[]}function xa(t){return"IndexedDbTransactionError"===t.name}function Va(t){this.Kt=t}var Ua=(Ga.prototype.applyToRemoteDocument=function(t,e,n){for(var r,i,o,s,a,u,c=n.mutationResults,h=0;h<this.mutations.length;h++){var l=this.mutations[h];l.key.isEqual(t)&&(r=l,i=e,o=c[h],l=u=a=s=void 0,e=r instanceof ds?(a=o,u=(s=r).value,l=ws(s.fieldTransforms,i,a.transformResults),u=_s(s.fieldTransforms,u,l),new Ni(s.key,a.version,u,{hasCommittedMutations:!0})):r instanceof ys?function(t,e,n){if(!us(t.precondition,e))return new Ci(t.key,n.version);e=ms(t,e,ws(t.fieldTransforms,e,n.transformResults));return new Ni(t.key,n.version,e,{hasCommittedMutations:!0})}(r,i,o):new Di(r.key,o.version,{hasCommittedMutations:!0}))}return e},Ga.prototype.applyToLocalView=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(t)&&(e=cs(i,e,this.localWriteTime));for(var i,o=0,s=this.mutations;o<s.length;o++)(i=s[o]).key.isEqual(t)&&(e=cs(i,e,this.localWriteTime));return e},Ga.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Ga.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ws())},Ga.prototype.isEqual=function(t){return this.batchId===t.batchId&&xr(this.mutations,t.mutations,hs)&&xr(this.baseMutations,t.baseMutations,hs)},Ga),Fa=(Ba.from=function(t,e,n){Lr(t.mutations.length===n.length);for(var r=Hs,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Ba(t,e,n,r)},Ba),qa=(ja.prototype.withSequenceNumber=function(t){return new ja(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},ja.prototype.withResumeToken=function(t,e){return new ja(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},ja.prototype.withLastLimboFreeSnapshotVersion=function(t){return new ja(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},ja);function ja(t,e,n,r,i,o,s){void 0===i&&(i=Ro.min()),void 0===o&&(o=Ro.min()),void 0===s&&(s=Jr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ba(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Ga(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Ka(t){var e=Ia({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Io(e,e.limit,"L"):e}var Ha=(Ya.prototype.addToCollectionParentIndex=function(t,e){return this.Wt.add(e),Oa.resolve()},Ya.prototype.getCollectionParents=function(t,e){return Oa.resolve(this.Wt.getEntries(e))},Ya),Qa=(Xa.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Fs(Wr.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},Xa.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast(),e=this.index[e];return e&&e.has(t)},Xa.prototype.getEntries=function(t){return(this.index[t]||new Fs(Wr.comparator)).toArray()},Xa),Wa=(za.prototype.next=function(){return this.te+=2,this.te},za.ee=function(){return new za(0)},za.ne=function(){return new za(-1)},za);function za(t){this.te=t}function Xa(){this.index={}}function Ya(){this.Wt=new Qa}function Ja(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==Hr.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;return Nr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function $a(t,e){this.progress=t,this.En=e}var Za=(cu.prototype.get=function(t){var e=this.mapKeyFn(t),e=this.inner[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,t))return i}},cu.prototype.has=function(t){return void 0!==this.get(t)},cu.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},cu.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},cu.prototype.forEach=function(s){Ur(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},cu.prototype.isEmpty=function(){return Fr(this.inner)},cu),Ee=(uu.prototype.getReadTime=function(t){t=this.changes.get(t);return t?t.readTime:Ro.min()},uu.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{maybeDocument:t,readTime:e})},uu.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{maybeDocument:null,readTime:e})},uu.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Oa.resolve(n.maybeDocument):this.getFromCache(t,e)},uu.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},uu.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},uu.prototype.assertNotApplied=function(){},uu),tu=(au.prototype.In=function(e,n){var r=this;return this.Tn.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.An(e,n,t)})},au.prototype.An=function(t,r,i){return this.ze.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},au.prototype.Rn=function(t,e,i){var o=js;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},au.prototype.bn=function(e,t){var n=this;return this.ze.getEntries(e,t).next(function(t){return n.vn(e,t)})},au.prototype.vn=function(e,r){var i=this;return this.Tn.getAllMutationBatchesAffectingDocumentKeys(e,r).next(function(t){var t=i.Rn(e,r,t),n=js;return t.forEach(function(t,e){e=e||new Di(t,Ro.min()),n=n.insert(t,e)}),n})},au.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,Yr.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Pn(t,e.path):_o(e)?this.Vn(t,e,n):this.Sn(t,e,n);var r},au.prototype.Pn=function(t,e){return this.In(t,new Yr(e)).next(function(t){var e=Ks;return e=t instanceof Ni?e.insert(t.key,t):e})},au.prototype.Vn=function(n,r,i){var o=this,s=r.collectionGroup,a=Ks;return this.Gt.getCollectionParents(n,s).next(function(t){return Oa.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new yo(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.Sn(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},au.prototype.Sn=function(e,n,t){var u,c,r=this;return this.ze.getDocumentsMatchingQuery(e,n,t).next(function(t){return u=t,r.Tn.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return c=t,r.Dn(e,c,u).next(function(t){u=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,s=cs(s,u.get(a),r.localWriteTime);u=s instanceof Ni?u.insert(a,s):u.remove(a)}})}).next(function(){return u.forEach(function(t,e){Do(n,e)||(u=u.remove(t))}),u})},au.prototype.Dn=function(t,e,n){for(var r=Ws(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ys&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.ze.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ni&&(c=c.insert(t,e))}),c})},au),eu=(su.Nn=function(t,e){for(var n=Ws(),r=Ws(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new su(t,e.fromCache,n,r)},su),nu=(ou.prototype.$n=function(t){this.Fn=t},ou.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Ro.min())?this.On(e,r):this.Fn.bn(e,o).next(function(t){var n=s.kn(r,t);return(vo(r)||mo(r))&&s.Mn(r.limitType,n,o,i)?s.On(e,r):(Sr()<=a.DEBUG&&Nr("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),No(r)),s.Fn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},ou.prototype.kn=function(n,t){var r=new Fs(Co(n));return t.forEach(function(t,e){e instanceof Ni&&Do(n,e)&&(r=r.add(e))}),r},ou.prototype.Mn=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.compareTo(r))},ou.prototype.On=function(t,e){return Sr()<=a.DEBUG&&Nr("QueryEngine","Using full collection scan to execute query:",No(e)),this.Fn.getDocumentsMatchingQuery(t,e,Ro.min())},ou),ru=(iu.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.Bn)})},iu);function iu(t,e,n,r){this.persistence=t,this.Ln=e,this.D=r,this.Bn=new Ls(Mr),this.qn=new Za(Mi,xi),this.Un=Ro.min(),this.Tn=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.Ge=t.getTargetCache(),this.Kn=new tu(this.Qn,this.Tn,this.persistence.getIndexManager()),this.He=t.getBundleCache(),this.Ln.$n(this.Kn)}function ou(){}function su(t,e,n,r){this.targetId=t,this.fromCache=e,this.Cn=n,this.xn=r}function au(t,e,n){this.ze=t,this.Tn=e,this.Gt=n}function uu(){this.changes=new Za(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function cu(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function hu(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Tn,m=e.Kn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var v;return e.Tn.getAllMutationBatches(g).next(function(t){return v=t,n=e.persistence.getMutationQueue(o),m=new tu(e.Qn,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=Ws(),i=0,o=v;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var p=0,d=f.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.bn(g,r).next(function(t){return{Wn:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e.Tn=n,e.Kn=m,e.Ln.$n(e.Kn),r)]}})})}function lu(t,h){var l=t;return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,a,u=h.batch.keys(),c=l.Qn.newChangeBuffer({trackRemovals:!0});return e=l,r=t,o=c,s=(i=h).batch,n=s.keys(),a=Oa.resolve(),n.forEach(function(n){a=a.next(function(){return o.getEntry(r,n)}).next(function(t){var e=t,t=i.docVersions.get(n);Lr(null!==t),(!e||e.version.compareTo(t)<0)&&(e=s.applyToRemoteDocument(n,e,i))&&o.addEntry(e,i.commitVersion)})}),a.next(function(){return e.Tn.removeMutationBatch(r,s)}).next(function(){return c.apply(t)}).next(function(){return l.Tn.performConsistencyCheck(t)}).next(function(){return l.Kn.bn(t,u)})})}function fu(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ge.getLastRemoteSnapshotVersion(t)})}function pu(t,r){var u=t,c=r.snapshotVersion,h=u.Bn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.Qn.newChangeBuffer({trackRemovals:!0});h=u.Bn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.Ge.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.Ge.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,Lr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.Ge.updateTargetData(s,n))))});var e,n=js;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(du(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(Ro.min())||(e=u.Ge.getLastRemoteSnapshotVersion(s).next(function(t){return u.Ge.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),Oa.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Kn.vn(s,n)})}).then(function(t){return u.Bn=h,t})}function du(t,s,e,a,u){var n=Ws();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=js;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e instanceof Di&&e.version.isEqual(Ro.min())?(s.removeEntry(t,r),o=o.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):Nr("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function yu(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ge.getTargetData(e,r).next(function(t){return t?(n=t,Oa.resolve(n)):i.Ge.allocateTargetId(e).next(function(t){return n=new qa(r,t,0,e.currentSequenceNumber),i.Ge.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.Bn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.Bn=i.Bn.insert(t.targetId,t),i.qn.set(r,t.targetId)),t})}function gu(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).Bn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!xa(r=t.sent()))throw r;return Nr("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Bn=e.Bn.remove(o),e.qn.delete(n.target),[2]}})})}function vu(t,o,s){var a=t,u=Ro.min(),c=Ws();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=To(o),(void 0!==(t=(i=t).qn.get(r))?Oa.resolve(i.Bn.get(t)):i.Ge.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.Ge.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.Ln.getDocumentsMatchingQuery(e,o,s?u:Ro.min(),s?c:Ws())}).next(function(t){return{documents:t,jn:c}});var t,n,r,i})}var mu,wu,bu=(ju.prototype.getBundleMetadata=function(t,e){return Oa.resolve(this.Jn.get(e))},ju.prototype.saveBundleMetadata=function(t,e){return this.Jn.set(e.id,{id:e.id,version:e.version,createTime:pa(e.createTime)}),Oa.resolve()},ju.prototype.getNamedQuery=function(t,e){return Oa.resolve(this.Yn.get(e))},ju.prototype.saveNamedQuery=function(t,e){return this.Yn.set(e.name,{name:(e=e).name,query:Ka(e.bundledQuery),readTime:pa(e.readTime)}),Oa.resolve()},ju),_u=(qu.prototype.isEmpty=function(){return this.Xn.isEmpty()},qu.prototype.addReference=function(t,e){e=new Eu(t,e);this.Xn=this.Xn.add(e),this.ts=this.ts.add(e)},qu.prototype.ns=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},qu.prototype.removeReference=function(t,e){this.ss(new Eu(t,e))},qu.prototype.rs=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},qu.prototype.os=function(t){var e=this,n=new Yr(new Wr([])),r=new Eu(n,t),t=new Eu(n,t+1),i=[];return this.ts.forEachInRange([r,t],function(t){e.ss(t),i.push(t.key)}),i},qu.prototype.cs=function(){var e=this;this.Xn.forEach(function(t){return e.ss(t)})},qu.prototype.ss=function(t){this.Xn=this.Xn.delete(t),this.ts=this.ts.delete(t)},qu.prototype.us=function(t){var e=new Yr(new Wr([])),n=new Eu(e,t),t=new Eu(e,t+1),r=Ws();return this.ts.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},qu.prototype.containsKey=function(t){var e=new Eu(t,0),e=this.Xn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)},qu),Eu=(Fu.Zn=function(t,e){return Yr.comparator(t.key,e.key)||Mr(t.hs,e.hs)},Fu.es=function(t,e){return Mr(t.hs,e.hs)||Yr.comparator(t.key,e.key)},Fu),Tu=(Uu.prototype.checkEmpty=function(t){return Oa.resolve(0===this.Tn.length)},Uu.prototype.addMutationBatch=function(t,e,n,r){var i=this.ls;this.ls++,0<this.Tn.length&&this.Tn[this.Tn.length-1];n=new Ua(i,e,n,r);this.Tn.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.fs=this.fs.add(new Eu(a.key,i)),this.Gt.addToCollectionParentIndex(t,a.key.path.popLast())}return Oa.resolve(n)},Uu.prototype.lookupMutationBatch=function(t,e){return Oa.resolve(this.ds(e))},Uu.prototype.getNextMutationBatchAfterBatchId=function(t,e){e+=1,e=this.ws(e),e=e<0?0:e;return Oa.resolve(this.Tn.length>e?this.Tn[e]:null)},Uu.prototype.getHighestUnacknowledgedBatchId=function(){return Oa.resolve(0===this.Tn.length?-1:this.ls-1)},Uu.prototype.getAllMutationBatches=function(t){return Oa.resolve(this.Tn.slice())},Uu.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new Eu(e,0),e=new Eu(e,Number.POSITIVE_INFINITY),i=[];return this.fs.forEachInRange([r,e],function(t){t=n.ds(t.hs);i.push(t)}),Oa.resolve(i)},Uu.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Fs(Mr);return e.forEach(function(t){var e=new Eu(t,0),t=new Eu(t,Number.POSITIVE_INFINITY);n.fs.forEachInRange([e,t],function(t){r=r.add(t.hs)})}),Oa.resolve(this._s(r))},Uu.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;Yr.isDocumentKey(e)||(e=e.child(""));var e=new Eu(new Yr(e),0),i=new Fs(Mr);return this.fs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.hs)),!0)},e),Oa.resolve(this._s(i))},Uu.prototype._s=function(t){var e=this,n=[];return t.forEach(function(t){t=e.ds(t);null!==t&&n.push(t)}),n},Uu.prototype.removeMutationBatch=function(n,r){var i=this;Lr(0===this.ys(r.batchId,"removed")),this.Tn.shift();var o=this.fs;return Oa.forEach(r.mutations,function(t){var e=new Eu(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.fs=o})},Uu.prototype.Xt=function(t){},Uu.prototype.containsKey=function(t,e){var n=new Eu(e,0),n=this.fs.firstAfterOrEqual(n);return Oa.resolve(e.isEqual(n&&n.key))},Uu.prototype.performConsistencyCheck=function(t){return this.Tn.length,Oa.resolve()},Uu.prototype.ys=function(t,e){return this.ws(t)},Uu.prototype.ws=function(t){return 0===this.Tn.length?0:t-this.Tn[0].batchId},Uu.prototype.ds=function(t){t=this.ws(t);return t<0||t>=this.Tn.length?null:this.Tn[t]},Uu),Iu=(Vu.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.gs(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:i,readTime:n}),this.size+=i-o,this.Gt.addToCollectionParentIndex(t,r.path.popLast())},Vu.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Vu.prototype.getEntry=function(t,e){e=this.docs.get(e);return Oa.resolve(e?e.maybeDocument:null)},Vu.prototype.getEntries=function(t,e){var n=this,r=js;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),Oa.resolve(r)},Vu.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Ks,i=new Yr(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,s=u.maybeDocument,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||s instanceof Ni&&Do(e,s)&&(r=r.insert(s.key,s))}return Oa.resolve(r)},Vu.prototype.ps=function(t,e){return Oa.forEach(this.docs,function(t){return e(t)})},Vu.prototype.newChangeBuffer=function(t){return new Au(this)},Vu.prototype.getSize=function(t){return Oa.resolve(this.size)},Vu),Au=(n(xu,wu=Ee),xu.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e&&e.maybeDocument?i.push(r.Ve.addEntry(n,e.maybeDocument,r.getReadTime(t))):r.Ve.removeEntry(t)}),Oa.waitFor(i)},xu.prototype.getFromCache=function(t,e){return this.Ve.getEntry(t,e)},xu.prototype.getAllFromCache=function(t,e){return this.Ve.getEntries(t,e)},xu),Su=(Mu.prototype.forEachTarget=function(t,n){return this.Es.forEach(function(t,e){return n(e)}),Oa.resolve()},Mu.prototype.getLastRemoteSnapshotVersion=function(t){return Oa.resolve(this.lastRemoteSnapshotVersion)},Mu.prototype.getHighestSequenceNumber=function(t){return Oa.resolve(this.Ts)},Mu.prototype.allocateTargetId=function(t){return this.highestTargetId=this.As.next(),Oa.resolve(this.highestTargetId)},Mu.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ts&&(this.Ts=e),Oa.resolve()},Mu.prototype.re=function(t){this.Es.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.As=new Wa(e),this.highestTargetId=e),t.sequenceNumber>this.Ts&&(this.Ts=t.sequenceNumber)},Mu.prototype.addTargetData=function(t,e){return this.re(e),this.targetCount+=1,Oa.resolve()},Mu.prototype.updateTargetData=function(t,e){return this.re(e),Oa.resolve()},Mu.prototype.removeTargetData=function(t,e){return this.Es.delete(e.target),this.Is.os(e.targetId),--this.targetCount,Oa.resolve()},Mu.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.Es.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Es.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),Oa.waitFor(a).next(function(){return s})},Mu.prototype.getTargetCount=function(t){return Oa.resolve(this.targetCount)},Mu.prototype.getTargetData=function(t,e){e=this.Es.get(e)||null;return Oa.resolve(e)},Mu.prototype.addMatchingKeys=function(t,e,n){return this.Is.ns(e,n),Oa.resolve()},Mu.prototype.removeMatchingKeys=function(e,t,n){this.Is.rs(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),Oa.waitFor(i)},Mu.prototype.removeMatchingKeysForTargetId=function(t,e){return this.Is.os(e),Oa.resolve()},Mu.prototype.getMatchingKeysForTargetId=function(t,e){e=this.Is.us(e);return Oa.resolve(e)},Mu.prototype.containsKey=function(t,e){return Oa.resolve(this.Is.containsKey(e))},Mu),Nu=(Pu.prototype.start=function(){return Promise.resolve()},Pu.prototype.shutdown=function(){return this.Le=!1,Promise.resolve()},Object.defineProperty(Pu.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),Pu.prototype.setDatabaseDeletedListener=function(){},Pu.prototype.setNetworkEnabled=function(){},Pu.prototype.getIndexManager=function(){return this.Gt},Pu.prototype.getMutationQueue=function(t){var e=this.Rs[t.toKey()];return e||(e=new Tu(this.Gt,this.referenceDelegate),this.Rs[t.toKey()]=e),e},Pu.prototype.getTargetCache=function(){return this.Ge},Pu.prototype.getRemoteDocumentCache=function(){return this.ze},Pu.prototype.getBundleCache=function(){return this.He},Pu.prototype.runTransaction=function(t,e,n){var r=this;Nr("MemoryPersistence","Starting transaction:",t);var i=new Du(this.Me.next());return this.referenceDelegate.vs(),n(i).next(function(t){return r.referenceDelegate.Ps(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Pu.prototype.Vs=function(e,n){return Oa.or(Object.values(this.Rs).map(function(t){return function(){return t.containsKey(e,n)}}))},Pu),Du=(n(Ou,mu=h),Ou),Cu=(Lu.Cs=function(t){return new Lu(t)},Object.defineProperty(Lu.prototype,"xs",{get:function(){if(this.Ds)return this.Ds;throw kr()},enumerable:!1,configurable:!0}),Lu.prototype.addReference=function(t,e,n){return this.Ss.addReference(n,e),this.xs.delete(n.toString()),Oa.resolve()},Lu.prototype.removeReference=function(t,e,n){return this.Ss.removeReference(n,e),this.xs.add(n.toString()),Oa.resolve()},Lu.prototype.markPotentiallyOrphaned=function(t,e){return this.xs.add(e.toString()),Oa.resolve()},Lu.prototype.removeTarget=function(t,e){var n=this;this.Ss.os(e.targetId).forEach(function(t){return n.xs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.xs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Lu.prototype.vs=function(){this.Ds=new Set},Lu.prototype.Ps=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Oa.forEach(this.xs,function(t){var e=Yr.fromPath(t);return r.Ns(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Ds=null,i.apply(n)})},Lu.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ns(t,e).next(function(t){t?n.xs.delete(e.toString()):n.xs.add(e.toString())})},Lu.prototype.bs=function(t){return 0},Lu.prototype.Ns=function(t,e){var n=this;return Oa.or([function(){return Oa.resolve(n.Ss.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Vs(t,e)}])},Lu),Ru=(ku.prototype.isAuthenticated=function(){return null!=this.uid},ku.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},ku.prototype.isEqual=function(t){return t.uid===this.uid},ku);function ku(t){this.uid=t}function Lu(t){this.persistence=t,this.Ss=new _u,this.Ds=null}function Ou(t){var e=this;return(e=mu.call(this)||this).currentSequenceNumber=t,e}function Pu(t,e){var n=this;this.Rs={},this.Me=new Tr(0),this.Le=!1,this.Le=!0,this.referenceDelegate=t(this),this.Ge=new Su(this),this.Gt=new Ha,this.ze=(t=this.Gt,new Iu(t,function(t){return n.referenceDelegate.bs(t)})),this.D=new Va(e),this.He=new bu(this.D)}function Mu(t){this.persistence=t,this.Es=new Za(Mi,xi),this.lastRemoteSnapshotVersion=Ro.min(),this.highestTargetId=0,this.Ts=0,this.Is=new _u,this.targetCount=0,this.As=Wa.ee()}function xu(t){var e=this;return(e=wu.call(this)||this).Ve=t,e}function Vu(t,e){this.Gt=t,this.gs=e,this.docs=new Ls(Yr.comparator),this.size=0}function Uu(t,e){this.Gt=t,this.referenceDelegate=e,this.Tn=[],this.ls=1,this.fs=new Fs(Eu.Zn)}function Fu(t,e){this.key=t,this.hs=e}function qu(){this.Xn=new Fs(Eu.Zn),this.ts=new Fs(Eu.es)}function ju(t){this.D=t,this.Jn=new Map,this.Yn=new Map}Ru.UNAUTHENTICATED=new Ru(null),Ru.GOOGLE_CREDENTIALS=new Ru("google-credentials-uid"),Ru.FIRST_PARTY=new Ru("first-party-uid");var Bu,Gu=(nc.prototype.Os=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},nc.prototype.ks=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},nc.prototype.Fs=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},nc),Ku=(ec.prototype.addPendingMutation=function(t){},ec.prototype.updateMutationState=function(t,e,n){},ec.prototype.addLocalQueryTarget=function(t){return this.yi.Os(t),this.gi[t]||"not-current"},ec.prototype.updateQueryState=function(t,e,n){this.gi[t]=e},ec.prototype.removeLocalQueryTarget=function(t){this.yi.ks(t)},ec.prototype.isLocalQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},ec.prototype.clearQueryState=function(t){delete this.gi[t]},ec.prototype.getAllActiveQueryTargets=function(){return this.yi.activeTargetIds},ec.prototype.isActiveQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},ec.prototype.start=function(){return this.yi=new Gu,Promise.resolve()},ec.prototype.handleUserChange=function(t,e,n){},ec.prototype.setOnlineState=function(t){},ec.prototype.shutdown=function(){},ec.prototype.writeSequenceNumber=function(t){},ec.prototype.notifyBundleLoaded=function(){},ec),Hu=(tc.prototype.pi=function(t){},tc.prototype.shutdown=function(){},tc),Qu=(Zu.prototype.pi=function(t){this.Ri.push(t)},Zu.prototype.shutdown=function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ii)},Zu.prototype.bi=function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ii)},Zu.prototype.Ti=function(){Nr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(0)},Zu.prototype.Ai=function(){Nr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(1)},Zu.At=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},Zu),Wu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},zu=($u.prototype.Vi=function(t){this.Si=t},$u.prototype.Di=function(t){this.Ci=t},$u.prototype.onMessage=function(t){this.xi=t},$u.prototype.close=function(){this.Pi()},$u.prototype.send=function(t){this.vi(t)},$u.prototype.Ni=function(){this.Si()},$u.prototype.$i=function(t){this.Ci(t)},$u.prototype.Fi=function(t){this.xi(t)},$u),Xu=(Ju.prototype.Mi=function(e,t,n,r){var i=this.Li(e,t);Nr("RestConnection","Sending: ",i,n);t={};return this.Bi(t,r),this.qi(e,i,t,n).then(function(t){return Nr("RestConnection","Received: ",t),t},function(t){throw Cr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Ju.prototype.Ui=function(t,e,n,r){return this.Mi(t,e,n,r)},Ju.prototype.Bi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.1",t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},Ju.prototype.Li=function(t,e){t=Wu[t];return this.Oi+"/v1/"+e+":"+t},n(Yu,Bu=Ju),Yu.prototype.qi=function(o,e,s,a){return new Promise(function(n,r){var i=new Er;i.listenOnce(vr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case gr.NO_ERROR:var t=i.getResponseJson();Nr("Connection","XHR received:",JSON.stringify(t)),n(t);break;case gr.TIMEOUT:Nr("Connection",'RPC "'+o+'" timed out'),r(new Qr(Hr.DEADLINE_EXCEEDED,"Request time out"));break;case gr.HTTP_ERROR:var e=i.getStatus();Nr("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(Hr).indexOf(e)?e:Hr.UNKNOWN,r(new Qr(e,t.message))):r(new Qr(Hr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Qr(Hr.UNAVAILABLE,"Connection failed."));break;default:kr()}}finally{Nr("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(a);i.send(e,"POST",t,s,15)})},Yu.prototype.Qi=function(t,e){var n,r=[this.Oi,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new hr,o=yr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Bi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=f().indexOf("Electron/")||(0<=(n=f()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=f().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Nr("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new zu({vi:function(t){u?Nr("Connection","Not sending because WebChannel is closed:",t):(a||(Nr("Connection","Opening WebChannel transport."),s.open(),a=!0),Nr("Connection","WebChannel sending:",t),s.send(t))},Pi:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,_r.EventType.OPEN,function(){u||Nr("Connection","WebChannel transport opened.")}),t(s,_r.EventType.CLOSE,function(){u||(u=!0,Nr("Connection","WebChannel transport closed"),c.$i())}),t(s,_r.EventType.ERROR,function(t){u||(u=!0,Cr("Connection","WebChannel transport errored:",t),c.$i(new Qr(Hr.UNAVAILABLE,"The operation could not be completed")))}),t(s,_r.EventType.MESSAGE,function(t){var e,n,r,i;u||(Lr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Nr("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Ts[r];if(void 0!==t)return ks(t)}(),i=n.message,void 0===t&&(t=Hr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.$i(new Qr(t,i)),s.close()):(Nr("Connection","WebChannel received:",e),c.Fi(e)))}),t(o,mr.STAT_EVENT,function(t){t.stat===wr?Nr("Connection","Detected buffering proxy"):t.stat===br&&Nr("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Ni()},0),c},Yu);function Yu(t){var e=this;return(e=Bu.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e}function Ju(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Oi=e+"://"+t.host,this.ki="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function $u(t){this.vi=t.vi,this.Pi=t.Pi}function Zu(){var t=this;this.Ei=function(){return t.Ti()},this.Ii=function(){return t.Ai()},this.Ri=[],this.bi()}function tc(){}function ec(){this.yi=new Gu,this.gi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function nc(){this.activeTargetIds=zs}function rc(){return"undefined"!=typeof document?document:null}function ic(t){return new ha(t,!0)}function oc(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.qr=[],this.Ur=new Map,this.Qr=new Set,this.Kr=[],this.Wr=i,this.Wr.pi(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Dc(this)?(Nr("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Qr.add(4),[4,_c(e)];case 1:return t.sent(),e.jr.set("Unknown"),e.Qr.delete(4),[4,bc(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.jr=new pc(n,r)}var sc,ac,uc,cc=(wc.prototype.reset=function(){this.Gi=0},wc.prototype.Ji=function(){this.Gi=this.ji},wc.prototype.Yi=function(t){var e=this;this.cancel();var n=Math.floor(this.Gi+this.Xi()),r=Math.max(0,Date.now()-this.Hi),i=Math.max(0,n-r);0<i&&Nr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Gi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zi=this.Fe.enqueueAfterDelay(this.timerId,i,function(){return e.Hi=Date.now(),t()}),this.Gi*=this.Wi,this.Gi<this.Ki&&(this.Gi=this.Ki),this.Gi>this.ji&&(this.Gi=this.ji)},wc.prototype.Zi=function(){null!==this.zi&&(this.zi.skipDelay(),this.zi=null)},wc.prototype.cancel=function(){null!==this.zi&&(this.zi.cancel(),this.zi=null)},wc.prototype.Xi=function(){return(Math.random()-.5)*this.Gi},wc),Ee=(mc.prototype.cr=function(){return 1===this.state||2===this.state||4===this.state},mc.prototype.ar=function(){return 2===this.state},mc.prototype.start=function(){3!==this.state?this.auth():this.ur()},mc.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.cr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},mc.prototype.hr=function(){this.state=0,this.rr.reset()},mc.prototype.lr=function(){var t=this;this.ar()&&null===this.ir&&(this.ir=this.Fe.enqueueAfterDelay(this.tr,6e4,function(){return t.dr()}))},mc.prototype.wr=function(t){this._r(),this.stream.send(t)},mc.prototype.dr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.ar()?[2,this.close(0)]:[2]})})},mc.prototype._r=function(){this.ir&&(this.ir.cancel(),this.ir=null)},mc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():n&&n.code===Hr.RESOURCE_EXHAUSTED?(Dr(n.toString()),Dr("Using maximum backoff delay to prevent overloading the backend."),this.rr.Ji()):n&&n.code===Hr.UNAUTHENTICATED&&this.nr.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Di(n)];case 1:return t.sent(),[2]}})})},mc.prototype.mr=function(){},mc.prototype.auth=function(){var n=this;this.state=1;var t=this.yr(this.sr),e=this.sr;this.nr.getToken().then(function(t){n.sr===e&&n.gr(t)},function(e){t(function(){var t=new Qr(Hr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.pr(t)})})},mc.prototype.gr=function(t){var e=this,n=this.yr(this.sr);this.stream=this.Er(t),this.stream.Vi(function(){n(function(){return e.state=2,e.listener.Vi()})}),this.stream.Di(function(t){n(function(){return e.pr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},mc.prototype.ur=function(){var t=this;this.state=4,this.rr.Yi(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},mc.prototype.pr=function(t){return Nr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},mc.prototype.yr=function(e){var n=this;return function(t){n.Fe.enqueueAndForget(function(){return n.sr===e?t():(Nr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},mc),hc=(n(vc,uc=Ee),vc.prototype.Er=function(t){return this.er.Qi("Listen",t)},vc.prototype.onMessage=function(t){this.rr.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:kr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.V?(Lr(void 0===s||"string"==typeof s),Jr.fromBase64String(s||"")):(Lr(void 0===s||s instanceof Uint8Array),Jr.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Hr.UNKNOWN:ks(c.code),new Qr(u,c.message||"")),s=new Zs(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=va(t,n.document.name),i=pa(n.document.updateTime),a=new Lo({mapValue:{fields:n.document.fields}}),u=(o=new Ni(r,i,a,{}),n.targetIds||[]),c=n.removedTargetIds||[];s=new Js(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=va(t,n.document),i=n.readTime?pa(n.readTime):Ro.min(),a=new Di(r,i),o=n.removedTargetIds||[],s=new Js([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=va(t,n.document),i=n.removedTargetIds||[],s=new Js([],i,r,null);else{if(!("filter"in e))return kr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new Es(n),i=e.targetId,s=new $s(i,r)}return s}(this.D,t),t=function(t){if(!("targetChange"in t))return Ro.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?pa(t.readTime):Ro.min()}(t);return this.listener.Tr(e,t)},vc.prototype.Ir=function(t){var e,n,r,i={};i.database=wa(this.D),i.addTarget=(e=this.D,(r=Vi(r=(n=t).target)?{documents:{documents:[ma(e,r.path)]}}:{query:Ta(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=fa(e,n.resumeToken):0<n.snapshotVersion.compareTo(Ro.min())&&(r.readTime=la(e,n.snapshotVersion.toTimestamp())),r);var o,t=(this.D,o=t,null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return kr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.wr(i)},vc.prototype.Ar=function(t){var e={};e.database=wa(this.D),e.removeTarget=t,this.wr(e)},vc),lc=(n(gc,ac=Ee),Object.defineProperty(gc.prototype,"br",{get:function(){return this.Rr},enumerable:!1,configurable:!0}),gc.prototype.start=function(){this.Rr=!1,this.lastStreamToken=void 0,ac.prototype.start.call(this)},gc.prototype.mr=function(){this.Rr&&this.vr([])},gc.prototype.Er=function(t){return this.er.Qi("Write",t)},gc.prototype.onMessage=function(t){if(Lr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Lr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?pa(e.updateTime):pa(n)).isEqual(Ro.min())&&(t=pa(n)),new os(t,e.transformResults||[]);var e,n})):[]),n=pa(t.commitTime);return this.listener.Pr(n,e)}var n,r;return Lr(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()},gc.prototype.Sr=function(){var t={};t.database=wa(this.D),this.wr(t)},gc.prototype.vr=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ea(e.D,t)})};this.wr(t)},gc),fc=(n(yc,sc=function(){}),yc.prototype.Cr=function(){if(this.Dr)throw new Qr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},yc.prototype.Mi=function(e,n,r){var i=this;return this.Cr(),this.credentials.getToken().then(function(t){return i.er.Mi(e,n,r,t)}).catch(function(t){throw t.code===Hr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},yc.prototype.Ui=function(e,n,r){var i=this;return this.Cr(),this.credentials.getToken().then(function(t){return i.er.Ui(e,n,r,t)}).catch(function(t){throw t.code===Hr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},yc.prototype.terminate=function(){this.Dr=!1},yc),pc=(dc.prototype.Or=function(){var t=this;0===this.Nr&&(this.kr("Unknown"),this.$r=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.$r=null,t.Mr("Backend didn't respond within 10 seconds."),t.kr("Offline"),Promise.resolve()}))},dc.prototype.Lr=function(t){"Online"===this.state?this.kr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr("Connection failed 1 times. Most recent error: "+t.toString()),this.kr("Offline")))},dc.prototype.set=function(t){this.Br(),this.Nr=0,"Online"===t&&(this.Fr=!1),this.kr(t)},dc.prototype.kr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},dc.prototype.Mr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fr?(Dr(t),this.Fr=!1):Nr("OnlineStateTracker",t)},dc.prototype.Br=function(){null!==this.$r&&(this.$r.cancel(),this.$r=null)},dc);function dc(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.$r=null,this.Fr=!0}function yc(t,e,n){var r=this;return(r=sc.call(this)||this).credentials=t,r.er=e,r.D=n,r.Dr=!1,r}function gc(t,e,n,r,i){var o=this;return(o=ac.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).D=r,o.Rr=!1,o}function vc(t,e,n,r,i){var o=this;return(o=uc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).D=r,o}function mc(t,e,n,r,i,o){this.Fe=t,this.tr=n,this.er=r,this.nr=i,this.listener=o,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new cc(t,e)}function wc(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Fe=t,this.timerId=e,this.Ki=n,this.Wi=r,this.ji=i,this.Gi=0,this.zi=null,this.Hi=Date.now(),this.reset()}function bc(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!Dc(r))return[3,4];e=0,n=r.Kr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function _c(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Kr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Ec(t,e){t.Ur.has(e.targetId)||(t.Ur.set(e.targetId,e),Nc(t)?Sc(t):xc(t).ar()&&Ic(t,e))}function Tc(t,e){var n=t,t=xc(n);n.Ur.delete(e),t.ar()&&Ac(n,e),0===n.Ur.size&&(t.ar()?t.lr():Dc(n)&&n.jr.set("Unknown"))}function Ic(t,e){t.Gr.H(e.targetId),xc(t).Ir(e)}function Ac(t,e){t.Gr.H(e),xc(t).Ar(e)}function Sc(e){e.Gr=new ea({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},yt:function(t){return e.Ur.get(t)||null}}),xc(e).start(),e.jr.Or()}function Nc(t){return Dc(t)&&!xc(t).cr()&&0<t.Ur.size}function Dc(t){return 0===t.Qr.size}function Cc(t){t.Gr=void 0}function Rc(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.jr.set("Online"),!(a instanceof Zs&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Ur.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Ur.delete(i),o.Gr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Nr("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,kc(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof Js?s.Gr.st(a):a instanceof $s?s.Gr.ht(a):s.Gr.ot(a),u.isEqual(Ro.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,fu(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,(i=u,(e=(r=s).Gr.dt(i)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&((n=r.Ur.get(e))&&r.Ur.set(e,n.withResumeToken(t.resumeToken,i)))}),e.targetMismatches.forEach(function(t){var e=r.Ur.get(t);e&&(r.Ur.set(t,e.withResumeToken(Jr.EMPTY_BYTE_STRING,e.snapshotVersion)),Ac(r,t),e=new qa(e.target,t,1,e.sequenceNumber),Ic(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Nr("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,kc(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function kc(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!xa(r))throw r;return n.Qr.add(1),[4,_c(n)];case 1:return t.sent(),n.jr.set("Offline"),i=i||function(){return fu(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Nr("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Qr.delete(1),[4,bc(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Lc(e,n){return n().catch(function(t){return kc(e,t,n)})}function Oc(u){return y(this,void 0,void 0,function(){var i,o,s,a;return g(this,function(t){switch(t.label){case 0:o=Vc(i=u),s=0<i.qr.length?i.qr[i.qr.length-1].batchId:-1,t.label=1;case 1:if(!(Dc(i)&&i.qr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.localStore,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Tn.getNextMutationBatchAfterBatchId(t,n)}))];case 3:return null===(a=t.sent())?(0===i.qr.length&&o.lr(),[3,7]):(s=a.batchId,function(t,e){t.qr.push(e);t=Vc(t);t.ar()&&t.br&&t.vr(e.mutations)}(i,a),[3,6]);case 4:return a=t.sent(),[4,kc(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Pc(i)&&Mc(i),[2]}var e,n,r})})}function Pc(t){return Dc(t)&&!Vc(t).cr()&&0<t.qr.length}function Mc(t){Vc(t).start()}function xc(n){var t,e,r,i=this;return n.zr||(n.zr=(t=n.datastore,e=n.asyncQueue,r={Vi:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.Ur.forEach(function(t,e){Ic(n,t)}),[2]})})}.bind(null,n),Di:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return Cc(e),Nc(e)?(e.jr.Lr(n),Sc(e)):e.jr.set("Unknown"),[2]})})}.bind(null,n),Tr:Rc.bind(null,n)},t.Cr(),new hc(e,t.er,t.credentials,t.D,r)),n.Kr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.zr.hr(),Nc(n)?Sc(n):n.jr.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.zr.stop()];case 2:t.sent(),Cc(n),t.label=3;case 3:return[2]}})})})),n.zr}function Vc(n){var t,e,r,i=this;return n.Hr||(n.Hr=(t=n.datastore,e=n.asyncQueue,r={Vi:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return Vc(e).Sr(),[2]})})}.bind(null,n),Di:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&Vc(e).br?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return Rs(n=i.code)&&n!==Hr.ABORTED?(e=r.qr.shift(),Vc(r).hr(),[4,Lc(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Oc(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Pc(e)&&Mc(e),[2]}})})}.bind(null,n),Vr:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=Vc(o),n=0,r=o.qr;n<r.length;n++)i=r[n],e.vr(i.mutations);return[2]})})}.bind(null,n),Pr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.qr.shift(),n=Fa.from(e,i,o),[4,Lc(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,Oc(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.Cr(),new lc(e,t.er,t.credentials,t.D,r)),n.Kr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Hr.hr(),[4,Oc(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Hr.stop()];case 3:t.sent(),0<n.qr.length&&(Nr("RemoteStore","Stopping write stream with "+n.qr.length+" pending writes"),n.qr=[]),t.label=4;case 4:return[2]}})})})),n.Hr}var Uc=(Fc.createAndSchedule=function(t,e,n,r,i){i=new Fc(t,e,Date.now()+n,r,i);return i.start(n),i},Fc.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},Fc.prototype.skipDelay=function(){return this.handleDelayElapsed()},Fc.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Qr(Hr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Fc.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},Fc.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},Fc);function Fc(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new La,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function qc(t,e){if(Dr("AsyncQueue",e+": "+t),xa(t))return new Qr(Hr.UNAVAILABLE,e+": "+t);throw t}function jc(){this.queries=new Za(So,Ao),this.onlineState="Unknown",this.Zr=new Set}var Bc=(zc.emptySet=function(t){return new zc(t.comparator)},zc.prototype.has=function(t){return null!=this.keyedMap.get(t)},zc.prototype.get=function(t){return this.keyedMap.get(t)},zc.prototype.first=function(){return this.sortedSet.minKey()},zc.prototype.last=function(){return this.sortedSet.maxKey()},zc.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},zc.prototype.indexOf=function(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(zc.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),zc.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},zc.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},zc.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},zc.prototype.isEqual=function(t){if(!(t instanceof zc))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},zc.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},zc.prototype.copy=function(t,e){var n=new zc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},zc),Gc=(Wc.prototype.track=function(t){var e=t.doc.key,n=this.Jr.get(e);!n||0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):kr()},Wc.prototype.Yr=function(){var n=[];return this.Jr.inorderTraversal(function(t,e){n.push(e)}),n},Wc),Kc=(Qc.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Qc(t,e,Bc.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(Qc.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),Qc.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ao(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Qc),Hc=function(){this.Xr=void 0,this.listeners=[]};function Qc(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function Wc(){this.Jr=new Ls(Yr.comparator)}function zc(n){this.comparator=n?function(t,e){return n(t,e)||Yr.comparator(t.key,e.key)}:function(t,e){return Yr.comparator(t.key,e.key)},this.keyedMap=Ks,this.sortedSet=new Ls(this.comparator)}function Xc(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new Hc),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Xr=t.sent(),[3,4];case 3:return o=t.sent(),o=qc(o,"Initialization of query '"+No(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.eo(e.onlineState),i.Xr&&a.no(i.Xr)&&Jc(e),[2]}})})}function Yc(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function Jc(t){t.Zr.forEach(function(t){t.next()})}var $c=(oh.prototype.no=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Kc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.io?this.oo(t)&&(this.so.next(t),o=!0):this.co(t,this.onlineState)&&(this.ao(t),o=!0),this.ro=t,o},oh.prototype.onError=function(t){this.so.error(t)},oh.prototype.eo=function(t){this.onlineState=t;var e=!1;return this.ro&&!this.io&&this.co(this.ro,t)&&(this.ao(this.ro),e=!0),e},oh.prototype.co=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.uo&&n||t.docs.isEmpty()&&"Offline"!==e)},oh.prototype.oo=function(t){if(0<t.docChanges.length)return!0;var e=this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},oh.prototype.ao=function(t){t=Kc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)},oh),Zc=(ih.prototype.ho=function(){return"metadata"in this.payload},ih),th=(rh.prototype.Gn=function(t){return va(this.D,t)},rh.prototype.zn=function(t){return t.metadata.exists?(e=this.D,n=t.document,r=va(e,n.name),e=pa(n.updateTime),n=new Lo({mapValue:{fields:n.fields}}),new Ni(r,e,n,{hasCommittedMutations:!1})):new Di(this.Gn(t.metadata.name),this.Hn(t.metadata.readTime));var e,n,r},rh.prototype.Hn=pa,rh),eh=(nh.prototype.fo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},nh.prototype.wo=function(t){for(var e=new Map,n=new th(this.D),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.Gn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ws()).add(s);e.set(c,h)}}return e},nh.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,p,d){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=Ws(),i=js,o=Hs,e=0,s=p;e<s.length;e++)a=s[e],u=f.Gn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.zn(a)),o=o.insert(u,f.Hn(a.metadata.readTime));return c=n.Qn.newChangeBuffer({trackRemovals:!0}),[4,yu(n,To(go(Wr.fromString("__bundle__/docs/"+d))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return du(e,c,i,Ro.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.Ge.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.Ge.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Kn.vn(e,t)})})})]}})})}(this.localStore,new th(this.D),this.documents,this.lo.id)];case 1:e=t.sent(),n=this.wo(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Ws()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,yu(e,To(Ka(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=pa(i.readTime);if(0<=n.snapshotVersion.compareTo(e))return r.He.saveNamedQuery(t,i);e=n.withResumeToken(Jr.EMPTY_BYTE_STRING,e);return r.Bn=r.Bn.insert(e.targetId,e),r.Ge.updateTargetData(t,e).next(function(){return r.Ge.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.Ge.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.He.saveNamedQuery(t,i)})})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new $a(Object.assign({},this.progress),e))]}})})},nh);function nh(t,e,n){this.lo=t,this.localStore=e,this.D=n,this.queries=[],this.documents=[],this.progress=sh(t)}function rh(t){this.D=t}function ih(t,e){this.payload=t,this.byteLength=e}function oh(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}function sh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var ah=function(t){this.key=t},uh=function(t){this.key=t},ch=(Object.defineProperty(dh.prototype,"To",{get:function(){return this._o},enumerable:!1,configurable:!0}),dh.prototype.Io=function(t,e){var s=this,a=e?e.Ao:new Gc,u=(e||this).Eo,c=(e||this).mutatedKeys,h=u,l=!1,f=vo(this.query)&&u.size===this.query.limit?u.last():null,p=mo(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=(r=e instanceof Ni?e:null)&&(Do(s.query,r)?r:null),i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),e=!0):s.Ro(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.po(r,f)||p&&s.po(r,p)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||p)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),vo(this.query)||mo(this.query))for(;h.size>this.query.limit;){var n=vo(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{Eo:h,Ao:a,Mn:l,mutatedKeys:c}},dh.prototype.Ro=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},dh.prototype.applyChanges=function(t,e,n){var o=this,r=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;var i=t.Ao.Yr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.po(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return kr()}}var r,i}),this.bo(n);var s=e?this.vo():[],n=0===this.yo.size&&this.current?1:0,e=n!==this.mo;return this.mo=n,0!==i.length||e?{snapshot:new Kc(this.query,t.Eo,r,i,t.mutatedKeys,0==n,e,!1),Po:s}:{Po:s}},dh.prototype.eo=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new Gc,mutatedKeys:this.mutatedKeys,Mn:!1},!1)):{Po:[]}},dh.prototype.Vo=function(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations},dh.prototype.bo=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._o=e._o.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e._o=e._o.delete(t)}),this.current=t.current)},dh.prototype.vo=function(){var e=this;if(!this.current)return[];var n=this.yo;this.yo=Ws(),this.Eo.forEach(function(t){e.Vo(t.key)&&(e.yo=e.yo.add(t.key))});var r=[];return n.forEach(function(t){e.yo.has(t)||r.push(new uh(t))}),this.yo.forEach(function(t){n.has(t)||r.push(new ah(t))}),r},dh.prototype.So=function(t){this._o=t.jn,this.yo=Ws();t=this.Io(t.documents);return this.applyChanges(t,!0)},dh.prototype.Do=function(){return Kc.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)},dh),hh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},lh=function(t){this.key=t,this.Co=!1},fh=(Object.defineProperty(ph.prototype,"isPrimaryClient",{get:function(){return!0===this.Uo},enumerable:!1,configurable:!0}),ph);function ph(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.xo={},this.No=new Za(So,Ao),this.$o=new Map,this.Fo=new Set,this.Oo=new Ls(Yr.comparator),this.ko=new Map,this.Mo=new _u,this.Lo={},this.Bo=new Map,this.qo=Wa.ne(),this.onlineState="Unknown",this.Uo=void 0}function dh(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=Ws(),this.mutatedKeys=Ws(),this.po=Co(t),this.Eo=new Bc(this.po)}function yh(a,u){return y(this,void 0,void 0,function(){var n,r,i,o,s;return g(this,function(t){switch(t.label){case 0:return(e=a).remoteStore.remoteSyncer.applyRemoteEvent=vh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t,t=n.ko.get(e);if(t&&t.Co)return Ws().add(t.key);var r=Ws(),e=n.$o.get(e);if(!e)return r;for(var i=0,o=e;i<o.length;i++){var s=o[i],s=n.No.get(s);r=r.unionWith(s.view.To)}return r}.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.ko.get(s),(n=i&&i.key)?(r=(r=new Ls(Yr.comparator)).insert(n,new Di(n,Ro.min())),i=Ws().add(n),i=new Xs(Ro.min(),new Map,new Fs(Mr),r,i),[4,vh(e,i)]):[3,2];case 1:return t.sent(),e.Oo=e.Oo.remove(n),e.ko.delete(s),Ah(e),[3,4];case 2:return[4,gu(e.localStore,s,!1).then(function(){return Eh(e,s,a)}).catch(Ja)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,e),e.xo.Tr=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,a=n.queries.get(a);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].no(s)&&(r=!0);a.Xr=s}}r&&Jc(n)}.bind(null,e.eventManager),e.xo.Ko=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,e.eventManager),(s=(n=e).No.get(u))?(r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Do(),[3,4]):[3,1];case 1:return[4,yu(n.localStore,To(u))];case 2:return o=t.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),r=o.targetId,[4,function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.Qo=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view.Io(o)).Mn?[4,vu(r.localStore,i.query,!1).then(function(t){t=t.documents;return i.view.Io(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(Ih(r,i.targetId,n.Po),n.snapshot)]}})})}(i,t,e,n)},[4,vu(i.localStore,o,!0)];case 1:return n=t.sent(),r=new ch(o,n.jn),e=r.Io(n.documents),n=Ys.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Ih(i,s,n.Po),r=new hh(o,s,r),[2,(i.No.set(o,r),i.$o.has(s)?i.$o.get(s).push(o):i.$o.set(s,[o]),n.snapshot)]}})})}(n,u,r,"current"===s)];case 3:i=t.sent(),n.isPrimaryClient&&Ec(n.remoteStore,o),t.label=4;case 4:return[2,i]}var e})})}function gh(f,p,d){return y(this,void 0,void 0,function(){var s,a;return g(this,function(t){switch(t.label){case 0:(o=f).remoteStore.remoteSyncer.applySuccessfulWrite=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,lu(e.localStore,o)];case 2:return r=t.sent(),_h(e,n,null),bh(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),[4,Sh(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,Ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,o),o.remoteStore.remoteSyncer.rejectFailedWrite=function(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Tn.lookupMutationBatch(e,r).next(function(t){return Lr(null!==t),n=t.keys(),i.Tn.removeMutationBatch(e,t)}).next(function(){return i.Tn.performConsistencyCheck(e)}).next(function(){return i.Kn.bn(e,n)})}))];case 2:return o=t.sent(),_h(n,a,u),bh(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,Sh(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}.bind(null,o),a=o,t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(r=a.localStore,u=p,h=r,l=ui.now(),i=u.reduce(function(t,e){return t.add(e.key)},Ws()),h.persistence.runTransaction("Locally write mutations","readwrite",function(a){return h.Kn.bn(a,i).next(function(t){c=t;for(var e,n=[],r=0,i=u;r<i.length;r++){var o=i[r],s=(e=o,s=c.get(o.key),function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof Ni?e.field(o.field):void 0,s=jo(o.transform,s||null);null!=s&&(n=(null==n?new Oo:n).set(o.field,s))}return n?n.v():null}(e.fieldTransforms,s));null!=s&&n.push(new ys(o.key,s,function s(t){var a=[];return Ur(t.fields||{},function(t,e){var n=new Xr([t]);if(Ti(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new ko(a)}(s.proto.mapValue),ss.exists(!0)))}return h.Tn.addMutationBatch(a,l,n,u)})}).then(function(t){var e=t.applyToLocalDocumentSet(c);return{batchId:t.batchId,changes:e}}))];case 2:return s=t.sent(),a.sharedClientState.addPendingMutation(s.batchId),e=a,n=s.batchId,o=d,r=(r=(r=e.Lo[e.currentUser.toKey()])||new Ls(Mr)).insert(n,o),e.Lo[e.currentUser.toKey()]=r,[4,Sh(a,s.changes)];case 3:return t.sent(),[4,Oc(a.remoteStore)];case 4:return t.sent(),[3,6];case 5:return a=t.sent(),a=qc(a,"Failed to persist write"),d.reject(a),[3,6];case 6:return[2]}var e,n,r,u,c,h,l,i,o})})}function vh(r,i){return y(this,void 0,void 0,function(){var n,e;return g(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,pu(n.localStore,i)];case 2:return e=t.sent(),i.targetChanges.forEach(function(t,e){e=n.ko.get(e);e&&(Lr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.Co=!0:0<t.modifiedDocuments.size?Lr(e.Co):0<t.removedDocuments.size&&(Lr(e.Co),e.Co=!1))}),[4,Sh(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,Ja(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function mh(t,n,e){var r,t=t;(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.No.forEach(function(t,e){e=e.view.eo(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].eo(i)&&(o=!0)}),o&&Jc(t)}(t.eventManager,n),r.length&&t.xo.Tr(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function wh(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:Dc((n=o).remoteStore)||Nr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Tn.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Bo.get(r)||[]).push(s),n.Bo.set(r,i),[3,4]);case 3:return i=t.sent(),i=qc(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function bh(t,e){(t.Bo.get(e)||[]).forEach(function(t){t.resolve()}),t.Bo.delete(e)}function _h(t,e,n){var r=t,i=r.Lo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Lo[r.currentUser.toKey()]=i)}function Eh(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.$o.get(t);r<i.length;r++){var o=i[r];e.No.delete(o),n&&e.xo.Ko(o,n)}e.$o.delete(t),e.isPrimaryClient&&e.Mo.os(t).forEach(function(t){e.Mo.containsKey(t)||Th(e,t)})}function Th(t,e){t.Fo.delete(e.path.canonicalString());var n=t.Oo.get(e);null!==n&&(Tc(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.ko.delete(n),Ah(t))}function Ih(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof ah?(t.Mo.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Oo.get(o)||r.Fo.has(i)||(Nr("SyncEngine","New document in limbo: "+o),r.Fo.add(i),Ah(r))):u instanceof uh?(Nr("SyncEngine","Document no longer in limbo: "+u.key),t.Mo.removeReference(u.key,e),t.Mo.containsKey(u.key)||Th(t,u.key)):kr()}}function Ah(t){for(;0<t.Fo.size&&t.Oo.size<t.maxConcurrentLimboResolutions;){var e=t.Fo.values().next().value;t.Fo.delete(e);var n=new Yr(Wr.fromString(e)),e=t.qo.next();t.ko.set(e,new lh(n)),t.Oo=t.Oo.insert(n,e),Ec(t.remoteStore,new qa(To(go(n.path)),e,2,Tr.o))}}function Sh(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).No.isEmpty()?[3,3]:(n.No.forEach(function(t,e){o.push(n.Qo(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=eu.Nn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.xo.Tr(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Oa.forEach(c,function(e){return Oa.forEach(e.Cn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return Oa.forEach(e.xn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!xa(e=t.sent()))throw e;return Nr("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.Bn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.Bn=r.Bn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Nh(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Nr("SyncEngine","User change. New user:",o.toKey()),[4,hu(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Bo.forEach(function(t){t.forEach(function(t){t.reject(new Qr(Hr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,Sh(n,r.Wn)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Dh(t,e,n){var r=t;!function(f,p,d){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,p.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=pa((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.He.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,p.close()]:[3,4];case 3:return[2,(t.sent(),void d._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return d._updateProgress(sh(a)),u=new eh(a,f.localStore,p.D),[4,p.Wo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.fo(c)]:[3,10];case 7:return(h=t.sent())&&d._updateProgress(h),[4,p.Wo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,Sh(f,l.En,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.He.saveBundleMetadata(t,e)}))];case 13:return t.sent(),d._completeWith(l.progress),[3,15];case 14:return Cr("SyncEngine","Loading bundle failed with "+(l=t.sent())),d._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})}(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var Ch=(Lh.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.D=ic(e.databaseInfo.databaseId),this.sharedClientState=this.jo(e),this.persistence=this.Go(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e),[2]}})})},Lh.prototype.zo=function(t){return null},Lh.prototype.Ho=function(t){return e=this.persistence,n=new nu,r=t.initialUser,t=this.D,new ru(e,n,r,t);var e,n,r},Lh.prototype.Go=function(t){return new Nu(Cu.Cs,this.D)},Lh.prototype.jo=function(t){return new Ku},Lh.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},Lh),Rh=(kh.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return mh(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Nh.bind(null,this.syncEngine),[4,function(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.Qr.delete(2),[4,bc(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Qr.add(2),[4,_c(e)]);case 3:t.sent(),e.jr.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},kh.prototype.createEventManager=function(t){return new jc},kh.prototype.createDatastore=function(t){var e=ic(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new Xu(n));return t=t.credentials,new fc(t,n,e)},kh.prototype.createRemoteStore=function(t){var e=this,n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(t){return mh(e.syncEngine,t,0)},t=new(Qu.At()?Qu:Hu);return new oc(n,r,i,o,t)},kh.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){o=new fh(t,e,n,r,i,o);return s&&(o.Uo=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},kh.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,Nr("RemoteStore","RemoteStore shutting down."),e.Qr.add(5),[4,_c(e)];case 1:return t.sent(),e.Wr.shutdown(),e.jr.set("Unknown"),[2]}})})}(this.remoteStore)},kh);function kh(){}function Lh(){this.synchronizeTabs=!1}function Oh(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var Ph=(Gh.prototype.next=function(t){this.observer.next&&this.Yo(this.observer.next,t)},Gh.prototype.error=function(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Gh.prototype.Xo=function(){this.muted=!0},Gh.prototype.Yo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Gh),Mh=(Bh.prototype.close=function(){return this.Zo.cancel()},Bh.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},Bh.prototype.Wo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.ec())]}})})},Bh.prototype.ec=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.nc()];case 1:return null===(e=t.sent())?[2,null]:(r=this.tc.decode(e),n=Number(r),isNaN(n)&&this.sc("length string ("+r+") is not valid number"),[4,this.ic(n)]);case 2:return r=t.sent(),[2,new Zc(JSON.parse(r),e.length+n)]}})})},Bh.prototype.rc=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},Bh.prototype.nc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.rc()<0?[4,this.oc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.rc())<0&&this.sc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},Bh.prototype.ic=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.oc()]:[3,3];case 1:t.sent()&&this.sc("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.tc.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},Bh.prototype.sc=function(t){throw this.Zo.cancel(),new Error("Invalid bundle format: "+t)},Bh.prototype.oc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Zo.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},Bh),xh=(jh.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Qr(Hr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var n,e,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=wa((n=s).D)+"/documents",r={documents:a.map(function(t){return ga(n.D,t)})},[4,n.Ui("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.D,"found"in(t=t)?function(t,e){Lr(!!e.found),e.found.name,e.found.updateTime;var n=va(t,e.found.name),t=pa(e.found.updateTime),e=new Lo({mapValue:{fields:e.found.fields}});return new Ni(n,t,e,{})}(e,t):"missing"in t?function(t,e){Lr(!!e.missing),Lr(!!e.readTime);t=va(t,e.missing),e=pa(e.readTime);return new Di(t,e)}(e,t):kr());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){t=i.get(t.toString());Lr(!!t),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Di||t instanceof Ni?n.recordVersion(t):kr()}),e)]}})})},jh.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},jh.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},jh.prototype.delete=function(t){this.write(new Ss(t,this.precondition(t))),this.writtenDocs.add(t.toString())},jh.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=Yr.fromPath(e);n.mutations.push(new Ns(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=wa((e=i).D)+"/documents",r={writes:o.map(function(t){return Ea(e.D,t)})},[4,e.Mi("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},jh.prototype.recordVersion=function(t){var e;if(t instanceof Ni)e=t.version;else{if(!(t instanceof Di))throw kr();e=Ro.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Qr(Hr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},jh.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ss.updateTime(e):ss.none()},jh.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return ss.exists(!0);if(e.isEqual(Ro.min()))throw new Qr(Hr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ss.updateTime(e)},jh.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},jh.prototype.ensureCommitNotCalled=function(){},jh),Vh=(qh.prototype.run=function(){this.ac()},qh.prototype.ac=function(){var t=this;this.rr.Yi(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new xh(this.datastore),(n=this.uc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.hc(t)})})}).catch(function(t){r.hc(t)}),[2]})})})},qh.prototype.uc=function(t){try{var e=this.updateFunction(t);return!qr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},qh.prototype.hc=function(t){var e=this;0<this.cc&&this.lc(t)?(--this.cc,this.asyncQueue.enqueueAndForget(function(){return e.ac(),Promise.resolve()})):this.deferred.reject(t)},qh.prototype.lc=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Rs(t)},qh),Uh=(Fh.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},Fh.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},Fh.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Qr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},Fh.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new La;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=t.sent(),e=qc(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},Fh);function Fh(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Ru.UNAUTHENTICATED,this.clientId=Or.u(),this.credentialListener=function(){},this.receivedInitialUser=new La,this.credentials.setChangeListener(function(t){Nr("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}function qh(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.cc=5,this.rr=new cc(this.asyncQueue,"transaction_retry")}function jh(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function Bh(t,e){var n=this;this.Zo=t,this.D=e,this.metadata=new La,this.buffer=new Uint8Array,this.tc=new TextDecoder("utf-8"),this.ec().then(function(t){t&&t.ho()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function Gh(t){this.observer=t,this.muted=!1}function Kh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(Nr("FirestoreClient","Using default OfflineComponentProvider"),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),Nr("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){n.isEqual(e)||(n=e,i.asyncQueue.enqueueRetryable(function(){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,hu(o.localStore,e)];case 1:return t.sent(),[2]}})})}))}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}(e,new Ch)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function Hh(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(Nr("FirestoreClient","Using default OnlineComponentProvider"),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Kh(r)];case 1:return e=t.sent(),Nr("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return r.asyncQueue.enqueueRetryable(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),Nr("RemoteStore","RemoteStore received new credentials"),n=Dc(e),e.Qr.add(3),[4,_c(e)];case 1:return t.sent(),n&&e.jr.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.Qr.delete(3),[4,bc(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)})}),r.onlineComponents=i,[2]}})})}(e,new Rh)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Qh(t){return Kh(t).then(function(t){return t.persistence})}function Wh(t){return Kh(t).then(function(t){return t.localStore})}function zh(t){return Hh(t).then(function(t){return t.remoteStore})}function Xh(t){return Hh(t).then(function(t){return t.syncEngine})}function Yh(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Hh(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=yh.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).No.get(o),1<(r=e.$o.get(n.targetId)).length?[2,(e.$o.set(n.targetId,r.filter(function(t){return!Ao(t,o)})),void e.No.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,gu(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),Tc(e.remoteStore,n.targetId),Eh(e,n.targetId)}).catch(Ja)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Eh(e,n.targetId),[4,gu(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function Jh(n,r,i){var t=this;void 0===i&&(i={});var o=new La;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new Ph({next:function(t){r.enqueueAndForget(function(){return Yc(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Qr(Hr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Qr(Hr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new $c(go(i.path),t,{includeMetadataChanges:!0,uo:!0});return Xc(n,a)},[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function $h(n,r,i){var t=this;void 0===i&&(i={});var o=new La;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new Ph({next:function(t){n.enqueueAndForget(function(){return Yc(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Qr(Hr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new $c(t,o,{includeMetadataChanges:!0,uo:!0});return Xc(e,s)},[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function Zh(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var tl=function(t,e,n,r,i,o){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},el=(Object.defineProperty(ll.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),ll.prototype.isEqual=function(t){return t instanceof ll&&t.projectId===this.projectId&&t.database===this.database},ll),nl=new Map,rl=(hl.prototype.getToken=function(){return Promise.resolve(null)},hl.prototype.invalidateToken=function(){},hl.prototype.setChangeListener=function(t){(this.changeListener=t)(Ru.UNAUTHENTICATED)},hl.prototype.removeChangeListener=function(){this.changeListener=null},hl),il=(cl.prototype.getToken=function(){var e=this,n=this.dc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.dc!==n?(Nr("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Lr("string"==typeof t.accessToken),new Zh(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},cl.prototype.invalidateToken=function(){this.forceRefresh=!0},cl.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},cl.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.fc),this.fc=null,this.changeListener=null},cl.prototype.wc=function(){var t=this.auth&&this.auth.getUid();return Lr(null===t||"string"==typeof t),new Ru(t)},cl),ol=(Object.defineProperty(ul.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.mc},e=this._c.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),ul),sl=(al.prototype.getToken=function(){return Promise.resolve(new ol(this._c,this.mc))},al.prototype.setChangeListener=function(t){t(Ru.FIRST_PARTY)},al.prototype.removeChangeListener=function(){},al.prototype.invalidateToken=function(){},al);function al(t,e){this._c=t,this.mc=e}function ul(t,e){this._c=t,this.mc=e,this.type="FirstParty",this.user=Ru.FIRST_PARTY}function cl(t){var e=this;this.fc=null,this.currentUser=Ru.UNAUTHENTICATED,this.receivedInitialUser=!1,this.dc=0,this.changeListener=null,this.forceRefresh=!1,this.fc=function(){e.dc++,e.currentUser=e.wc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.dc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.fc):(this.fc(null),t.get().then(function(t){e.auth=t,e.fc&&e.auth.addAuthTokenListener(e.fc)},function(){}))}function hl(){this.changeListener=null}function ll(t,e){this.projectId=t,this.database=e||"(default)"}function fl(t,e,n){if(!n)throw new Qr(Hr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function pl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function dl(t,e,n,r){if(!0===e&&!0===r)throw new Qr(Hr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function yl(t){if(!Yr.isDocumentKey(t))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function gl(t){if(Yr.isDocumentKey(t))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function vl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":kr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function ml(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Qr(Hr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=vl(t);throw new Qr(Hr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function wl(t,e){if(e<=0)throw new Qr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var bl,_l=(kl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},kl),El=(Object.defineProperty(Rl.prototype,"app",{get:function(){if(!this._app)throw new Qr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(Rl.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(Rl.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),Rl.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Qr(Hr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _l(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new rl;switch(t.type){case"gapi":var e=t.client;return Lr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new sl(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Qr(Hr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},Rl.prototype._getSettings=function(){return this._settings},Rl.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},Rl.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},Rl.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},Rl.prototype._terminate=function(){return(t=nl.get(this))&&(Nr("ComponentProvider","Removing Datastore"),nl.delete(this),t.terminate()),Promise.resolve();var t},Rl),Tl=function(t){this._delegate=t},Il=(Object.defineProperty(Cl.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(Cl.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Cl.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Cl.prototype,"parent",{get:function(){return new Sl(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),Cl.prototype.withConverter=function(t){return new Cl(this.firestore,t,this._key)},Cl),Al=(Dl.prototype.withConverter=function(t){return new Dl(this.firestore,t,this._query)},Dl),Sl=(n(Nl,bl=Al),Object.defineProperty(Nl.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Nl.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(Nl.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Il(this.firestore,null,new Yr(t))},enumerable:!1,configurable:!0}),Nl.prototype.withConverter=function(t){return new Nl(this.firestore,t,this._path)},Nl);function Nl(t,e,n){var r=this;return(r=bl.call(this,t,e,go(n))||this).firestore=t,r._path=n,r.type="collection",r}function Dl(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}function Cl(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}function Rl(t,e){this._persistenceKey="(lite)",this._settings=new _l({}),this._settingsFrozen=!1,t instanceof el?(this._databaseId=t,this._credentials=new rl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Qr(Hr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new el(t.options.projectId)}(t),this._credentials=new il(e))}function kl(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Qr(Hr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Qr(Hr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,dl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function Ll(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Tl&&(t=t._delegate),fl("collection","path",e),t instanceof El)return gl(n=Wr.fromString.apply(Wr,s([e],r))),new Sl(t,null,n);if(!(t instanceof Il||t instanceof Sl))throw new Qr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return gl(n=Wr.fromString.apply(Wr,s([t.path],r)).child(Wr.fromString(e))),new Sl(t.firestore,null,n)}function Ol(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof Tl&&(t=t._delegate),fl("doc","path",e=1===arguments.length?Or.u():e),t instanceof El)return yl(n=Wr.fromString.apply(Wr,s([e],r))),new Il(t,null,new Yr(n));if(!(t instanceof Il||t instanceof Sl))throw new Qr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return yl(n=t._path.child(Wr.fromString.apply(Wr,s([e],r)))),new Il(t.firestore,t instanceof Sl?t._converter:null,new Yr(n))}function Pl(t,e){return t instanceof Tl&&(t=t._delegate),e instanceof Tl&&(e=e._delegate),(t instanceof Il||t instanceof Sl)&&(e instanceof Il||e instanceof Sl)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Ml(t,e){return t instanceof Tl&&(t=t._delegate),e instanceof Tl&&(e=e._delegate),t instanceof Al&&e instanceof Al&&t.firestore===e.firestore&&Ao(t._query,e._query)&&t._converter===e._converter}var xl=(Object.defineProperty(Vl.prototype,"isShuttingDown",{get:function(){return this.Ec},enumerable:!1,configurable:!0}),Vl.prototype.enqueueAndForget=function(t){this.enqueue(t)},Vl.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.vc(),this.Pc(t)},Vl.prototype.enterRestrictedMode=function(){var t;this.Ec||(this.Ec=!0,(t=rc())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc))},Vl.prototype.enqueue=function(t){return this.vc(),this.Ec?new Promise(function(t){}):this.Pc(t)},Vl.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.gc.push(t),e.Vc()})},Vl.prototype.Vc=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.gc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.gc[0]()];case 2:return t.sent(),this.gc.shift(),this.rr.reset(),[3,4];case 3:if(!xa(e=t.sent()))throw e;return Nr("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.gc.length&&this.rr.Yi(function(){return n.Vc()}),t.label=5;case 5:return[2]}})})},Vl.prototype.Pc=function(t){var r=this,e=this.yc.then(function(){return r.Ac=!0,t().catch(function(t){throw r.Ic=t,r.Ac=!1,Dr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.Ac=!1,t})});return this.yc=e},Vl.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.vc(),-1<this.Rc.indexOf(t)&&(e=0);n=Uc.createAndSchedule(this,t,e,n,function(t){return r.Sc(t)});return this.Tc.push(n),n},Vl.prototype.vc=function(){this.Ic&&kr()},Vl.prototype.verifyOperationInProgress=function(){},Vl.prototype.Dc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this.yc];case 1:t.sent(),t.label=2;case 2:if(e!==this.yc)return[3,0];t.label=3;case 3:return[2]}})})},Vl.prototype.Cc=function(t){for(var e=0,n=this.Tc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},Vl.prototype.xc=function(r){var i=this;return this.Dc().then(function(){i.Tc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.Tc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.Dc()})},Vl.prototype.Nc=function(t){this.Rc.push(t)},Vl.prototype.Sc=function(t){t=this.Tc.indexOf(t);this.Tc.splice(t,1)},Vl);function Vl(){var e=this;this.yc=Promise.resolve(),this.gc=[],this.Ec=!1,this.Tc=[],this.Ic=null,this.Ac=!1,this.Rc=[],this.rr=new cc(this,"async_queue_retry"),this.bc=function(){var t=rc();t&&Nr("AsyncQueue","Visibility state changed to "+t.visibilityState),e.rr.Zi()};var t=rc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bc)}function Ul(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Fl,ql=(Gl.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Gl.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Gl.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Gl.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Gl.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Gl.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Gl),jl=(n(Bl,Fl=El),Bl.prototype._terminate=function(){return this._firestoreClient||Hl(this),this._firestoreClient.terminate()},Bl);function Bl(t,e){var n=this;return(n=Fl.call(this,t,e)||this)._queue=new xl,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Gl(){this._progressObserver={},this._taskCompletionResolver=new La,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Kl(t){return t._firestoreClient||Hl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Hl(t){var e,n,r=t._freezeSettings(),r=(e=t._databaseId,n=t._persistenceKey,new tl(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t._firestoreClient=new Uh(t._credentials,t._queue,r)}var Ql=(rf.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},rf),Wl=(nf.fromBase64String=function(t){try{return new nf(Jr.fromBase64String(t))}catch(t){throw new Qr(Hr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},nf.fromUint8Array=function(t){return new nf(Jr.fromUint8Array(t))},nf.prototype.toBase64=function(){return this._byteString.toBase64()},nf.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},nf.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},nf.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},nf),zl=function(t){this._methodName=t},Xl=(Object.defineProperty(ef.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(ef.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),ef.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},ef.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},ef.prototype._compareTo=function(t){return Mr(this._lat,t._lat)||Mr(this._long,t._long)},ef),Yl=/^__.*__$/,Jl=(tf.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ys(t,this.data,this.fieldMask,e,this.fieldTransforms):new ds(t,this.data,e,this.fieldTransforms)},tf),$l=(Zl.prototype.toMutation=function(t,e){return new ys(t,this.data,this.fieldMask,e,this.fieldTransforms)},Zl);function Zl(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function tf(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function ef(t,e){if(!isFinite(t)||t<-90||90<t)throw new Qr(Hr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Qr(Hr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function nf(t){this._byteString=t}function rf(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Xr(t)}function of(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw kr()}}var sf=(Object.defineProperty(cf.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(cf.prototype,"Fc",{get:function(){return this.settings.Fc},enumerable:!1,configurable:!0}),cf.prototype.Oc=function(t){return new cf(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.D,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},cf.prototype.kc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.Oc({path:e,Mc:!1});return e.Lc(t),e},cf.prototype.Bc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.Oc({path:t,Mc:!1});return t.$c(),t},cf.prototype.qc=function(t){return this.Oc({path:void 0,Mc:!0})},cf.prototype.Uc=function(t){return Uf(t,this.settings.methodName,this.settings.Qc||!1,this.path,this.settings.Kc)},cf.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},cf.prototype.$c=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Lc(this.path.get(t))},cf.prototype.Lc=function(t){if(0===t.length)throw this.Uc("Document fields must not be empty");if(of(this.Fc)&&Yl.test(t))throw this.Uc('Document fields cannot begin and end with "__"')},cf),af=(uf.prototype.Wc=function(t,e,n,r){return void 0===r&&(r=!1),new sf({Fc:t,methodName:e,Kc:n,path:Xr.emptyPath(),Mc:!1,Qc:r},this.databaseId,this.D,this.ignoreUndefinedProperties)},uf);function uf(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.D=n||ic(t)}function cf(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.D=n,this.ignoreUndefinedProperties=r,void 0===i&&this.$c(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function hf(t){var e=t._freezeSettings(),n=ic(t._databaseId);return new af(t._databaseId,!!e.ignoreUndefinedProperties,n)}function lf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Wc(o.merge||o.mergeFields?2:0,e,n,i);Pf("Data must be an object, but it was:",s,r);var a,u,r=Lf(r,s);if(o.merge)a=new ko(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=Mf(e,l[h],n);if(!s.contains(f))throw new Qr(Hr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Ff(c,f)||c.push(f)}a=new ko(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Jl(new Lo(r),a,u)}var ff,pf=(n(df,ff=zl),df.prototype._toFieldTransform=function(t){if(2!==t.Fc)throw 1===t.Fc?t.Uc(this._methodName+"() can only appear at the top level of your update data"):t.Uc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},df.prototype.isEqual=function(t){return t instanceof df},df);function df(){return null!==ff&&ff.apply(this,arguments)||this}function yf(t,e,n){return new sf({Fc:3,Kc:e.settings.Kc,methodName:t._methodName,Mc:n},e.databaseId,e.D,e.ignoreUndefinedProperties)}var gf,vf,mf,wf,bf=(n(Nf,wf=zl),Nf.prototype._toFieldTransform=function(t){return new is(t.path,new Ko)},Nf.prototype.isEqual=function(t){return t instanceof Nf},Nf),_f=(n(Sf,mf=zl),Sf.prototype._toFieldTransform=function(t){var e=yf(this,t,!0),n=this.jc.map(function(t){return kf(t,e)}),n=new Ho(n);return new is(t.path,n)},Sf.prototype.isEqual=function(t){return this===t},Sf),Ef=(n(Af,vf=zl),Af.prototype._toFieldTransform=function(t){var e=yf(this,t,!0),n=this.jc.map(function(t){return kf(t,e)}),n=new Yo(n);return new is(t.path,n)},Af.prototype.isEqual=function(t){return this===t},Af),Tf=(n(If,gf=zl),If.prototype._toFieldTransform=function(t){var e=new ts(t.D,qo(t.D,this.Gc));return new is(t.path,e)},If.prototype.isEqual=function(t){return this===t},If);function If(t,e){var n=this;return(n=gf.call(this,t)||this).Gc=e,n}function Af(t,e){var n=this;return(n=vf.call(this,t)||this).jc=e,n}function Sf(t,e){var n=this;return(n=mf.call(this,t)||this).jc=e,n}function Nf(){return null!==wf&&wf.apply(this,arguments)||this}function Df(t,r,i,e){var o=t.Wc(1,r,i);Pf("Data must be an object, but it was:",o,e);var s=[],a=new Oo;Ur(e,function(t,e){var n=Vf(r,t,i);e instanceof Tl&&(e=e._delegate);t=o.Bc(n);e instanceof pf?s.push(n):null!=(t=kf(e,t))&&(s.push(n),a.set(n,t))});e=new ko(s);return new $l(a.v(),e,o.fieldTransforms)}function Cf(t,e,n,r,i,o){var s=t.Wc(1,e,n),a=[Mf(e,r,n)],u=[i];if(o.length%2!=0)throw new Qr(Hr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Mf(e,o[c])),u.push(o[c+1]);for(var h,l,f,p=[],d=new Oo,y=a.length-1;0<=y;--y)Ff(p,a[y])||(h=a[y],(l=u[y])instanceof Tl&&(l=l._delegate),f=s.Bc(h),l instanceof pf?p.push(h):null!=(f=kf(l,f))&&(p.push(h),d.set(h,f)));i=new ko(p);return new $l(d.v(),i,s.fieldTransforms)}function Rf(t,e,n,r){return void 0===r&&(r=!1),kf(n,t.Wc(r?4:3,e))}function kf(s,t){if(Of(s=s instanceof Tl?s._delegate:s))return Pf("Unsupported field value:",t,s),Lf(s,t);if(s instanceof zl)return function(t,e){if(!of(e.Fc))throw e.Uc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Uc(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.Mc&&4!==t.Fc)throw t.Uc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=kf(i[r],t.qc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=t instanceof Tl?t._delegate:t))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return qo(e.D,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ui.fromDate(t);return{timestampValue:la(e.D,n)}}if(t instanceof ui)return n=new ui(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:la(e.D,n)};if(t instanceof Xl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Wl)return{bytesValue:fa(e.D,t._byteString)};if(t instanceof Il){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Uc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:da(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Uc("Unsupported field value: "+vl(t))}(s,t)}function Lf(t,n){var r={};return Fr(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Ur(t,function(t,e){e=kf(e,n.kc(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function Of(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ui||t instanceof Xl||t instanceof Wl||t instanceof Il||t instanceof zl)}function Pf(t,e,n){if(!Of(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=vl(n);throw"an object"===n?e.Uc(t+" a custom object"):e.Uc(t+" "+n)}var r}function Mf(t,e,n){if((e=e instanceof Tl?e._delegate:e)instanceof Ql)return e._internalPath;if("string"==typeof e)return Vf(t,e);throw Uf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var xf=new RegExp("[~\\*/\\[\\]]");function Vf(e,n,r){if(0<=n.search(xf))throw Uf("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Ql.bind.apply(Ql,s([void 0],n.split(".")))))._internalPath}catch(t){throw Uf("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function Uf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Qr(Hr.INVALID_ARGUMENT,(e+=". ")+t+n)}function Ff(t,e){return t.some(function(t){return t.isEqual(e)})}var qf,jf=(Object.defineProperty(Kf.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(Kf.prototype,"ref",{get:function(){return new Il(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),Kf.prototype.exists=function(){return null!==this._document},Kf.prototype.data=function(){if(this._document){if(this._converter){var t=new Bf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.toProto())}},Kf.prototype.get=function(t){if(this._document){t=this._document.data().field(Hf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}},Kf),Bf=(n(Gf,qf=jf),Gf.prototype.data=function(){return qf.prototype.data.call(this)},Gf);function Gf(){return null!==qf&&qf.apply(this,arguments)||this}function Kf(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function Hf(t,e){return"string"==typeof e?Vf(t,e):(e instanceof Tl?e._delegate:e)._internalPath}var Qf,Wf,zf=(ep.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},ep),Xf=(n(tp,Wf=jf),tp.prototype.exists=function(){return Wf.prototype.exists.call(this)},tp.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Yf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.toProto(),t.serverTimestamps)}},tp.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){t=this._document.data().field(Hf("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}},tp),Yf=(n(Zf,Qf=Xf),Zf.prototype.data=function(t){return void 0===t&&(t={}),Qf.prototype.data.call(this,t)},Zf),Jf=(Object.defineProperty($f.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty($f.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty($f.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),$f.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new Yf(r._firestore,r._userDataWriter,t.key,t,new zf(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query._converter))})},$f.prototype.docChanges=function(t){t=!!(t=void 0===t?{}:t).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Qr(Hr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){var e=new Yf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new zf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new Yf(i._firestore,i._userDataWriter,t.doc.key,t.doc,new zf(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return kr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},$f);function $f(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new zf(r.hasPendingWrites,r.fromCache),this.query=n}function Zf(){return null!==Qf&&Qf.apply(this,arguments)||this}function tp(t,e,n,r,i,o){var s=this;return(s=Wf.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function ep(t,e){this.hasPendingWrites=t,this.fromCache=e}function np(t,e){return t instanceof Xf&&e instanceof Xf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Jf&&e instanceof Jf&&t._firestore===e._firestore&&Ml(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function rp(t){if(mo(t)&&0===t.explicitOrderBy.length)throw new Qr(Hr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}h=function(){};function ip(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var op,sp,ap,up,cp,hp=(n(wp,cp=h),wp.prototype._apply=function(t){var e=hf(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){Ep(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(_p(n,t,c))}h={arrayValue:{values:s}}}else h=_p(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Ep(o,i),h=Rf(e,"where",o,"in"===i||"not-in"===i);var h=Fi.create(r,i,h);return function(t,e){if(e.g()){var n=bo(t);if(null!==n&&!n.isEqual(e.field))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=wo(t);null!==n&&Tp(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.zc,this.Hc,this.Jc);return new Al(t.firestore,t._converter,(t=t._query,e=t.filters.concat([e]),new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},wp),lp=(n(mp,up=h),mp.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new lo(e,n);return e=r,null!==wo(n=t)||null!==(t=bo(n))&&Tp(0,t,e.field),r}(t._query,this.zc,this.Yc);return new Al(t.firestore,t._converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new yo(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},mp),fp=(n(vp,ap=h),vp.prototype._apply=function(t){return new Al(t.firestore,t._converter,Io(t._query,this.Xc,this.Zc))},vp),pp=(n(gp,sp=h),gp.prototype._apply=function(t){var e=bp(t,this.type,this.ta,this.ea);return new Al(t.firestore,t._converter,(t=t._query,e=e,new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},gp),dp=(n(yp,op=h),yp.prototype._apply=function(t){var e=bp(t,this.type,this.ta,this.ea);return new Al(t.firestore,t._converter,(t=t._query,e=e,new yo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},yp);function yp(t,e,n){var r=this;return(r=op.call(this)||this).type=t,r.ta=e,r.ea=n,r}function gp(t,e,n){var r=this;return(r=sp.call(this)||this).type=t,r.ta=e,r.ea=n,r}function vp(t,e,n){var r=this;return(r=ap.call(this)||this).type=t,r.Xc=e,r.Zc=n,r}function mp(t,e){var n=this;return(n=up.call(this)||this).zc=t,n.Yc=e,n.type="orderBy",n}function wp(t,e,n){var r=this;return(r=cp.call(this)||this).zc=t,r.Hc=e,r.Jc=n,r.type="where",r}function bp(t,c,e,n){if(e[0]instanceof Tl&&(e[0]=e[0]._delegate),e[0]instanceof jf)return function(t,e,n,r){if(!n)throw new Qr(Hr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=Eo(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(mi(e,n.key));else{var u=n.field(a.field);if(hi(u))throw new Qr(Hr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){a=a.field.canonicalString();throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}i.push(u)}}return new oo(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=hf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Qr(Hr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!_o(t)&&-1!==c.indexOf("/"))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Wr.fromString(c));if(!Yr.isDocumentKey(h))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new Yr(h);a.push(mi(e,h))}else{c=Rf(n,r,c);a.push(c)}}return new oo(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function _p(t,e,n){if("string"==typeof(n=n instanceof Tl?n._delegate:n)){if(""===n)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!_o(e)&&-1!==n.indexOf("/"))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(Wr.fromString(n));if(!Yr.isDocumentKey(e))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return mi(t,new Yr(e))}if(n instanceof Il)return mi(t,n._key);throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+vl(n)+".")}function Ep(t,e){if(!Array.isArray(t)||0===t.length)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function Tp(t,e,n){if(!n.isEqual(e))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}Ip.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),fi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return si(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ai(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw kr()}},Ip.prototype.convertObject=function(t,n){var r=this,i={};return Ur(t.fields||{},function(t,e){i[t]=r.convertValue(e,n)}),i},Ip.prototype.convertGeoPoint=function(t){return new Xl(si(t.latitude),si(t.longitude))},Ip.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},Ip.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return hi(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(li(t));default:return null}},Ip.prototype.convertTimestamp=function(t){t=oi(t);return new ui(t.seconds,t.nanos)},Ip.prototype.convertDocumentKey=function(t,e){var n=Wr.fromString(t);Lr(ka(n));t=new el(n.get(1),n.get(3)),n=new Yr(n.popFirst(5));return t.isEqual(e)||Dr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},Ee=Ip;function Ip(){}function Ap(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Sp,Np=(n(Rp,Sp=Ee),Rp.prototype.convertBytes=function(t){return new Wl(t)},Rp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new Il(this.firestore,null,t)},Rp),Dp=(Cp.prototype.set=function(t,e,n){this._verifyNotCommitted();t=kp(t,this._firestore),e=Ap(t._converter,e,n),n=lf(this._dataReader,"WriteBatch.set",t._key,e,null!==t._converter,n);return this._mutations.push(n.toMutation(t._key,ss.none())),this},Cp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();t=kp(t,this._firestore),e="string"==typeof(e=e instanceof Tl?e._delegate:e)||e instanceof Ql?Cf(this._dataReader,"WriteBatch.update",t._key,e,n,r):Df(this._dataReader,"WriteBatch.update",t._key,e);return this._mutations.push(e.toMutation(t._key,ss.exists(!0))),this},Cp.prototype.delete=function(t){this._verifyNotCommitted();t=kp(t,this._firestore);return this._mutations=this._mutations.concat(new Ss(t._key,ss.none())),this},Cp.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},Cp.prototype._verifyNotCommitted=function(){if(this._committed)throw new Qr(Hr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Cp);function Cp(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=hf(t)}function Rp(t){var e=this;return(e=Sp.call(this)||this).firestore=t,e}function kp(t,e){if((t=t instanceof Tl?t._delegate:t).firestore!==e)throw new Qr(Hr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Lp,Op=(n(Pp,Lp=Ee),Pp.prototype.convertBytes=function(t){return new Wl(t)},Pp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new Il(this.firestore,null,t)},Pp);function Pp(t){var e=this;return(e=Lp.call(this)||this).firestore=t,e}function Mp(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ml(t,Il);var o=ml(t.firestore,jl),s=hf(o);return Vp(o,[("string"==typeof(e=e instanceof Tl?e._delegate:e)||e instanceof Ql?Cf(s,"updateDoc",t._key,e,n,r):Df(s,"updateDoc",t._key,e)).toMutation(t._key,ss.exists(!0))])}function xp(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e instanceof Tl&&(e=e._delegate);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||Ul(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return Ul(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof Il?(a=ml(e.firestore,jl),u=go(e._key.path),h={next:function(t){n[i]&&n[i](Up(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=ml(e,Al),a=ml(s.firestore,jl),u=s._query,c=new Op(a),h={next:function(t){n[i]&&n[i](new Jf(a,c,s,t))},error:n[i+1],complete:n[i+2]},rp(e._query)),function(n,t,e){var r=this,i=new Ph(h),o=new $c(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Xc,[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Xo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Yc,[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Kl(a),u,l)}function Vp(t,e){return function(n,r){var t=this,i=new La;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=gh,[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Kl(t),e)}function Up(t,e,n){var r=n.docs.get(e._key),i=new Op(t);return new Xf(t,i,e._key,r,new zf(n.hasPendingWrites,n.fromCache),e._converter)}var Fp,qp=(Bp.prototype.get=function(t){var e=this,n=kp(t,this._firestore),r=new Np(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return kr();t=t[0];if(t instanceof Di)return new jf(e._firestore,r,n._key,null,n._converter);if(t instanceof Ni)return new jf(e._firestore,r,t.key,t,n._converter);throw kr()})},Bp.prototype.set=function(t,e,n){t=kp(t,this._firestore),e=Ap(t._converter,e,n),n=lf(this._dataReader,"Transaction.set",t._key,e,null!==t._converter,n);return this._transaction.set(t._key,n),this},Bp.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=kp(t,this._firestore),e="string"==typeof(e=e instanceof Tl?e._delegate:e)||e instanceof Ql?Cf(this._dataReader,"Transaction.update",t._key,e,n,r):Df(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this},Bp.prototype.delete=function(t){t=kp(t,this._firestore);return this._transaction.delete(t._key),this},n(jp,Fp=Bp),jp.prototype.get=function(t){var e=this,n=kp(t,this._firestore),r=new Op(this._firestore);return Fp.prototype.get.call(this,t).then(function(t){return new Xf(e._firestore,r,n._key,t._document,new zf(!1,!1),n._converter)})},jp);function jp(t,e){var n=this;return(n=Fp.call(this,t,e)||this)._firestore=t,n}function Bp(t,e){this._firestore=t,this._transaction=e,this._dataReader=hf(t)}function Gp(){if("undefined"==typeof Uint8Array)throw new Qr(Hr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Kp(){if("undefined"==typeof atob)throw new Qr(Hr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Hp,Qp,Wp,zp=(n(nd,Wp=Tl),nd.fromBase64String=function(t){return Kp(),new nd(Wl.fromBase64String(t))},nd.fromUint8Array=function(t){return Gp(),new nd(Wl.fromUint8Array(t))},nd.prototype.toBase64=function(){return Kp(),this._delegate.toBase64()},nd.prototype.toUint8Array=function(){return Gp(),this._delegate.toUint8Array()},nd.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},nd.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},nd),Xp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Yp=(ed.prototype.enableIndexedDbPersistence=function(t,e){throw new Qr(Hr.FAILED_PRECONDITION,Xp)},ed.prototype.enableMultiTabIndexedDbPersistence=function(t){throw new Qr(Hr.FAILED_PRECONDITION,Xp)},ed.prototype.clearIndexedDbPersistence=function(t){throw new Qr(Hr.FAILED_PRECONDITION,Xp)},ed),Jp=(n(td,Qp=Tl),Object.defineProperty(td.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),td.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},td.prototype.useEmulator=function(t,e){var n,r;n=this._delegate,r=t,t=e,"firestore.googleapis.com"!==(e=(n=ml(n,El))._getSettings()).host&&e.host!==r&&Cr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},e),{host:r+":"+t,ssl:!1}))},td.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,Qh(i)];case 1:return n=t.sent(),[4,zh(i)];case 2:return r=t.sent(),[2,(n.setNetworkEnabled(!0),(e=r).Qr.delete(0),bc(e))]}var e})})})}(Kl(ml(this._delegate,jl)))},td.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Qh(r)];case 1:return e=t.sent(),[4,zh(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Qr.add(0),[4,_c(e)];case 1:return t.sent(),e.jr.set("Offline"),[2]}})})}(n))]}})})})}(Kl(ml(this._delegate,jl)))},td.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&dl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.na.enableMultiTabIndexedDbPersistence(this):this.na.enableIndexedDbPersistence(this,n)},td.prototype.clearPersistence=function(){return this.na.clearIndexedDbPersistence(this)},td.prototype.terminate=function(){return this.sa&&(this.sa._removeServiceInstance("firestore"),this.sa._removeServiceInstance("firestore-exp")),this._delegate._delete()},td.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new La;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=wh,[4,Xh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Kl(ml(this._delegate,jl)))},td.prototype.onSnapshotsInSync=function(t){return e=this._delegate,t=t,function(n,t){var e=this,r=new Ph(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Zr.add(e),e.next()},[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Xo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Zr.delete(e)},[4,Yh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(Kl(ml(e,jl)),Ul(t)?t:{next:t});var e},Object.defineProperty(td.prototype,"app",{get:function(){if(!this.sa)throw new Qr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.sa},enumerable:!1,configurable:!0}),td.prototype.collection=function(t){try{return new Cd(this,Ll(this._delegate,t))}catch(t){throw yd(t,"collection()","Firestore.collection()")}},td.prototype.doc=function(t){try{return new pd(this,Ol(this._delegate,t))}catch(t){throw yd(t,"doc()","Firestore.doc()")}},td.prototype.collectionGroup=function(t){try{return new Sd(this,function(t,e){if(t=ml(t,El),fl("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Qr(Hr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Al(t,null,(e=e,new yo(Wr.emptyPath(),e)))}(this._delegate,t))}catch(t){throw yd(t,"collectionGroup()","Firestore.collectionGroup()")}},td.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new La;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,Hh(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new Vh(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(Kl(n=this._delegate),function(t){return t=new qp(n,t),e(new sd(r,t))})},td.prototype.batch=function(){var e=this;return Kl(this._delegate),new ad(new Dp(this._delegate,function(t){return Vp(e._delegate,t)}))},td.prototype.loadBundle=function(t){throw new Qr(Hr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},td.prototype.namedQuery=function(t){throw new Qr(Hr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},td),$p=(n(Zp,Hp=Ee),Zp.prototype.convertBytes=function(t){return new zp(new Wl(t))},Zp.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return pd.ia(t,this.firestore,null)},Zp);function Zp(t){var e=this;return(e=Hp.call(this)||this).firestore=t,e}function td(t,e,n){var r=this;return(r=Qp.call(this,e)||this).na=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof el||(r.sa=t),r}function ed(){}function nd(){return null!==Wp&&Wp.apply(this,arguments)||this}var rd,id,od,sd=(n(ld,od=Tl),ld.prototype.get=function(t){var e=this,n=xd(t);return this._delegate.get(n).then(function(t){return new Id(e._firestore,new Xf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))})},ld.prototype.set=function(t,e,n){t=xd(t);return n?(pl("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},ld.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=xd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},ld.prototype.delete=function(t){t=xd(t);return this._delegate.delete(t),this},ld),ad=(n(hd,id=Tl),hd.prototype.set=function(t,e,n){t=xd(t);return n?(pl("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},hd.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=xd(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},hd.prototype.delete=function(t){t=xd(t);return this._delegate.delete(t),this},hd.prototype.commit=function(){return this._delegate.commit()},hd),ud=(n(cd,rd=Tl),cd.prototype.fromFirestore=function(t,e){t=new Yf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Ad(this._firestore,t),null!=e?e:{})},cd.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},cd.ra=function(t,e){var n=cd.oa,r=n.get(t);r||(r=new WeakMap,n.set(t,r));n=r.get(e);return n||(n=new cd(t,new $p(t),e),r.set(e,n)),n},cd);function cd(t,e,n){var r=this;return(r=rd.call(this,n)||this)._firestore=t,r._userDataWriter=e,r}function hd(){return null!==id&&id.apply(this,arguments)||this}function ld(t,e){var n=this;return(n=od.call(this,e)||this)._firestore=t,n._userDataWriter=new $p(t),n}ud.oa=new WeakMap;var fd,pd=(n(dd,fd=Tl),dd.ca=function(t,e,n){if(t.length%2!=0)throw new Qr(Hr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new dd(e,new Il(e._delegate,n,new Yr(t)))},dd.ia=function(t,e,n){return new dd(e,new Il(e._delegate,n,t))},Object.defineProperty(dd.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"parent",{get:function(){return new Cd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(dd.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),dd.prototype.collection=function(t){try{return new Cd(this.firestore,Ll(this._delegate,t))}catch(t){throw yd(t,"collection()","DocumentReference.collection()")}},dd.prototype.isEqual=function(t){return(t=t instanceof Tl?t._delegate:t)instanceof Il&&Pl(this._delegate,t)},dd.prototype.set=function(t,e){e=pl("DocumentReference.set",e);try{return function(t,e,n){t=ml(t,Il);var r=ml(t.firestore,jl),e=Ap(t._converter,e,n);return Vp(r,[lf(hf(r),"setDoc",t._key,e,null!==t._converter,n).toMutation(t._key,ss.none())])}(this._delegate,t,e)}catch(t){throw yd(t,"setDoc()","DocumentReference.set()")}},dd.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Mp(this._delegate,t):Mp.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw yd(t,"updateDoc()","DocumentReference.update()")}},dd.prototype.delete=function(){return Vp(ml((t=this._delegate).firestore,jl),[new Ss(t._key,ss.none())]);var t},dd.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=gd(t),i=vd(t,function(t){return new Id(e.firestore,new Xf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))});return xp(this._delegate,r,i)},dd.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=ml(e,Il);var n=ml(e.firestore,jl),t=Kl(n),r=new Op(n);return function(n,r){var t=this,i=new La;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Kn.In(t,e)}))];case 1:return(i=t.sent())instanceof Ni?a.resolve(i):i instanceof Di?a.resolve(null):a.reject(new Qr(Hr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=qc(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Wh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new Xf(n,r,e._key,t,new zf(t instanceof Ni&&t.hasLocalMutations,!0),e._converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=ml(e,Il);var n=ml(e.firestore,jl);return Jh(Kl(n),e._key,{source:"server"}).then(function(t){return Up(n,e,t)})}:function(e){e=ml(e,Il);var n=ml(e.firestore,jl);return Jh(Kl(n),e._key).then(function(t){return Up(n,e,t)})})(this._delegate).then(function(t){return new Id(e.firestore,new Xf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))})},dd.prototype.withConverter=function(t){return new dd(this.firestore,t?this._delegate.withConverter(ud.ra(this.firestore,t)):this._delegate.withConverter(null))},dd);function dd(t,e){var n=this;return(n=fd.call(this,e)||this).firestore=t,n._userDataWriter=new $p(t),n}function yd(t,e,n){return t.message=t.message.replace(e,n),t}function gd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!Ul(r))return r}return{}}function vd(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=Ul(t[0])?t[0]:Ul(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var md,wd,bd,_d,Ed,Td,Id=(n(Md,Td=Tl),Object.defineProperty(Md.prototype,"ref",{get:function(){return new pd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(Md.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),Md.prototype.data=function(t){return this._delegate.data(t)},Md.prototype.get=function(t,e){return this._delegate.get(t,e)},Md.prototype.isEqual=function(t){return np(this._delegate,t._delegate)},Md),Ad=(n(Pd,Ed=Id),Pd.prototype.data=function(t){return this._delegate.data(t)},Pd),Sd=(n(Od,_d=Tl),Od.prototype.where=function(t,e,n){try{return new Od(this.firestore,ip(this._delegate,(r=n,i=e,o=Hf("where",t),new hp(o,i,r))))}catch(t){throw yd(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},Od.prototype.orderBy=function(t,e){try{return new Od(this.firestore,ip(this._delegate,(n=void 0===e?"asc":e,r=Hf("orderBy",t),new lp(r,n))))}catch(t){throw yd(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},Od.prototype.limit=function(t){try{return new Od(this.firestore,ip(this._delegate,(wl("limit",e=t),new fp("limit",e,"F"))))}catch(t){throw yd(t,"limit()","Query.limit()")}var e},Od.prototype.limitToLast=function(t){try{return new Od(this.firestore,ip(this._delegate,(wl("limitToLast",e=t),new fp("limitToLast",e,"L"))))}catch(t){throw yd(t,"limitToLast()","Query.limitToLast()")}var e},Od.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Od(this.firestore,ip(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new pp("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw yd(t,"startAt()","Query.startAt()")}},Od.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Od(this.firestore,ip(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new pp("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw yd(t,"startAfter()","Query.startAfter()")}},Od.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Od(this.firestore,ip(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dp("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw yd(t,"endBefore()","Query.endBefore()")}},Od.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new Od(this.firestore,ip(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new dp("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw yd(t,"endAt()","Query.endAt()")}},Od.prototype.isEqual=function(t){return Ml(this._delegate,t._delegate)},Od.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=ml(e,Al);var n=ml(e.firestore,jl),t=Kl(n),r=new Op(n);return function(n,r){var t=this,i=new La;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,vu(i,o,!0)];case 1:return r=t.sent(),e=new ch(o,r.jn),n=e.Io(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=qc(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Wh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new Jf(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=ml(e,Al);var n=ml(e.firestore,jl),t=Kl(n),r=new Op(n);return $h(t,e._query,{source:"server"}).then(function(t){return new Jf(n,r,e,t)})}:function(e){e=ml(e,Al);var n=ml(e.firestore,jl),t=Kl(n),r=new Op(n);return rp(e._query),$h(t,e._query).then(function(t){return new Jf(n,r,e,t)})})(this._delegate).then(function(t){return new Dd(e.firestore,new Jf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},Od.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=gd(t),i=vd(t,function(t){return new Dd(e.firestore,new Jf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return xp(this._delegate,r,i)},Od.prototype.withConverter=function(t){return new Od(this.firestore,t?this._delegate.withConverter(ud.ra(this.firestore,t)):this._delegate.withConverter(null))},Od),Nd=(n(Ld,bd=Tl),Object.defineProperty(Ld.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(Ld.prototype,"doc",{get:function(){return new Ad(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(Ld.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Ld.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),Ld),Dd=(n(kd,wd=Tl),Object.defineProperty(kd.prototype,"query",{get:function(){return new Sd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(kd.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(kd.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(kd.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(kd.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new Ad(e._firestore,t)})},enumerable:!1,configurable:!0}),kd.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Nd(e._firestore,t)})},kd.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new Ad(r._firestore,t))})},kd.prototype.isEqual=function(t){return np(this._delegate,t._delegate)},kd),Cd=(n(Rd,md=Sd),Object.defineProperty(Rd.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Rd.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(Rd.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new pd(this.firestore,t):null},enumerable:!1,configurable:!0}),Rd.prototype.doc=function(t){try{return new pd(this.firestore,void 0===t?Ol(this._delegate):Ol(this._delegate,t))}catch(t){throw yd(t,"doc()","CollectionReference.doc()")}},Rd.prototype.add=function(t){var e,n,r,i=this;return e=this._delegate,n=t,t=ml(e.firestore,jl),r=Ol(e),n=Ap(e._converter,n),Vp(t,[lf(hf(e.firestore),"addDoc",r._key,n,null!==e._converter,{}).toMutation(r._key,ss.exists(!1))]).then(function(){return r}).then(function(t){return new pd(i.firestore,t)})},Rd.prototype.isEqual=function(t){return Pl(this._delegate,t._delegate)},Rd.prototype.withConverter=function(t){return new Rd(this.firestore,t?this._delegate.withConverter(ud.ra(this.firestore,t)):this._delegate.withConverter(null))},Rd);function Rd(t,e){var n=this;return(n=md.call(this,t,e)||this).firestore=t,n._delegate=e,n}function kd(t,e){var n=this;return(n=wd.call(this,e)||this)._firestore=t,n}function Ld(t,e){var n=this;return(n=bd.call(this,e)||this)._firestore=t,n}function Od(t,e){var n=this;return(n=_d.call(this,e)||this).firestore=t,n._userDataWriter=new $p(t),n}function Pd(){return null!==Ed&&Ed.apply(this,arguments)||this}function Md(t,e){var n=this;return(n=Td.call(this,e)||this)._firestore=t,n}function xd(t){return ml(t=t instanceof Tl?t._delegate:t,Il)}var Vd,Ud,h=(n(qd,Ud=Tl),qd.documentId=function(){return new qd(Xr.keyField().canonicalString())},qd.prototype.isEqual=function(t){return(t=t instanceof Tl?t._delegate:t)instanceof Ql&&this._delegate._internalPath.isEqual(t._internalPath)},qd),Ee=(n(Fd,Vd=Tl),Fd.serverTimestamp=function(){var t=new bf("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new Fd(t)},Fd.delete=function(){var t=new pf("deleteField");return t._methodName="FieldValue.delete",new Fd(t)},Fd.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new _f("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new Fd(n)},Fd.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ef("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new Fd(n)},Fd.increment=function(t){t=new Tf("increment",t);return t._methodName="FieldValue.increment",new Fd(t)},Fd.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},Fd);function Fd(){return null!==Vd&&Vd.apply(this,arguments)||this}function qd(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Ud.call(this,new(Ql.bind.apply(Ql,s([void 0],t))))||this}function jd(t){return e=this._delegate,s=t,n=Kl(e=ml(e,jl)),t=new ql,function(n,t,r){var e,i=this,o=(e=s,t=ic(t),e=function(t){if(t instanceof Uint8Array)return Oh(t,void 0);if(t instanceof ArrayBuffer)return Oh(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new Mh(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Dh,[4,Xh(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n}function Bd(t){var e=this,n=this._delegate,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.He.getNamedQuery(t,e)})},[4,Wh(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(Kl(n=ml(n,jl)),t).then(function(t){return t?new Al(n,null,t.query):null}).then(function(t){return t?new Sd(e,t):null})}var Gd=(Kd.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Kd.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Kd.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Kd);function Kd(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Hd,Qd,Wd={Firestore:Jp,GeoPoint:Xl,Timestamp:ui,Blob:zp,Transaction:sd,WriteBatch:ad,DocumentReference:pd,DocumentSnapshot:Id,Query:Sd,QueryDocumentSnapshot:Ad,QuerySnapshot:Dd,CollectionReference:Cd,FieldPath:h,FieldValue:Ee,setLogLevel:function(t){Ar.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(Hd=e.default).INTERNAL.registerComponent(new Gd("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new Jp(e,new jl(e,t),new Yp)},"PUBLIC").setServiceProps(Object.assign({},Wd))),Hd.registerVersion("@firebase/firestore","2.2.1"),(Qd=Jp).prototype.loadBundle=jd,Qd.prototype.namedQuery=Bd}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.memory.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.memory.js.map
