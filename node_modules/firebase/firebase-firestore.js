!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Av){"use strict";try{!function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var f,e=t(Av),r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,a,u){return new(a=a||Promise)(function(n,e){function r(t){try{o(u.next(t))}catch(t){e(t)}}function i(t){try{o(u.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof a?e:new a(function(t){t(e)})).then(r,i)}o((u=u.apply(t,s||[])).next())})}function g(n,r){var i,o,s,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(n,a)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t}(Ee=f=f||{})[Ee.DEBUG=0]="DEBUG",Ee[Ee.VERBOSE=1]="VERBOSE",Ee[Ee.INFO=2]="INFO",Ee[Ee.WARN=3]="WARN",Ee[Ee.ERROR=4]="ERROR",Ee[Ee.SILENT=5]="SILENT";function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=u[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var o={debug:f.DEBUG,verbose:f.VERBOSE,info:f.INFO,warn:f.WARN,error:f.ERROR,silent:f.SILENT},a=f.INFO,u=((Te={})[f.DEBUG]="log",Te[f.VERBOSE]="log",Te[f.INFO]="info",Te[f.WARN]="warn",Te[f.ERROR]="error",Te),c=(Object.defineProperty(h.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in f))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),h.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(h.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),h.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.DEBUG],t)),this._logHandler.apply(this,s([this,f.DEBUG],t))},h.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.VERBOSE],t)),this._logHandler.apply(this,s([this,f.VERBOSE],t))},h.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.INFO],t)),this._logHandler.apply(this,s([this,f.INFO],t))},h.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.WARN],t)),this._logHandler.apply(this,s([this,f.WARN],t))},h.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,f.ERROR],t)),this._logHandler.apply(this,s([this,f.ERROR],t))},h);function h(t){this.name=t,this._logLevel=a,this._logHandler=i,this._userLogHandler=null}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var d,p="FirebaseError",v=(n(m,d=Error),m);function m(t,e,n){e=d.call(this,e)||this;return e.code=t,e.customData=n,e.name=p,Object.setPrototypeOf(e,m.prototype),Error.captureStackTrace&&Error.captureStackTrace(e,b.prototype.create),e}var b=(w.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r,i=e[0]||{},o=this.service+"/"+t,t=this.errors[t],t=t?(r=i,t.replace(E,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",t=this.serviceName+": "+t+" ("+o+").";return new v(o,t,i)},w);function w(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var E=/\{\$([^}]+)}/g,T=function(t,e){return(T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function I(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return{value:(t=t&&r>=t.length?void 0:t)&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var _,S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D={},A=S||self;function N(){}function C(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function k(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var x="closure_uid_"+(1e9*Math.random()>>>0),R=0;function L(t,e,n){return t.call.apply(t.bind,arguments)}function O(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function P(t,e,n){return(P=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?L:O).apply(null,arguments)}function M(e){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function F(){return Date.now()}function q(t,o){function e(){}e.prototype=o.prototype,t.X=o.prototype,t.prototype=new e,(t.prototype.constructor=t).Kb=function(t,e,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return o.prototype[e].apply(t,r)}}function V(){this.j=this.j,this.i=this.i}V.prototype.j=!1,V.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,x)&&t[x]||(t[x]=++R))},V.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var U=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},B=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function j(){return Array.prototype.concat.apply([],arguments)}function G(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var z,Q=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function H(t,e){return-1!=t.indexOf(e)}function W(t,e){return t<e?-1:e<t?1:0}t:{var Y=A.navigator;if(Y){Y=Y.userAgent;if(Y){z=Y;break t}}z=""}function X(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function J(t){var e,n={};for(e in t)n[e]=t[e];return n}var $="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Z(t){for(var e,n,r=1;r<arguments.length;r++){for(e in n=arguments[r])t[e]=n[e];for(var i=0;i<$.length;i++)e=$[i],Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}}function tt(t){return tt[" "](t),t}tt[" "]=N;var et,nt=H(z,"Opera"),rt=H(z,"Trident")||H(z,"MSIE"),it=H(z,"Edge"),ot=it||rt,st=H(z,"Gecko")&&!(H(z.toLowerCase(),"webkit")&&!H(z,"Edge"))&&!(H(z,"Trident")||H(z,"MSIE"))&&!H(z,"Edge"),at=H(z.toLowerCase(),"webkit")&&!H(z,"Edge");function ut(){var t=A.document;return t?t.documentMode:void 0}t:{var ct="",ht=(ht=z,st?/rv:([^\);]+)(\)|;)/.exec(ht):it?/Edge\/([\d\.]+)/.exec(ht):rt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ht):at?/WebKit\/(\S+)/.exec(ht):nt?/(?:Version)[ \/]?(\S+)/.exec(ht):void 0);if(ht&&(ct=ht?ht[1]:""),rt){ht=ut();if(null!=ht&&ht>parseFloat(ct)){et=String(ht);break t}}et=ct}var lt={};function ft(a){return t=a,e=function(){for(var t=0,e=Q(String(et)).split("."),n=Q(String(a)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++)for(var o=e[i]||"",s=n[i]||"";o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],(0!=o[0].length||0!=s[0].length)&&(t=W(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||W(0==o[2].length,0==s[2].length)||W(o[2],s[2]),o=o[3],s=s[3],0==t););return 0<=t},n=lt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var dt=A.document&&rt&&(ut()||parseInt(et,10))||void 0,pt=!rt||9<=Number(dt),yt=rt&&!ft("9"),gt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",N,e),A.removeEventListener("test",N,e)}catch(t){}return t}();function vt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function mt(t,e){if(vt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{tt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}vt.prototype.b=function(){this.defaultPrevented=!0},q(mt,vt);var bt={2:"touch",3:"pen",4:"mouse"};mt.prototype.b=function(){mt.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,yt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var wt="closure_listenable_"+(1e6*Math.random()|0),Et=0;function Tt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Et,this.Y=this.Z=!1}function It(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function St(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=U(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(It(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Dt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}_t.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Dt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Tt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var At="closure_lm_"+(1e6*Math.random()|0),Nt={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Ft(r);return e&&e[wt]?e.wa(n,r,k(i)?!!i.capture:!!i,o):kt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[wt]?t.va(e,n,k(r)?!!r.capture:!!r,i):kt(t,e,n,!1,r,i)}function kt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=k(i)?!!i.capture:!!i;if(s&&!pt)return null;var a,u,c=Pt(t);if(c||(t[At]=c=new _t(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(a=Ot,r=u=pt?function(t){return a.call(u.src,u.listener,t)}:function(t){if(!(t=a.call(u.src,u.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)void 0===(i=!gt?s:i)&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function xt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[wt]?St(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Rt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Pt(e))?(St(n,t),0==n.b&&(n.src=null,e[At]=null)):It(t)))}function Rt(t){return t in Nt?Nt[t]:Nt[t]="on"+t}function Lt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&xt(t),n.call(r,e)}function Ot(t,e){if(t.Y)return!0;if(pt)return Lt(t,new mt(e,this));if(!e)t:{e=["window","event"];for(var n=A,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Lt(t,e=new mt(e,this))}function Pt(t){return(t=t[At])instanceof _t?t:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==typeof e?e:(e[Mt]||(e[Mt]=function(t){return e.handleEvent(t)}),e[Mt])}function qt(){V.call(this),this.c=new _t(this),(this.J=this).C=null}function Vt(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e?e=new vt(e,t):e instanceof vt?e.target=e.target||t:(s=e,Z(e=new vt(r,t),s)),s=!0,n)for(var i=n.length-1;0<=i;i--)var o=e.a=n[i],s=Ut(o,r,!0,e)&&s;if(s=Ut(o=e.a=t,r,!0,e)&&s,s=Ut(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=Ut(o=e.a=n[i],r,!1,e)&&s}function Ut(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,a,u=e[o];u&&!u.Y&&u.capture==n&&(s=u.listener,a=u.ca||u.src,u.Z&&St(t.c,u),i=!1!==s.call(a,r)&&i)}return i&&!r.defaultPrevented}q(qt,V),qt.prototype[wt]=!0,(_=qt.prototype).addEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},_.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=k(i)?!!i.capture:!!i,r=Ft(r),e&&e[wt]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Dt(s=e.a[n],r,i,o))&&(It(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Pt(e))&&(n=e.a[n.toString()],(r=(e=-1)<(e=n?Dt(n,r,i,o):e)?n[e]:null)&&xt(r))}(this,t,e,n,r)},_.G=function(){if(qt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)It(n[r]);delete e.a[t],e.b--}}this.C=null},_.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},_.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Bt=A.JSON.stringify;function jt(){this.b=this.a=null}var Gt,Kt=(zt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new zt(function(){return new Qt},function(t){t.reset()}));function zt(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function Qt(){this.next=this.b=this.a=null}function Ht(t,e){var n;Gt||(n=A.Promise.resolve(void 0),Gt=function(){n.then(Xt)}),Wt||(Gt(),Wt=!0),Yt.add(t,e)}jt.prototype.add=function(t,e){var n=Kt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Qt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Wt=!(Qt.prototype.reset=function(){this.next=this.b=this.a=null}),Yt=new jt;function Xt(){for(var t,e;n=e=void 0,n=null,(e=Yt).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){A.setTimeout(function(){throw t},0)}(t)}var n=Kt;n.f(t),n.b<100&&(n.b++,t.next=n.a,n.a=t)}Wt=!1}function Jt(t,e){qt.call(this),this.b=t||1,this.a=e||A,this.f=P(this.Za,this),this.g=F()}function $t(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==typeof t)n&&(t=P(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=P(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}q(Jt,qt),(_=Jt.prototype).aa=!1,_.M=null,_.Za=function(){var t;this.aa&&(0<(t=F()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Vt(this,"tick"),this.aa&&($t(this),this.start())))},_.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=F())},_.G=function(){Jt.X.G.call(this),$t(this),delete this.a};var te,ee,ne,re=(T(ee=oe,ne=te=V),ee.prototype=null===ne?Object.create(ne):(ie.prototype=ne.prototype,new ie),oe.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},oe.prototype.G=function(){te.prototype.G.call(this),this.a&&(A.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},oe);function ie(){this.constructor=ee}function oe(t,e){var n=te.call(this)||this;return n.g=t,n.h=e,n.b=null,n.c=!1,n.a=null,n}function se(t){V.call(this),this.b=t,this.a={}}q(se,V);var ae=[];function ue(t,e,n,r){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ce(t){X(t.a,function(t,e){this.a.hasOwnProperty(e)&&xt(t)},t),t.a={}}function he(){this.a=!0}function le(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Bt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}se.prototype.G=function(){se.X.G.call(this),ce(this)},se.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},he.prototype.info=function(){};var fe={},de=null;function pe(){return de=de||new qt}function ye(t){vt.call(this,fe.Fa,t)}function ge(t){var e=pe();Vt(e,new ye(e))}function ve(t,e){vt.call(this,fe.STAT_EVENT,t),this.stat=e}function me(t){var e=pe();Vt(e,new ve(e,t))}function be(t){vt.call(this,fe.Ga,t)}function we(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}fe.Fa="serverreachability",q(ye,vt),fe.STAT_EVENT="statevent",q(ve,vt),fe.Ga="timingevent",q(be,vt);var Ee={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Te={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function Ie(){}function _e(t){var e;return e=!(e=t.a)?t.a={}:e}function Se(){}Ie.prototype.a=null;S={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function De(){vt.call(this,"d")}function Ae(){vt.call(this,"c")}function Ne(){}function Ce(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new se(this),this.P=xe,t=ot?125:void 0,this.R=new Jt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}q(De,vt),q(Ae,vt),q(Ne,Ie);var ke=new Ne,xe=45e3,Re={},Le={};function Oe(t,e,n){t.H=1,t.i=en(Ye(e)),t.j=n,t.I=!0,Pe(t,null)}function Pe(t,e){t.u=F(),Fe(t),t.l=Ye(t.i);var s,a,u,c,h,l,n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),yn(n.b,"t",r),t.D=0,t.a=ur(t.g,t.g.C?e:null),0<t.O&&(t.F=new re(P(t.Ca,t,t.a),t.O)),ue(t.J,t.a,"readystatechange",t.Xa),e=t.B?J(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ge(1),s=t.c,a=t.m,u=t.l,c=t.f,h=t.S,l=t.j,s.info(function(){if(s.a)if(l)for(var t="",e=l.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=l;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+a+"\n"+u+"\n"+t})}function Me(t,e,n){for(var r,i,o,s=!0;!t.A&&t.D<n.length;){var a=(a=n,o=i=void 0,i=(r=t).D,-1==(o=a.indexOf("\n",i))?Le:(i=Number(a.substring(i,o)),isNaN(i)?Re:(o+=1)+i>a.length?Le:(a=a.substr(o,i),r.D=o+i,a)));if(a==Le){4==e&&(t.h=4,me(14),s=!1),le(t.c,t.f,null,"[Incomplete Response]");break}if(a==Re){t.h=4,me(15),le(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}le(t.c,t.f,a,null),je(t,a)}4==e&&0==n.length&&(t.h=1,me(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),tr(e),e.F=!0,me(11))):(le(t.c,t.f,n,"[Invalid Chunked Response]"),Be(t),Ue(t))}function Fe(t){t.T=F()+t.P,qe(t,t.P)}function qe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=we(P(t.Va,t),e)}function Ve(t){t.o&&(A.clearTimeout(t.o),t.o=null)}function Ue(t){0==t.g.v||t.A||rr(t.g,t)}function Be(t){Ve(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,$t(t.R),ce(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function je(t,e){try{var n,r,i,o,s,a=t.g;if(0!=a.v&&(a.a==t||Tn(a.b,t)))if(a.I=t.N,!t.C&&Tn(a.b,t)&&3==a.v){try{var u=a.ka.a.parse(e)}catch(t){u=null}if(Array.isArray(u)&&3==u.length){var c=u;if(0==c[0]){t:if(!a.j){if(a.a){if(!(a.a.u+3e3<t.u))break t;nr(a),zn(a)}Zn(a),me(18)}}else a.oa=c[1],0<a.oa-a.P&&c[2]<37500&&a.H&&0==a.o&&!a.m&&(a.m=we(P(a.Sa,a),6e3));if(En(a.b)<=1&&a.ea){try{a.ea()}catch(t){}a.ea=void 0}}else or(a,11)}else if(!t.C&&a.a!=t||nr(a),!K(e))for(e=u=a.ka.a.parse(e),u=0;u<e.length;u++)c=e[u],a.P=c[0],c=c[1],2==a.v?"c"==c[0]?(a.J=c[1],a.ga=c[2],null!=(r=c[3])&&(a.ha=r,a.c.info("VER="+a.ha)),null!=(o=c[4])&&(a.pa=o,a.c.info("SVER="+a.pa)),null!=(r=c[5])&&"number"==typeof r&&0<r&&(n=1.5*r,a.D=n,a.c.info("backChannelRequestTimeoutMs_="+n)),n=a,(o=t.a)&&(!(r=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(i=n.b).a&&(H(r,"spdy")||H(r,"quic")||H(r,"h2"))&&(i.f=i.g,i.a=new Set,i.b&&(In(i,i.b),i.b=null)),!n.A||(s=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(n.na=s,tn(n.B,n.A,s))),a.v=3,a.f&&a.f.ta(),a.U&&(a.N=F()-t.u,a.c.info("Handshake RTT: "+a.N+"ms")),i=t,(n=a).la=ar(n,n.C?n.ga:null,n.fa),i.C?(_n(n.b,i),o=i,(s=n.D)&&o.setTimeout(s),o.o&&(Ve(o),Fe(o)),n.a=i):$n(n),0<a.g.length&&Wn(a)):"stop"!=c[0]&&"close"!=c[0]||or(a,7):3==a.v&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?or(a,7):Kn(a):"noop"!=c[0]&&a.f&&a.f.sa(c),a.o=0);ge(4)}catch(t){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||"string"==typeof t)B(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(C(t)||"string"==typeof t)for(var n=[],r=t.length,i=0;i<r;i++)n.push(i);else for(i in n=[],r=0,t)n[r++]=i;for(var i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ke(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ke)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function ze(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Qe(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Qe(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Qe(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(_=Ce.prototype).setTimeout=function(t){this.P=t},_.Xa=function(t){t=t.target;var e=this.F;e&&3==Un(t)?e.f():this.Ca(t)},_.Ca=function(t){try{if(t==this.a)t:{var e=Un(this.a),n=this.a.ua(),r=this.a.W();if(!(e<3||3==e&&!ot&&!this.a.$())){this.A||4!=e||7==n||ge(8==n||r<=0?3:2),Ve(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,r=this.c,u=this.m,c=this.l,h=this.f,l=this.S,f=e,d=i,r.info(function(){return"XMLHTTP RESP ("+h+") [ attempt "+l+"]: "+u+"\n"+c+"\n"+f+" "+d}),this.b){if(this.U&&!this.C){e:{if(this.a){var s=this.a;if((s=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,me(12),Be(this),Ue(this);break t}le(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,je(this,a)}this.I?(Me(this,e,o),ot&&this.b&&3==e&&(ue(this.J,this.R,"tick",this.Wa),this.R.start())):(le(this.c,this.f,o,null),je(this,o)),4==e&&Be(this),this.b&&!this.A&&(4==e?rr(this.g,this):(this.b=!1,Fe(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,me(12)):(this.h=0,me(13)),Be(this),Ue(this)}}}catch(t){}var u,c,h,l,f,d},_.Wa=function(){var t,e;this.a&&(t=Un(this.a),e=this.a.$(),this.D<e.length&&(Ve(this),Me(this,t,e),this.b&&4!=t&&Fe(this)))},_.cancel=function(){this.A=!0,Be(this)},_.Va=function(){this.o=null;var t,e,n=F();0<=n-this.T?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(ge(3),me(17)),Be(this),this.h=2,Ue(this)):qe(this,this.T-n)},(_=Ke.prototype).K=function(){ze(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},_.L=function(){return ze(this),this.a.concat()},_.get=function(t,e){return Qe(this.b,t)?this.b[t]:e},_.set=function(t,e){Qe(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},_.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var He=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function We(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof We?(this.a=void 0!==e?e:t.a,Xe(this,t.f),this.j=t.j,Je(this,t.c),$e(this,t.h),this.g=t.g,e=t.b,(n=new ln).c=e.c,e.a&&(n.a=new Ke(e.a),n.b=e.b),Ze(this,n),this.i=t.i):t&&(n=String(t).match(He))?(this.a=!!e,Xe(this,n[1]||"",!0),this.j=nn(n[2]||""),Je(this,n[3]||"",!0),$e(this,n[4]),this.g=nn(n[5]||"",!0),Ze(this,n[6]||"",!0),this.i=nn(n[7]||"")):(this.a=!!e,this.b=new ln(null,this.a))}function Ye(t){return new We(t)}function Xe(t,e,n){t.f=n?nn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Je(t,e,n){t.c=n?nn(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ze(t,e,n){var r,i;e instanceof ln?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(fn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(dn(this,e),yn(this,n,t))},r)),r.f=i):(n||(e=rn(e,cn)),t.b=new ln(e,t.a))}function tn(t,e,n){t.b.set(e,n)}function en(t){return tn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^F()).toString(36)),t}function nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,on),t=n?t.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):t):null}function on(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}We.prototype.toString=function(){var t=[],e=this.f;e&&t.push(rn(e,sn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(rn(e,sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(rn(n,"/"==n.charAt(0)?un:an,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",rn(n,hn)),t.join("")};var sn=/[#\/\?@]/g,an=/[#\?:]/g,un=/[#\?]/g,cn=/[#\?@]/g,hn=/#/g;function ln(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function fn(n){n.a||(n.a=new Ke,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function dn(t,e){fn(t),e=gn(t,e),Qe(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Qe((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&ze(t)))}function pn(t,e){return fn(t),e=gn(t,e),Qe(t.a.b,e)}function yn(t,e,n){dn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),G(n)),t.b+=n.length)}function gn(t,e){return e=String(e),e=t.f?e.toLowerCase():e}(_=ln.prototype).add=function(t,e){fn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},_.forEach=function(n,r){fn(this),this.a.forEach(function(t,e){B(t,function(t){n.call(r,t,e,this)},this)},this)},_.L=function(){fn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},_.K=function(t){fn(this);var e=[];if("string"==typeof t)pn(this,t)&&(e=j(e,this.a.get(gn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=j(e,t[n])}return e},_.set=function(t,e){return fn(this),this.c=null,pn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},_.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},_.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var vn=function(t,e){this.b=t,this.a=e};function mn(t){this.g=t||bn,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ia&&A.ia.ya&&A.ia.ya()&&A.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var bn=10;function wn(t){return t.b||t.a&&t.a.size>=t.f}function En(t){return t.b?1:t.a?t.a.size:0}function Tn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function In(t,e){t.a?t.a.add(e):t.b=e}function _n(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Sn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return G(t.c);var r=t.c;try{for(var i=I(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Dn(){}function An(){this.a=new Dn}function Nn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}mn.prototype.cancel=function(){var e,t;if(this.c=Sn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=I(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Dn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},Dn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Cn=A.JSON.parse;function kn(t){qt.call(this),this.headers=new Ke,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=xn,this.D=this.F=!1}q(kn,qt);var xn="",Rn=/^https?$/i,Ln=["POST","PUT"];function On(t){return"content-type"==t.toLowerCase()}function Pn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Mn(t),qn(t)}function Mn(t){t.u||(t.u=!0,Vt(t,"complete"),Vt(t,"error"))}function Fn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=Un(t)||2!=t.W()))if(t.l&&4==Un(t))Zt(t.za,0,t);else if(Vt(t,"readystatechange"),4==Un(t)){t.b=!1;try{var e,n,r,i,o=t.W();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}(e=s)||((n=0===o)&&(!(i=String(t.B).match(He)[1]||null)&&A.self&&A.self.location&&(i=(r=A.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n);if(e)Vt(t,"complete"),Vt(t,"success");else{t.h=6;try{var a=2<Un(t)?t.a.statusText:""}catch(o){a=""}t.f=a+" ["+t.W()+"]",Mn(t)}}finally{qn(t)}}}function qn(t,e){if(t.a){Vn(t);var n=t.a,r=t.s[0]?N:null;t.a=null,t.s=null,e||Vt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function Vn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Un(t){return t.a?t.a.readyState:0}function Bn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",X(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):tn(t,e,n))}function jn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.pa=0,this.g=[],this.c=new he,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=jn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=jn("baseRetryDelayMs",5e3,t),this.Ra=jn("retryDelaySeedMs",1e4,t),this.Ma=jn("forwardChannelMaxRetries",2,t),this.ma=jn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new mn(t&&t.concurrentRequestLimit),this.ka=new An,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Kn(t){var e,n;Qn(t),3==t.v&&(e=t.R++,tn(n=Ye(t.B),"SID",t.J),tn(n,"RID",e),tn(n,"TYPE","terminate"),Xn(t,n),(e=new Ce(t,t.c,e,void 0)).H=2,e.i=en(Ye(n)),n=!1,!(n=A.navigator&&A.navigator.sendBeacon?A.navigator.sendBeacon(e.i.toString(),""):n)&&A.Image&&((new Image).src=e.i,n=!0),n||(e.a=ur(e.g,null),e.a.ba(e.i)),e.u=F(),Fe(e)),sr(t)}function zn(t){t.a&&(tr(t),t.a.cancel(),t.a=null)}function Qn(t){zn(t),t.j&&(A.clearTimeout(t.j),t.j=null),nr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&A.clearTimeout(t.h),t.h=null)}function Hn(t,e){t.g.push(new vn(t.Oa++,e)),3==t.v&&Wn(t)}function Wn(t){wn(t.b)||t.h||(t.h=!0,Ht(t.Ba,t),t.u=0)}function Yn(t,e){var n=e?e.f:t.R++,r=Ye(t.B);tn(r,"SID",t.J),tn(r,"RID",n),tn(r,"AID",t.P),Xn(t,r),t.i&&t.l&&Bn(r,t.i,t.l),n=new Ce(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Jn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),In(t.b,n),Oe(n,r,e)}function Xn(t,n){t.f&&Ge({},function(t,e){tn(n,e,t)})}function Jn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?P(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if((c-=o)<0)o=Math.max(0,i[u].b-100),a=!1;else try{!function(t,r,e){var i=e||"";try{Ge(t,function(t,e){var n=t;k(t)&&(n=Bt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function $n(t){t.a||t.j||(t.T=1,Ht(t.Aa,t),t.o=0)}function Zn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=we(P(t.Aa,t),ir(t,t.o)),t.o++,1)}function tr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function er(t){t.a=new Ce(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ye(t.la);tn(e,"RID","rpc"),tn(e,"SID",t.J),tn(e,"CI",t.H?"0":"1"),tn(e,"AID",t.P),Xn(t,e),tn(e,"TYPE","xmlhttp"),t.i&&t.l&&Bn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=en(Ye(e)),n.j=null,n.I=!0,Pe(n,t)}function nr(t){null!=t.m&&(A.clearTimeout(t.m),t.m=null)}function rr(t,e){var n,r,i,o=null;if(t.a==e){nr(t),tr(t),t.a=null;var s=2}else{if(!Tn(t.b,e))return;o=e.s,_n(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)1==s?(o=e.j?e.j.length:0,e=F()-e.u,n=t.u,Vt(s=pe(),new be(s)),Wn(t)):$n(t);else if(3==(n=e.h)||0==n&&0<t.I||(1!=s||(i=e,En((r=t).b)>=r.b.f-(r.h?1:0)||(r.h?(r.g=i.s.concat(r.g),0):1==r.v||2==r.v||r.u>=(r.La?0:r.Ma)||(r.h=we(P(r.Ba,r,i),ir(r,r.u)),r.u++,0))))&&(2!=s||!Zn(t)))switch(o&&0<o.length&&(e=t.b,e.c=e.c.concat(o)),n){case 1:or(t,5);break;case 4:or(t,10);break;case 3:or(t,6);break;default:or(t,2)}}function ir(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function or(t,e){var n,r,i,o;t.c.info("Error code "+e),2==e?(r=null,t.f&&(r=null),o=P(t.Ya,t),r||(r=new We("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||Xe(r,"https"),en(r)),n=r.toString(),r=o,o=new he,A.Image?((i=new Image).onload=M(Nn,o,i,"TestLoadImage: loaded",!0,r),i.onerror=M(Nn,o,i,"TestLoadImage: error",!1,r),i.onabort=M(Nn,o,i,"TestLoadImage: abort",!1,r),i.ontimeout=M(Nn,o,i,"TestLoadImage: timeout",!1,r),A.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n):r(!1)):me(2),t.v=0,t.f&&t.f.ra(e),sr(t),Qn(t)}function sr(t){t.v=0,t.I=-1,t.f&&(0==Sn(t.b).length&&0==t.g.length||(t.b.c.length=0,G(t.g),t.g.length=0),t.f.qa())}function ar(t,e,n){var r,i,o,s,a,u=(s=n)instanceof We?Ye(s):new We(s,void 0);return""!=u.c?(e&&Je(u,e+"."+u.c),$e(u,u.h)):(a=A.location,r=a.protocol,i=e?e+"."+a.hostname:a.hostname,o=+a.port,s=n,a=new We(null,void 0),r&&Xe(a,r),i&&Je(a,i),o&&$e(a,o),s&&(a.g=s),u=a),t.V&&X(t.V,function(t,e){tn(u,e,t)}),e=t.A,n=t.na,e&&n&&tn(u,e,n),tn(u,"VER",t.ha),Xn(t,u),u}function ur(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new kn(t.Na)).F=t.C,e}function cr(){}function hr(){if(rt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function lr(t,e){qt.call(this),this.a=new Gn(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new pr(this)}function fr(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function dr(){Ae.call(this),this.status=1}function pr(t){this.a=t}(_=kn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?_e(this.H):_e(ke),this.a.onreadystatechange=P(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Pn(this,t)}t=n||"";var i,o=new Ke(this.headers);r&&Ge(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=On,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=A.FormData&&t instanceof A.FormData,0<=U(Ln,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Vn(this),0<this.o&&((this.D=(i=this.a,rt&&ft(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=P(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Pn(this,t)}},_.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Vt(this,"timeout"),this.abort(8))},_.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Vt(this,"complete"),Vt(this,"abort"),qn(this))},_.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),qn(this,!0)),kn.X.G.call(this)},_.za=function(){this.j||(this.A||this.l||this.g?Fn(this):this.Ua())},_.Ua=function(){Fn(this)},_.W=function(){try{return 2<Un(this)?this.a.status:-1}catch(t){return-1}},_.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},_.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Cn(e)}},_.ua=function(){return this.h},_.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(_=Gn.prototype).ha=8,_.v=1,_.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ce(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Z(r=J(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Jn(this,n,e),tn(i=Ye(this.B),"RID",t),tn(i,"CVER",22),this.A&&tn(i,"X-HTTP-Session-Id",this.A),Xn(this,i),this.i&&r&&Bn(i,this.i,r),In(this.b,n),this.Ia&&tn(i,"TYPE","init"),this.da?(tn(i,"$req",e),tn(i,"SID","null"),n.U=!0,Oe(n,i,null)):Oe(n,i,e),this.v=2}}else 3==this.v&&(t?Yn(this,t):0==this.g.length||wn(this.b)||Yn(this))},_.Aa=function(){var t;this.j=null,er(this),this.U&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=we(P(this.Ta,this),t))},_.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,me(10),zn(this),er(this))},_.Sa=function(){null!=this.m&&(this.m=null,zn(this),Zn(this),me(19))},_.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),me(2)):(this.c.info("Failed to ping google.com"),me(1))},(_=cr.prototype).ta=function(){},_.sa=function(){},_.ra=function(){},_.qa=function(){},_.Ja=function(){},hr.prototype.a=function(t,e){return new lr(t,e)},q(lr,qt),lr.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;me(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=ar(t,null,t.fa),Wn(t)},lr.prototype.close=function(){Kn(this.a)},lr.prototype.h=function(t){var e;"string"==typeof t?((e={}).__data__=t,Hn(this.a,e)):this.l?((e={}).__data__=Bt(t),Hn(this.a,e)):Hn(this.a,t)},lr.prototype.G=function(){this.a.f=null,delete this.f,Kn(this.a),delete this.a,lr.X.G.call(this)},q(fr,De),q(dr,Ae),q(pr,cr),pr.prototype.ta=function(){Vt(this.a,"a")},pr.prototype.sa=function(t){Vt(this.a,new fr(t))},pr.prototype.ra=function(t){Vt(this.a,new dr)},pr.prototype.qa=function(){Vt(this.a,"b")},hr.prototype.createWebChannel=hr.prototype.a,lr.prototype.send=lr.prototype.h,lr.prototype.open=lr.prototype.g,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Te.COMPLETE="complete",(Se.EventType=S).OPEN="a",S.CLOSE="b",S.ERROR="c",S.MESSAGE="d",qt.prototype.listen=qt.prototype.va,kn.prototype.listenOnce=kn.prototype.wa,kn.prototype.getLastError=kn.prototype.Qa,kn.prototype.getLastErrorCode=kn.prototype.ua,kn.prototype.getStatus=kn.prototype.W,kn.prototype.getResponseJson=kn.prototype.Pa,kn.prototype.getResponseText=kn.prototype.$,kn.prototype.send=kn.prototype.ba;var yr=pe,gr=Ee,vr=Te,mr=fe,br=10,wr=11,Er=Se,Tr=kn,Ir=(_r.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},_r.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},_r);function _r(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}Ir.o=-1;var Sr=new c("@firebase/firestore");function Dr(){return Sr.logLevel}function Ar(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Sr.logLevel<=f.DEBUG&&(e=n.map(kr),Sr.debug.apply(Sr,s(["Firestore (8.3.1): "+t],e)))}function Nr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Sr.logLevel<=f.ERROR&&(e=n.map(kr),Sr.error.apply(Sr,s(["Firestore (8.3.1): "+t],e)))}function Cr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Sr.logLevel<=f.WARN&&(e=n.map(kr),Sr.warn.apply(Sr,s(["Firestore (8.3.1): "+t],e)))}function kr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function xr(t){t="FIRESTORE (8.3.1) INTERNAL ASSERTION FAILED: "+(t=void 0===t?"Unexpected state":t);throw Nr(t),new Error(t)}function Rr(t){t||xr()}var Lr=(Or.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Or);function Or(){}function Pr(t,e){return t<e?-1:e<t?1:0}function Mr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Fr(t){return t+"\0"}function qr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Vr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ur(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Br(t){return null==t}function jr(t){return 0===t&&1/t==-1/0}function Gr(t){return"number"==typeof t&&Number.isInteger(t)&&!jr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Kr,zr,Qr,Hr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Wr=(n(oi,Qr=Error),oi),Te=(Object.defineProperty(ii.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),ii.prototype.isEqual=function(t){return 0===ii.comparator(this,t)},ii.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ii?t.forEach(function(t){e.push(t)}):e.push(t),this.construct(e)},ii.prototype.limit=function(){return this.offset+this.length},ii.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},ii.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},ii.prototype.firstSegment=function(){return this.segments[this.offset]},ii.prototype.lastSegment=function(){return this.get(this.length-1)},ii.prototype.get=function(t){return this.segments[this.offset+t]},ii.prototype.isEmpty=function(){return 0===this.length},ii.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ii.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ii.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ii.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},ii.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ii),Yr=(n(ri,zr=Te),ri.prototype.construct=function(t,e,n){return new ri(t,e,n)},ri.prototype.canonicalString=function(){return this.toArray().join("/")},ri.prototype.toString=function(){return this.canonicalString()},ri.fromString=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=[],r=0,i=t;r<i.length;r++){var o=i[r];if(0<=o.indexOf("//"))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid segment ("+o+"). Paths must not contain // in them.");n.push.apply(n,o.split("/").filter(function(t){return 0<t.length}))}return new ri(n)},ri.emptyPath=function(){return new ri([])},ri),Xr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Jr=(n(ni,Kr=Te),ni.prototype.construct=function(t,e,n){return new ni(t,e,n)},ni.isValidIdentifier=function(t){return Xr.test(t)},ni.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!ni.isValidIdentifier(t)?"`"+t+"`":t}).join(".")},ni.prototype.toString=function(){return this.canonicalString()},ni.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},ni.keyField=function(){return new ni(["__name__"])},ni.fromServerFormat=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Wr(Hr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var a=t[r+1];if("\\"!==a&&"."!==a&&"`"!==a)throw new Wr(Hr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=a,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Wr(Hr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ni(e)},ni.emptyPath=function(){return new ni([])},ni),$r=(ei.fromPath=function(t){return new ei(Yr.fromString(t))},ei.fromName=function(t){return new ei(Yr.fromString(t).popFirst(5))},ei.prototype.hasCollectionId=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},ei.prototype.isEqual=function(t){return null!==t&&0===Yr.comparator(this.path,t.path)},ei.prototype.toString=function(){return this.path.toString()},ei.comparator=function(t,e){return Yr.comparator(t.path,e.path)},ei.isDocumentKey=function(t){return t.length%2==0},ei.fromSegments=function(t){return new ei(new Yr(t.slice()))},ei),Zr=(ti.fromBase64String=function(t){return new ti(atob(t))},ti.fromUint8Array=function(t){return new ti(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ti.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},ti.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},ti.prototype.approximateByteSize=function(){return 2*this.binaryString.length},ti.prototype.compareTo=function(t){return Pr(this.binaryString,t.binaryString)},ti.prototype.isEqual=function(t){return this.binaryString===t.binaryString},ti);function ti(t){this.binaryString=t}function ei(t){this.path=t}function ni(){return null!==Kr&&Kr.apply(this,arguments)||this}function ri(){return null!==zr&&zr.apply(this,arguments)||this}function ii(t,e,n){void 0===e?e=0:e>t.length&&xr(),void 0===n?n=t.length-e:n>t.length-e&&xr(),this.segments=t,this.offset=e,this.len=n}function oi(t,e){var n=this;return(n=Qr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Zr.EMPTY_BYTE_STRING=new Zr("");var si=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ai(t){if(Rr(!!t),"string"!=typeof t)return{seconds:ui(t.seconds),nanos:ui(t.nanos)};var e=0,n=si.exec(t);Rr(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),e=Number(n));t=new Date(t);return{seconds:Math.floor(t.getTime()/1e3),nanos:e}}function ui(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ci(t){return"string"==typeof t?Zr.fromBase64String(t):Zr.fromUint8Array(t)}var hi=(li.now=function(){return li.fromMillis(Date.now())},li.fromDate=function(t){return li.fromMillis(t.getTime())},li.fromMillis=function(t){var e=Math.floor(t/1e3);return new li(e,1e6*(t-1e3*e))},li.prototype.toDate=function(){return new Date(this.toMillis())},li.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},li.prototype._compareTo=function(t){return this.seconds===t.seconds?Pr(this.nanoseconds,t.nanoseconds):Pr(this.seconds,t.seconds)},li.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},li.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},li.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},li.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},li);function li(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Wr(Hr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function fi(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function di(t){t=ai(t.mapValue.fields.__local_write_time__.timestampValue);return new hi(t.seconds,t.nanos)}function pi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?fi(t)?4:10:xr()}function yi(r,i){var t,e,n=pi(r);if(n!==pi(i))return!1;switch(n){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return di(r).isEqual(di(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=ai(r.timestampValue),t=ai(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return e=i,ci(r.bytesValue).isEqual(ci(e.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return t=i,ui((e=r).geoPointValue.latitude)===ui(t.geoPointValue.latitude)&&ui(e.geoPointValue.longitude)===ui(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ui(t.integerValue)===ui(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=ui(t.doubleValue),e=ui(e.doubleValue);return t===e?jr(t)===jr(e):isNaN(t)&&isNaN(e)}return!1}(r,i);case 9:return Mr(r.arrayValue.values||[],i.arrayValue.values||[],yi);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(qr(e)!==qr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!yi(e[t],n[t])))return!1;return!0}();default:return xr()}}function gi(t,e){return void 0!==(t.values||[]).find(function(t){return yi(t,e)})}function vi(t,e){var n,r,i,o=pi(t),s=pi(e);if(o!==s)return Pr(o,s);switch(o){case 0:return 0;case 1:return Pr(t.booleanValue,e.booleanValue);case 2:return r=e,i=ui(t.integerValue||t.doubleValue),r=ui(r.integerValue||r.doubleValue),i<r?-1:r<i?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1;case 3:return mi(t.timestampValue,e.timestampValue);case 4:return mi(di(t),di(e));case 5:return Pr(t.stringValue,e.stringValue);case 6:return function(t,e){t=ci(t),e=ci(e);return t.compareTo(e)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Pr(n[i],r[i]);if(0!==o)return o}return Pr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,i=e.geoPointValue,0!==(r=Pr(ui(n.latitude),ui(i.latitude)))?r:Pr(ui(n.longitude),ui(i.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=vi(n[i],r[i]);if(o)return o}return Pr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Pr(r[s],o[s]);if(0!==a)return a;a=vi(n[r[s]],i[o[s]]);if(0!==a)return a}return Pr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw xr()}}function mi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Pr(t,e);var n=ai(t),t=ai(e),e=Pr(n.seconds,t.seconds);return 0!==e?e:Pr(n.nanos,t.nanos)}function bi(t){return function s(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var t=ai(t);return"time("+t.seconds+","+t.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?ci(t.bytesValue).toBase64():"referenceValue"in t?(e=t.referenceValue,$r.fromName(e).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=s(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(t.mapValue):xr();var e}(t)}function wi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Ei(t){return t&&"integerValue"in t}function Ti(t){return!!t&&"arrayValue"in t}function Ii(t){return t&&"nullValue"in t}function _i(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Si(t){return t&&"mapValue"in t}var Di,Ai,Ni,c=function(t,e){this.key=t,this.version=e},Ci=(n(Pi,Ni=c),Pi.prototype.field=function(t){return this.objectValue.field(t)},Pi.prototype.data=function(){return this.objectValue},Pi.prototype.toProto=function(){return this.objectValue.proto},Pi.prototype.isEqual=function(t){return t instanceof Pi&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.objectValue.isEqual(t.objectValue)},Pi.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.objectValue.toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Pi.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Pi),ki=(n(Oi,Ai=c),Oi.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Oi.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Oi.prototype.isEqual=function(t){return t instanceof Oi&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Oi),xi=(n(Li,Di=c),Li.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Li.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Li.prototype.isEqual=function(t){return t instanceof Li&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Li),Ri=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Li(){return null!==Di&&Di.apply(this,arguments)||this}function Oi(t,e,n){var r=this;return(r=Ai.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Pi(t,e,n,r){var i=this;return(i=Ni.call(this,t,e)||this).objectValue=n,i.hasLocalMutations=!!r.hasLocalMutations,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Mi(t,e,n,r,i,o,s){return new Ri(t,e=void 0===e?null:e,n=void 0===n?[]:n,r=void 0===r?[]:r,i=void 0===i?null:i,o=void 0===o?null:o,s=void 0===s?null:s)}function Fi(t){var e=t;return null===e.h&&(t=e.path.canonicalString(),null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(function(t){return(t=t).field.canonicalString()+t.op.toString()+bi(t.value)}).join(","),t+="|ob:",t+=e.orderBy.map(function(t){return(t=t).field.canonicalString()+t.dir}).join(","),Br(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=fo(e.startAt)),e.endAt&&(t+="|ub:",t+=fo(e.endAt)),e.h=t),e.h}function qi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,a=0;a<t.filters.length;a++)if(o=t.filters[a],s=e.filters[a],o.op!==s.op||!o.field.isEqual(s.field)||!yi(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!go(t.startAt,e.startAt)&&go(t.endAt,e.endAt)}function Vi(t){return $r.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ui,Bi=(n(ji,Ui=function(){}),ji.create=function(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.l(t,e,n):new Qi(t,e,n):"array-contains"===e?new ro(t,n):"in"===e?new io(t,n):"not-in"===e?new oo(t,n):"array-contains-any"===e?new so(t,n):new ji(t,e,n)},ji.l=function(t,e,n){return new("in"===e?Hi:Wi)(t,n)},ji.prototype.matches=function(t){t=t.field(this.field);return"!="===this.op?null!==t&&this.m(vi(t,this.value)):null!==t&&pi(this.value)===pi(t)&&this.m(vi(t,this.value))},ji.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return xr()}},ji.prototype.g=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},ji);function ji(t,e,n){var r=this;return(r=Ui.call(this)||this).field=t,r.op=e,r.value=n,r}var Gi,Ki,zi,Qi=(n(Ji,zi=Bi),Ji.prototype.matches=function(t){t=$r.comparator(t.key,this.key);return this.m(t)},Ji),Hi=(n(Xi,Ki=Bi),Xi.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Xi),Wi=(n(Yi,Gi=Bi),Yi.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Yi);function Yi(t,e){var n=this;return(n=Gi.call(this,t,"not-in",e)||this).keys=$i(0,e),n}function Xi(t,e){var n=this;return(n=Ki.call(this,t,"in",e)||this).keys=$i(0,e),n}function Ji(t,e,n){var r=this;return(r=zi.call(this,t,e,n)||this).key=$r.fromName(n.referenceValue),r}function $i(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(function(t){return $r.fromName(t.referenceValue)})}var Zi,to,eo,no,ro=(n(lo,no=Bi),lo.prototype.matches=function(t){t=t.field(this.field);return Ti(t)&&gi(t.arrayValue,this.value)},lo),io=(n(ho,eo=Bi),ho.prototype.matches=function(t){t=t.field(this.field);return null!==t&&gi(this.value.arrayValue,t)},ho),oo=(n(co,to=Bi),co.prototype.matches=function(t){if(gi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.field(this.field);return null!==t&&!gi(this.value.arrayValue,t)},co),so=(n(uo,Zi=Bi),uo.prototype.matches=function(t){var e=this,t=t.field(this.field);return!(!Ti(t)||!t.arrayValue.values)&&t.arrayValue.values.some(function(t){return gi(e.value.arrayValue,t)})},uo),ao=function(t,e){this.position=t,this.before=e};function uo(t,e){return Zi.call(this,t,"array-contains-any",e)||this}function co(t,e){return to.call(this,t,"not-in",e)||this}function ho(t,e){return eo.call(this,t,"in",e)||this}function lo(t,e){return no.call(this,t,"array-contains",e)||this}function fo(t){return(t.before?"b":"a")+":"+t.position.map(bi).join(",")}var po=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function yo(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.isKeyField()?$r.comparator($r.fromName(s.referenceValue),n.key):vi(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function go(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!yi(t.position[n],e.position[n]))return!1;return!0}var vo=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function mo(t,e,n,r,i,o,s,a){return new vo(t,e,n,r,i,o,s,a)}function bo(t){return new vo(t)}function wo(t){return!Br(t.limit)&&"F"===t.limitType}function Eo(t){return!Br(t.limit)&&"L"===t.limitType}function To(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function Io(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function _o(t){return null!==t.collectionGroup}function So(t){var e=t;if(null===e.p){e.p=[];var n=Io(e),t=To(e);if(null!==n&&null===t)n.isKeyField()||e.p.push(new po(n)),e.p.push(new po(Jr.keyField(),"asc"));else{for(var r=!1,i=0,o=e.explicitOrderBy;i<o.length;i++){var s=o[i];e.p.push(s),s.field.isKeyField()&&(r=!0)}r||(n=0<e.explicitOrderBy.length?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",e.p.push(new po(Jr.keyField(),n)))}}return e.p}function Do(t){var e=t;if(!e.T)if("F"===e.limitType)e.T=Mi(e.path,e.collectionGroup,So(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=So(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new po(o.field,s))}var a=e.endAt?new ao(e.endAt.position,!e.endAt.before):null,t=e.startAt?new ao(e.startAt.position,!e.startAt.before):null;e.T=Mi(e.path,e.collectionGroup,n,e.filters,e.limit,a,t)}return e.T}function Ao(t,e,n){return new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function No(t,e){return qi(Do(t),Do(e))&&t.limitType===e.limitType}function Co(t){return Fi(Do(t))+"|lt:"+t.limitType}function ko(t){return"Query(target="+(e=Do(t),n=e.path.canonicalString(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(t=t).field.canonicalString()+" "+t.op+" "+bi(t.value)}).join(", ")+"]"),Br(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(t=t).field.canonicalString()+" ("+t.dir+")"}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+fo(e.startAt)),e.endAt&&(n+=", endAt: "+fo(e.endAt)),"Target("+n+")")+"; limitType="+t.limitType+")";var e,n}function xo(i,t){return e=i,n=t.key.path,(null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):$r.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n))&&function(t){for(var e=0,n=i.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(t=i).startAt||yo(t.startAt,So(t),n))&&(!t.endAt||!yo(t.endAt,So(t),n)));var e,n}function Ro(a){return function(t,e){for(var n=!1,r=0,i=So(a);r<i.length;r++){var o=i[r],s=function(t,r,e){var n=t.field.isKeyField()?$r.comparator(r.key,e.key):function(t,e){var n=r.field(t),t=e.field(t);return null!==n&&null!==t?vi(n,t):xr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return xr()}}(o,t,e);if(0!==s)return s;n=n||o.field.isKeyField()}return 0}}var Lo=(Uo.fromTimestamp=function(t){return new Uo(t)},Uo.min=function(){return new Uo(new hi(0,0))},Uo.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},Uo.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Uo.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Uo.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Uo.prototype.toTimestamp=function(){return this.timestamp},Uo),Oo=(Vo.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},Vo.prototype.isEqual=function(t){return Mr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Vo),Po=(qo.empty=function(){return new qo({mapValue:{}})},qo.prototype.field=function(t){if(t.isEmpty())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Si(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},qo.prototype.isEqual=function(t){return yi(this.proto,t.proto)},qo),Mo=(Fo.prototype.set=function(t,e){return this.R(t,e),this},Fo.prototype.delete=function(t){return this.R(t,null),this},Fo.prototype.R=function(t,e){for(var n=this.A,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===pi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.lastSegment(),e)},Fo.prototype.v=function(){var t=this.P(Jr.emptyPath(),this.A);return null!=t?new Po(t):this.I},Fo.prototype.P=function(r,t){var i=this,o=!1,e=this.I.field(r),s=Si(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.P(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Fo);function Fo(t){void 0===t&&(t=Po.empty()),this.I=t,this.A=new Map}function qo(t){this.proto=t}function Vo(t){(this.fields=t).sort(Jr.comparator)}function Uo(t){this.timestamp=t}function Bo(t,e){if(t.V){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:jr(e)?"-0":e}}function jo(t){return{integerValue:""+t}}function Go(t,e){return Gr(e)?jo(e):Bo(t,e)}Te=function(){this._=void 0};function Ko(t,e){return t instanceof rs?Ei(t=e)||t&&"doubleValue"in t?e:{integerValue:0}:null}var zo,Qo,Ho=(n(Xo,Qo=Te),Xo),Wo=(n(Yo,zo=Te),Yo);function Yo(t){var e=this;return(e=zo.call(this)||this).elements=t,e}function Xo(){return null!==Qo&&Qo.apply(this,arguments)||this}function Jo(t,e){for(var n=ss(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return yi(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var $o,Zo=(n(ts,$o=Te),ts);function ts(t){var e=this;return(e=$o.call(this)||this).elements=t,e}function es(t,e){for(var n=ss(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!yi(t,e)})}(i[r]);return{arrayValue:{values:n}}}var ns,rs=(n(is,ns=Te),is);function is(t,e){var n=this;return(n=ns.call(this)||this).D=t,n.S=e,n}function os(t){return ui(t.integerValue||t.doubleValue)}function ss(t){return Ti(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function as(t,e){this.version=t,this.transformResults=e}var us=function(t,e){this.field=t,this.transform=e},cs=(hs.none=function(){return new hs},hs.exists=function(t){return new hs(void 0,t)},hs.updateTime=function(t){return new hs(t)},Object.defineProperty(hs.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),hs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},hs);function hs(t,e){this.updateTime=t,this.exists=e}function ls(t,e){return void 0!==t.updateTime?e instanceof Ci&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Ci}c=function(){};function fs(t,e,n){return t instanceof vs?function(t,e,n){if(!ls(t.precondition,e))return e;var r=t.value,n=Is(t.fieldTransforms,n,e),r=_s(t.fieldTransforms,r,n),e=ps(e);return new Ci(t.key,e,r,{hasLocalMutations:!0})}(t,e,n):t instanceof ms?function(t,e,n){if(!ls(t.precondition,e))return e;var r=ps(e),e=Es(t,e,Is(t.fieldTransforms,n,e));return new Ci(t.key,r,e,{hasLocalMutations:!0})}(t,e,n):(e=e,ls((t=t).precondition,e)?new ki(t.key,Lo.min()):e)}function ds(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&(n=t.fieldTransforms,r=e.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&Mr(n,r,function(t,e){return e=e,(t=t).field.isEqual(e.field)&&(t=t.transform,e=e.transform,t instanceof Wo&&e instanceof Wo||t instanceof Zo&&e instanceof Zo?Mr(t.elements,e.elements,yi):t instanceof rs&&e instanceof rs?yi(t.S,e.S):t instanceof Ho&&e instanceof Ho)})))&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask));var n,r}function ps(t){return t instanceof Ci?t.version:Lo.min()}var ys,gs,vs=(n(ws,gs=c),ws),ms=(n(bs,ys=c),bs);function bs(t,e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=ys.call(this)||this).key=t,o.data=e,o.fieldMask=n,o.precondition=r,o.fieldTransforms=i,o.type=1,o}function ws(t,e,n,r){void 0===r&&(r=[]);var i=this;return(i=gs.call(this)||this).key=t,i.value=e,i.precondition=n,i.fieldTransforms=r,i.type=0,i}function Es(t,e,n){var r,i,o;return i=t,e=r=e instanceof Ci?e.data():Po.empty(),o=new Mo(e),i.fieldMask.fields.forEach(function(t){var e;t.isEmpty()||(null!==(e=i.data.field(t))?o.set(t,e):o.delete(t))}),r=o.v(),_s(t.fieldTransforms,r,n)}function Ts(t,e,n){var r=[];Rr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=null;e instanceof Ci&&(a=e.field(o.field)),r.push((o=s,s=a,a=n[i],o instanceof Wo?Jo(o,s):o instanceof Zo?es(o,s):a))}return r}function Is(t,e,n){for(var r,i=[],o=0,s=t;o<s.length;o++){var a=s[o],u=a.transform,c=null;n instanceof Ci&&(c=n.field(a.field)),i.push((r=c,a=e,c=void 0,(u=u)instanceof Ho?(c={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}},r&&(c.fields.__previous_value__=r),{mapValue:c}):u instanceof Wo?Jo(u,r):u instanceof Zo?es(u,r):(u=Ko(c=u,r),r=os(u)+os(c.S),Ei(u)&&Ei(c.S)?jo(r):Bo(c.D,r))))}return i}function _s(t,e,n){for(var r=new Mo(e),i=0;i<t.length;i++){var o=t[i];r.set(o.field,n[i])}return r.v()}function Ss(t){this.count=t}var Ds,As,Ns,Cs=(n(Rs,Ns=c),Rs),ks=(n(xs,As=c),xs);function xs(t,e){var n=this;return(n=As.call(this)||this).key=t,n.precondition=e,n.type=3,n.fieldTransforms=[],n}function Rs(t,e){var n=this;return(n=Ns.call(this)||this).key=t,n.precondition=e,n.type=2,n.fieldTransforms=[],n}function Ls(t){switch(t){case Hr.OK:return xr(),0;case Hr.CANCELLED:case Hr.UNKNOWN:case Hr.DEADLINE_EXCEEDED:case Hr.RESOURCE_EXHAUSTED:case Hr.INTERNAL:case Hr.UNAVAILABLE:case Hr.UNAUTHENTICATED:return;case Hr.INVALID_ARGUMENT:case Hr.NOT_FOUND:case Hr.ALREADY_EXISTS:case Hr.PERMISSION_DENIED:case Hr.FAILED_PRECONDITION:case Hr.ABORTED:case Hr.OUT_OF_RANGE:case Hr.UNIMPLEMENTED:case Hr.DATA_LOSS:return 1;default:return xr(),0}}function Os(t){if(void 0===t)return Nr("GRPC error has no .code"),Hr.UNKNOWN;switch(t){case Ds.OK:return Hr.OK;case Ds.CANCELLED:return Hr.CANCELLED;case Ds.UNKNOWN:return Hr.UNKNOWN;case Ds.DEADLINE_EXCEEDED:return Hr.DEADLINE_EXCEEDED;case Ds.RESOURCE_EXHAUSTED:return Hr.RESOURCE_EXHAUSTED;case Ds.INTERNAL:return Hr.INTERNAL;case Ds.UNAVAILABLE:return Hr.UNAVAILABLE;case Ds.UNAUTHENTICATED:return Hr.UNAUTHENTICATED;case Ds.INVALID_ARGUMENT:return Hr.INVALID_ARGUMENT;case Ds.NOT_FOUND:return Hr.NOT_FOUND;case Ds.ALREADY_EXISTS:return Hr.ALREADY_EXISTS;case Ds.PERMISSION_DENIED:return Hr.PERMISSION_DENIED;case Ds.FAILED_PRECONDITION:return Hr.FAILED_PRECONDITION;case Ds.ABORTED:return Hr.ABORTED;case Ds.OUT_OF_RANGE:return Hr.OUT_OF_RANGE;case Ds.UNIMPLEMENTED:return Hr.UNIMPLEMENTED;case Ds.DATA_LOSS:return Hr.DATA_LOSS;default:return xr()}}(Te=Ds=Ds||{})[Te.OK=0]="OK",Te[Te.CANCELLED=1]="CANCELLED",Te[Te.UNKNOWN=2]="UNKNOWN",Te[Te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Te[Te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Te[Te.NOT_FOUND=5]="NOT_FOUND",Te[Te.ALREADY_EXISTS=6]="ALREADY_EXISTS",Te[Te.PERMISSION_DENIED=7]="PERMISSION_DENIED",Te[Te.UNAUTHENTICATED=16]="UNAUTHENTICATED",Te[Te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Te[Te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Te[Te.ABORTED=10]="ABORTED",Te[Te.OUT_OF_RANGE=11]="OUT_OF_RANGE",Te[Te.UNIMPLEMENTED=12]="UNIMPLEMENTED",Te[Te.INTERNAL=13]="INTERNAL",Te[Te.UNAVAILABLE=14]="UNAVAILABLE",Te[Te.DATA_LOSS=15]="DATA_LOSS";var Ps=(Us.prototype.insert=function(t,e){return new Us(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Fs.BLACK,null,null))},Us.prototype.remove=function(t){return new Us(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Fs.BLACK,null,null))},Us.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Us.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Us.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(Us.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Us.prototype.minKey=function(){return this.root.minKey()},Us.prototype.maxKey=function(){return this.root.maxKey()},Us.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},Us.prototype.forEach=function(n){this.inorderTraversal(function(t,e){return n(t,e),!1})},Us.prototype.toString=function(){var n=[];return this.inorderTraversal(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Us.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},Us.prototype.getIterator=function(){return new Ms(this.root,null,this.comparator,!1)},Us.prototype.getIteratorFrom=function(t){return new Ms(this.root,t,this.comparator,!1)},Us.prototype.getReverseIterator=function(){return new Ms(this.root,null,this.comparator,!0)},Us.prototype.getReverseIteratorFrom=function(t){return new Ms(this.root,t,this.comparator,!0)},Us),Ms=(Vs.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},Vs.prototype.hasNext=function(){return 0<this.nodeStack.length},Vs.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},Vs),Fs=(qs.prototype.copy=function(t,e,n,r,i){return new qs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},qs.prototype.isEmpty=function(){return!1},qs.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},qs.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},qs.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},qs.prototype.minKey=function(){return this.min().key},qs.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},qs.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},qs.prototype.removeMin=function(){if(this.left.isEmpty())return qs.EMPTY;var t=this;return(t=(t=!t.left.isRed()&&!t.left.left.isRed()?t.moveRedLeft():t).copy(null,null,null,t.left.removeMin(),null)).fixUp()},qs.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r=(r=!(r.left.isEmpty()||r.left.isRed()||r.left.left.isRed())?r.moveRedLeft():r).copy(null,null,null,r.left.remove(t,e),null);else{if(0===e(t,(r=!((r=r.left.isRed()?r.rotateRight():r).right.isEmpty()||r.right.isRed()||r.right.left.isRed())?r.moveRedRight():r).key)){if(r.right.isEmpty())return qs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()},qs.prototype.isRed=function(){return this.color},qs.prototype.fixUp=function(){var t=this;return t=(t=(t=t.right.isRed()&&!t.left.isRed()?t.rotateLeft():t).left.isRed()&&t.left.left.isRed()?t.rotateRight():t).left.isRed()&&t.right.isRed()?t.colorFlip():t},qs.prototype.moveRedLeft=function(){var t=this.colorFlip();return t=t.right.left.isRed()?(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip():t},qs.prototype.moveRedRight=function(){var t=this.colorFlip();return t=t.left.left.isRed()?(t=t.rotateRight()).colorFlip():t},qs.prototype.rotateLeft=function(){var t=this.copy(null,null,qs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},qs.prototype.rotateRight=function(){var t=this.copy(null,null,qs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},qs.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},qs.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},qs.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw xr();if(this.right.isRed())throw xr();var t=this.left.check();if(t!==this.right.check())throw xr();return t+(this.isRed()?0:1)},qs);function qs(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:qs.RED,this.left=null!=r?r:qs.EMPTY,this.right=null!=i?i:qs.EMPTY,this.size=this.left.size+1+this.right.size}function Vs(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}function Us(t,e){this.comparator=t,this.root=e||Fs.EMPTY}function Bs(){this.size=0}Fs.EMPTY=null,Fs.RED=!0,Fs.BLACK=!1,Fs.EMPTY=(Object.defineProperty(Bs.prototype,"key",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Bs.prototype,"value",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Bs.prototype,"color",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Bs.prototype,"left",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Object.defineProperty(Bs.prototype,"right",{get:function(){throw xr()},enumerable:!1,configurable:!0}),Bs.prototype.copy=function(t,e,n,r,i){return this},Bs.prototype.insert=function(t,e,n){return new Fs(t,e)},Bs.prototype.remove=function(t,e){return this},Bs.prototype.isEmpty=function(){return!0},Bs.prototype.inorderTraversal=function(t){return!1},Bs.prototype.reverseTraversal=function(t){return!1},Bs.prototype.minKey=function(){return null},Bs.prototype.maxKey=function(){return null},Bs.prototype.isRed=function(){return!1},Bs.prototype.checkMaxDepth=function(){return!0},Bs.prototype.check=function(){return 0},new Bs);var js=(Qs.prototype.has=function(t){return null!==this.data.get(t)},Qs.prototype.first=function(){return this.data.minKey()},Qs.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(Qs.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Qs.prototype.indexOf=function(t){return this.data.indexOf(t)},Qs.prototype.forEach=function(n){this.data.inorderTraversal(function(t,e){return n(t),!1})},Qs.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,t[1]))return;e(r.key)}},Qs.prototype.forEachWhile=function(t,e){for(var n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},Qs.prototype.firstAfterOrEqual=function(t){t=this.data.getIteratorFrom(t);return t.hasNext()?t.getNext().key:null},Qs.prototype.getIterator=function(){return new Gs(this.data.getIterator())},Qs.prototype.getIteratorFrom=function(t){return new Gs(this.data.getIteratorFrom(t))},Qs.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},Qs.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Qs.prototype.isEmpty=function(){return this.data.isEmpty()},Qs.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Qs.prototype.isEqual=function(t){if(!(t instanceof Qs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.getIterator(),n=t.data.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(r,i))return!1}return!0},Qs.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Qs.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Qs.prototype.copy=function(t){var e=new Qs(this.comparator);return e.data=t,e},Qs),Gs=(zs.prototype.getNext=function(){return this.iter.getNext().key},zs.prototype.hasNext=function(){return this.iter.hasNext()},zs),Ks=new Ps($r.comparator);function zs(t){this.iter=t}function Qs(t){this.comparator=t,this.data=new Ps(this.comparator)}var Hs=new Ps($r.comparator);var Ws=new Ps($r.comparator);var Ys=new js($r.comparator);function Xs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ys,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Js=new js(Pr);var $s=(ua.createSynthesizedRemoteEventForCurrentChange=function(t,e){var n=new Map;return n.set(t,Zs.createSynthesizedTargetChangeForCurrentChange(t,e)),new ua(Lo.min(),n,Js,Ks,Xs())},ua),Zs=(aa.createSynthesizedTargetChangeForCurrentChange=function(t,e){return new aa(Zr.EMPTY_BYTE_STRING,e,Xs(),Xs(),Xs())},aa),ta=function(t,e,n,r){this.C=t,this.removedTargetIds=e,this.key=n,this.N=r},ea=function(t,e){this.targetId=t,this.$=e},na=function(t,e,n,r){void 0===n&&(n=Zr.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ra=(Object.defineProperty(sa.prototype,"current",{get:function(){return this.M},enumerable:!1,configurable:!0}),Object.defineProperty(sa.prototype,"resumeToken",{get:function(){return this.k},enumerable:!1,configurable:!0}),Object.defineProperty(sa.prototype,"B",{get:function(){return 0!==this.F},enumerable:!1,configurable:!0}),Object.defineProperty(sa.prototype,"q",{get:function(){return this.L},enumerable:!1,configurable:!0}),sa.prototype.U=function(t){0<t.approximateByteSize()&&(this.L=!0,this.k=t)},sa.prototype.K=function(){var n=Xs(),r=Xs(),i=Xs();return this.O.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:xr()}}),new Zs(this.k,this.M,n,r,i)},sa.prototype.W=function(){this.L=!1,this.O=ha()},sa.prototype.j=function(t,e){this.L=!0,this.O=this.O.insert(t,e)},sa.prototype.G=function(t){this.L=!0,this.O=this.O.remove(t)},sa.prototype.H=function(){this.F+=1},sa.prototype.J=function(){--this.F},sa.prototype.Y=function(){this.L=!0,this.M=!0},sa),ia=(oa.prototype.st=function(t){for(var e=0,n=t.C;e<n.length;e++){var r=n[e];t.N instanceof Ci?this.it(r,t.N):t.N instanceof ki&&this.rt(r,t.key,t.N)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.rt(r,t.key,t.N)},oa.prototype.ot=function(n){var r=this;this.forEachTarget(n,function(t){var e=r.ct(t);switch(n.state){case 0:r.at(t)&&e.U(n.resumeToken);break;case 1:e.J(),e.B||e.W(),e.U(n.resumeToken);break;case 2:e.J(),e.B||r.removeTarget(t);break;case 3:r.at(t)&&(e.Y(),e.U(n.resumeToken));break;case 4:r.at(t)&&(r.ut(t),e.U(n.resumeToken));break;default:xr()}})},oa.prototype.forEachTarget=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Z.forEach(function(t,e){r.at(e)&&n(e)})},oa.prototype.ht=function(t){var e=t.targetId,n=t.$.count,t=this.lt(e);t&&(Vi(t=t.target)?0===n?(t=new $r(t.path),this.rt(e,t,new ki(t,Lo.min()))):Rr(1===n):this.ft(e)!==n&&(this.ut(e),this.nt=this.nt.add(e)))},oa.prototype.dt=function(r){var i=this,o=new Map;this.Z.forEach(function(t,e){var n=i.lt(e);n&&(t.current&&Vi(n.target)&&(n=new $r(n.target.path),null!==i.tt.get(n)||i.wt(e,n)||i.rt(e,n,new ki(n,r))),t.q&&(o.set(e,t.K()),t.W()))});var s=Xs();this.et.forEach(function(t,e){var n=!0;e.forEachWhile(function(t){t=i.lt(t);return!t||2===t.purpose||(n=!1)}),n&&(s=s.add(t))});var t=new $s(r,o,this.nt,this.tt,s);return this.tt=Ks,this.et=ca(),this.nt=new js(Pr),t},oa.prototype.it=function(t,e){var n;this.at(t)&&(n=this.wt(t,e.key)?2:0,this.ct(t).j(e.key,n),this.tt=this.tt.insert(e.key,e),this.et=this.et.insert(e.key,this._t(e.key).add(t)))},oa.prototype.rt=function(t,e,n){var r;this.at(t)&&(r=this.ct(t),this.wt(t,e)?r.j(e,1):r.G(e),this.et=this.et.insert(e,this._t(e).delete(t)),n&&(this.tt=this.tt.insert(e,n)))},oa.prototype.removeTarget=function(t){this.Z.delete(t)},oa.prototype.ft=function(t){var e=this.ct(t).K();return this.X.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},oa.prototype.H=function(t){this.ct(t).H()},oa.prototype.ct=function(t){var e=this.Z.get(t);return e||(e=new ra,this.Z.set(t,e)),e},oa.prototype._t=function(t){var e=this.et.get(t);return e||(e=new js(Pr),this.et=this.et.insert(t,e)),e},oa.prototype.at=function(t){var e=null!==this.lt(t);return e||Ar("WatchChangeAggregator","Detected inactive target",t),e},oa.prototype.lt=function(t){var e=this.Z.get(t);return e&&e.B?null:this.X.yt(t)},oa.prototype.ut=function(e){var n=this;this.Z.set(e,new ra),this.X.getRemoteKeysForTarget(e).forEach(function(t){n.rt(e,t,null)})},oa.prototype.wt=function(t,e){return this.X.getRemoteKeysForTarget(t).has(e)},oa);function oa(t){this.X=t,this.Z=new Map,this.tt=Ks,this.et=ca(),this.nt=new js(Pr)}function sa(){this.F=0,this.O=ha(),this.k=Zr.EMPTY_BYTE_STRING,this.M=!1,this.L=!0}function aa(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}function ua(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}function ca(){return new Ps($r.comparator)}function ha(){return new Ps($r.comparator)}var la={asc:"ASCENDING",desc:"DESCENDING"},fa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},da=function(t,e){this.databaseId=t,this.V=e};function pa(t,e){return t.V?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ya(t,e){return t.V?e.toBase64():e.toUint8Array()}function ga(t){return Rr(!!t),Lo.fromTimestamp((t=ai(t),new hi(t.seconds,t.nanos)))}function va(t,e){return new Yr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function ma(t){t=Yr.fromString(t);return Rr(qa(t)),t}function ba(t,e){return va(t.databaseId,e.path)}function wa(t,e){e=ma(e);if(e.get(1)!==t.databaseId.projectId)throw new Wr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+t.databaseId.projectId);if(e.get(3)!==t.databaseId.database)throw new Wr(Hr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+t.databaseId.database);return new $r(_a(e))}function Ea(t,e){return va(t.databaseId,e)}function Ta(t){t=ma(t);return 4===t.length?Yr.emptyPath():_a(t)}function Ia(t){return new Yr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function _a(t){return Rr(4<t.length&&"documents"===t.get(4)),t.popFirst(5)}function Sa(t,e,n){return{name:ba(t,e),fields:n.proto.mapValue.fields}}function Da(t,e,n){var r=wa(t,e.name),t=ga(e.updateTime),e=new Po({mapValue:{fields:e.fields}});return new Ci(r,t,e,{hasCommittedMutations:!!n})}function Aa(t,e){var n,r,i;if(e instanceof vs)n={update:Sa(t,e.key,e.value)};else if(e instanceof Cs)n={delete:ba(t,e.key)};else if(e instanceof ms)n={update:Sa(t,e.key,e.data),updateMask:(i=e.fieldMask,r=[],i.fields.forEach(function(t){return r.push(t.canonicalString())}),{fieldPaths:r})};else{if(!(e instanceof ks))return xr();n={verify:ba(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Ho)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof Wo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof Zo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof rs)return{fieldPath:t.field.canonicalString(),increment:e.S};throw xr()})),e.precondition.isNone||(n.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:(e=t,t=i.updateTime,pa(e,t.toTimestamp()))}:void 0!==i.exists?{exists:i.exists}:xr()),n}function Na(e,t){var n=t.currentDocument?void 0!==(s=t.currentDocument).updateTime?cs.updateTime(ga(s.updateTime)):void 0!==s.exists?cs.exists(s.exists):cs.none():cs.none(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(t,e){var n,r=null;"setToServerValue"in e?(Rr("REQUEST_TIME"===e.setToServerValue),r=new Ho):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],r=new Wo(n)):"removeAllFromArray"in e?(n=e.removeAllFromArray.values||[],r=new Zo(n)):"increment"in e?r=new rs(t,e.increment):xr();e=Jr.fromServerFormat(e.fieldPath);return new us(e,r)}(e,t)}):[];if(t.update){t.update.name;var i=wa(e,t.update.name),o=new Po({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(s=t.updateMask.fieldPaths||[],new Oo(s.map(function(t){return Jr.fromServerFormat(t)})));return new ms(i,o,s,n,r)}return new vs(i,o,n,r)}if(t.delete){r=wa(e,t.delete);return new Cs(r,n)}if(t.verify){t=wa(e,t.verify);return new ks(t,n)}return xr()}function Ca(t,e){return{documents:[Ea(t,e.path)]}}function ka(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ea(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ea(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);r=function(t){if(0!==t.length){t=t.map(function(t){if("=="===t.op){if(_i(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NAN"}};if(Ii(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(_i(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NOT_NAN"}};if(Ii(t.value))return{unaryFilter:{field:Oa(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Oa(t.field),op:(e=t.op,fa[e]),value:t.value}};var e});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);r&&(n.structuredQuery.where=r);r=function(t){if(0!==t.length)return t.map(function(t){return{field:Oa((t=t).field),direction:(t=t.dir,la[t])}})}(e.orderBy);r&&(n.structuredQuery.orderBy=r);r=e.limit,r=t.V||Br(r)?r:{value:r};return null!==r&&(n.structuredQuery.limit=r),e.startAt&&(n.structuredQuery.startAt=Ra(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ra(e.endAt)),n}function xa(t){var e=Ta(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;0<r&&(Rr(1===r),(a=n.from[0]).allDescendants?i=a.collectionId:e=e.child(a.collectionId));var o=[];n.where&&(o=function e(t){return t?void 0!==t.unaryFilter?[Fa(t)]:void 0!==t.fieldFilter?[Ma(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e(t)}).reduce(function(t,e){return t.concat(e)}):xr():[]}(n.where));var s=[],t=null,r=null,a=null;return mo(e,i,s=n.orderBy?n.orderBy.map(function(t){return new po(Pa((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}):s,o,t=n.limit?Br(o="object"==typeof(o=n.limit)?o.value:o)?null:o:t,"F",r=n.startAt?La(n.startAt):r,a=n.endAt?La(n.endAt):a)}function Ra(t){return{before:t.before,values:t.position}}function La(t){var e=!!t.before,t=t.values||[];return new ao(t,e)}function Oa(t){return{fieldPath:t.canonicalString()}}function Pa(t){return Jr.fromServerFormat(t.fieldPath)}function Ma(t){return Bi.create(Pa(t.fieldFilter.field),function(){switch(t.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return xr()}}(),t.fieldFilter.value)}function Fa(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Pa(t.unaryFilter.field);return Bi.create(e,"==",{doubleValue:NaN});case"IS_NULL":e=Pa(t.unaryFilter.field);return Bi.create(e,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=Pa(t.unaryFilter.field);return Bi.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":n=Pa(t.unaryFilter.field);return Bi.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return xr()}}function qa(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Va(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ua(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}(t.get(n),e);return Ua(e)}function Ua(t){return t+"\x01\x01"}function Ba(t){var e=t.length;if(Rr(2<=e),2===e)return Rr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Yr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&xr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:xr()}o=s+2}return new Yr(r)}function ja(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}var Ga=function(t,e){this.seconds=t,this.nanoseconds=e};ja.store="owner",ja.key="owner";function Ka(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}Ka.store="mutationQueues",Ka.keyPath="userId";function za(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}za.store="mutations",za.keyPath="batchId",za.userMutationsIndex="userMutationsIndex",za.userMutationsKeyPath=["userId","batchId"];var Qa=(Ha.prefixForUser=function(t){return[t]},Ha.prefixForPath=function(t,e){return[t,Va(e)]},Ha.key=function(t,e,n){return[t,Va(e),n]},Ha);function Ha(){}Qa.store="documentMutations",Qa.PLACEHOLDER=new Qa;function Wa(t,e){this.path=t,this.readTime=e}function Ya(t,e){this.path=t,this.version=e}var Xa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Xa.store="remoteDocuments",Xa.readTimeIndex="readTimeIndex",Xa.readTimeIndexPath="readTime",Xa.collectionReadTimeIndex="collectionReadTimeIndex",Xa.collectionReadTimeIndexPath=["parentPath","readTime"];function Ja(t){this.byteSize=t}Ja.store="remoteDocumentGlobal",Ja.key="remoteDocumentGlobalKey";function $a(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}$a.store="targets",$a.keyPath="targetId",$a.queryTargetsIndexName="queryTargetsIndex",$a.queryTargetsKeyPath=["canonicalId","targetId"];var Za=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Za.store="targetDocuments",Za.keyPath=["targetId","path"],Za.documentTargetsIndex="documentTargetsIndex",Za.documentTargetsKeyPath=["path","targetId"];function tu(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}tu.key="targetGlobalKey",tu.store="targetGlobal";function eu(t,e){this.collectionId=t,this.parent=e}eu.store="collectionParents",eu.keyPath=["collectionId","parent"];function nu(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}nu.store="clientMetadata",nu.keyPath="clientId";function ru(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}ru.store="bundles",ru.keyPath="bundleId";function iu(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}iu.store="namedQueries",iu.keyPath="name";var ou,su=s(s([],s(s([],s(s([],s(s([],[Ka.store,za.store,Qa.store,Xa.store,$a.store,ja.store,tu.store,Za.store]),[nu.store])),[Ja.store])),[eu.store])),[ru.store,iu.store]),au="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",c=(bu.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},bu.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},bu),uu=function(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})},cu=(mu.prototype.catch=function(t){return this.next(void 0,t)},mu.prototype.next=function(r,i){var o=this;return this.callbackAttached&&xr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(i,this.error):this.wrapSuccess(r,this.result):new mu(function(e,n){o.nextCallback=function(t){o.wrapSuccess(r,t).next(e,n)},o.catchCallback=function(t){o.wrapFailure(i,t).next(e,n)}})},mu.prototype.toPromise=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},mu.prototype.wrapUserFunction=function(t){try{var e=t();return e instanceof mu?e:mu.resolve(e)}catch(t){return mu.reject(t)}},mu.prototype.wrapSuccess=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):mu.resolve(e)},mu.prototype.wrapFailure=function(t,e){return t?this.wrapUserFunction(function(){return t(e)}):mu.reject(e)},mu.resolve=function(n){return new mu(function(t,e){t(n)})},mu.reject=function(n){return new mu(function(t,e){e(n)})},mu.waitFor=function(t){return new mu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},mu.or=function(t){for(var n=mu.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?mu.resolve(t):e()})}(r[e]);return n},mu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.waitFor(i)},mu),hu=(vu.open=function(t,e,n,r){try{return new vu(e,t.transaction(r,n))}catch(t){throw new du(e,t)}},Object.defineProperty(vu.prototype,"Et",{get:function(){return this.gt.promise},enumerable:!1,configurable:!0}),vu.prototype.abort=function(t){t&&this.gt.reject(t),this.aborted||(Ar("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},vu.prototype.store=function(t){t=this.transaction.objectStore(t);return new Eu(t)},vu),lu=(gu.delete=function(t){return Ar("SimpleDb","Removing database:",t),Iu(window.indexedDB.deleteDatabase(t)).toPromise()},gu.At=function(){if("undefined"==typeof indexedDB)return!1;if(gu.Rt())return!0;var t=l(),e=gu.It(t),n=0<e&&e<10,e=gu.bt(t),e=0<e&&e<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||e)},gu.Rt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.vt)},gu.Pt=function(t,e){return t.store(e)},gu.It=function(t){t=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),t=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(t)},gu.bt=function(t){t=t.match(/Android ([\d.]+)/i),t=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(t)},gu.prototype.Vt=function(o){return y(this,void 0,void 0,function(){var e,i=this;return g(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Ar("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,n){var r=indexedDB.open(i.name,i.version);r.onsuccess=function(t){t=t.target.result;e(t)},r.onblocked=function(){n(new du(o,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=function(t){t=t.target.error;"VersionError"===t.name?n(new Wr(Hr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):n(new du(o,t))},r.onupgradeneeded=function(t){Ar("SimpleDb",'Database "'+i.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;i.Tt.St(e,r.transaction,t.oldVersion,i.version).next(function(){Ar("SimpleDb","Database upgrade to version "+i.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Dt&&(this.db.onversionchange=function(t){return i.Dt(t)}),this.db)]}})})},gu.prototype.Ct=function(e){this.Dt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},gu.prototype.runTransaction=function(a,n,u,c){return y(this,void 0,void 0,function(){var i,o,s,e;return g(this,function(t){switch(t.label){case 0:i="readonly"===n,o=0,e=function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:++o,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,s.Vt(a)];case 2:return s.db=t.sent(),e=hu.open(s.db,a,i?"readonly":"readwrite",u),n=c(e).catch(function(t){return e.abort(t),cu.reject(t)}).toPromise(),r={},n.catch(function(){}),[4,e.Et];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return n=t.sent(),r="FirebaseError"!==n.name&&o<3,Ar("SimpleDb","Transaction failed with error:",n.message,"Retrying:",r),s.close(),r?[3,5]:[2,{value:Promise.reject(n)}];case 5:return[2]}})},s=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(e=t.sent()))return[2,e.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},gu.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},gu),fu=(Object.defineProperty(yu.prototype,"isDone",{get:function(){return this.Nt},enumerable:!1,configurable:!0}),Object.defineProperty(yu.prototype,"Ft",{get:function(){return this.$t},enumerable:!1,configurable:!0}),Object.defineProperty(yu.prototype,"cursor",{set:function(t){this.xt=t},enumerable:!1,configurable:!0}),yu.prototype.done=function(){this.Nt=!0},yu.prototype.Ot=function(t){this.$t=t},yu.prototype.delete=function(){return Iu(this.xt.delete())},yu),du=(n(pu,ou=Wr),pu);function pu(t,e){var n=this;return(n=ou.call(this,Hr.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+e)||this).name="IndexedDbTransactionError",n}function yu(t){this.xt=t,this.Nt=!1,this.$t=null}function gu(t,e,n){this.name=t,this.version=e,this.Tt=n,12.2===gu.It(l())&&Nr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function vu(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.gt=new uu,this.transaction.oncomplete=function(){n.gt.resolve()},this.transaction.onabort=function(){t.error?n.gt.reject(new du(e,t.error)):n.gt.resolve()},this.transaction.onerror=function(t){t=Su(t.target.error);n.gt.reject(new du(e,t))}}function mu(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}function bu(){this.onCommittedListeners=[]}function wu(t){return"IndexedDbTransactionError"===t.name}var Eu=(Tu.prototype.put=function(t,e){t=void 0!==e?(Ar("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ar("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Iu(t)},Tu.prototype.add=function(t){return Ar("SimpleDb","ADD",this.store.name,t,t),Iu(this.store.add(t))},Tu.prototype.get=function(e){var n=this;return Iu(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ar("SimpleDb","GET",n.store.name,e,t),t})},Tu.prototype.delete=function(t){return Ar("SimpleDb","DELETE",this.store.name,t),Iu(this.store.delete(t))},Tu.prototype.count=function(){return Ar("SimpleDb","COUNT",this.store.name),Iu(this.store.count())},Tu.prototype.kt=function(t,e){var e=this.cursor(this.options(t,e)),n=[];return this.Mt(e,function(t,e){n.push(e)}).next(function(){return n})},Tu.prototype.Lt=function(t,e){Ar("SimpleDb","DELETE ALL",this.store.name);e=this.options(t,e);e.Bt=!1;e=this.cursor(e);return this.Mt(e,function(t,e,n){return n.delete()})},Tu.prototype.qt=function(t,e){e?n=t:(n={},e=t);var n=this.cursor(n);return this.Mt(n,e)},Tu.prototype.Ut=function(r){var t=this.cursor({});return new cu(function(n,e){t.onerror=function(t){t=Su(t.target.error);e(t)},t.onsuccess=function(t){var e=t.target.result;e?r(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Tu.prototype.Mt=function(t,i){var o=[];return new cu(function(r,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n=t.target.result;n?(e=new fu(n),(t=i(n.primaryKey,n.value,e))instanceof cu&&(t=t.catch(function(t){return e.done(),cu.reject(t)}),o.push(t)),e.isDone?r():null===e.Ft?n.continue():n.continue(e.Ft)):r()}}).next(function(){return cu.waitFor(o)})},Tu.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Tu.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Bt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Tu);function Tu(t){this.store=t}function Iu(t){return new cu(function(e,n){t.onsuccess=function(t){t=t.target.result;e(t)},t.onerror=function(t){t=Su(t.target.error);n(t)}})}var _u=!1;function Su(t){var e=lu.It(l());if(12.2<=e&&e<13){e="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(e)){var n=new Wr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+e+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return _u||(_u=!0,setTimeout(function(){throw n},0)),n}}return t}var Du,Au=(n(Nu,Du=c),Nu);function Nu(t,e){var n=this;return(n=Du.call(this)||this).Qt=t,n.currentSequenceNumber=e,n}function Cu(t,e){return lu.Pt(t.Qt,e)}var ku=(Mu.prototype.applyToRemoteDocument=function(t,e,n){for(var r,i,o,s,a,u,c=n.mutationResults,h=0;h<this.mutations.length;h++){var l=this.mutations[h];l.key.isEqual(t)&&(r=l,i=e,o=c[h],l=u=a=s=void 0,e=r instanceof vs?(a=o,u=(s=r).value,l=Ts(s.fieldTransforms,i,a.transformResults),u=_s(s.fieldTransforms,u,l),new Ci(s.key,a.version,u,{hasCommittedMutations:!0})):r instanceof ms?function(t,e,n){if(!ls(t.precondition,e))return new xi(t.key,n.version);e=Es(t,e,Ts(t.fieldTransforms,e,n.transformResults));return new Ci(t.key,n.version,e,{hasCommittedMutations:!0})}(r,i,o):new ki(r.key,o.version,{hasCommittedMutations:!0}))}return e},Mu.prototype.applyToLocalView=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++)(i=r[n]).key.isEqual(t)&&(e=fs(i,e,this.localWriteTime));for(var i,o=0,s=this.mutations;o<s.length;o++)(i=s[o]).key.isEqual(t)&&(e=fs(i,e,this.localWriteTime));return e},Mu.prototype.applyToLocalDocumentSet=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.applyToLocalView(t.key,n.get(t.key));e&&(i=i.insert(t.key,e))}),i},Mu.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Xs())},Mu.prototype.isEqual=function(t){return this.batchId===t.batchId&&Mr(this.mutations,t.mutations,ds)&&Mr(this.baseMutations,t.baseMutations,ds)},Mu),xu=(Pu.from=function(t,e,n){Rr(t.mutations.length===n.length);for(var r=Ws,i=t.mutations,o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Pu(t,e,n,r)},Pu),Ru=(Ou.prototype.withSequenceNumber=function(t){return new Ou(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Ou.prototype.withResumeToken=function(t,e){return new Ou(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Ou.prototype.withLastLimboFreeSnapshotVersion=function(t){return new Ou(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},Ou),Lu=function(t){this.Kt=t};function Ou(t,e,n,r,i,o,s){void 0===i&&(i=Lo.min()),void 0===o&&(o=Lo.min()),void 0===s&&(s=Zr.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Pu(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}function Mu(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}function Fu(t,e){if(e.document)return Da(t.Kt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=$r.fromSegments(e.noDocument.path),r=ju(e.noDocument.readTime);return new ki(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){n=$r.fromSegments(e.unknownDocument.path),r=ju(e.unknownDocument.version);return new xi(n,r)}return xr()}function qu(t,e,n){var r=Vu(n),n=e.key.path.popLast().toArray();if(e instanceof Ci){var i={name:ba(o=t.Kt,(s=e).key),fields:s.toProto().mapValue.fields,updateTime:pa(o,s.version.toTimestamp())},o=e.hasCommittedMutations;return new Xa(null,null,i,o,r,n)}if(e instanceof ki){var s=e.key.path.toArray(),i=Bu(e.version),o=e.hasCommittedMutations;return new Xa(null,new Wa(s,i),null,o,r,n)}if(e instanceof xi){o=e.key.path.toArray(),e=Bu(e.version);return new Xa(new Ya(o,e),null,null,!0,r,n)}return xr()}function Vu(t){t=t.toTimestamp();return[t.seconds,t.nanoseconds]}function Uu(t){t=new hi(t[0],t[1]);return Lo.fromTimestamp(t)}function Bu(t){t=t.toTimestamp();return new Ga(t.seconds,t.nanoseconds)}function ju(t){t=new hi(t.seconds,t.nanoseconds);return Lo.fromTimestamp(t)}function Gu(e,t){for(var n=(t.baseMutations||[]).map(function(t){return Na(e.Kt,t)}),r=0;r<t.mutations.length-1;++r){var i,o=t.mutations[r];r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform&&(i=t.mutations[r+1],o.updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r+1,1),++r)}var s=t.mutations.map(function(t){return Na(e.Kt,t)}),a=hi.fromMillis(t.localWriteTimeMs);return new ku(t.batchId,a,n,s)}function Ku(t){var e=ju(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ju(t.lastLimboFreeSnapshotVersion):Lo.min(),r=void 0!==t.query.documents?(Rr(1===(r=t.query).documents.length),Do(bo(Ta(r.documents[0])))):Do(xa(t.query));return new Ru(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Zr.fromBase64String(t.resumeToken))}function zu(t,e){var n=Bu(e.snapshotVersion),r=Bu(e.lastLimboFreeSnapshotVersion),i=(Vi(e.target)?Ca:ka)(t.Kt,e.target),t=e.resumeToken.toBase64();return new $a(e.targetId,Fi(e.target),n,t,e.sequenceNumber,r,i)}function Qu(t){var e=xa({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Ao(e,e.limit,"L"):e}var Hu=(Wu.prototype.getBundleMetadata=function(t,e){return Yu(t).get(e).next(function(t){if(t)return{id:(t=t).bundleId,createTime:ju(t.createTime),version:t.version}})},Wu.prototype.saveBundleMetadata=function(t,e){return Yu(t).put({bundleId:(e=e).id,createTime:Bu(ga(e.createTime)),version:e.version})},Wu.prototype.getNamedQuery=function(t,e){return Xu(t).get(e).next(function(t){if(t)return{name:(t=t).name,query:Qu(t.bundledQuery),readTime:ju(t.readTime)}})},Wu.prototype.saveNamedQuery=function(t,e){return Xu(t).put({name:(e=e).name,readTime:Bu(ga(e.readTime)),bundledQuery:e.bundledQuery})},Wu);function Wu(){}function Yu(t){return Cu(t,ru.store)}function Xu(t){return Cu(t,iu.store)}var Ju=(nc.prototype.addToCollectionParentIndex=function(t,e){return this.Wt.add(e),cu.resolve()},nc.prototype.getCollectionParents=function(t,e){return cu.resolve(this.Wt.getEntries(e))},nc),$u=(ec.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new js(Yr.comparator),t=!r.has(n);return this.index[e]=r.add(n),t},ec.prototype.has=function(t){var e=t.lastSegment(),t=t.popLast(),e=this.index[e];return e&&e.has(t)},ec.prototype.getEntries=function(t){return(this.index[t]||new js(Yr.comparator)).toArray()},ec),Zu=(tc.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(this.jt.has(e))return cu.resolve();var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.jt.add(e)});i={collectionId:r,parent:Va(i)};return rc(t).put(i)},tc.prototype.getCollectionParents=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Fr(i),""],!1,!0);return rc(t).kt(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Ba(r.parent))}return o})},tc);function tc(){this.jt=new $u}function ec(){this.index={}}function nc(){this.Wt=new $u}function rc(t){return Cu(t,eu.store)}var ic={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},oc=(sc.withCacheSize=function(t){return new sc(t,sc.DEFAULT_COLLECTION_PERCENTILE,sc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},sc);function sc(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}function ac(t,e,n){var r=t.store(za.store),i=t.store(Qa.store),o=[],t=IDBKeyRange.only(n.batchId),s=0,t=r.qt({range:t},function(t,e,n){return s++,n.delete()});o.push(t.next(function(){Rr(1===s)}));for(var a=[],u=0,c=n.mutations;u<c.length;u++){var h=c[u],l=Qa.key(e,h.key.path,n.batchId);o.push(i.delete(l)),a.push(h.key)}return cu.waitFor(o).next(function(){return a})}function uc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw xr();e=t.noDocument}return JSON.stringify(e).length}oc.DEFAULT_COLLECTION_PERCENTILE=10,oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,oc.DEFAULT=new oc(41943040,oc.DEFAULT_COLLECTION_PERCENTILE,oc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),oc.DISABLED=new oc(-1,0,0);var cc=(hc.Ht=function(t,e,n,r){return Rr(""!==t.uid),new hc(t.isAuthenticated()?t.uid:"",e,n,r)},hc.prototype.checkEmpty=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return fc(t).qt({index:za.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},hc.prototype.addMutationBatch=function(p,y,g,v){var m=this,b=dc(p),w=fc(p);return w.add({}).next(function(t){Rr("number"==typeof t);for(var e,n,r,i,o,s=new ku(t,y,g,v),a=(e=m.D,n=m.userId,i=(r=s).baseMutations.map(function(t){return Aa(e.Kt,t)}),o=r.mutations.map(function(t){return Aa(e.Kt,t)}),new za(n,r.batchId,r.localWriteTime.toMillis(),i,o)),u=[],c=new js(function(t,e){return Pr(t.canonicalString(),e.canonicalString())}),h=0,l=v;h<l.length;h++){var f=l[h],d=Qa.key(m.userId,f.key.path,t),c=c.add(f.key.path.popLast());u.push(w.put(a)),u.push(b.put(d,Qa.PLACEHOLDER))}return c.forEach(function(t){u.push(m.Gt.addToCollectionParentIndex(p,t))}),p.addOnCommittedListener(function(){m.zt[t]=s.keys()}),cu.waitFor(u).next(function(){return s})})},hc.prototype.lookupMutationBatch=function(t,e){var n=this;return fc(t).get(e).next(function(t){return t?(Rr(t.userId===n.userId),Gu(n.D,t)):null})},hc.prototype.Jt=function(t,e){var n=this;return this.zt[e]?cu.resolve(this.zt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){t=t.keys();return n.zt[e]=t}return null})},hc.prototype.getNextMutationBatchAfterBatchId=function(t,e){var r=this,i=e+1,e=IDBKeyRange.lowerBound([this.userId,i]),o=null;return fc(t).qt({index:za.userMutationsIndex,range:e},function(t,e,n){e.userId===r.userId&&(Rr(e.batchId>=i),o=Gu(r.D,e)),n.done()}).next(function(){return o})},hc.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return fc(t).qt({index:za.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},hc.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return fc(t).kt(za.userMutationsIndex,n).next(function(t){return t.map(function(t){return Gu(e.D,t)})})},hc.prototype.getAllMutationBatchesAffectingDocumentKey=function(o,s){var a=this,t=Qa.prefixForPath(this.userId,s.path),t=IDBKeyRange.lowerBound(t),u=[];return dc(o).qt({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ba(i);if(r===a.userId&&s.path.isEqual(i))return fc(o).get(t).next(function(t){if(!t)throw xr();Rr(t.userId===a.userId),u.push(Gu(a.D,t))});n.done()}).next(function(){return u})},hc.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var s=this,a=new js(Pr),n=[];return t.forEach(function(o){var t=Qa.prefixForPath(s.userId,o.path),t=IDBKeyRange.lowerBound(t),t=dc(e).qt({range:t},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ba(i);r===s.userId&&o.path.isEqual(i)?a=a.add(t):n.done()});n.push(t)}),cu.waitFor(n).next(function(){return s.Yt(e,a)})},hc.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var o=this,s=e.path,a=s.length+1,e=Qa.prefixForPath(this.userId,s),e=IDBKeyRange.lowerBound(e),u=new js(Pr);return dc(t).qt({range:e},function(t,e,n){var r=t[0],i=t[1],t=t[2],i=Ba(i);r===o.userId&&s.isPrefixOf(i)?i.length===a&&(u=u.add(t)):n.done()}).next(function(){return o.Yt(t,u)})},hc.prototype.Yt=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(fc(e).get(t).next(function(t){if(null===t)throw xr();Rr(t.userId===n.userId),r.push(Gu(n.D,t))}))}),cu.waitFor(i).next(function(){return r})},hc.prototype.removeMutationBatch=function(e,n){var r=this;return ac(e.Qt,this.userId,n).next(function(t){return e.addOnCommittedListener(function(){r.Xt(n.batchId)}),cu.forEach(t,function(t){return r.referenceDelegate.markPotentiallyOrphaned(e,t)})})},hc.prototype.Xt=function(t){delete this.zt[t]},hc.prototype.performConsistencyCheck=function(e){var i=this;return this.checkEmpty(e).next(function(t){if(!t)return cu.resolve();var t=IDBKeyRange.lowerBound(Qa.prefixForUser(i.userId)),r=[];return dc(e).qt({range:t},function(t,e,n){t[0]===i.userId?(t=Ba(t[1]),r.push(t)):n.done()}).next(function(){Rr(0===r.length)})})},hc.prototype.containsKey=function(t,e){return lc(t,this.userId,e)},hc.prototype.Zt=function(t){var e=this;return pc(t).get(this.userId).next(function(t){return t||new Ka(e.userId,-1,"")})},hc);function hc(t,e,n,r){this.userId=t,this.D=e,this.Gt=n,this.referenceDelegate=r,this.zt={}}function lc(t,o,e){var e=Qa.prefixForPath(o,e.path),s=e[1],e=IDBKeyRange.lowerBound(e),a=!1;return dc(t).qt({range:e,Bt:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(a=!0),n.done()}).next(function(){return a})}function fc(t){return Cu(t,za.store)}function dc(t){return Cu(t,Qa.store)}function pc(t){return Cu(t,Ka.store)}var yc=(mc.prototype.next=function(){return this.te+=2,this.te},mc.ee=function(){return new mc(0)},mc.ne=function(){return new mc(-1)},mc),gc=(vc.prototype.allocateTargetId=function(n){var r=this;return this.se(n).next(function(t){var e=new yc(t.highestTargetId);return t.highestTargetId=e.next(),r.ie(n,t).next(function(){return t.highestTargetId})})},vc.prototype.getLastRemoteSnapshotVersion=function(t){return this.se(t).next(function(t){return Lo.fromTimestamp(new hi(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},vc.prototype.getHighestSequenceNumber=function(t){return this.se(t).next(function(t){return t.highestListenSequenceNumber})},vc.prototype.setTargetsMetadata=function(e,n,r){var i=this;return this.se(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.toTimestamp()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.ie(e,t)})},vc.prototype.addTargetData=function(e,n){var r=this;return this.re(e,n).next(function(){return r.se(e).next(function(t){return t.targetCount+=1,r.oe(n,t),r.ie(e,t)})})},vc.prototype.updateTargetData=function(t,e){return this.re(t,e)},vc.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return bc(e).delete(t.targetId)}).next(function(){return n.se(e)}).next(function(t){return Rr(0<t.targetCount),--t.targetCount,n.ie(e,t)})},vc.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return bc(n).qt(function(t,e){e=Ku(e);e.sequenceNumber<=r&&null===i.get(e.targetId)&&(s++,a.push(o.removeTargetData(n,e)))}).next(function(){return cu.waitFor(a)}).next(function(){return s})},vc.prototype.forEachTarget=function(t,n){return bc(t).qt(function(t,e){e=Ku(e);n(e)})},vc.prototype.se=function(t){return wc(t).get(tu.key).next(function(t){return Rr(null!==t),t})},vc.prototype.ie=function(t,e){return wc(t).put(tu.key,e)},vc.prototype.re=function(t,e){return bc(t).put(zu(this.D,e))},vc.prototype.oe=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},vc.prototype.getTargetCount=function(t){return this.se(t).next(function(t){return t.targetCount})},vc.prototype.getTargetData=function(t,r){var e=Fi(r),e=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),i=null;return bc(t).qt({range:e,index:$a.queryTargetsIndexName},function(t,e,n){e=Ku(e);qi(r,e.target)&&(i=e,n.done())}).next(function(){return i})},vc.prototype.addMatchingKeys=function(n,t,r){var i=this,o=[],s=Ec(n);return t.forEach(function(t){var e=Va(t.path);o.push(s.put(new Za(r,e))),o.push(i.referenceDelegate.addReference(n,r,t))}),cu.waitFor(o)},vc.prototype.removeMatchingKeys=function(n,t,r){var i=this,o=Ec(n);return cu.forEach(t,function(t){var e=Va(t.path);return cu.waitFor([o.delete([r,e]),i.referenceDelegate.removeReference(n,r,t)])})},vc.prototype.removeMatchingKeysForTargetId=function(t,e){t=Ec(t),e=IDBKeyRange.bound([e],[e+1],!1,!0);return t.delete(e)},vc.prototype.getMatchingKeysForTargetId=function(t,e){var e=IDBKeyRange.bound([e],[e+1],!1,!0),t=Ec(t),r=Xs();return t.qt({range:e,Bt:!0},function(t,e,n){t=Ba(t[1]),t=new $r(t);r=r.add(t)}).next(function(){return r})},vc.prototype.containsKey=function(t,e){var e=Va(e.path),e=IDBKeyRange.bound([e],[Fr(e)],!1,!0),i=0;return Ec(t).qt({index:Za.documentTargetsIndex,Bt:!0,range:e},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},vc.prototype.yt=function(t,e){return bc(t).get(e).next(function(t){return t?Ku(t):null})},vc);function vc(t,e){this.referenceDelegate=t,this.D=e}function mc(t){this.te=t}function bc(t){return Cu(t,$a.store)}function wc(t){return Cu(t,tu.store)}function Ec(t){return Cu(t,Za.store)}function Tc(e){return y(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==Hr.FAILED_PRECONDITION||e.message!==au)throw e;return Ar("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Ic(t,e){var n=t[0],r=t[1],t=e[0],e=e[1],t=Pr(n,t);return 0===t?Pr(r,e):t}var _c=(xc.prototype.ue=function(){return++this.ae},xc.prototype.he=function(t){var e=[t,this.ue()];this.buffer.size<this.ce?this.buffer=this.buffer.add(e):Ic(e,t=this.buffer.last())<0&&(this.buffer=this.buffer.delete(t).add(e))},Object.defineProperty(xc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),xc),Sc=(kc.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.de(t)},kc.prototype.stop=function(){this.fe&&(this.fe.cancel(),this.fe=null)},Object.defineProperty(kc.prototype,"started",{get:function(){return null!==this.fe},enumerable:!1,configurable:!0}),kc.prototype.de=function(n){var t=this,e=this.le?3e5:6e4;Ar("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.fe=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:this.fe=null,this.le=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.collectGarbage(this.garbageCollector)];case 2:return t.sent(),[3,7];case 3:return wu(e=t.sent())?(Ar("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Tc(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.de(n)];case 8:return t.sent(),[2]}})})})},kc),Dc=(Cc.prototype.calculateTargetCount=function(t,e){return this.we._e(t).next(function(t){return Math.floor(e/100*t)})},Cc.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return cu.resolve(Ir.o);var r=new _c(e);return this.we.forEachTarget(t,function(t){return r.he(t.sequenceNumber)}).next(function(){return n.we.me(t,function(t){return r.he(t)})}).next(function(){return r.maxValue})},Cc.prototype.removeTargets=function(t,e,n){return this.we.removeTargets(t,e,n)},Cc.prototype.removeOrphanedDocuments=function(t,e){return this.we.removeOrphanedDocuments(t,e)},Cc.prototype.collect=function(e,n){var r=this;return-1===this.params.cacheSizeCollectionThreshold?(Ar("LruGarbageCollector","Garbage collection skipped; disabled"),cu.resolve(ic)):this.getCacheSize(e).next(function(t){return t<r.params.cacheSizeCollectionThreshold?(Ar("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),ic):r.ye(e,n)})},Cc.prototype.getCacheSize=function(t){return this.we.getCacheSize(t)},Cc.prototype.ye=function(e,n){var r,i,o,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return i=t>h.params.maximumSequenceNumbersToCollect?(Ar("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+t),h.params.maximumSequenceNumbersToCollect):t,s=Date.now(),h.nthSequenceNumber(e,i)}).next(function(t){return r=t,a=Date.now(),h.removeTargets(e,r,n)}).next(function(t){return o=t,u=Date.now(),h.removeOrphanedDocuments(e,r)}).next(function(t){return c=Date.now(),Dr()<=f.DEBUG&&Ar("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+i+" in "+(a-s)+"ms\n\tRemoved "+o+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),cu.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:t})})},Cc),Ac=(Nc.prototype._e=function(t){var n=this.ge(t);return this.db.getTargetCache().getTargetCount(t).next(function(e){return n.next(function(t){return e+t})})},Nc.prototype.ge=function(t){var e=0;return this.me(t,function(t){e++}).next(function(){return e})},Nc.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},Nc.prototype.me=function(t,n){return this.pe(t,function(t,e){return n(e)})},Nc.prototype.addReference=function(t,e,n){return Rc(t,n)},Nc.prototype.removeReference=function(t,e,n){return Rc(t,n)},Nc.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},Nc.prototype.markPotentiallyOrphaned=Rc,Nc.prototype.Ee=function(t,e){return r=e,i=!1,pc(n=t).Ut(function(t){return lc(n,t,r).next(function(t){return t&&(i=!0),cu.resolve(!t)})}).next(function(){return i});var n,r,i},Nc.prototype.removeOrphanedDocuments=function(n,r){var i=this,o=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],a=0;return this.pe(n,function(e,t){t<=r&&(t=i.Ee(n,e).next(function(t){if(!t)return a++,o.getEntry(n,e).next(function(){return o.removeEntry(e),Ec(n).delete([0,Va(e.path)])})}),s.push(t))}).next(function(){return cu.waitFor(s)}).next(function(){return o.apply(n)}).next(function(){return a})},Nc.prototype.removeTarget=function(t,e){e=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,e)},Nc.prototype.updateLimboDocument=Rc,Nc.prototype.pe=function(t,r){var i,t=Ec(t),o=Ir.o;return t.qt({index:Za.documentTargetsIndex},function(t,e){var n=t[0],t=(t[1],e.path),e=e.sequenceNumber;0===n?(o!==Ir.o&&r(new $r(Ba(i)),o),o=e,i=t):o=Ir.o}).next(function(){o!==Ir.o&&r(new $r(Ba(i)),o)})},Nc.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},Nc);function Nc(t,e){this.db=t,this.garbageCollector=new Dc(this,e)}function Cc(t,e){this.we=t,this.params=e}function kc(t,e){this.garbageCollector=t,this.asyncQueue=e,this.le=!1,this.fe=null}function xc(t){this.ce=t,this.buffer=new js(Ic),this.ae=0}function Rc(t,e){return Ec(t).put((t=t.currentSequenceNumber,new Za(0,Va(e.path),t)))}var Lc,Oc=(Uc.prototype.get=function(t){var e=this.mapKeyFn(t),e=this.inner[e];if(void 0!==e)for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];if(this.equalsFn(o,t))return i}},Uc.prototype.has=function(t){return void 0!==this.get(t)},Uc.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},Uc.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},Uc.prototype.forEach=function(s){Vr(this.inner,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],i=i[1];s(o,i)}})},Uc.prototype.isEmpty=function(){return Ur(this.inner)},Uc),Te=(Vc.prototype.getReadTime=function(t){t=this.changes.get(t);return t?t.readTime:Lo.min()},Vc.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{maybeDocument:t,readTime:e})},Vc.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{maybeDocument:null,readTime:e})},Vc.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?cu.resolve(n.maybeDocument):this.getFromCache(t,e)},Vc.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},Vc.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},Vc.prototype.assertNotApplied=function(){},Vc),Pc=(qc.prototype.addEntry=function(t,e,n){return jc(t).put(Gc(e),n)},qc.prototype.removeEntry=function(t,e){t=jc(t),e=Gc(e);return t.delete(e)},qc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Te(e,t)})},qc.prototype.getEntry=function(t,e){var n=this;return jc(t).get(Gc(e)).next(function(t){return n.Ie(t)})},qc.prototype.Ae=function(t,e){var n=this;return jc(t).get(Gc(e)).next(function(t){var e=n.Ie(t);return e?{maybeDocument:e,size:uc(t)}:null})},qc.prototype.getEntries=function(t,e){var n=this,r=Ks;return this.Re(t,e,function(t,e){e=n.Ie(e);r=r.insert(t,e)}).next(function(){return r})},qc.prototype.be=function(t,e){var r=this,i=Ks,o=new Ps($r.comparator);return this.Re(t,e,function(t,e){var n=r.Ie(e);o=n?(i=i.insert(t,n),o.insert(t,uc(e))):(i=i.insert(t,null),o.insert(t,0))}).next(function(){return{ve:i,Pe:o}})},qc.prototype.Re=function(t,e,i){if(e.isEmpty())return cu.resolve();var n=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),o=e.getIterator(),s=o.getNext();return jc(t).qt({range:n},function(t,e,n){for(var r=$r.fromSegments(t);s&&$r.comparator(s,r)<0;)i(s,null),s=o.getNext();s&&s.isEqual(r)&&(i(s,e),s=o.hasNext()?o.getNext():null),s?n.Ot(s.path.toArray()):n.done()}).next(function(){for(;s;)i(s,null),s=o.hasNext()?o.getNext():null})},qc.prototype.getDocumentsMatchingQuery=function(t,r,e){var n,i=this,o=Hs,s=r.path.length+1,a={};return e.isEqual(Lo.min())?(n=r.path.toArray(),a.range=IDBKeyRange.lowerBound(n)):(n=r.path.toArray(),e=Vu(e),a.range=IDBKeyRange.lowerBound([n,e],!0),a.index=Xa.collectionReadTimeIndex),jc(t).qt(a,function(t,e,n){t.length===s&&(e=Fu(i.D,e),r.path.isPrefixOf(e.key.path)?e instanceof Ci&&xo(r,e)&&(o=o.insert(e.key,e)):n.done())}).next(function(){return o})},qc.prototype.newChangeBuffer=function(t){return new Mc(this,!!t&&t.trackRemovals)},qc.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},qc.prototype.getMetadata=function(t){return Bc(t).get(Ja.key).next(function(t){return Rr(!!t),t})},qc.prototype.Te=function(t,e){return Bc(t).put(Ja.key,e)},qc.prototype.Ie=function(t){if(t){t=Fu(this.D,t);return t instanceof ki&&t.version.isEqual(Lo.min())?null:t}return null},qc),Mc=(n(Fc,Lc=Te),Fc.prototype.applyChanges=function(i){var o=this,s=[],a=0,u=new js(function(t,e){return Pr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(t,e){var n,r=o.Se.get(t);e.maybeDocument?(n=qu(o.Ve.D,e.maybeDocument,o.getReadTime(t)),u=u.add(t.path.popLast()),e=uc(n),a+=e-r,s.push(o.Ve.addEntry(i,t,n))):(a-=r,o.trackRemovals?(r=qu(o.Ve.D,new ki(t,Lo.min()),o.getReadTime(t)),s.push(o.Ve.addEntry(i,t,r))):s.push(o.Ve.removeEntry(i,t)))}),u.forEach(function(t){s.push(o.Ve.Gt.addToCollectionParentIndex(i,t))}),s.push(this.Ve.updateMetadata(i,a)),cu.waitFor(s)},Fc.prototype.getFromCache=function(t,e){var n=this;return this.Ve.Ae(t,e).next(function(t){return null===t?(n.Se.set(e,0),null):(n.Se.set(e,t.size),t.maybeDocument)})},Fc.prototype.getAllFromCache=function(t,e){var n=this;return this.Ve.be(t,e).next(function(t){var e=t.ve;return t.Pe.forEach(function(t,e){n.Se.set(t,e)}),e})},Fc);function Fc(t,e){var n=this;return(n=Lc.call(this)||this).Ve=t,n.trackRemovals=e,n.Se=new Oc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}function qc(t,e){this.D=t,this.Gt=e}function Vc(){this.changes=new Oc(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}function Uc(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}function Bc(t){return Cu(t,Ja.store)}function jc(t){return Cu(t,Xa.store)}function Gc(t){return t.path.toArray()}var Kc=(zc.prototype.St=function(e,n,t,r){var i=this;Rr(t<r&&0<=t&&r<=11);var o=new hu("createOrUpgrade",n);t<1&&1<=r&&(e.createObjectStore(ja.store),(s=e).createObjectStore(Ka.store,{keyPath:Ka.keyPath}),s.createObjectStore(za.store,{keyPath:za.keyPath,autoIncrement:!0}).createIndex(za.userMutationsIndex,za.userMutationsKeyPath,{unique:!0}),s.createObjectStore(Qa.store),Qc(e),e.createObjectStore(Xa.store));var s,a=cu.resolve();return t<3&&3<=r&&(0!==t&&((s=e).deleteObjectStore(Za.store),s.deleteObjectStore($a.store),s.deleteObjectStore(tu.store),Qc(e)),a=a.next(function(){return t=o.store(tu.store),e=new tu(0,0,Lo.min().toTimestamp(),0),t.put(tu.key,e);var t,e})),t<4&&4<=r&&(a=(a=0!==t?a.next(function(){return n=e,(r=o).store(za.store).kt().next(function(t){n.deleteObjectStore(za.store),n.createObjectStore(za.store,{keyPath:za.keyPath,autoIncrement:!0}).createIndex(za.userMutationsIndex,za.userMutationsKeyPath,{unique:!0});var e=r.store(za.store),t=t.map(function(t){return e.put(t)});return cu.waitFor(t)});var n,r}):a).next(function(){e.createObjectStore(nu.store,{keyPath:nu.keyPath})})),t<5&&5<=r&&(a=a.next(function(){return i.De(o)})),t<6&&6<=r&&(a=a.next(function(){return e.createObjectStore(Ja.store),i.Ce(o)})),t<7&&7<=r&&(a=a.next(function(){return i.xe(o)})),t<8&&8<=r&&(a=a.next(function(){return i.Ne(e,o)})),t<9&&9<=r&&(a=a.next(function(){var t;(t=e).objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges"),(t=n.objectStore(Xa.store)).createIndex(Xa.readTimeIndex,Xa.readTimeIndexPath,{unique:!1}),t.createIndex(Xa.collectionReadTimeIndex,Xa.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=r&&(a=a.next(function(){return i.$e(o)})),a=t<11&&11<=r?a.next(function(){e.createObjectStore(ru.store,{keyPath:ru.keyPath}),e.createObjectStore(iu.store,{keyPath:iu.keyPath})}):a},zc.prototype.Ce=function(e){var n=0;return e.store(Xa.store).qt(function(t,e){n+=uc(e)}).next(function(){var t=new Ja(n);return e.store(Ja.store).put(Ja.key,t)})},zc.prototype.De=function(n){var r=this,t=n.store(Ka.store),i=n.store(za.store);return t.kt().next(function(t){return cu.forEach(t,function(e){var t=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return i.kt(za.userMutationsIndex,t).next(function(t){return cu.forEach(t,function(t){Rr(t.userId===e.userId);t=Gu(r.D,t);return ac(n,e.userId,t).next(function(){})})})})})},zc.prototype.xe=function(t){var o=t.store(Za.store),e=t.store(Xa.store);return t.store(tu.store).get(tu.key).next(function(r){var i=[];return e.qt(function(t,e){var n=new Yr(t),t=[0,Va(n)];i.push(o.get(t).next(function(t){return t?cu.resolve():o.put(new Za(0,Va(n),r.highestListenSequenceNumber))}))}).next(function(){return cu.waitFor(i)})})},zc.prototype.Ne=function(t,e){t.createObjectStore(eu.store,{keyPath:eu.keyPath});function r(t){if(i.add(t)){var e=t.lastSegment(),t=t.popLast();return n.put({collectionId:e,parent:Va(t)})}}var n=e.store(eu.store),i=new $u;return e.store(Xa.store).qt({Bt:!0},function(t,e){t=new Yr(t);return r(t.popLast())}).next(function(){return e.store(Qa.store).qt({Bt:!0},function(t,e){t[0];var n=t[1],n=(t[2],Ba(n));return r(n.popLast())})})},zc.prototype.$e=function(t){var n=this,r=t.store($a.store);return r.qt(function(t,e){e=Ku(e),e=zu(n.D,e);return r.put(e)})},zc);function zc(t){this.D=t}function Qc(t){t.createObjectStore(Za.store,{keyPath:Za.keyPath}).createIndex(Za.documentTargetsIndex,Za.documentTargetsKeyPath,{unique:!0}),t.createObjectStore($a.store,{keyPath:$a.keyPath}).createIndex($a.queryTargetsIndexName,$a.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(tu.store)}var Hc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Wc=(Yc.prototype.start=function(){var e=this;return this.Ye().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Wr(Hr.FAILED_PRECONDITION,Hc);return e.Xe(),e.Ze(),e.tn(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Ge.getHighestSequenceNumber(t)})}).then(function(t){e.Me=new Ir(t,e.Oe)}).then(function(){e.Le=!0}).catch(function(t){return e.je&&e.je.close(),Promise.reject(t)})},Yc.prototype.en=function(n){var t=this;return this.Ke=function(e){return y(t,void 0,void 0,function(){return g(this,function(t){return this.started?[2,n(e)]:[2]})})},n(this.isPrimary)},Yc.prototype.setDatabaseDeletedListener=function(n){var t=this;this.je.Ct(function(e){return y(t,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Yc.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Fe.enqueueAndForget(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.started?[4,this.Ye()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Yc.prototype.Ye=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Jc(e).put(new nu(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.nn(e).next(function(t){t||(n.isPrimary=!1,n.Fe.enqueueRetryable(function(){return n.Ke(!1)}))})}).next(function(){return n.sn(e)}).next(function(t){return n.isPrimary&&!t?n.rn(e).next(function(){return!1}):!!t&&n.on(e).next(function(){return!0})})}).catch(function(t){if(wu(t))return Ar("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Ar("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Fe.enqueueRetryable(function(){return n.Ke(t)}),n.isPrimary=t})},Yc.prototype.nn=function(t){var e=this;return Xc(t).get(ja.key).next(function(t){return cu.resolve(e.cn(t))})},Yc.prototype.an=function(t){return Jc(t).delete(this.clientId)},Yc.prototype.un=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return g(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.hn(this.Qe,18e5)?[3,2]:(this.Qe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Cu(t,nu.store);return r.kt().next(function(t){var e=o.ln(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return cu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Je)for(n=0,r=e;n<r.length;n++)i=r[n],this.Je.removeItem(this.fn(i.clientId));t.label=2;case 2:return[2]}})})},Yc.prototype.tn=function(){var t=this;this.Ue=this.Fe.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.Ye().then(function(){return t.un()}).then(function(){return t.tn()})})},Yc.prototype.cn=function(t){return!!t&&t.ownerId===this.clientId},Yc.prototype.sn=function(e){var r=this;return this.ke?cu.resolve(!0):Xc(e).get(ja.key).next(function(t){if(null!==t&&r.hn(t.leaseTimestampMs,5e3)&&!r.dn(t.ownerId)){if(r.cn(t)&&r.networkEnabled)return!0;if(!r.cn(t)){if(!t.allowTabSynchronization)throw new Wr(Hr.FAILED_PRECONDITION,Hc);return!1}}return!(!r.networkEnabled||!r.inForeground)||Jc(e).kt().next(function(t){return void 0===r.ln(t,5e3).find(function(t){if(r.clientId!==t.clientId){var e=!r.networkEnabled&&t.networkEnabled,n=!r.inForeground&&t.inForeground,t=r.networkEnabled===t.networkEnabled;if(e||n&&t)return!0}return!1})})}).next(function(t){return r.isPrimary!==t&&Ar("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Yc.prototype.shutdown=function(){return y(this,void 0,void 0,function(){var n=this;return g(this,function(t){switch(t.label){case 0:return this.Le=!1,this.wn(),this.Ue&&(this.Ue.cancel(),this.Ue=null),this._n(),this.mn(),[4,this.je.runTransaction("shutdown","readwrite",[ja.store,nu.store],function(t){var e=new Au(t,Ir.o);return n.rn(e).next(function(){return n.an(e)})})];case 1:return t.sent(),this.je.close(),this.yn(),[2]}})})},Yc.prototype.ln=function(t,e){var n=this;return t.filter(function(t){return n.hn(t.updateTimeMs,e)&&!n.dn(t.clientId)})},Yc.prototype.gn=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Jc(t).kt().next(function(t){return e.ln(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(Yc.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),Yc.prototype.getMutationQueue=function(t){return cc.Ht(t,this.D,this.Gt,this.referenceDelegate)},Yc.prototype.getTargetCache=function(){return this.Ge},Yc.prototype.getRemoteDocumentCache=function(){return this.ze},Yc.prototype.getIndexManager=function(){return this.Gt},Yc.prototype.getBundleCache=function(){return this.He},Yc.prototype.runTransaction=function(e,n,r){var i=this;Ar("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.je.runTransaction(e,t,su,function(t){return o=new Au(t,i.Me?i.Me.next():Ir.o),"readwrite-primary"===n?i.nn(o).next(function(t){return!!t||i.sn(o)}).next(function(t){if(!t)throw Nr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Fe.enqueueRetryable(function(){return i.Ke(!1)}),new Wr(Hr.FAILED_PRECONDITION,au);return r(o)}).next(function(t){return i.on(o).next(function(){return t})}):i.pn(o).next(function(){return r(o)})}).then(function(t){return o.raiseOnCommittedEvent(),t})},Yc.prototype.pn=function(t){var e=this;return Xc(t).get(ja.key).next(function(t){if(null!==t&&e.hn(t.leaseTimestampMs,5e3)&&!e.dn(t.ownerId)&&!e.cn(t)&&!(e.ke||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Wr(Hr.FAILED_PRECONDITION,Hc)})},Yc.prototype.on=function(t){var e=new ja(this.clientId,this.allowTabSynchronization,Date.now());return Xc(t).put(ja.key,e)},Yc.At=function(){return lu.At()},Yc.prototype.rn=function(t){var e=this,n=Xc(t);return n.get(ja.key).next(function(t){return e.cn(t)?(Ar("IndexedDbPersistence","Releasing primary lease."),n.delete(ja.key)):cu.resolve()})},Yc.prototype.hn=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Nr("Detected an update time that is in the future: "+t+" > "+n),1))},Yc.prototype.Xe=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qe=function(){t.Fe.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ye()})},this.document.addEventListener("visibilitychange",this.qe),this.inForeground="visible"===this.document.visibilityState)},Yc.prototype._n=function(){this.qe&&(this.document.removeEventListener("visibilitychange",this.qe),this.qe=null)},Yc.prototype.Ze=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Be=function(){e.wn(),e.Fe.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("unload",this.Be))},Yc.prototype.mn=function(){this.Be&&(this.window.removeEventListener("unload",this.Be),this.Be=null)},Yc.prototype.dn=function(t){try{var e=null!==(null===(e=this.Je)||void 0===e?void 0:e.getItem(this.fn(t)));return Ar("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Nr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Yc.prototype.wn=function(){if(this.Je)try{this.Je.setItem(this.fn(this.clientId),String(Date.now()))}catch(t){Nr("Failed to set zombie client id.",t)}},Yc.prototype.yn=function(){if(this.Je)try{this.Je.removeItem(this.fn(this.clientId))}catch(t){}},Yc.prototype.fn=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Yc);function Yc(t,e,n,r,i,o,s,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Fe=i,this.window=o,this.document=s,this.Oe=u,this.ke=c,this.Me=null,this.Le=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Be=null,this.inForeground=!1,this.qe=null,this.Ue=null,this.Qe=Number.NEGATIVE_INFINITY,this.Ke=function(t){return Promise.resolve()},!Yc.At())throw new Wr(Hr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ac(this,r),this.We=e+"main",this.D=new Lu(a),this.je=new lu(this.We,11,new Kc(this.D)),this.Ge=new gc(this.referenceDelegate,this.D),this.Gt=new Zu,this.ze=(e=this.D,a=this.Gt,new Pc(e,a)),this.He=new Hu,this.window&&this.window.localStorage?this.Je=this.window.localStorage:(this.Je=null,!1===c&&Nr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Xc(t){return Cu(t,ja.store)}function Jc(t){return Cu(t,nu.store)}function $c(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}function Zc(t,e){this.progress=t,this.En=e}var th=(ah.prototype.In=function(e,n){var r=this;return this.Tn.getAllMutationBatchesAffectingDocumentKey(e,n).next(function(t){return r.An(e,n,t)})},ah.prototype.An=function(t,r,i){return this.ze.getEntry(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].applyToLocalView(r,t);return t})},ah.prototype.Rn=function(t,e,i){var o=Ks;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].applyToLocalView(t,e);o=o.insert(t,e)}),o},ah.prototype.bn=function(e,t){var n=this;return this.ze.getEntries(e,t).next(function(t){return n.vn(e,t)})},ah.prototype.vn=function(e,r){var i=this;return this.Tn.getAllMutationBatchesAffectingDocumentKeys(e,r).next(function(t){var t=i.Rn(e,r,t),n=Ks;return t.forEach(function(t,e){e=e||new ki(t,Lo.min()),n=n.insert(t,e)}),n})},ah.prototype.getDocumentsMatchingQuery=function(t,e,n){return r=e,$r.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Pn(t,e.path):_o(e)?this.Vn(t,e,n):this.Sn(t,e,n);var r},ah.prototype.Pn=function(t,e){return this.In(t,new $r(e)).next(function(t){var e=Hs;return e=t instanceof Ci?e.insert(t.key,t):e})},ah.prototype.Vn=function(n,r,i){var o=this,s=r.collectionGroup,a=Hs;return this.Gt.getCollectionParents(n,s).next(function(t){return cu.forEach(t,function(t){var e,e=(e=r,t=t.child(s),new vo(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt));return o.Sn(n,e,i).next(function(t){t.forEach(function(t,e){a=a.insert(t,e)})})}).next(function(){return a})})},ah.prototype.Sn=function(e,n,t){var u,c,r=this;return this.ze.getDocumentsMatchingQuery(e,n,t).next(function(t){return u=t,r.Tn.getAllMutationBatchesAffectingQuery(e,n)}).next(function(t){return c=t,r.Dn(e,c,u).next(function(t){u=t;for(var e=0,n=c;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],a=s.key,s=fs(s,u.get(a),r.localWriteTime);u=s instanceof Ci?u.insert(a,s):u.remove(a)}})}).next(function(){return u.forEach(function(t,e){xo(n,e)||(u=u.remove(t))}),u})},ah.prototype.Dn=function(t,e,n){for(var r=Xs(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof ms&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.ze.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Ci&&(c=c.insert(t,e))}),c})},ah),eh=(sh.Nn=function(t,e){for(var n=Xs(),r=Xs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new sh(t,e.fromCache,n,r)},sh),nh=(oh.prototype.$n=function(t){this.Fn=t},oh.prototype.getDocumentsMatchingQuery=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||i.isEqual(Lo.min())?this.On(e,r):this.Fn.bn(e,o).next(function(t){var n=s.kn(r,t);return(wo(r)||Eo(r))&&s.Mn(r.limitType,n,o,i)?s.On(e,r):(Dr()<=f.DEBUG&&Ar("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ko(r)),s.Fn.getDocumentsMatchingQuery(e,r,i).next(function(e){return n.forEach(function(t){e=e.insert(t.key,t)}),e}))})},oh.prototype.kn=function(n,t){var r=new js(Ro(n));return t.forEach(function(t,e){e instanceof Ci&&xo(n,e)&&(r=r.add(e))}),r},oh.prototype.Mn=function(t,e,n,r){if(n.size!==e.size)return!0;e="F"===t?e.last():e.first();return!!e&&(e.hasPendingWrites||0<e.version.compareTo(r))},oh.prototype.On=function(t,e){return Dr()<=f.DEBUG&&Ar("QueryEngine","Using full collection scan to execute query:",ko(e)),this.Fn.getDocumentsMatchingQuery(t,e,Lo.min())},oh),rh=(ih.prototype.collectGarbage=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.collect(t,n.Bn)})},ih);function ih(t,e,n,r){this.persistence=t,this.Ln=e,this.D=r,this.Bn=new Ps(Pr),this.qn=new Oc(Fi,qi),this.Un=Lo.min(),this.Tn=t.getMutationQueue(n),this.Qn=t.getRemoteDocumentCache(),this.Ge=t.getTargetCache(),this.Kn=new th(this.Qn,this.Tn,this.persistence.getIndexManager()),this.He=t.getBundleCache(),this.Ln.$n(this.Kn)}function oh(){}function sh(t,e,n,r){this.targetId=t,this.fromCache=e,this.Cn=n,this.xn=r}function ah(t,e,n){this.ze=t,this.Tn=e,this.Gt=n}function uh(t,e,n,r){return new rh(t,e,n,r)}function ch(i,o){return y(this,void 0,void 0,function(){var e,n,m,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).Tn,m=e.Kn,[4,e.persistence.runTransaction("Handle user change","readonly",function(g){var v;return e.Tn.getAllMutationBatches(g).next(function(t){return v=t,n=e.persistence.getMutationQueue(o),m=new th(e.Qn,n,e.persistence.getIndexManager()),n.getAllMutationBatches(g)}).next(function(t){for(var e=[],n=[],r=Xs(),i=0,o=v;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var a=0,u=s.mutations;a<u.length;a++)var c=u[a],r=r.add(c.key)}for(var h=0,l=t;h<l.length;h++){var f=l[h];n.push(f.batchId);for(var d=0,p=f.mutations;d<p.length;d++){var y=p[d];r=r.add(y.key)}}return m.bn(g,r).next(function(t){return{Wn:t,removedBatchIds:e,addedBatchIds:n}})})})];case 1:return r=t.sent(),[2,(e.Tn=n,e.Kn=m,e.Ln.$n(e.Kn),r)]}})})}function hh(t,h){var l=t;return l.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,r,i,o,s,n,a,u=h.batch.keys(),c=l.Qn.newChangeBuffer({trackRemovals:!0});return e=l,r=t,o=c,s=(i=h).batch,n=s.keys(),a=cu.resolve(),n.forEach(function(n){a=a.next(function(){return o.getEntry(r,n)}).next(function(t){var e=t,t=i.docVersions.get(n);Rr(null!==t),(!e||e.version.compareTo(t)<0)&&(e=s.applyToRemoteDocument(n,e,i))&&o.addEntry(e,i.commitVersion)})}),a.next(function(){return e.Tn.removeMutationBatch(r,s)}).next(function(){return c.apply(t)}).next(function(){return l.Tn.performConsistencyCheck(t)}).next(function(){return l.Kn.bn(t,u)})})}function lh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ge.getLastRemoteSnapshotVersion(t)})}function fh(t,r){var u=t,c=r.snapshotVersion,h=u.Bn;return u.persistence.runTransaction("Apply remote event","readwrite-primary",function(s){var t=u.Qn.newChangeBuffer({trackRemovals:!0});h=u.Bn;var a=[];r.targetChanges.forEach(function(t,e){var n,r,i,o=h.get(e);o&&(a.push(u.Ge.removeMatchingKeys(s,t.removedDocuments,e).next(function(){return u.Ge.addMatchingKeys(s,t.addedDocuments,e)})),0<(i=t.resumeToken).approximateByteSize()&&(n=o.withResumeToken(i,c).withSequenceNumber(s.currentSequenceNumber),h=h.insert(e,n),r=o,i=t,Rr(0<(o=n).resumeToken.approximateByteSize()),(0===r.resumeToken.approximateByteSize()||3e8<=o.snapshotVersion.toMicroseconds()-r.snapshotVersion.toMicroseconds()||0<i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size)&&a.push(u.Ge.updateTargetData(s,n))))});var e,n=Ks;return r.documentUpdates.forEach(function(t,e){r.resolvedLimboDocuments.has(t)&&a.push(u.persistence.referenceDelegate.updateLimboDocument(s,t))}),a.push(dh(s,t,r.documentUpdates,c,void 0).next(function(t){n=t})),c.isEqual(Lo.min())||(e=u.Ge.getLastRemoteSnapshotVersion(s).next(function(t){return u.Ge.setTargetsMetadata(s,s.currentSequenceNumber,c)}),a.push(e)),cu.waitFor(a).next(function(){return t.apply(s)}).next(function(){return u.Kn.vn(s,n)})}).then(function(t){return u.Bn=h,t})}function dh(t,s,e,a,u){var n=Xs();return e.forEach(function(t){return n=n.add(t)}),s.getEntries(t,n).next(function(i){var o=Ks;return e.forEach(function(t,e){var n=i.get(t),r=(null==u?void 0:u.get(t))||a;e instanceof ki&&e.version.isEqual(Lo.min())?(s.removeEntry(t,r),o=o.insert(t,e)):null==n||0<e.version.compareTo(n.version)||0===e.version.compareTo(n.version)&&n.hasPendingWrites?(s.addEntry(e,r),o=o.insert(t,e)):Ar("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version)}),o})}function ph(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ge.getTargetData(e,r).next(function(t){return t?(n=t,cu.resolve(n)):i.Ge.allocateTargetId(e).next(function(t){return n=new Ru(r,t,0,e.currentSequenceNumber),i.Ge.addTargetData(e,n).next(function(){return n})})})}).then(function(t){var e=i.Bn.get(t.targetId);return(null===e||0<t.snapshotVersion.compareTo(e.snapshotVersion))&&(i.Bn=i.Bn.insert(t.targetId,t),i.qn.set(r,t.targetId)),t})}function yh(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:n=(e=i).Bn.get(o),r=s?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),s?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.referenceDelegate.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!wu(r=t.sent()))throw r;return Ar("LocalStore","Failed to update sequence numbers for target "+o+": "+r),[3,5];case 5:return e.Bn=e.Bn.remove(o),e.qn.delete(n.target),[2]}})})}function gh(t,o,s){var a=t,u=Lo.min(),c=Xs();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Do(o),(void 0!==(t=(i=t).qn.get(r))?cu.resolve(i.Bn.get(t)):i.Ge.getTargetData(n,r)).next(function(t){if(t)return u=t.lastLimboFreeSnapshotVersion,a.Ge.getMatchingKeysForTargetId(e,t.targetId).next(function(t){c=t})}).next(function(){return a.Ln.getDocumentsMatchingQuery(e,o,s?u:Lo.min(),s?c:Xs())}).next(function(t){return{documents:t,jn:c}});var t,n,r,i})}function vh(t,e){var n=t,r=n.Ge,t=n.Bn.get(e);return t?Promise.resolve(t.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.yt(t,e).next(function(t){return t?t.target:null})})}function mh(t){var s=t;return s.persistence.runTransaction("Get new document changes","readonly",function(t){return e=s.Qn,n=t,t=s.Un,r=e,i=Ks,o=Vu(t),t=jc(n),n=IDBKeyRange.lowerBound(o,!0),t.qt({index:Xa.readTimeIndex,range:n},function(t,e){var n=Fu(r.D,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{En:i,readTime:Uu(o)}});var e,n,r,i,o}).then(function(t){var e=t.En,t=t.readTime;return s.Un=t,e})}function bh(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,(e=n).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return t=jc(t),r=Lo.min(),t.qt({index:Xa.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=Uu(e.readTime)),n.done()}).next(function(){return r});var r}).then(function(t){e.Un=t})]})})}var wh,Eh,Th=(Gh.prototype.getBundleMetadata=function(t,e){return cu.resolve(this.Jn.get(e))},Gh.prototype.saveBundleMetadata=function(t,e){return this.Jn.set(e.id,{id:e.id,version:e.version,createTime:ga(e.createTime)}),cu.resolve()},Gh.prototype.getNamedQuery=function(t,e){return cu.resolve(this.Yn.get(e))},Gh.prototype.saveNamedQuery=function(t,e){return this.Yn.set(e.name,{name:(e=e).name,query:Qu(e.bundledQuery),readTime:ga(e.readTime)}),cu.resolve()},Gh),Ih=(jh.prototype.isEmpty=function(){return this.Xn.isEmpty()},jh.prototype.addReference=function(t,e){e=new _h(t,e);this.Xn=this.Xn.add(e),this.ts=this.ts.add(e)},jh.prototype.ns=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},jh.prototype.removeReference=function(t,e){this.ss(new _h(t,e))},jh.prototype.rs=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},jh.prototype.os=function(t){var e=this,n=new $r(new Yr([])),r=new _h(n,t),t=new _h(n,t+1),i=[];return this.ts.forEachInRange([r,t],function(t){e.ss(t),i.push(t.key)}),i},jh.prototype.cs=function(){var e=this;this.Xn.forEach(function(t){return e.ss(t)})},jh.prototype.ss=function(t){this.Xn=this.Xn.delete(t),this.ts=this.ts.delete(t)},jh.prototype.us=function(t){var e=new $r(new Yr([])),n=new _h(e,t),t=new _h(e,t+1),r=Xs();return this.ts.forEachInRange([n,t],function(t){r=r.add(t.key)}),r},jh.prototype.containsKey=function(t){var e=new _h(t,0),e=this.Xn.firstAfterOrEqual(e);return null!==e&&t.isEqual(e.key)},jh),_h=(Bh.Zn=function(t,e){return $r.comparator(t.key,e.key)||Pr(t.hs,e.hs)},Bh.es=function(t,e){return Pr(t.hs,e.hs)||$r.comparator(t.key,e.key)},Bh),Sh=(Uh.prototype.checkEmpty=function(t){return cu.resolve(0===this.Tn.length)},Uh.prototype.addMutationBatch=function(t,e,n,r){var i=this.ls;this.ls++,0<this.Tn.length&&this.Tn[this.Tn.length-1];n=new ku(i,e,n,r);this.Tn.push(n);for(var o=0,s=r;o<s.length;o++){var a=s[o];this.fs=this.fs.add(new _h(a.key,i)),this.Gt.addToCollectionParentIndex(t,a.key.path.popLast())}return cu.resolve(n)},Uh.prototype.lookupMutationBatch=function(t,e){return cu.resolve(this.ds(e))},Uh.prototype.getNextMutationBatchAfterBatchId=function(t,e){e+=1,e=this.ws(e),e=e<0?0:e;return cu.resolve(this.Tn.length>e?this.Tn[e]:null)},Uh.prototype.getHighestUnacknowledgedBatchId=function(){return cu.resolve(0===this.Tn.length?-1:this.ls-1)},Uh.prototype.getAllMutationBatches=function(t){return cu.resolve(this.Tn.slice())},Uh.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new _h(e,0),e=new _h(e,Number.POSITIVE_INFINITY),i=[];return this.fs.forEachInRange([r,e],function(t){t=n.ds(t.hs);i.push(t)}),cu.resolve(i)},Uh.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new js(Pr);return e.forEach(function(t){var e=new _h(t,0),t=new _h(t,Number.POSITIVE_INFINITY);n.fs.forEachInRange([e,t],function(t){r=r.add(t.hs)})}),cu.resolve(this._s(r))},Uh.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,e=n;$r.isDocumentKey(e)||(e=e.child(""));var e=new _h(new $r(e),0),i=new js(Pr);return this.fs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(i=i.add(t.hs)),!0)},e),cu.resolve(this._s(i))},Uh.prototype._s=function(t){var e=this,n=[];return t.forEach(function(t){t=e.ds(t);null!==t&&n.push(t)}),n},Uh.prototype.removeMutationBatch=function(n,r){var i=this;Rr(0===this.ys(r.batchId,"removed")),this.Tn.shift();var o=this.fs;return cu.forEach(r.mutations,function(t){var e=new _h(t.key,r.batchId);return o=o.delete(e),i.referenceDelegate.markPotentiallyOrphaned(n,t.key)}).next(function(){i.fs=o})},Uh.prototype.Xt=function(t){},Uh.prototype.containsKey=function(t,e){var n=new _h(e,0),n=this.fs.firstAfterOrEqual(n);return cu.resolve(e.isEqual(n&&n.key))},Uh.prototype.performConsistencyCheck=function(t){return this.Tn.length,cu.resolve()},Uh.prototype.ys=function(t,e){return this.ws(t)},Uh.prototype.ws=function(t){return 0===this.Tn.length?0:t-this.Tn[0].batchId},Uh.prototype.ds=function(t){t=this.ws(t);return t<0||t>=this.Tn.length?null:this.Tn[t]},Uh),Dh=(Vh.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,i=this.gs(e);return this.docs=this.docs.insert(r,{maybeDocument:e,size:i,readTime:n}),this.size+=i-o,this.Gt.addToCollectionParentIndex(t,r.path.popLast())},Vh.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Vh.prototype.getEntry=function(t,e){e=this.docs.get(e);return cu.resolve(e?e.maybeDocument:null)},Vh.prototype.getEntries=function(t,e){var n=this,r=Ks;return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),cu.resolve(r)},Vh.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Hs,i=new $r(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,s=u.maybeDocument,u=u.readTime;if(!e.path.isPrefixOf(a.path))break;u.compareTo(n)<=0||s instanceof Ci&&xo(e,s)&&(r=r.insert(s.key,s))}return cu.resolve(r)},Vh.prototype.ps=function(t,e){return cu.forEach(this.docs,function(t){return e(t)})},Vh.prototype.newChangeBuffer=function(t){return new Ah(this)},Vh.prototype.getSize=function(t){return cu.resolve(this.size)},Vh),Ah=(n(qh,Eh=Te),qh.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(t,e){e&&e.maybeDocument?i.push(r.Ve.addEntry(n,e.maybeDocument,r.getReadTime(t))):r.Ve.removeEntry(t)}),cu.waitFor(i)},qh.prototype.getFromCache=function(t,e){return this.Ve.getEntry(t,e)},qh.prototype.getAllFromCache=function(t,e){return this.Ve.getEntries(t,e)},qh),Nh=(Fh.prototype.forEachTarget=function(t,n){return this.Es.forEach(function(t,e){return n(e)}),cu.resolve()},Fh.prototype.getLastRemoteSnapshotVersion=function(t){return cu.resolve(this.lastRemoteSnapshotVersion)},Fh.prototype.getHighestSequenceNumber=function(t){return cu.resolve(this.Ts)},Fh.prototype.allocateTargetId=function(t){return this.highestTargetId=this.As.next(),cu.resolve(this.highestTargetId)},Fh.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Ts&&(this.Ts=e),cu.resolve()},Fh.prototype.re=function(t){this.Es.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.As=new yc(e),this.highestTargetId=e),t.sequenceNumber>this.Ts&&(this.Ts=t.sequenceNumber)},Fh.prototype.addTargetData=function(t,e){return this.re(e),this.targetCount+=1,cu.resolve()},Fh.prototype.updateTargetData=function(t,e){return this.re(e),cu.resolve()},Fh.prototype.removeTargetData=function(t,e){return this.Es.delete(e.target),this.Is.os(e.targetId),--this.targetCount,cu.resolve()},Fh.prototype.removeTargets=function(n,r,i){var o=this,s=0,a=[];return this.Es.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Es.delete(t),a.push(o.removeMatchingKeysForTargetId(n,e.targetId)),s++)}),cu.waitFor(a).next(function(){return s})},Fh.prototype.getTargetCount=function(t){return cu.resolve(this.targetCount)},Fh.prototype.getTargetData=function(t,e){e=this.Es.get(e)||null;return cu.resolve(e)},Fh.prototype.addMatchingKeys=function(t,e,n){return this.Is.ns(e,n),cu.resolve()},Fh.prototype.removeMatchingKeys=function(e,t,n){this.Is.rs(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),cu.waitFor(i)},Fh.prototype.removeMatchingKeysForTargetId=function(t,e){return this.Is.os(e),cu.resolve()},Fh.prototype.getMatchingKeysForTargetId=function(t,e){e=this.Is.us(e);return cu.resolve(e)},Fh.prototype.containsKey=function(t,e){return cu.resolve(this.Is.containsKey(e))},Fh),Ch=(Mh.prototype.start=function(){return Promise.resolve()},Mh.prototype.shutdown=function(){return this.Le=!1,Promise.resolve()},Object.defineProperty(Mh.prototype,"started",{get:function(){return this.Le},enumerable:!1,configurable:!0}),Mh.prototype.setDatabaseDeletedListener=function(){},Mh.prototype.setNetworkEnabled=function(){},Mh.prototype.getIndexManager=function(){return this.Gt},Mh.prototype.getMutationQueue=function(t){var e=this.Rs[t.toKey()];return e||(e=new Sh(this.Gt,this.referenceDelegate),this.Rs[t.toKey()]=e),e},Mh.prototype.getTargetCache=function(){return this.Ge},Mh.prototype.getRemoteDocumentCache=function(){return this.ze},Mh.prototype.getBundleCache=function(){return this.He},Mh.prototype.runTransaction=function(t,e,n){var r=this;Ar("MemoryPersistence","Starting transaction:",t);var i=new kh(this.Me.next());return this.referenceDelegate.vs(),n(i).next(function(t){return r.referenceDelegate.Ps(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},Mh.prototype.Vs=function(e,n){return cu.or(Object.values(this.Rs).map(function(t){return function(){return t.containsKey(e,n)}}))},Mh),kh=(n(Ph,wh=c),Ph),xh=(Oh.Cs=function(t){return new Oh(t)},Object.defineProperty(Oh.prototype,"xs",{get:function(){if(this.Ds)return this.Ds;throw xr()},enumerable:!1,configurable:!0}),Oh.prototype.addReference=function(t,e,n){return this.Ss.addReference(n,e),this.xs.delete(n.toString()),cu.resolve()},Oh.prototype.removeReference=function(t,e,n){return this.Ss.removeReference(n,e),this.xs.add(n.toString()),cu.resolve()},Oh.prototype.markPotentiallyOrphaned=function(t,e){return this.xs.add(e.toString()),cu.resolve()},Oh.prototype.removeTarget=function(t,e){var n=this;this.Ss.os(e.targetId).forEach(function(t){return n.xs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.xs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},Oh.prototype.vs=function(){this.Ds=new Set},Oh.prototype.Ps=function(n){var r=this,i=this.persistence.getRemoteDocumentCache().newChangeBuffer();return cu.forEach(this.xs,function(t){var e=$r.fromPath(t);return r.Ns(n,e).next(function(t){t||i.removeEntry(e)})}).next(function(){return r.Ds=null,i.apply(n)})},Oh.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ns(t,e).next(function(t){t?n.xs.delete(e.toString()):n.xs.add(e.toString())})},Oh.prototype.bs=function(t){return 0},Oh.prototype.Ns=function(t,e){var n=this;return cu.or([function(){return cu.resolve(n.Ss.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Vs(t,e)}])},Oh),Rh=(Lh.prototype.isAuthenticated=function(){return null!=this.uid},Lh.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},Lh.prototype.isEqual=function(t){return t.uid===this.uid},Lh);function Lh(t){this.uid=t}function Oh(t){this.persistence=t,this.Ss=new Ih,this.Ds=null}function Ph(t){var e=this;return(e=wh.call(this)||this).currentSequenceNumber=t,e}function Mh(t,e){var n=this;this.Rs={},this.Me=new Ir(0),this.Le=!1,this.Le=!0,this.referenceDelegate=t(this),this.Ge=new Nh(this),this.Gt=new Ju,this.ze=(t=this.Gt,new Dh(t,function(t){return n.referenceDelegate.bs(t)})),this.D=new Lu(e),this.He=new Th(this.D)}function Fh(t){this.persistence=t,this.Es=new Oc(Fi,qi),this.lastRemoteSnapshotVersion=Lo.min(),this.highestTargetId=0,this.Ts=0,this.Is=new Ih,this.targetCount=0,this.As=yc.ee()}function qh(t){var e=this;return(e=Eh.call(this)||this).Ve=t,e}function Vh(t,e){this.Gt=t,this.gs=e,this.docs=new Ps($r.comparator),this.size=0}function Uh(t,e){this.Gt=t,this.referenceDelegate=e,this.Tn=[],this.ls=1,this.fs=new js(_h.Zn)}function Bh(t,e){this.key=t,this.hs=e}function jh(){this.Xn=new js(_h.Zn),this.ts=new js(_h.es)}function Gh(t){this.D=t,this.Jn=new Map,this.Yn=new Map}function Kh(t,e){return"firestore_clients_"+t+"_"+e}function zh(t,e,n){n="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(n+="_"+e.uid),n}function Qh(t,e){return"firestore_targets_"+t+"_"+e}Rh.UNAUTHENTICATED=new Rh(null),Rh.GOOGLE_CREDENTIALS=new Rh("google-credentials-uid"),Rh.FIRST_PARTY=new Rh("first-party-uid");var Hh,Wh=(vl.$s=function(t,e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Wr(i.error.code,i.error.message)),o?new vl(t,e,i.state,r):(Nr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},vl.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},vl),Yh=(gl.$s=function(t,e){var n,r=JSON.parse(e),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(n=new Wr(r.error.code,r.error.message)),i?new gl(t,r.state,n):(Nr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},gl.prototype.Fs=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},gl),Xh=(yl.$s=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Js,o=0;r&&o<n.activeTargetIds.length;++o)r=Gr(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new yl(t,i):(Nr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},yl),Jh=(pl.$s=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new pl(e.clientId,e.onlineState):(Nr("SharedClientState","Failed to parse online state: "+t),null)},pl),$h=(dl.prototype.Os=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},dl.prototype.ks=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},dl.prototype.Fs=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},dl),Zh=(fl.At=function(t){return!(!t||!t.localStorage)},fl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l=this;return g(this,function(t){switch(t.label){case 0:return[4,this.syncEngine.gn()];case 1:for(s=t.sent(),e=0,n=s;e<n.length;e++)(r=n[e])!==this.Ms&&(i=this.getItem(Kh(this.persistenceKey,r)))&&(o=Xh.$s(r,i))&&(this.qs=this.qs.insert(o.clientId,o));for(this.Js(),(s=this.storage.getItem(this.zs))&&(a=this.Ys(s))&&this.Xs(a),u=0,c=this.Us;u<c.length;u++)h=c[u],this.Bs(h);return this.Us=[],this.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},fl.prototype.writeSequenceNumber=function(t){this.setItem(this.Ks,JSON.stringify(t))},fl.prototype.getAllActiveQueryTargets=function(){return this.Zs(this.qs)},fl.prototype.isActiveQueryTarget=function(n){var r=!1;return this.qs.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},fl.prototype.addPendingMutation=function(t){this.ti(t,"pending")},fl.prototype.updateMutationState=function(t,e,n){this.ti(t,e,n),this.ei(t)},fl.prototype.addLocalQueryTarget=function(t){var e,n="not-current";return this.isActiveQueryTarget(t)&&(!(e=this.storage.getItem(Qh(this.persistenceKey,t)))||(e=Yh.$s(t,e))&&(n=e.state)),this.ni.Os(t),this.Js(),n},fl.prototype.removeLocalQueryTarget=function(t){this.ni.ks(t),this.Js()},fl.prototype.isLocalQueryTarget=function(t){return this.ni.activeTargetIds.has(t)},fl.prototype.clearQueryState=function(t){this.removeItem(Qh(this.persistenceKey,t))},fl.prototype.updateQueryState=function(t,e,n){this.si(t,e,n)},fl.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.ei(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},fl.prototype.setOnlineState=function(t){this.ii(t)},fl.prototype.notifyBundleLoaded=function(){this.ri()},fl.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.Ls),this.removeItem(this.Qs),this.started=!1)},fl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ar("SharedClientState","READ",t,e),e},fl.prototype.setItem=function(t,e){Ar("SharedClientState","SET",t,e),this.storage.setItem(t,e)},fl.prototype.removeItem=function(t){Ar("SharedClientState","REMOVE",t),this.storage.removeItem(t)},fl.prototype.Bs=function(t){var e=this,o=t;o.storageArea===this.storage&&(Ar("SharedClientState","EVENT",o.key,o.newValue),o.key!==this.Qs?this.Fe.enqueueRetryable(function(){return y(e,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){if(this.started){if(null!==o.key)if(this.Ws.test(o.key)){if(null==o.newValue)return e=this.oi(o.key),[2,this.ci(e,null)];if(e=this.ai(o.key,o.newValue))return[2,this.ci(e.clientId,e)]}else if(this.js.test(o.key)){if(null!==o.newValue&&(n=this.ui(o.key,o.newValue)))return[2,this.hi(n)]}else if(this.Gs.test(o.key)){if(null!==o.newValue&&(r=this.li(o.key,o.newValue)))return[2,this.fi(r)]}else if(o.key===this.zs){if(null!==o.newValue&&(i=this.Ys(o.newValue)))return[2,this.Xs(i)]}else if(o.key===this.Ks)(i=function(t){var e=Ir.o;if(null!=t)try{var n=JSON.parse(t);Rr("number"==typeof n),e=n}catch(t){Nr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(o.newValue))!==Ir.o&&this.sequenceNumberHandler(i);else if(o.key===this.Hs)return[2,this.syncEngine.di()]}else this.Us.push(o);return[2]})})}):Nr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))},Object.defineProperty(fl.prototype,"ni",{get:function(){return this.qs.get(this.Ms)},enumerable:!1,configurable:!0}),fl.prototype.Js=function(){this.setItem(this.Qs,this.ni.Fs())},fl.prototype.ti=function(t,e,n){n=new Wh(this.currentUser,t,e,n),t=zh(this.persistenceKey,this.currentUser,t);this.setItem(t,n.Fs())},fl.prototype.ei=function(t){t=zh(this.persistenceKey,this.currentUser,t);this.removeItem(t)},fl.prototype.ii=function(t){t={clientId:this.Ms,onlineState:t};this.storage.setItem(this.zs,JSON.stringify(t))},fl.prototype.si=function(t,e,n){var r=Qh(this.persistenceKey,t),n=new Yh(t,e,n);this.setItem(r,n.Fs())},fl.prototype.ri=function(){this.setItem(this.Hs,"value-not-used")},fl.prototype.oi=function(t){t=this.Ws.exec(t);return t?t[1]:null},fl.prototype.ai=function(t,e){t=this.oi(t);return Xh.$s(t,e)},fl.prototype.ui=function(t,e){var n=this.js.exec(t),t=Number(n[1]),n=void 0!==n[2]?n[2]:null;return Wh.$s(new Rh(n),t,e)},fl.prototype.li=function(t,e){t=this.Gs.exec(t),t=Number(t[1]);return Yh.$s(t,e)},fl.prototype.Ys=function(t){return Jh.$s(t)},fl.prototype.hi=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.syncEngine.wi(e.batchId,e.state,e.error)]:(Ar("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},fl.prototype.fi=function(t){return this.syncEngine._i(t.targetId,t.state,t.error)},fl.prototype.ci=function(t,e){var n=this,r=e?this.qs.insert(t,e):this.qs.remove(t),i=this.Zs(this.qs),o=this.Zs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.mi(s,a).then(function(){n.qs=r})},fl.prototype.Xs=function(t){this.qs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},fl.prototype.Zs=function(t){var n=Js;return t.forEach(function(t,e){n=n.unionWith(e.activeTargetIds)}),n},fl),tl=(ll.prototype.addPendingMutation=function(t){},ll.prototype.updateMutationState=function(t,e,n){},ll.prototype.addLocalQueryTarget=function(t){return this.yi.Os(t),this.gi[t]||"not-current"},ll.prototype.updateQueryState=function(t,e,n){this.gi[t]=e},ll.prototype.removeLocalQueryTarget=function(t){this.yi.ks(t)},ll.prototype.isLocalQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},ll.prototype.clearQueryState=function(t){delete this.gi[t]},ll.prototype.getAllActiveQueryTargets=function(){return this.yi.activeTargetIds},ll.prototype.isActiveQueryTarget=function(t){return this.yi.activeTargetIds.has(t)},ll.prototype.start=function(){return this.yi=new $h,Promise.resolve()},ll.prototype.handleUserChange=function(t,e,n){},ll.prototype.setOnlineState=function(t){},ll.prototype.shutdown=function(){},ll.prototype.writeSequenceNumber=function(t){},ll.prototype.notifyBundleLoaded=function(){},ll),el=(hl.prototype.pi=function(t){},hl.prototype.shutdown=function(){},hl),nl=(cl.prototype.pi=function(t){this.Ri.push(t)},cl.prototype.shutdown=function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ii)},cl.prototype.bi=function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ii)},cl.prototype.Ti=function(){Ar("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(0)},cl.prototype.Ai=function(){Ar("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Ri;t<e.length;t++)(0,e[t])(1)},cl.At=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},cl),rl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},il=(ul.prototype.Vi=function(t){this.Si=t},ul.prototype.Di=function(t){this.Ci=t},ul.prototype.onMessage=function(t){this.xi=t},ul.prototype.close=function(){this.Pi()},ul.prototype.send=function(t){this.vi(t)},ul.prototype.Ni=function(){this.Si()},ul.prototype.$i=function(t){this.Ci(t)},ul.prototype.Fi=function(t){this.xi(t)},ul),ol=(al.prototype.Mi=function(e,t,n,r){var i=this.Li(e,t);Ar("RestConnection","Sending: ",i,n);t={};return this.Bi(t,r),this.qi(e,i,t,n).then(function(t){return Ar("RestConnection","Received: ",t),t},function(t){throw Cr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},al.prototype.Ui=function(t,e,n,r){return this.Mi(t,e,n,r)},al.prototype.Bi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.1",t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},al.prototype.Li=function(t,e){t=rl[t];return this.Oi+"/v1/"+e+":"+t},n(sl,Hh=al),sl.prototype.qi=function(o,e,s,a){return new Promise(function(n,r){var i=new Tr;i.listenOnce(vr.COMPLETE,function(){try{switch(i.getLastErrorCode()){case gr.NO_ERROR:var t=i.getResponseJson();Ar("Connection","XHR received:",JSON.stringify(t)),n(t);break;case gr.TIMEOUT:Ar("Connection",'RPC "'+o+'" timed out'),r(new Wr(Hr.DEADLINE_EXCEEDED,"Request time out"));break;case gr.HTTP_ERROR:var e=i.getStatus();Ar("Connection",'RPC "'+o+'" failed with status:',e,"response text:",i.getResponseText()),0<e?(t=i.getResponseJson().error)&&t.status&&t.message?(e=t.status.toLowerCase().replace(/_/g,"-"),e=0<=Object.values(Hr).indexOf(e)?e:Hr.UNKNOWN,r(new Wr(e,t.message))):r(new Wr(Hr.UNKNOWN,"Server responded with status "+i.getStatus())):r(new Wr(Hr.UNAVAILABLE,"Connection failed."));break;default:xr()}}finally{Ar("Connection",'RPC "'+o+'" completed.')}});var t=JSON.stringify(a);i.send(e,"POST",t,s,15)})},sl.prototype.Qi=function(t,e){var n,r=[this.Oi,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=new hr,o=yr(),t={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Bi(t.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=l().indexOf("Electron/")||(0<=(n=l()).indexOf("MSIE ")||0<=n.indexOf("Trident/"))||0<=l().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(t.httpHeadersOverwriteParam="$httpHeaders");r=r.join("");Ar("Connection","Creating WebChannel: "+r,t);var s=i.createWebChannel(r,t),a=!1,u=!1,c=new il({vi:function(t){u?Ar("Connection","Not sending because WebChannel is closed:",t):(a||(Ar("Connection","Opening WebChannel transport."),s.open(),a=!0),Ar("Connection","WebChannel sending:",t),s.send(t))},Pi:function(){return s.close()}}),t=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return t(s,Er.EventType.OPEN,function(){u||Ar("Connection","WebChannel transport opened.")}),t(s,Er.EventType.CLOSE,function(){u||(u=!0,Ar("Connection","WebChannel transport closed"),c.$i())}),t(s,Er.EventType.ERROR,function(t){u||(u=!0,Cr("Connection","WebChannel transport errored:",t),c.$i(new Wr(Hr.UNAVAILABLE,"The operation could not be completed")))}),t(s,Er.EventType.MESSAGE,function(t){var e,n,r,i;u||(Rr(!!(e=t.data[0])),(n=e.error||(null===(i=e[0])||void 0===i?void 0:i.error))?(Ar("Connection","WebChannel received error:",n),r=n.status,t=function(){var t=Ds[r];if(void 0!==t)return Os(t)}(),i=n.message,void 0===t&&(t=Hr.INTERNAL,i="Unknown error status: "+r+" with message "+n.message),u=!0,c.$i(new Wr(t,i)),s.close()):(Ar("Connection","WebChannel received:",e),c.Fi(e)))}),t(o,mr.STAT_EVENT,function(t){t.stat===br?Ar("Connection","Detected buffering proxy"):t.stat===wr&&Ar("Connection","Detected no buffering proxy")}),setTimeout(function(){c.Ni()},0),c},sl);function sl(t){var e=this;return(e=Hh.call(this,t)||this).forceLongPolling=t.forceLongPolling,e.autoDetectLongPolling=t.autoDetectLongPolling,e}function al(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Oi=e+"://"+t.host,this.ki="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}function ul(t){this.vi=t.vi,this.Pi=t.Pi}function cl(){var t=this;this.Ei=function(){return t.Ti()},this.Ii=function(){return t.Ai()},this.Ri=[],this.bi()}function hl(){}function ll(){this.yi=new $h,this.gi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}function fl(t,e,n,r,i){this.window=t,this.Fe=e,this.persistenceKey=n,this.Ms=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ls=this.Bs.bind(this),this.qs=new Ps(Pr),this.started=!1,this.Us=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=Kh(this.persistenceKey,this.Ms),this.Ks="firestore_sequence_number_"+this.persistenceKey,this.qs=this.qs.insert(this.Ms,new $h),this.Ws=new RegExp("^firestore_clients_"+n+"_([^_]*)$"),this.js=new RegExp("^firestore_mutations_"+n+"_(\\d+)(?:_(.*))?$"),this.Gs=new RegExp("^firestore_targets_"+n+"_(\\d+)$"),this.zs="firestore_online_state_"+this.persistenceKey,this.Hs="firestore_bundle_loaded_"+this.persistenceKey,this.window.addEventListener("storage",this.Ls)}function dl(){this.activeTargetIds=Js}function pl(t,e){this.clientId=t,this.onlineState=e}function yl(t,e){this.clientId=t,this.activeTargetIds=e}function gl(t,e,n){this.targetId=t,this.state=e,this.error=n}function vl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function ml(){return"undefined"!=typeof window?window:null}function bl(){return"undefined"!=typeof document?document:null}function wl(t){return new da(t,!0)}function El(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.qr=[],this.Ur=new Map,this.Qr=new Set,this.Kr=[],this.Wr=i,this.Wr.pi(function(t){n.enqueueAndForget(function(){return y(o,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Kl(this)?(Ar("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Qr.add(4),[4,Fl(e)];case 1:return t.sent(),e.jr.set("Unknown"),e.Qr.delete(4),[4,Ml(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.jr=new Cl(n,r)}var Tl,Il,_l,Sl=(Pl.prototype.reset=function(){this.Gi=0},Pl.prototype.Ji=function(){this.Gi=this.ji},Pl.prototype.Yi=function(t){var e=this;this.cancel();var n=Math.floor(this.Gi+this.Xi()),r=Math.max(0,Date.now()-this.Hi),i=Math.max(0,n-r);0<i&&Ar("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Gi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.zi=this.Fe.enqueueAfterDelay(this.timerId,i,function(){return e.Hi=Date.now(),t()}),this.Gi*=this.Wi,this.Gi<this.Ki&&(this.Gi=this.Ki),this.Gi>this.ji&&(this.Gi=this.ji)},Pl.prototype.Zi=function(){null!==this.zi&&(this.zi.skipDelay(),this.zi=null)},Pl.prototype.cancel=function(){null!==this.zi&&(this.zi.cancel(),this.zi=null)},Pl.prototype.Xi=function(){return(Math.random()-.5)*this.Gi},Pl),Te=(Ol.prototype.cr=function(){return 1===this.state||2===this.state||4===this.state},Ol.prototype.ar=function(){return 2===this.state},Ol.prototype.start=function(){3!==this.state?this.auth():this.ur()},Ol.prototype.stop=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.cr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Ol.prototype.hr=function(){this.state=0,this.rr.reset()},Ol.prototype.lr=function(){var t=this;this.ar()&&null===this.ir&&(this.ir=this.Fe.enqueueAfterDelay(this.tr,6e4,function(){return t.dr()}))},Ol.prototype.wr=function(t){this._r(),this.stream.send(t)},Ol.prototype.dr=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return this.ar()?[2,this.close(0)]:[2]})})},Ol.prototype._r=function(){this.ir&&(this.ir.cancel(),this.ir=null)},Ol.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this._r(),this.rr.cancel(),this.sr++,3!==e?this.rr.reset():n&&n.code===Hr.RESOURCE_EXHAUSTED?(Nr(n.toString()),Nr("Using maximum backoff delay to prevent overloading the backend."),this.rr.Ji()):n&&n.code===Hr.UNAUTHENTICATED&&this.nr.invalidateToken(),null!==this.stream&&(this.mr(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Di(n)];case 1:return t.sent(),[2]}})})},Ol.prototype.mr=function(){},Ol.prototype.auth=function(){var n=this;this.state=1;var t=this.yr(this.sr),e=this.sr;this.nr.getToken().then(function(t){n.sr===e&&n.gr(t)},function(e){t(function(){var t=new Wr(Hr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.pr(t)})})},Ol.prototype.gr=function(t){var e=this,n=this.yr(this.sr);this.stream=this.Er(t),this.stream.Vi(function(){n(function(){return e.state=2,e.listener.Vi()})}),this.stream.Di(function(t){n(function(){return e.pr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Ol.prototype.ur=function(){var t=this;this.state=4,this.rr.Yi(function(){return y(t,void 0,void 0,function(){return g(this,function(t){return this.state=0,this.start(),[2]})})})},Ol.prototype.pr=function(t){return Ar("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Ol.prototype.yr=function(e){var n=this;return function(t){n.Fe.enqueueAndForget(function(){return n.sr===e?t():(Ar("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Ol),Dl=(n(Ll,_l=Te),Ll.prototype.Er=function(t){return this.er.Qi("Listen",t)},Ll.prototype.onMessage=function(t){this.rr.reset();var e=function(t,e){if("targetChange"in e){e.targetChange;var n="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:xr(),r=e.targetChange.targetIds||[],i=(s=e.targetChange.resumeToken,t.V?(Rr(void 0===s||"string"==typeof s),Zr.fromBase64String(s||"")):(Rr(void 0===s||s instanceof Uint8Array),Zr.fromUint8Array(s||new Uint8Array))),o=(a=e.targetChange.cause)&&(u=void 0===(c=a).code?Hr.UNKNOWN:Os(c.code),new Wr(u,c.message||"")),s=new na(n,r,i,o||null)}else if("documentChange"in e){e.documentChange,(n=e.documentChange).document,n.document.name,n.document.updateTime;var r=wa(t,n.document.name),i=ga(n.document.updateTime),a=new Po({mapValue:{fields:n.document.fields}}),u=(o=new Ci(r,i,a,{}),n.targetIds||[]),c=n.removedTargetIds||[];s=new ta(u,c,o.key,o)}else if("documentDelete"in e)e.documentDelete,(n=e.documentDelete).document,r=wa(t,n.document),i=n.readTime?ga(n.readTime):Lo.min(),a=new ki(r,i),o=n.removedTargetIds||[],s=new ta([],o,a.key,a);else if("documentRemove"in e)e.documentRemove,(n=e.documentRemove).document,r=wa(t,n.document),i=n.removedTargetIds||[],s=new ta([],i,r,null);else{if(!("filter"in e))return xr();e.filter;e=e.filter;e.targetId,n=e.count||0,r=new Ss(n),i=e.targetId,s=new ea(i,r)}return s}(this.D,t),t=function(t){if(!("targetChange"in t))return Lo.min();t=t.targetChange;return(!t.targetIds||!t.targetIds.length)&&t.readTime?ga(t.readTime):Lo.min()}(t);return this.listener.Tr(e,t)},Ll.prototype.Ir=function(t){var e,n,r,i={};i.database=Ia(this.D),i.addTarget=(e=this.D,(r=Vi(r=(n=t).target)?{documents:Ca(e,r)}:{query:ka(e,r)}).targetId=n.targetId,0<n.resumeToken.approximateByteSize()?r.resumeToken=ya(e,n.resumeToken):0<n.snapshotVersion.compareTo(Lo.min())&&(r.readTime=pa(e,n.snapshotVersion.toTimestamp())),r);var o,t=(this.D,o=t,null==(t=function(){switch(o.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return xr()}}())?null:{"goog-listen-tags":t});t&&(i.labels=t),this.wr(i)},Ll.prototype.Ar=function(t){var e={};e.database=Ia(this.D),e.removeTarget=t,this.wr(e)},Ll),Al=(n(Rl,Il=Te),Object.defineProperty(Rl.prototype,"br",{get:function(){return this.Rr},enumerable:!1,configurable:!0}),Rl.prototype.start=function(){this.Rr=!1,this.lastStreamToken=void 0,Il.prototype.start.call(this)},Rl.prototype.mr=function(){this.Rr&&this.vr([])},Rl.prototype.Er=function(t){return this.er.Qi("Write",t)},Rl.prototype.onMessage=function(t){if(Rr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Rr){this.rr.reset();var e=(n=t.writeResults,r=t.commitTime,n&&0<n.length?(Rr(void 0!==r),n.map(function(t){return n=r,(t=(e=t).updateTime?ga(e.updateTime):ga(n)).isEqual(Lo.min())&&(t=ga(n)),new as(t,e.transformResults||[]);var e,n})):[]),n=ga(t.commitTime);return this.listener.Pr(n,e)}var n,r;return Rr(!t.writeResults||0===t.writeResults.length),this.Rr=!0,this.listener.Vr()},Rl.prototype.Sr=function(){var t={};t.database=Ia(this.D),this.wr(t)},Rl.prototype.vr=function(t){var e=this,t={streamToken:this.lastStreamToken,writes:t.map(function(t){return Aa(e.D,t)})};this.wr(t)},Rl),Nl=(n(xl,Tl=function(){}),xl.prototype.Cr=function(){if(this.Dr)throw new Wr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},xl.prototype.Mi=function(e,n,r){var i=this;return this.Cr(),this.credentials.getToken().then(function(t){return i.er.Mi(e,n,r,t)}).catch(function(t){throw t.code===Hr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},xl.prototype.Ui=function(e,n,r){var i=this;return this.Cr(),this.credentials.getToken().then(function(t){return i.er.Ui(e,n,r,t)}).catch(function(t){throw t.code===Hr.UNAUTHENTICATED&&i.credentials.invalidateToken(),t})},xl.prototype.terminate=function(){this.Dr=!1},xl),Cl=(kl.prototype.Or=function(){var t=this;0===this.Nr&&(this.kr("Unknown"),this.$r=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.$r=null,t.Mr("Backend didn't respond within 10 seconds."),t.kr("Offline"),Promise.resolve()}))},kl.prototype.Lr=function(t){"Online"===this.state?this.kr("Unknown"):(this.Nr++,1<=this.Nr&&(this.Br(),this.Mr("Connection failed 1 times. Most recent error: "+t.toString()),this.kr("Offline")))},kl.prototype.set=function(t){this.Br(),this.Nr=0,"Online"===t&&(this.Fr=!1),this.kr(t)},kl.prototype.kr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},kl.prototype.Mr=function(t){t="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fr?(Nr(t),this.Fr=!1):Ar("OnlineStateTracker",t)},kl.prototype.Br=function(){null!==this.$r&&(this.$r.cancel(),this.$r=null)},kl);function kl(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.Nr=0,this.$r=null,this.Fr=!0}function xl(t,e,n){var r=this;return(r=Tl.call(this)||this).credentials=t,r.er=e,r.D=n,r.Dr=!1,r}function Rl(t,e,n,r,i){var o=this;return(o=Il.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).D=r,o.Rr=!1,o}function Ll(t,e,n,r,i){var o=this;return(o=_l.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).D=r,o}function Ol(t,e,n,r,i,o){this.Fe=t,this.tr=n,this.er=r,this.nr=i,this.listener=o,this.state=0,this.sr=0,this.ir=null,this.stream=null,this.rr=new Sl(t,e)}function Pl(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Fe=t,this.timerId=e,this.Ki=n,this.Wi=r,this.ji=i,this.Gi=0,this.zi=null,this.Hi=Date.now(),this.reset()}function Ml(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:if(!Kl(r))return[3,4];e=0,n=r.Kr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Fl(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:e=0,n=r.Kr,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ql(t,e){t.Ur.has(e.targetId)||(t.Ur.set(e.targetId,e),Gl(t)?jl(t):Zl(t).ar()&&Ul(t,e))}function Vl(t,e){var n=t,t=Zl(n);n.Ur.delete(e),t.ar()&&Bl(n,e),0===n.Ur.size&&(t.ar()?t.lr():Kl(n)&&n.jr.set("Unknown"))}function Ul(t,e){t.Gr.H(e.targetId),Zl(t).Ir(e)}function Bl(t,e){t.Gr.H(e),Zl(t).Ar(e)}function jl(e){e.Gr=new ia({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},yt:function(t){return e.Ur.get(t)||null}}),Zl(e).start(),e.jr.Or()}function Gl(t){return Kl(t)&&!Zl(t).cr()&&0<t.Ur.size}function Kl(t){return 0===t.Qr.size}function zl(t){t.Gr=void 0}function Ql(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:if(s.jr.set("Online"),!(a instanceof na&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Ur.has(i)?[4,o.remoteSyncer.rejectListen(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Ur.delete(i),o.Gr.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(s,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Ar("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,Hl(s,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof ta?s.Gr.st(a):a instanceof ea?s.Gr.ht(a):s.Gr.ot(a),u.isEqual(Lo.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,lh(s.localStore)];case 8:return o=t.sent(),0<=u.compareTo(o)?[4,(i=u,(e=(r=s).Gr.dt(i)).targetChanges.forEach(function(t,e){var n;0<t.resumeToken.approximateByteSize()&&((n=r.Ur.get(e))&&r.Ur.set(e,n.withResumeToken(t.resumeToken,i)))}),e.targetMismatches.forEach(function(t){var e=r.Ur.get(t);e&&(r.Ur.set(t,e.withResumeToken(Zr.EMPTY_BYTE_STRING,e.snapshotVersion)),Bl(r,t),e=new Ru(e.target,t,1,e.sequenceNumber),Ul(r,e))}),r.remoteSyncer.applyRemoteEvent(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Ar("RemoteStore","Failed to raise snapshot:",o=t.sent()),[4,Hl(s,o)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function Hl(n,r,i){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:if(!wu(r))throw r;return n.Qr.add(1),[4,Fl(n)];case 1:return t.sent(),n.jr.set("Offline"),i=i||function(){return lh(n.localStore)},n.asyncQueue.enqueueRetryable(function(){return y(e,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return Ar("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Qr.delete(1),[4,Ml(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function Wl(e,n){return n().catch(function(t){return Hl(e,t,n)})}function Yl(u){return y(this,void 0,void 0,function(){var i,o,s,a;return g(this,function(t){switch(t.label){case 0:o=tf(i=u),s=0<i.qr.length?i.qr[i.qr.length-1].batchId:-1,t.label=1;case 1:if(!(Kl(i)&&i.qr.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.localStore,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Tn.getNextMutationBatchAfterBatchId(t,n)}))];case 3:return null===(a=t.sent())?(0===i.qr.length&&o.lr(),[3,7]):(s=a.batchId,function(t,e){t.qr.push(e);t=tf(t);t.ar()&&t.br&&t.vr(e.mutations)}(i,a),[3,6]);case 4:return a=t.sent(),[4,Hl(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return Xl(i)&&Jl(i),[2]}var e,n,r})})}function Xl(t){return Kl(t)&&!tf(t).cr()&&0<t.qr.length}function Jl(t){tf(t).start()}function $l(n,r){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,r?(e.Qr.delete(2),[4,Ml(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Qr.add(2),[4,Fl(e)]);case 3:t.sent(),e.jr.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function Zl(n){var t,e,r,i=this;return n.zr||(n.zr=(t=n.datastore,e=n.asyncQueue,r={Vi:function(n){return y(this,void 0,void 0,function(){return g(this,function(t){return n.Ur.forEach(function(t,e){Ul(n,t)}),[2]})})}.bind(null,n),Di:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){return zl(e),Gl(e)?(e.jr.Lr(n),jl(e)):e.jr.set("Unknown"),[2]})})}.bind(null,n),Tr:Ql.bind(null,n)},t.Cr(),new Dl(e,t.er,t.credentials,t.D,r)),n.Kr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.zr.hr(),Gl(n)?jl(n):n.jr.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.zr.stop()];case 2:t.sent(),zl(n),t.label=3;case 3:return[2]}})})})),n.zr}function tf(n){var t,e,r,i=this;return n.Hr||(n.Hr=(t=n.datastore,e=n.asyncQueue,r={Vi:function(e){return y(this,void 0,void 0,function(){return g(this,function(t){return tf(e).Sr(),[2]})})}.bind(null,n),Di:function(e,n){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return n&&tf(e).br?[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return Ls(n=i.code)&&n!==Hr.ABORTED?(e=r.qr.shift(),tf(r).hr(),[4,Wl(r,function(){return r.remoteSyncer.rejectFailedWrite(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,Yl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return Xl(e)&&Jl(e),[2]}})})}.bind(null,n),Vr:function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){for(e=tf(o),n=0,r=o.qr;n<r.length;n++)i=r[n],e.vr(i.mutations);return[2]})})}.bind(null,n),Pr:function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return e=r.qr.shift(),n=xu.from(e,i,o),[4,Wl(r,function(){return r.remoteSyncer.applySuccessfulWrite(n)})];case 1:return t.sent(),[4,Yl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},t.Cr(),new Al(e,t.er,t.credentials,t.D,r)),n.Kr.push(function(e){return y(i,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e?(n.Hr.hr(),[4,Yl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.Hr.stop()];case 3:t.sent(),0<n.qr.length&&(Ar("RemoteStore","Stopping write stream with "+n.qr.length+" pending writes"),n.qr=[]),t.label=4;case 4:return[2]}})})})),n.Hr}var ef=(nf.createAndSchedule=function(t,e,n,r,i){i=new nf(t,e,Date.now()+n,r,i);return i.start(n),i},nf.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},nf.prototype.skipDelay=function(){return this.handleDelayElapsed()},nf.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Wr(Hr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},nf.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},nf.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},nf);function nf(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new uu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}function rf(t,e){if(Nr("AsyncQueue",e+": "+t),wu(t))return new Wr(Hr.UNAVAILABLE,e+": "+t);throw t}function of(){this.queries=new Oc(Co,No),this.onlineState="Unknown",this.Zr=new Set}var sf=(ff.emptySet=function(t){return new ff(t.comparator)},ff.prototype.has=function(t){return null!=this.keyedMap.get(t)},ff.prototype.get=function(t){return this.keyedMap.get(t)},ff.prototype.first=function(){return this.sortedSet.minKey()},ff.prototype.last=function(){return this.sortedSet.maxKey()},ff.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},ff.prototype.indexOf=function(t){t=this.keyedMap.get(t);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(ff.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),ff.prototype.forEach=function(n){this.sortedSet.inorderTraversal(function(t,e){return n(t),!1})},ff.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},ff.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},ff.prototype.isEqual=function(t){if(!(t instanceof ff))return!1;if(this.size!==t.size)return!1;for(var e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();e.hasNext();){var r=e.getNext().key,i=n.getNext().key;if(!r.isEqual(i))return!1}return!0},ff.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},ff.prototype.copy=function(t,e){var n=new ff;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n},ff),af=(lf.prototype.track=function(t){var e=t.doc.key,n=this.Jr.get(e);!n||0!==t.type&&3===n.type?this.Jr=this.Jr.insert(e,t):3===t.type&&1!==n.type?this.Jr=this.Jr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jr=this.Jr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jr=this.Jr.remove(e):1===t.type&&2===n.type?this.Jr=this.Jr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jr=this.Jr.insert(e,{type:2,doc:t.doc}):xr()},lf.prototype.Yr=function(){var n=[];return this.Jr.inorderTraversal(function(t,e){n.push(e)}),n},lf),uf=(hf.fromInitialDocuments=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new hf(t,e,sf.emptySet(e),i,n,r,!0,!1)},Object.defineProperty(hf.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),hf.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&No(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},hf),cf=function(){this.Xr=void 0,this.listeners=[]};function hf(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}function lf(){this.Jr=new Ps($r.comparator)}function ff(n){this.comparator=n?function(t,e){return n(t,e)||$r.comparator(t.key,e.key)}:function(t,e){return $r.comparator(t.key,e.key)},this.keyedMap=Hs,this.sortedSet=new Ps(this.comparator)}function df(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:if(e=s,n=a.query,r=!1,(i=e.queries.get(n))||(r=!0,i=new cf),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.onListen(n)];case 2:return o.Xr=t.sent(),[3,4];case 3:return o=t.sent(),o=rf(o,"Initialization of query '"+ko(a.query)+"' failed"),[2,void a.onError(o)];case 4:return e.queries.set(n,i),i.listeners.push(a),a.eo(e.onlineState),i.Xr&&a.no(i.Xr)&&yf(e),[2]}})})}function pf(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){return e=s,n=a.query,r=!1,(i=e.queries.get(n))&&0<=(o=i.listeners.indexOf(a))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.queries.delete(n),e.onUnlisten(n))]:[2]})})}function yf(t){t.Zr.forEach(function(t){t.next()})}var gf=(If.prototype.no=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new uf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.io?this.oo(t)&&(this.so.next(t),o=!0):this.co(t,this.onlineState)&&(this.ao(t),o=!0),this.ro=t,o},If.prototype.onError=function(t){this.so.error(t)},If.prototype.eo=function(t){this.onlineState=t;var e=!1;return this.ro&&!this.io&&this.co(this.ro,t)&&(this.ao(this.ro),e=!0),e},If.prototype.co=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.uo&&n||t.docs.isEmpty()&&"Offline"!==e)},If.prototype.oo=function(t){if(0<t.docChanges.length)return!0;var e=this.ro&&this.ro.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},If.prototype.ao=function(t){t=uf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.io=!0,this.so.next(t)},If),vf=(Tf.prototype.ho=function(){return"metadata"in this.payload},Tf),mf=(Ef.prototype.Gn=function(t){return wa(this.D,t)},Ef.prototype.zn=function(t){return t.metadata.exists?Da(this.D,t.document,!1):new ki(this.Gn(t.metadata.name),this.Hn(t.metadata.readTime))},Ef.prototype.Hn=ga,Ef),bf=(wf.prototype.fo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},wf.prototype.wo=function(t){for(var e=new Map,n=new mf(this.D),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.Gn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Xs()).add(s);e.set(c,h)}}return e},wf.prototype.complete=function(){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return[4,function(l,f,d,p){return y(this,void 0,void 0,function(){var n,r,i,o,e,s,a,u,c,h;return g(this,function(t){switch(t.label){case 0:for(n=l,r=Xs(),i=Ks,o=Ws,e=0,s=d;e<s.length;e++)a=s[e],u=f.Gn(a.metadata.name),a.document&&(r=r.add(u)),i=i.insert(u,f.zn(a)),o=o.insert(u,f.Hn(a.metadata.readTime));return c=n.Qn.newChangeBuffer({trackRemovals:!0}),[4,ph(n,Do(bo(Yr.fromString("__bundle__/docs/"+p))))];case 1:return h=t.sent(),[2,n.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return dh(e,c,i,Lo.min(),o).next(function(t){return c.apply(e),t}).next(function(t){return n.Ge.removeMatchingKeysForTargetId(e,h.targetId).next(function(){return n.Ge.addMatchingKeys(e,r,h.targetId)}).next(function(){return n.Kn.vn(e,t)})})})]}})})}(this.localStore,new mf(this.D),this.documents,this.lo.id)];case 1:e=t.sent(),n=this.wo(this.documents),r=0,i=this.queries,t.label=2;case 2:return r<i.length?(i=i[r],[4,function(e,i,o){return void 0===o&&(o=Xs()),y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,ph(e,Do(Qu(i.bundledQuery)))];case 1:return n=t.sent(),[2,(r=e).persistence.runTransaction("Save named query","readwrite",function(t){var e=ga(i.readTime);if(0<=n.snapshotVersion.compareTo(e))return r.He.saveNamedQuery(t,i);e=n.withResumeToken(Zr.EMPTY_BYTE_STRING,e);return r.Bn=r.Bn.insert(e.targetId,e),r.Ge.updateTargetData(t,e).next(function(){return r.Ge.removeMatchingKeysForTargetId(t,n.targetId)}).next(function(){return r.Ge.addMatchingKeys(t,o,n.targetId)}).next(function(){return r.He.saveNamedQuery(t,i)})})]}})})}(this.localStore,i,n.get(i.name))]):[3,5];case 3:t.sent(),t.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Zc(Object.assign({},this.progress),e))]}})})},wf);function wf(t,e,n){this.lo=t,this.localStore=e,this.D=n,this.queries=[],this.documents=[],this.progress=_f(t)}function Ef(t){this.D=t}function Tf(t,e){this.payload=t,this.byteLength=e}function If(t,e,n){this.query=t,this.so=e,this.io=!1,this.ro=null,this.onlineState="Unknown",this.options=n||{}}function _f(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var Sf=function(t){this.key=t},Df=function(t){this.key=t},Af=(Object.defineProperty(Rf.prototype,"To",{get:function(){return this._o},enumerable:!1,configurable:!0}),Rf.prototype.Io=function(t,e){var s=this,a=e?e.Ao:new af,u=(e||this).Eo,c=(e||this).mutatedKeys,h=u,l=!1,f=wo(this.query)&&u.size===this.query.limit?u.last():null,d=Eo(this.query)&&u.size===this.query.limit?u.first():null;if(t.inorderTraversal(function(t,e){var n=u.get(t),r=(r=e instanceof Ci?e:null)&&(xo(s.query,r)?r:null),i=!!n&&s.mutatedKeys.has(n.key),o=!!r&&(r.hasLocalMutations||s.mutatedKeys.has(r.key)&&r.hasCommittedMutations),e=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),e=!0):s.Ro(n,r)||(a.track({type:2,doc:r}),e=!0,(f&&0<s.po(r,f)||d&&s.po(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),e=!0):n&&!r&&(a.track({type:1,doc:n}),e=!0,(f||d)&&(l=!0)),e&&(c=r?(h=h.add(r),o?c.add(t):c.delete(t)):(h=h.delete(t),c.delete(t)))}),wo(this.query)||Eo(this.query))for(;h.size>this.query.limit;){var n=wo(this.query)?h.last():h.first(),h=h.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{Eo:h,Ao:a,Mn:l,mutatedKeys:c}},Rf.prototype.Ro=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},Rf.prototype.applyChanges=function(t,e,n){var o=this,r=this.Eo;this.Eo=t.Eo,this.mutatedKeys=t.mutatedKeys;var i=t.Ao.Yr();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.po(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return xr()}}var r,i}),this.bo(n);var s=e?this.vo():[],n=0===this.yo.size&&this.current?1:0,e=n!==this.mo;return this.mo=n,0!==i.length||e?{snapshot:new uf(this.query,t.Eo,r,i,t.mutatedKeys,0==n,e,!1),Po:s}:{Po:s}},Rf.prototype.eo=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Eo:this.Eo,Ao:new af,mutatedKeys:this.mutatedKeys,Mn:!1},!1)):{Po:[]}},Rf.prototype.Vo=function(t){return!this._o.has(t)&&!!this.Eo.has(t)&&!this.Eo.get(t).hasLocalMutations},Rf.prototype.bo=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._o=e._o.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e._o=e._o.delete(t)}),this.current=t.current)},Rf.prototype.vo=function(){var e=this;if(!this.current)return[];var n=this.yo;this.yo=Xs(),this.Eo.forEach(function(t){e.Vo(t.key)&&(e.yo=e.yo.add(t.key))});var r=[];return n.forEach(function(t){e.yo.has(t)||r.push(new Df(t))}),this.yo.forEach(function(t){n.has(t)||r.push(new Sf(t))}),r},Rf.prototype.So=function(t){this._o=t.jn,this.yo=Xs();t=this.Io(t.documents);return this.applyChanges(t,!0)},Rf.prototype.Do=function(){return uf.fromInitialDocuments(this.query,this.Eo,this.mutatedKeys,0===this.mo)},Rf),Nf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Cf=function(t){this.key=t,this.Co=!1},kf=(Object.defineProperty(xf.prototype,"isPrimaryClient",{get:function(){return!0===this.Uo},enumerable:!1,configurable:!0}),xf);function xf(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.xo={},this.No=new Oc(Co,No),this.$o=new Map,this.Fo=new Set,this.Oo=new Ps($r.comparator),this.ko=new Map,this.Mo=new Ih,this.Lo={},this.Bo=new Map,this.qo=yc.ne(),this.onlineState="Unknown",this.Uo=void 0}function Rf(t,e){this.query=t,this._o=e,this.mo=null,this.current=!1,this.yo=Xs(),this.mutatedKeys=Xs(),this.po=Ro(t),this.Eo=new sf(this.po)}function Lf(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return i.Qo=function(t,e,n){return function(r,i,o,s){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=i.view.Io(o)).Mn?[4,gh(r.localStore,i.query,!1).then(function(t){t=t.documents;return i.view.Io(t,e)})]:[3,2];case 1:e=t.sent(),t.label=2;case 2:return n=s&&s.targetChanges.get(i.targetId),n=i.view.applyChanges(e,r.isPrimaryClient,n),[2,(Gf(r,i.targetId,n.Po),n.snapshot)]}})})}(i,t,e,n)},[4,gh(i.localStore,o,!0)];case 1:return n=t.sent(),r=new Af(o,n.jn),e=r.Io(n.documents),n=Zs.createSynthesizedTargetChangeForCurrentChange(s,a&&"Offline"!==i.onlineState),n=r.applyChanges(e,i.isPrimaryClient,n),Gf(i,s,n.Po),r=new Nf(o,s,r),[2,(i.No.set(o,r),i.$o.has(s)?i.$o.get(s).push(o):i.$o.set(s,[o]),n.snapshot)]}})})}function Of(f,d,p){return y(this,void 0,void 0,function(){var s,a;return g(this,function(t){switch(t.label){case 0:a=$f(f),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(i=a.localStore,u=d,h=i,l=hi.now(),o=u.reduce(function(t,e){return t.add(e.key)},Xs()),h.persistence.runTransaction("Locally write mutations","readwrite",function(a){return h.Kn.bn(a,o).next(function(t){c=t;for(var e,n=[],r=0,i=u;r<i.length;r++){var o=i[r],s=(e=o,s=c.get(o.key),function(t,e){for(var n=null,r=0,i=t;r<i.length;r++){var o=i[r],s=e instanceof Ci?e.field(o.field):void 0,s=Ko(o.transform,s||null);null!=s&&(n=(null==n?new Mo:n).set(o.field,s))}return n?n.v():null}(e.fieldTransforms,s));null!=s&&n.push(new ms(o.key,s,function s(t){var a=[];return Vr(t.fields||{},function(t,e){var n=new Jr([t]);if(Si(e))if(0===(e=s(e.mapValue).fields).length)a.push(n);else for(var r=0,i=e;r<i.length;r++){var o=i[r];a.push(n.child(o))}else a.push(n)}),new Oo(a)}(s.proto.mapValue),cs.exists(!0)))}return h.Tn.addMutationBatch(a,l,n,u)})}).then(function(t){var e=t.applyToLocalDocumentSet(c);return{batchId:t.batchId,changes:e}}))];case 2:return s=t.sent(),a.sharedClientState.addPendingMutation(s.batchId),e=a,n=s.batchId,r=p,i=(i=(i=e.Lo[e.currentUser.toKey()])||new Ps(Pr)).insert(n,r),e.Lo[e.currentUser.toKey()]=i,[4,zf(a,s.changes)];case 3:return t.sent(),[4,Yl(a.remoteStore)];case 4:return t.sent(),[3,6];case 5:return a=t.sent(),a=rf(a,"Failed to persist write"),p.reject(a),[3,6];case 6:return[2]}var e,n,r,i,u,c,h,l,o})})}function Pf(r,i){return y(this,void 0,void 0,function(){var n,e;return g(this,function(t){switch(t.label){case 0:n=r,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,fh(n.localStore,i)];case 2:return e=t.sent(),i.targetChanges.forEach(function(t,e){e=n.ko.get(e);e&&(Rr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),0<t.addedDocuments.size?e.Co=!0:0<t.modifiedDocuments.size?Rr(e.Co):0<t.removedDocuments.size&&(Rr(e.Co),e.Co=!1))}),[4,zf(n,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,Tc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function Mf(t,n,e){var r,t=t;(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e)&&(r=[],t.No.forEach(function(t,e){e=e.view.eo(n);e.snapshot&&r.push(e.snapshot)}),function(t,i){t.onlineState=i;var o=!1;t.queries.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].eo(i)&&(o=!0)}),o&&yf(t)}(t.eventManager,n),r.length&&t.xo.Tr(r),t.onlineState=n,t.isPrimaryClient&&t.sharedClientState.setOnlineState(n))}function Ff(s,a,u){return y(this,void 0,void 0,function(){var n,o;return g(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.localStore,r=a,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Tn.lookupMutationBatch(e,r).next(function(t){return Rr(null!==t),n=t.keys(),i.Tn.removeMutationBatch(e,t)}).next(function(){return i.Tn.performConsistencyCheck(e)}).next(function(){return i.Kn.bn(e,n)})}))];case 2:return o=t.sent(),Uf(n,a,u),Vf(n,a),n.sharedClientState.updateMutationState(a,"rejected",u),[4,zf(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,Tc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function qf(o,s){return y(this,void 0,void 0,function(){var n,r,i;return g(this,function(t){switch(t.label){case 0:Kl((n=o).remoteStore)||Ar("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.localStore).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Tn.getHighestUnacknowledgedBatchId(t)})];case 2:return-1===(r=t.sent())?[2,void s.resolve()]:((i=n.Bo.get(r)||[]).push(s),n.Bo.set(r,i),[3,4]);case 3:return i=t.sent(),i=rf(i,"Initialization of waitForPendingWrites() operation failed"),s.reject(i),[3,4];case 4:return[2]}var e})})}function Vf(t,e){(t.Bo.get(e)||[]).forEach(function(t){t.resolve()}),t.Bo.delete(e)}function Uf(t,e,n){var r=t,i=r.Lo[r.currentUser.toKey()];i&&((t=i.get(e))&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Lo[r.currentUser.toKey()]=i)}function Bf(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.$o.get(t);r<i.length;r++){var o=i[r];e.No.delete(o),n&&e.xo.Ko(o,n)}e.$o.delete(t),e.isPrimaryClient&&e.Mo.os(t).forEach(function(t){e.Mo.containsKey(t)||jf(e,t)})}function jf(t,e){t.Fo.delete(e.path.canonicalString());var n=t.Oo.get(e);null!==n&&(Vl(t.remoteStore,n),t.Oo=t.Oo.remove(e),t.ko.delete(n),Kf(t))}function Gf(t,e,n){for(var r,i,o,s=0,a=n;s<a.length;s++){var u=a[s];u instanceof Sf?(t.Mo.addReference(u.key,e),r=t,o=void 0,i=(o=(i=u).key).path.canonicalString(),r.Oo.get(o)||r.Fo.has(i)||(Ar("SyncEngine","New document in limbo: "+o),r.Fo.add(i),Kf(r))):u instanceof Df?(Ar("SyncEngine","Document no longer in limbo: "+u.key),t.Mo.removeReference(u.key,e),t.Mo.containsKey(u.key)||jf(t,u.key)):xr()}}function Kf(t){for(;0<t.Fo.size&&t.Oo.size<t.maxConcurrentLimboResolutions;){var e=t.Fo.values().next().value;t.Fo.delete(e);var n=new $r(Yr.fromString(e)),e=t.qo.next();t.ko.set(e,new Cf(n)),t.Oo=t.Oo.insert(n,e),ql(t.remoteStore,new Ru(Do(bo(n.path)),e,2,Ir.o))}}function zf(e,s,a){return y(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(t){switch(t.label){case 0:return r=[],i=[],o=[],(n=e).No.isEmpty()?[3,3]:(n.No.forEach(function(t,e){o.push(n.Qo(e,s,a).then(function(t){t&&(n.isPrimaryClient&&n.sharedClientState.updateQueryState(e.targetId,t.fromCache?"not-current":"current"),r.push(t),t=eh.Nn(e.targetId,t),i.push(t))}))}),[4,Promise.all(o)]);case 1:return t.sent(),n.xo.Tr(r),[4,function(u,c){return y(this,void 0,void 0,function(){var r,e,n,i,o,s,a;return g(this,function(t){switch(t.label){case 0:r=u,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return cu.forEach(c,function(e){return cu.forEach(e.Cn,function(t){return r.persistence.referenceDelegate.addReference(n,e.targetId,t)}).next(function(){return cu.forEach(e.xn,function(t){return r.persistence.referenceDelegate.removeReference(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!wu(e=t.sent()))throw e;return Ar("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=c;n<i.length;n++)a=i[n],o=a.targetId,a.fromCache||(s=r.Bn.get(o),a=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(a),r.Bn=r.Bn.insert(o,a));return[2]}})})}(n.localStore,i)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Qf(i,o){return y(this,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Ar("SyncEngine","User change. New user:",o.toKey()),[4,ch(n.localStore,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Bo.forEach(function(t){t.forEach(function(t){t.reject(new Wr(Hr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Bo.clear(),n.sharedClientState.handleUserChange(o,r.removedBatchIds,r.addedBatchIds),[4,zf(n,r.Wn)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Hf(a,u,c,h){return y(this,void 0,void 0,function(){var o,s;return g(this,function(t){switch(t.label){case 0:return[4,(e=(o=a).localStore,n=u,i=(r=e).Tn,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Jt(e,n).next(function(t){return t?r.Kn.bn(e,t):cu.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,Yl(o.remoteStore)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Uf(o,u,h||null),Vf(o,u),o.localStore.Tn.Xt(u)):xr(),t.label=4;case 4:return[4,zf(o,s)];case 5:return t.sent(),[3,7];case 6:Ar("SyncEngine","Cannot apply mutation batch with id: "+u),t.label=7;case 7:return[2]}var e,n,r,i})})}function Wf(h,l){return y(this,void 0,void 0,function(){var r,e,i,o,s,a,u,c;return g(this,function(t){switch(t.label){case 0:return Jf(r=h),$f(r),!0!==l||!0===r.Uo?[3,3]:(e=r.sharedClientState.getAllActiveQueryTargets(),[4,Yf(r,e.toArray())]);case 1:return i=t.sent(),r.Uo=!0,[4,$l(r.remoteStore,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)a=s[o],ql(r.remoteStore,a);return[3,7];case 3:return!1!==l||!1===r.Uo?[3,7]:(u=[],c=Promise.resolve(),r.$o.forEach(function(t,e){r.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then(function(){return Bf(r,e),yh(r.localStore,e,!0)}),Vl(r.remoteStore,e)}),[4,c]);case 4:return t.sent(),[4,Yf(r,u)];case 5:return t.sent(),(n=r).ko.forEach(function(t,e){Vl(n.remoteStore,e)}),n.Mo.cs(),n.ko=new Map,n.Oo=new Ps($r.comparator),r.Uo=!1,[4,$l(r.remoteStore,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Yf(d,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,a,u,c,h,l,f;return g(this,function(t){switch(t.label){case 0:e=d,n=[],r=[],i=0,o=p,t.label=1;case 1:return i<o.length?(s=o[i],a=void 0,(u=e.$o.get(s))&&0!==u.length?[4,ph(e.localStore,Do(u[0]))]:[3,7]):[3,13];case 2:a=t.sent(),c=0,h=u,t.label=3;case 3:return c<h.length?(l=h[c],l=e.No.get(l),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,gh((e=r).localStore,i.query,!0)];case 1:return n=t.sent(),n=i.view.So(n),[2,(e.isPrimaryClient&&Gf(e,i.targetId,n.Po),n)]}})})}(e,l)]):[3,6];case 4:(l=t.sent()).snapshot&&r.push(l.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,vh(e.localStore,s)];case 8:return f=t.sent(),[4,ph(e.localStore,f)];case 9:return a=t.sent(),[4,Lf(e,Xf(f),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(a),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.xo.Tr(r),n)]}})})}function Xf(t){return mo(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Jf(t){return t.remoteStore.remoteSyncer.applyRemoteEvent=Pf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(t,e){var n=t;if((t=n.ko.get(e))&&t.Co)return Xs().add(t.key);var r=Xs();if(!(e=n.$o.get(e)))return r;for(var i=0,o=e;i<o.length;i++)var s=o[i],s=n.No.get(s),r=r.unionWith(s.view.To);return r}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=function(o,s,a){return y(this,void 0,void 0,function(){var e,n,r,i;return g(this,function(t){switch(t.label){case 0:return(e=o).sharedClientState.updateQueryState(s,"rejected",a),i=e.ko.get(s),(n=i&&i.key)?(r=(r=new Ps($r.comparator)).insert(n,new ki(n,Lo.min())),i=Xs().add(n),i=new $s(Lo.min(),new Map,new js(Pr),r,i),[4,Pf(e,i)]):[3,2];case 1:return t.sent(),e.Oo=e.Oo.remove(n),e.ko.delete(s),Kf(e),[3,4];case 2:return[4,yh(e.localStore,s,!1).then(function(){return Bf(e,s,a)}).catch(Tc)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,t),t.xo.Tr=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,a=n.queries.get(a);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].no(s)&&(r=!0);a.Xr=s}}r&&yf(n)}.bind(null,t.eventManager),t.xo.Ko=function(t,e,n){var r=t;if(t=r.queries.get(e))for(var i=0,o=t.listeners;i<o.length;i++)o[i].onError(n);r.queries.delete(e)}.bind(null,t.eventManager),t}function $f(t){return t.remoteStore.remoteSyncer.applySuccessfulWrite=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,hh(e.localStore,o)];case 2:return r=t.sent(),Uf(e,n,null),Vf(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),[4,zf(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,Tc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Ff.bind(null,t),t}function Zf(t,e,n){var r=t;!function(f,d,p){return y(this,void 0,void 0,function(){var a,u,c,h,l;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,14,,15]),[4,d.getMetadata()];case 1:return a=t.sent(),[4,(r=f.localStore,o=r,s=ga((i=a).createTime),o.persistence.runTransaction("hasNewerBundle","readonly",function(t){return o.He.getBundleMetadata(t,i.id)}).then(function(t){return!!t&&0<=t.createTime.compareTo(s)}))];case 2:return t.sent()?[4,d.close()]:[3,4];case 3:return[2,(t.sent(),void p._completeWith({taskState:"Success",documentsLoaded:a.totalDocuments,bytesLoaded:a.totalBytes,totalDocuments:a.totalDocuments,totalBytes:a.totalBytes}))];case 4:return p._updateProgress(_f(a)),u=new bf(a,f.localStore,d.D),[4,d.Wo()];case 5:c=t.sent(),t.label=6;case 6:return c?[4,u.fo(c)]:[3,10];case 7:return(h=t.sent())&&p._updateProgress(h),[4,d.Wo()];case 8:c=t.sent(),t.label=9;case 9:return[3,6];case 10:return[4,u.complete()];case 11:return l=t.sent(),[4,zf(f,l.En,void 0)];case 12:return t.sent(),[4,(r=f.localStore,e=a,(n=r).persistence.runTransaction("Save bundle","readwrite",function(t){return n.He.saveBundleMetadata(t,e)}))];case 13:return t.sent(),p._completeWith(l.progress),[3,15];case 14:return Cr("SyncEngine","Loading bundle failed with "+(l=t.sent())),p._failWith(l),[3,15];case 15:return[2]}var e,n,r,i,o,s})})}(r,e,n).then(function(){r.sharedClientState.notifyBundleLoaded()})}var td,ed,nd=(cd.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.D=wl(e.databaseInfo.databaseId),this.sharedClientState=this.jo(e),this.persistence=this.Go(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.zo(e),this.localStore=this.Ho(e),[2]}})})},cd.prototype.zo=function(t){return null},cd.prototype.Ho=function(t){return uh(this.persistence,new nh,t.initialUser,this.D)},cd.prototype.Go=function(t){return new Ch(xh.Cs,this.D)},cd.prototype.jo=function(t){return new tl},cd.prototype.terminate=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},cd),rd=(n(ud,ed=nd),ud.prototype.initialize=function(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,ed.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,bh(this.localStore)];case 2:return t.sent(),[4,this.Jo.initialize(this,e)];case 3:return t.sent(),[4,$f(this.Jo.syncEngine)];case 4:return t.sent(),[4,Yl(this.Jo.remoteStore)];case 5:return t.sent(),[2]}})})},ud.prototype.Ho=function(t){return uh(this.persistence,new nh,t.initialUser,this.D)},ud.prototype.zo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new Sc(e,t.asyncQueue)},ud.prototype.Go=function(t){var e=$c(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?oc.withCacheSize(this.cacheSizeBytes):oc.DEFAULT;return new Wc(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,ml(),bl(),this.D,this.sharedClientState,!!this.forceOwnership)},ud.prototype.jo=function(t){return new tl},ud),id=(n(ad,td=rd),ad.prototype.initialize=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:return[4,td.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Jo.syncEngine,this.sharedClientState instanceof Zh?(this.sharedClientState.syncEngine={wi:Hf.bind(null,e),_i:function(i,o,s,a){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return(e=i).Uo?(Ar("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!e.$o.has(o))return[3,8];switch(s){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,mh(e.localStore)];case 3:return n=t.sent(),r=$s.createSynthesizedRemoteEventForCurrentChange(o,"current"===s),[4,zf(e,n,r)];case 4:return t.sent(),[3,8];case 5:return[4,yh(e.localStore,o,!0)];case 6:return t.sent(),Bf(e,o,a),[3,8];case 7:xr(),t.label=8;case 8:return[2]}})})}.bind(null,e),mi:function(c,h,l){return y(this,void 0,void 0,function(){var n,e,r,i,o,s,a,u;return g(this,function(t){switch(t.label){case 0:if(!(n=Jf(c)).Uo)return[3,10];e=0,r=h,t.label=1;case 1:return e<r.length?(r=r[e],n.$o.has(r)?(Ar("SyncEngine","Adding an already active target "+r),[3,5]):[4,vh(n.localStore,r)]):[3,6];case 2:return i=t.sent(),[4,ph(n.localStore,i)];case 3:return o=t.sent(),[4,Lf(n,Xf(i),o.targetId,!1)];case 4:t.sent(),ql(n.remoteStore,o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return g(this,function(t){switch(t.label){case 0:return n.$o.has(e)?[4,yh(n.localStore,e,!1).then(function(){Vl(n.remoteStore,e),Bf(n,e)}).catch(Tc)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,u=l,t.label=7;case 7:return a<u.length?(u=u[a],[5,s(u)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),gn:function(t){return t.localStore.persistence.gn()}.bind(null,e),di:function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return[2,mh((e=n).localStore).then(function(t){return zf(e,t)})]})})}.bind(null,e)},[4,this.sharedClientState.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.en(function(e){return y(n,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,Wf(this.Jo.syncEngine,e)];case 1:return t.sent(),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},ad.prototype.jo=function(t){var e=ml();if(!Zh.At(e))throw new Wr(Hr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=$c(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Zh(e,t.asyncQueue,n,t.clientId,t.initialUser)},ad),od=(sd.prototype.initialize=function(n,r){return y(this,void 0,void 0,function(){var e=this;return g(this,function(t){switch(t.label){case 0:return this.localStore?[3,2]:(this.localStore=n.localStore,this.sharedClientState=n.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!n.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Mf(e.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Qf.bind(null,this.syncEngine),[4,$l(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},sd.prototype.createEventManager=function(t){return new of},sd.prototype.createDatastore=function(t){var e=wl(t.databaseInfo.databaseId),n=(n=t.databaseInfo,new ol(n));return t=t.credentials,new Nl(t,n,e)},sd.prototype.createRemoteStore=function(t){var e=this,n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(t){return Mf(e.syncEngine,t,0)},t=new(nl.At()?nl:el);return new El(n,r,i,o,t)},sd.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){o=new kf(t,e,n,r,i,o);return s&&(o.Uo=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},sd.prototype.terminate=function(){return function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=n,Ar("RemoteStore","RemoteStore shutting down."),e.Qr.add(5),[4,Fl(e)];case 1:return t.sent(),e.Wr.shutdown(),e.jr.set("Unknown"),[2]}})})}(this.remoteStore)},sd);function sd(){}function ad(t,e){var n=this;return(n=td.call(this,t,e,!1)||this).Jo=t,n.cacheSizeBytes=e,n.synchronizeTabs=!0,n}function ud(t,e,n){var r=this;return(r=ed.call(this)||this).Jo=t,r.cacheSizeBytes=e,r.forceOwnership=n,r.synchronizeTabs=!1,r}function cd(){this.synchronizeTabs=!1}function hd(n,r){void 0===r&&(r=10240);var i=0;return{read:function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){return i<n.byteLength?(e={value:n.slice(i,i+r),done:!1},[2,(i+=r,e)]):[2,{done:!0}]})})},cancel:function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2]})})},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var ld=(wd.prototype.next=function(t){this.observer.next&&this.Yo(this.observer.next,t)},wd.prototype.error=function(t){this.observer.error?this.Yo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},wd.prototype.Xo=function(){this.muted=!0},wd.prototype.Yo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},wd),fd=(bd.prototype.close=function(){return this.Zo.cancel()},bd.prototype.getMetadata=function(){return y(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},bd.prototype.Wo=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.ec())]}})})},bd.prototype.ec=function(){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return[4,this.nc()];case 1:return null===(e=t.sent())?[2,null]:(r=this.tc.decode(e),n=Number(r),isNaN(n)&&this.sc("length string ("+r+") is not valid number"),[4,this.ic(n)]);case 2:return r=t.sent(),[2,new vf(JSON.parse(r),e.length+n)]}})})},bd.prototype.rc=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},bd.prototype.nc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return this.rc()<0?[4,this.oc()]:[3,3];case 1:if(t.sent())return[3,3];t.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.rc())<0&&this.sc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),n)])}})})},bd.prototype.ic=function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return this.buffer.length<n?[4,this.oc()]:[3,3];case 1:t.sent()&&this.sc("Reached the end of bundle when more is expected."),t.label=2;case 2:return[3,0];case 3:return e=this.tc.decode(this.buffer.slice(0,n)),[2,(this.buffer=this.buffer.slice(n),e)]}})})},bd.prototype.sc=function(t){throw this.Zo.cancel(),new Error("Invalid bundle format: "+t)},bd.prototype.oc=function(){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,this.Zo.read()];case 1:return(e=t.sent()).done||((n=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n),[2,e.done]}})})},bd),dd=(md.prototype.lookup=function(r){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new Wr(Hr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,a){return y(this,void 0,void 0,function(){var n,e,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=Ia((n=s).D)+"/documents",r={documents:a.map(function(t){return ba(n.D,t)})},[4,n.Ui("BatchGetDocuments",e,r)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e,t=(e=n.D,"found"in(t=t)?function(t,e){Rr(!!e.found),e.found.name,e.found.updateTime;var n=wa(t,e.found.name),t=ga(e.found.updateTime),e=new Po({mapValue:{fields:e.found.fields}});return new Ci(n,t,e,{})}(e,t):"missing"in t?function(t,e){Rr(!!e.missing),Rr(!!e.readTime);t=wa(t,e.missing),e=ga(e.readTime);return new ki(t,e)}(e,t):xr());i.set(t.key.toString(),t)}),o=[],[2,(a.forEach(function(t){t=i.get(t.toString());Rr(!!t),o.push(t)}),o)]}})})}(this.datastore,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof ki||t instanceof Ci?n.recordVersion(t):xr()}),e)]}})})},md.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},md.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},md.prototype.delete=function(t){this.write(new Cs(t,this.precondition(t))),this.writtenDocs.add(t.toString())},md.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){e=$r.fromPath(e);n.mutations.push(new ks(e,n.precondition(e)))}),[4,function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=Ia((e=i).D)+"/documents",r={writes:o.map(function(t){return Aa(e.D,t)})},[4,e.Mi("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return t.sent(),this.committed=!0,[2]}})})},md.prototype.recordVersion=function(t){var e;if(t instanceof Ci)e=t.version;else{if(!(t instanceof ki))throw xr();e=Lo.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Wr(Hr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},md.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?cs.updateTime(e):cs.none()},md.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return cs.exists(!0);if(e.isEqual(Lo.min()))throw new Wr(Hr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return cs.updateTime(e)},md.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},md.prototype.ensureCommitNotCalled=function(){},md),pd=(vd.prototype.run=function(){this.ac()},vd.prototype.ac=function(){var t=this;this.rr.Yi(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){return e=new dd(this.datastore),(n=this.uc(e))&&n.then(function(t){r.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){r.deferred.resolve(t)}).catch(function(t){r.hc(t)})})}).catch(function(t){r.hc(t)}),[2]})})})},vd.prototype.uc=function(t){try{var e=this.updateFunction(t);return!Br(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},vd.prototype.hc=function(t){var e=this;0<this.cc&&this.lc(t)?(--this.cc,this.asyncQueue.enqueueAndForget(function(){return e.ac(),Promise.resolve()})):this.deferred.reject(t)},vd.prototype.lc=function(t){if("FirebaseError"!==t.name)return!1;t=t.code;return"aborted"===t||"failed-precondition"===t||!Ls(t)},vd),yd=(gd.prototype.getConfiguration=function(){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}})})},gd.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then(function(){return e.credentialListener(e.user)})},gd.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Wr(Hr.FAILED_PRECONDITION,"The client has already been terminated.")},gd.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new uu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return e=t.sent(),e=rf(e,"Failed to shutdown persistence"),n.reject(e),[3,6];case 6:return[2]}})})}),n.promise},gd);function gd(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Rh.UNAUTHENTICATED,this.clientId=Lr.u(),this.credentialListener=function(){},this.receivedInitialUser=new uu,this.credentials.setChangeListener(function(t){Ar("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()})}function vd(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.cc=5,this.rr=new Sl(this.asyncQueue,"transaction_retry")}function md(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}function bd(t,e){var n=this;this.Zo=t,this.D=e,this.metadata=new uu,this.buffer=new Uint8Array,this.tc=new TextDecoder("utf-8"),this.ec().then(function(t){t&&t.ho()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}function wd(t){this.observer=t,this.muted=!1}function Ed(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return g(this,function(t){switch(t.label){case 0:return i.asyncQueue.verifyOperationInProgress(),Ar("FirestoreClient","Initializing OfflineComponentProvider"),[4,i.getConfiguration()];case 1:return e=t.sent(),[4,o.initialize(e)];case 2:return t.sent(),n=e.initialUser,i.setCredentialChangeListener(function(e){n.isEqual(e)||(n=e,i.asyncQueue.enqueueRetryable(function(){return y(r,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,ch(o.localStore,e)];case 1:return t.sent(),[2]}})})}))}),o.persistence.setDatabaseDeletedListener(function(){return i.terminate()}),i.offlineComponents=o,[2]}})})}function Td(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return r.asyncQueue.verifyOperationInProgress(),[4,Id(r)];case 1:return e=t.sent(),Ar("FirestoreClient","Initializing OnlineComponentProvider"),[4,r.getConfiguration()];case 2:return n=t.sent(),[4,i.initialize(e,n)];case 3:return t.sent(),r.setCredentialChangeListener(function(t){return r.asyncQueue.enqueueRetryable(function(){return function(r,i){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return(e=r).asyncQueue.verifyOperationInProgress(),Ar("RemoteStore","RemoteStore received new credentials"),n=Kl(e),e.Qr.add(3),[4,Fl(e)];case 1:return t.sent(),n&&e.jr.set("Unknown"),[4,e.remoteSyncer.handleCredentialChange(i)];case 2:return t.sent(),e.Qr.delete(3),[4,Ml(e)];case 3:return t.sent(),[2]}})})}(i.remoteStore,t)})}),r.onlineComponents=i,[2]}})})}function Id(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(Ar("FirestoreClient","Using default OfflineComponentProvider"),[4,Ed(e,new nd)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function _d(e){return y(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(Ar("FirestoreClient","Using default OnlineComponentProvider"),[4,Td(e,new od)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Sd(t){return Id(t).then(function(t){return t.persistence})}function Dd(t){return Id(t).then(function(t){return t.localStore})}function Ad(t){return _d(t).then(function(t){return t.remoteStore})}function Nd(t){return _d(t).then(function(t){return t.syncEngine})}function Cd(r){return y(this,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,_d(r)];case 1:return e=t.sent(),[2,((n=e.eventManager).onListen=function(s,a){return y(this,void 0,void 0,function(){var e,n,r,i,o;return g(this,function(t){switch(t.label){case 0:return e=Jf(s),(o=e.No.get(a))?(n=o.targetId,e.sharedClientState.addLocalQueryTarget(n),r=o.view.Do(),[3,4]):[3,1];case 1:return[4,ph(e.localStore,Do(a))];case 2:return i=t.sent(),o=e.sharedClientState.addLocalQueryTarget(i.targetId),n=i.targetId,[4,Lf(e,a,n,"current"===o)];case 3:r=t.sent(),e.isPrimaryClient&&ql(e.remoteStore,i),t.label=4;case 4:return[2,r]}})})}.bind(null,e.syncEngine),n.onUnlisten=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return n=(e=i).No.get(o),1<(r=e.$o.get(n.targetId)).length?[2,(e.$o.set(n.targetId,r.filter(function(t){return!No(t,o)})),void e.No.delete(o))]:e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(n.targetId),e.sharedClientState.isActiveQueryTarget(n.targetId)?[3,2]:[4,yh(e.localStore,n.targetId,!1).then(function(){e.sharedClientState.clearQueryState(n.targetId),Vl(e.remoteStore,n.targetId),Bf(e,n.targetId)}).catch(Tc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return Bf(e,n.targetId),[4,yh(e.localStore,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,e.syncEngine),n)]}})})}function kd(n,r,i){var t=this;void 0===i&&(i={});var o=new uu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(n,r,i,o,s){var t=new ld({next:function(t){r.enqueueAndForget(function(){return pf(n,a)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Wr(Hr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Wr(Hr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),a=new gf(bo(i.path),t,{includeMetadataChanges:!0,uo:!0});return df(n,a)},[4,Cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function xd(n,r,i){var t=this;void 0===i&&(i={});var o=new uu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(e,n,t,r,i){var o=new ld({next:function(t){n.enqueueAndForget(function(){return pf(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Wr(Hr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new gf(t,o,{includeMetadataChanges:!0,uo:!0});return df(e,s)},[4,Cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),n.asyncQueue,r,i,o])]}})})}),o.promise}function Rd(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t}var Ld=function(t,e,n,r,i,o){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o},Od=(Object.defineProperty(Kd.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Kd.prototype.isEqual=function(t){return t instanceof Kd&&t.projectId===this.projectId&&t.database===this.database},Kd),Pd=new Map,Md=(Gd.prototype.getToken=function(){return Promise.resolve(null)},Gd.prototype.invalidateToken=function(){},Gd.prototype.setChangeListener=function(t){(this.changeListener=t)(Rh.UNAUTHENTICATED)},Gd.prototype.removeChangeListener=function(){this.changeListener=null},Gd),Fd=(jd.prototype.getToken=function(){var e=this,n=this.dc,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.dc!==n?(Ar("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Rr("string"==typeof t.accessToken),new Rd(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},jd.prototype.invalidateToken=function(){this.forceRefresh=!0},jd.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},jd.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.fc),this.fc=null,this.changeListener=null},jd.prototype.wc=function(){var t=this.auth&&this.auth.getUid();return Rr(null===t||"string"==typeof t),new Rh(t)},jd),qd=(Object.defineProperty(Bd.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.mc},e=this._c.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),Bd),Vd=(Ud.prototype.getToken=function(){return Promise.resolve(new qd(this._c,this.mc))},Ud.prototype.setChangeListener=function(t){t(Rh.FIRST_PARTY)},Ud.prototype.removeChangeListener=function(){},Ud.prototype.invalidateToken=function(){},Ud);function Ud(t,e){this._c=t,this.mc=e}function Bd(t,e){this._c=t,this.mc=e,this.type="FirstParty",this.user=Rh.FIRST_PARTY}function jd(t){var e=this;this.fc=null,this.currentUser=Rh.UNAUTHENTICATED,this.receivedInitialUser=!1,this.dc=0,this.changeListener=null,this.forceRefresh=!1,this.fc=function(){e.dc++,e.currentUser=e.wc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.dc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.fc):(this.fc(null),t.get().then(function(t){e.auth=t,e.fc&&e.auth.addAuthTokenListener(e.fc)},function(){}))}function Gd(){this.changeListener=null}function Kd(t,e){this.projectId=t,this.database=e||"(default)"}function zd(t,e,n){if(!n)throw new Wr(Hr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Qd(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Hd(t,e,n,r){if(!0===e&&!0===r)throw new Wr(Hr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Wd(t){if(!$r.isDocumentKey(t))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Yd(t){if($r.isDocumentKey(t))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Xd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":xr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Jd(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new Wr(Hr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=Xd(t);throw new Wr(Hr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+t)}function $d(t,e){if(e<=0)throw new Wr(Hr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var Zd,tp=(hp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},hp),ep=(Object.defineProperty(cp.prototype,"app",{get:function(){if(!this._app)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(cp.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(cp.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),cp.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new tp(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Md;switch(t.type){case"gapi":var e=t.client;return Rr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Vd(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Wr(Hr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},cp.prototype._getSettings=function(){return this._settings},cp.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},cp.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},cp.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},cp.prototype._terminate=function(){return(t=Pd.get(this))&&(Ar("ComponentProvider","Removing Datastore"),Pd.delete(this),t.terminate()),Promise.resolve();var t},cp),np=function(t){this._delegate=t},rp=(Object.defineProperty(up.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(up.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(up.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(up.prototype,"parent",{get:function(){return new op(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),up.prototype.withConverter=function(t){return new up(this.firestore,t,this._key)},up),ip=(ap.prototype.withConverter=function(t){return new ap(this.firestore,t,this._query)},ap),op=(n(sp,Zd=ip),Object.defineProperty(sp.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(sp.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(sp.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new rp(this.firestore,null,new $r(t))},enumerable:!1,configurable:!0}),sp.prototype.withConverter=function(t){return new sp(this.firestore,t,this._path)},sp);function sp(t,e,n){var r=this;return(r=Zd.call(this,t,e,bo(n))||this).firestore=t,r._path=n,r.type="collection",r}function ap(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}function up(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}function cp(t,e){this._persistenceKey="(lite)",this._settings=new tp({}),this._settingsFrozen=!1,t instanceof Od?(this._databaseId=t,this._credentials=new Md):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Wr(Hr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Od(t.options.projectId)}(t),this._credentials=new Fd(e))}function hp(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Wr(Hr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Wr(Hr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,Hd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}function lp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof np&&(t=t._delegate),zd("collection","path",e),t instanceof ep)return Yd(n=Yr.fromString.apply(Yr,s([e],r))),new op(t,null,n);if(!(t instanceof rp||t instanceof op))throw new Wr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Yd(n=Yr.fromString.apply(Yr,s([t.path],r)).child(Yr.fromString(e))),new op(t.firestore,null,n)}function fp(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t instanceof np&&(t=t._delegate),zd("doc","path",e=1===arguments.length?Lr.u():e),t instanceof ep)return Wd(n=Yr.fromString.apply(Yr,s([e],r))),new rp(t,null,new $r(n));if(!(t instanceof rp||t instanceof op))throw new Wr(Hr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Wd(n=t._path.child(Yr.fromString.apply(Yr,s([e],r)))),new rp(t.firestore,t instanceof op?t._converter:null,new $r(n))}function dp(t,e){return t instanceof np&&(t=t._delegate),e instanceof np&&(e=e._delegate),(t instanceof rp||t instanceof op)&&(e instanceof rp||e instanceof op)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function pp(t,e){return t instanceof np&&(t=t._delegate),e instanceof np&&(e=e._delegate),t instanceof ip&&e instanceof ip&&t.firestore===e.firestore&&No(t._query,e._query)&&t._converter===e._converter}var yp=(Object.defineProperty(gp.prototype,"isShuttingDown",{get:function(){return this.Ec},enumerable:!1,configurable:!0}),gp.prototype.enqueueAndForget=function(t){this.enqueue(t)},gp.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.vc(),this.Pc(t)},gp.prototype.enterRestrictedMode=function(){var t;this.Ec||(this.Ec=!0,(t=bl())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc))},gp.prototype.enqueue=function(t){return this.vc(),this.Ec?new Promise(function(t){}):this.Pc(t)},gp.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.gc.push(t),e.Vc()})},gp.prototype.Vc=function(){return y(this,void 0,void 0,function(){var e,n=this;return g(this,function(t){switch(t.label){case 0:if(0===this.gc.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.gc[0]()];case 2:return t.sent(),this.gc.shift(),this.rr.reset(),[3,4];case 3:if(!wu(e=t.sent()))throw e;return Ar("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.gc.length&&this.rr.Yi(function(){return n.Vc()}),t.label=5;case 5:return[2]}})})},gp.prototype.Pc=function(t){var r=this,e=this.yc.then(function(){return r.Ac=!0,t().catch(function(t){throw r.Ic=t,r.Ac=!1,Nr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",n=e.stack?e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack:n)),t;var e,n}).then(function(t){return r.Ac=!1,t})});return this.yc=e},gp.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.vc(),-1<this.Rc.indexOf(t)&&(e=0);n=ef.createAndSchedule(this,t,e,n,function(t){return r.Sc(t)});return this.Tc.push(n),n},gp.prototype.vc=function(){this.Ic&&xr()},gp.prototype.verifyOperationInProgress=function(){},gp.prototype.Dc=function(){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,e=this.yc];case 1:t.sent(),t.label=2;case 2:if(e!==this.yc)return[3,0];t.label=3;case 3:return[2]}})})},gp.prototype.Cc=function(t){for(var e=0,n=this.Tc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},gp.prototype.xc=function(r){var i=this;return this.Dc().then(function(){i.Tc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var t=0,e=i.Tc;t<e.length;t++){var n=e[t];if(n.skipDelay(),"all"!==r&&n.timerId===r)break}return i.Dc()})},gp.prototype.Nc=function(t){this.Rc.push(t)},gp.prototype.Sc=function(t){t=this.Tc.indexOf(t);this.Tc.splice(t,1)},gp);function gp(){var e=this;this.yc=Promise.resolve(),this.gc=[],this.Ec=!1,this.Tc=[],this.Ic=null,this.Ac=!1,this.Rc=[],this.rr=new Sl(this,"async_queue_retry"),this.bc=function(){var t=bl();t&&Ar("AsyncQueue","Visibility state changed to "+t.visibilityState),e.rr.Zi()};var t=bl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bc)}function vp(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var mp,bp=(Tp.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},Tp.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},Tp.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},Tp.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},Tp.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},Tp.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},Tp),wp=(n(Ep,mp=ep),Ep.prototype._terminate=function(){return this._firestoreClient||_p(this),this._firestoreClient.terminate()},Ep);function Ep(t,e){var n=this;return(n=mp.call(this,t,e)||this)._queue=new yp,n._persistenceKey="name"in t?t.name:"[DEFAULT]",n}function Tp(){this._progressObserver={},this._taskCompletionResolver=new uu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}function Ip(t){return t._firestoreClient||_p(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function _p(t){var e,n,r=t._freezeSettings(),r=(e=t._databaseId,n=t._persistenceKey,new Ld(e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling));t._firestoreClient=new yd(t._credentials,t._queue,r)}function Sp(r,i,o){var t=this,s=new uu;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,Ed(r,o)];case 1:return t.sent(),[4,Td(r,i)];case 2:return t.sent(),s.resolve(),[3,4];case 3:if(!("FirebaseError"===(e=n=t.sent()).name?e.code===Hr.FAILED_PRECONDITION||e.code===Hr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code))throw n;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),s.reject(n),[3,4];case 4:return[2]}var e})})}).then(function(){return s.promise})}function Dp(t){if(t._initialized||t._terminated)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ap=(qp.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},qp),Np=(Fp.fromBase64String=function(t){try{return new Fp(Zr.fromBase64String(t))}catch(t){throw new Wr(Hr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},Fp.fromUint8Array=function(t){return new Fp(Zr.fromUint8Array(t))},Fp.prototype.toBase64=function(){return this._byteString.toBase64()},Fp.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},Fp.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Fp.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},Fp),Cp=function(t){this._methodName=t},kp=(Object.defineProperty(Mp.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(Mp.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),Mp.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},Mp.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},Mp.prototype._compareTo=function(t){return Pr(this._lat,t._lat)||Pr(this._long,t._long)},Mp),xp=/^__.*__$/,Rp=(Pp.prototype.toMutation=function(t,e){return null!==this.fieldMask?new ms(t,this.data,this.fieldMask,e,this.fieldTransforms):new vs(t,this.data,e,this.fieldTransforms)},Pp),Lp=(Op.prototype.toMutation=function(t,e){return new ms(t,this.data,this.fieldMask,e,this.fieldTransforms)},Op);function Op(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Pp(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}function Mp(t,e){if(!isFinite(t)||t<-90||90<t)throw new Wr(Hr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Wr(Hr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}function Fp(t){this._byteString=t}function qp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Jr(t)}function Vp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw xr()}}var Up=(Object.defineProperty(Gp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Gp.prototype,"Fc",{get:function(){return this.settings.Fc},enumerable:!1,configurable:!0}),Gp.prototype.Oc=function(t){return new Gp(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.D,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},Gp.prototype.kc=function(t){var e=null===(e=this.path)||void 0===e?void 0:e.child(t),e=this.Oc({path:e,Mc:!1});return e.Lc(t),e},Gp.prototype.Bc=function(t){var e,t=null===(e=this.path)||void 0===e?void 0:e.child(t),t=this.Oc({path:t,Mc:!1});return t.$c(),t},Gp.prototype.qc=function(t){return this.Oc({path:void 0,Mc:!0})},Gp.prototype.Uc=function(t){return my(t,this.settings.methodName,this.settings.Qc||!1,this.path,this.settings.Kc)},Gp.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},Gp.prototype.$c=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Lc(this.path.get(t))},Gp.prototype.Lc=function(t){if(0===t.length)throw this.Uc("Document fields must not be empty");if(Vp(this.Fc)&&xp.test(t))throw this.Uc('Document fields cannot begin and end with "__"')},Gp),Bp=(jp.prototype.Wc=function(t,e,n,r){return void 0===r&&(r=!1),new Up({Fc:t,methodName:e,Kc:n,path:Jr.emptyPath(),Mc:!1,Qc:r},this.databaseId,this.D,this.ignoreUndefinedProperties)},jp);function jp(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.D=n||wl(t)}function Gp(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.D=n,this.ignoreUndefinedProperties=r,void 0===i&&this.$c(),this.fieldTransforms=i||[],this.fieldMask=o||[]}function Kp(t){var e=t._freezeSettings(),n=wl(t._databaseId);return new Bp(t._databaseId,!!e.ignoreUndefinedProperties,n)}function zp(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Wc(o.merge||o.mergeFields?2:0,e,n,i);py("Data must be an object, but it was:",s,r);var a,u,r=fy(r,s);if(o.merge)a=new Oo(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var c=[],h=0,l=o.mergeFields;h<l.length;h++){var f=yy(e,l[h],n);if(!s.contains(f))throw new Wr(Hr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");by(c,f)||c.push(f)}a=new Oo(c),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new Rp(new Po(r),a,u)}var Qp,Hp=(n(Wp,Qp=Cp),Wp.prototype._toFieldTransform=function(t){if(2!==t.Fc)throw 1===t.Fc?t.Uc(this._methodName+"() can only appear at the top level of your update data"):t.Uc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},Wp.prototype.isEqual=function(t){return t instanceof Wp},Wp);function Wp(){return null!==Qp&&Qp.apply(this,arguments)||this}function Yp(t,e,n){return new Up({Fc:3,Kc:e.settings.Kc,methodName:t._methodName,Mc:n},e.databaseId,e.D,e.ignoreUndefinedProperties)}var Xp,Jp,$p,Zp,ty=(n(ay,Zp=Cp),ay.prototype._toFieldTransform=function(t){return new us(t.path,new Ho)},ay.prototype.isEqual=function(t){return t instanceof ay},ay),ey=(n(sy,$p=Cp),sy.prototype._toFieldTransform=function(t){var e=Yp(this,t,!0),n=this.jc.map(function(t){return ly(t,e)}),n=new Wo(n);return new us(t.path,n)},sy.prototype.isEqual=function(t){return this===t},sy),ny=(n(oy,Jp=Cp),oy.prototype._toFieldTransform=function(t){var e=Yp(this,t,!0),n=this.jc.map(function(t){return ly(t,e)}),n=new Zo(n);return new us(t.path,n)},oy.prototype.isEqual=function(t){return this===t},oy),ry=(n(iy,Xp=Cp),iy.prototype._toFieldTransform=function(t){var e=new rs(t.D,Go(t.D,this.Gc));return new us(t.path,e)},iy.prototype.isEqual=function(t){return this===t},iy);function iy(t,e){var n=this;return(n=Xp.call(this,t)||this).Gc=e,n}function oy(t,e){var n=this;return(n=Jp.call(this,t)||this).jc=e,n}function sy(t,e){var n=this;return(n=$p.call(this,t)||this).jc=e,n}function ay(){return null!==Zp&&Zp.apply(this,arguments)||this}function uy(t,r,i,e){var o=t.Wc(1,r,i);py("Data must be an object, but it was:",o,e);var s=[],a=new Mo;Vr(e,function(t,e){var n=vy(r,t,i);e instanceof np&&(e=e._delegate);t=o.Bc(n);e instanceof Hp?s.push(n):null!=(t=ly(e,t))&&(s.push(n),a.set(n,t))});e=new Oo(s);return new Lp(a.v(),e,o.fieldTransforms)}function cy(t,e,n,r,i,o){var s=t.Wc(1,e,n),a=[yy(e,r,n)],u=[i];if(o.length%2!=0)throw new Wr(Hr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(yy(e,o[c])),u.push(o[c+1]);for(var h,l,f,d=[],p=new Mo,y=a.length-1;0<=y;--y)by(d,a[y])||(h=a[y],(l=u[y])instanceof np&&(l=l._delegate),f=s.Bc(h),l instanceof Hp?d.push(h):null!=(f=ly(l,f))&&(d.push(h),p.set(h,f)));i=new Oo(d);return new Lp(p.v(),i,s.fieldTransforms)}function hy(t,e,n,r){return void 0===r&&(r=!1),ly(n,t.Wc(r?4:3,e))}function ly(s,t){if(dy(s=s instanceof np?s._delegate:s))return py("Unsupported field value:",t,s),fy(s,t);if(s instanceof Cp)return function(t,e){if(!Vp(e.Fc))throw e.Uc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Uc(t._methodName+"() is not currently supported inside arrays");t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(s,t),null;if(void 0===s&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),s instanceof Array){if(t.settings.Mc&&4!==t.Fc)throw t.Uc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=ly(i[r],t.qc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===(t=t instanceof np?t._delegate:t))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Go(e.D,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=hi.fromDate(t);return{timestampValue:pa(e.D,n)}}if(t instanceof hi)return n=new hi(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:pa(e.D,n)};if(t instanceof kp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Np)return{bytesValue:ya(e.D,t._byteString)};if(t instanceof rp){var n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Uc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:va(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Uc("Unsupported field value: "+Xd(t))}(s,t)}function fy(t,n){var r={};return Ur(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Vr(t,function(t,e){e=ly(e,n.kc(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function dy(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof hi||t instanceof kp||t instanceof Np||t instanceof rp||t instanceof Cp)}function py(t,e,n){if(!dy(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=Xd(n);throw"an object"===n?e.Uc(t+" a custom object"):e.Uc(t+" "+n)}var r}function yy(t,e,n){if((e=e instanceof np?e._delegate:e)instanceof Ap)return e._internalPath;if("string"==typeof e)return vy(t,e);throw my("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var gy=new RegExp("[~\\*/\\[\\]]");function vy(e,n,r){if(0<=n.search(gy))throw my("Invalid field path ("+n+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,r);try{return(new(Ap.bind.apply(Ap,s([void 0],n.split(".")))))._internalPath}catch(t){throw my("Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,r)}}function my(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,e="Function "+e+"() called with invalid data";n&&(e+=" (via `toFirestore()`)");n="";return(o||s)&&(n+=" (found",o&&(n+=" in field "+r),s&&(n+=" in document "+i),n+=")"),new Wr(Hr.INVALID_ARGUMENT,(e+=". ")+t+n)}function by(t,e){return t.some(function(t){return t.isEqual(e)})}var wy,Ey=(Object.defineProperty(_y.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(_y.prototype,"ref",{get:function(){return new rp(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),_y.prototype.exists=function(){return null!==this._document},_y.prototype.data=function(){if(this._document){if(this._converter){var t=new Ty(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.toProto())}},_y.prototype.get=function(t){if(this._document){t=this._document.data().field(Sy("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}},_y),Ty=(n(Iy,wy=Ey),Iy.prototype.data=function(){return wy.prototype.data.call(this)},Iy);function Iy(){return null!==wy&&wy.apply(this,arguments)||this}function _y(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}function Sy(t,e){return"string"==typeof e?vy(t,e):(e instanceof np?e._delegate:e)._internalPath}var Dy,Ay,Ny=(Py.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Py),Cy=(n(Oy,Ay=Ey),Oy.prototype.exists=function(){return Ay.prototype.exists.call(this)},Oy.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new ky(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.toProto(),t.serverTimestamps)}},Oy.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){t=this._document.data().field(Sy("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t,e.serverTimestamps)}},Oy),ky=(n(Ly,Dy=Cy),Ly.prototype.data=function(t){return void 0===t&&(t={}),Dy.prototype.data.call(this,t)},Ly),xy=(Object.defineProperty(Ry.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Ry.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(Ry.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),Ry.prototype.forEach=function(e,n){var r=this;this._snapshot.docs.forEach(function(t){e.call(n,new ky(r._firestore,r._userDataWriter,t.key,t,new Ny(r._snapshot.mutatedKeys.has(t.key),r._snapshot.fromCache),r.query._converter))})},Ry.prototype.docChanges=function(t){t=!!(t=void 0===t?{}:t).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Wr(Hr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,e){if(i._snapshot.oldDocs.isEmpty()){var n=0;return i._snapshot.docChanges.map(function(t){var e=new ky(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Ny(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new ky(i._firestore,i._userDataWriter,t.doc.key,t.doc,new Ny(i._snapshot.mutatedKeys.has(t.doc.key),i._snapshot.fromCache),i.query._converter),n=-1,r=-1;return 0!==t.type&&(n=o.indexOf(t.doc.key),o=o.delete(t.doc.key)),1!==t.type&&(r=(o=o.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return xr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},Ry);function Ry(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Ny(r.hasPendingWrites,r.fromCache),this.query=n}function Ly(){return null!==Dy&&Dy.apply(this,arguments)||this}function Oy(t,e,n,r,i,o){var s=this;return(s=Ay.call(this,t,e,n,r,o)||this)._firestore=t,s._firestoreImpl=t,s.metadata=i,s}function Py(t,e){this.hasPendingWrites=t,this.fromCache=e}function My(t,e){return t instanceof Cy&&e instanceof Cy?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof xy&&e instanceof xy&&t._firestore===e._firestore&&pp(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Fy(t){if(Eo(t)&&0===t.explicitOrderBy.length)throw new Wr(Hr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}c=function(){};function qy(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++)t=i[r]._apply(t);return t}var Vy,Uy,By,jy,Gy,Ky=(n(Zy,Gy=c),Zy.prototype._apply=function(t){var e=Kp(t.firestore),e=function(t,e,n,r,i,o){if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i||"not-in"===i){ng(o,i);for(var s=[],a=0,u=o;a<u.length;a++){var c=u[a];s.push(eg(n,t,c))}h={arrayValue:{values:s}}}else h=eg(n,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||ng(o,i),h=hy(e,"where",o,"in"===i||"not-in"===i);var h=Bi.create(r,i,h);return function(t,e){if(e.g()){var n=Io(t);if(null!==n&&!n.isEqual(e.field))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");n=To(t);null!==n&&rg(0,e.field,n)}t=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==t)throw t===e.op?new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+t.toString()+"' filters.")}(t,h),h}(t._query,e,t.firestore._databaseId,this.zc,this.Hc,this.Jc);return new ip(t.firestore,t._converter,(t=t._query,e=t.filters.concat([e]),new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))},Zy),zy=(n($y,jy=c),$y.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new po(e,n);return e=r,null!==To(n=t)||null!==(t=Io(n))&&rg(0,t,e.field),r}(t._query,this.zc,this.Yc);return new ip(t.firestore,t._converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new vo(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))},$y),Qy=(n(Jy,By=c),Jy.prototype._apply=function(t){return new ip(t.firestore,t._converter,Ao(t._query,this.Xc,this.Zc))},Jy),Hy=(n(Xy,Uy=c),Xy.prototype._apply=function(t){var e=tg(t,this.type,this.ta,this.ea);return new ip(t.firestore,t._converter,(t=t._query,e=e,new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))},Xy),Wy=(n(Yy,Vy=c),Yy.prototype._apply=function(t){var e=tg(t,this.type,this.ta,this.ea);return new ip(t.firestore,t._converter,(t=t._query,e=e,new vo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))},Yy);function Yy(t,e,n){var r=this;return(r=Vy.call(this)||this).type=t,r.ta=e,r.ea=n,r}function Xy(t,e,n){var r=this;return(r=Uy.call(this)||this).type=t,r.ta=e,r.ea=n,r}function Jy(t,e,n){var r=this;return(r=By.call(this)||this).type=t,r.Xc=e,r.Zc=n,r}function $y(t,e){var n=this;return(n=jy.call(this)||this).zc=t,n.Yc=e,n.type="orderBy",n}function Zy(t,e,n){var r=this;return(r=Gy.call(this)||this).zc=t,r.Hc=e,r.Jc=n,r.type="where",r}function tg(t,c,e,n){if(e[0]instanceof np&&(e[0]=e[0]._delegate),e[0]instanceof Ey)return function(t,e,n,r){if(!n)throw new Wr(Hr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+c+"().");for(var i=[],o=0,s=So(t);o<s.length;o++){var a=s[o];if(a.field.isKeyField())i.push(wi(e,n.key));else{var u=n.field(a.field);if(fi(u))throw new Wr(Hr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){a=a.field.canonicalString();throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}i.push(u)}}return new ao(i,r)}(t._query,t.firestore._databaseId,e[0]._document,n);var r=Kp(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Wr(Hr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!_o(t)&&-1!==c.indexOf("/"))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Yr.fromString(c));if(!$r.isDocumentKey(h))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");h=new $r(h);a.push(wi(e,h))}else{c=hy(n,r,c);a.push(c)}}return new ao(a,o)}(t._query,t.firestore._databaseId,r,c,e,n)}function eg(t,e,n){if("string"==typeof(n=n instanceof np?n._delegate:n)){if(""===n)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!_o(e)&&-1!==n.indexOf("/"))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");e=e.path.child(Yr.fromString(n));if(!$r.isDocumentKey(e))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return wi(t,new $r(e))}if(n instanceof rp)return wi(t,n._key);throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Xd(n)+".")}function ng(t,e){if(!Array.isArray(t)||0===t.length)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function rg(t,e,n){if(!n.isEqual(e))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}ig.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),pi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ui(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ci(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw xr()}},ig.prototype.convertObject=function(t,n){var r=this,i={};return Vr(t.fields||{},function(t,e){i[t]=r.convertValue(e,n)}),i},ig.prototype.convertGeoPoint=function(t){return new kp(ui(t.latitude),ui(t.longitude))},ig.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},ig.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=function t(e){e=e.mapValue.fields.__previous_value__;return fi(e)?t(e):e}(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(di(t));default:return null}},ig.prototype.convertTimestamp=function(t){t=ai(t);return new hi(t.seconds,t.nanos)},ig.prototype.convertDocumentKey=function(t,e){var n=Yr.fromString(t);Rr(qa(n));t=new Od(n.get(1),n.get(3)),n=new $r(n.popFirst(5));return t.isEqual(e)||Nr("Document "+n+" contains a document reference within a different database ("+t.projectId+"/"+t.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),n},Te=ig;function ig(){}function og(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var sg,ag=(n(hg,sg=Te),hg.prototype.convertBytes=function(t){return new Np(t)},hg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new rp(this.firestore,null,t)},hg),ug=(cg.prototype.set=function(t,e,n){this._verifyNotCommitted();t=lg(t,this._firestore),e=og(t._converter,e,n),n=zp(this._dataReader,"WriteBatch.set",t._key,e,null!==t._converter,n);return this._mutations.push(n.toMutation(t._key,cs.none())),this},cg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();t=lg(t,this._firestore),e="string"==typeof(e=e instanceof np?e._delegate:e)||e instanceof Ap?cy(this._dataReader,"WriteBatch.update",t._key,e,n,r):uy(this._dataReader,"WriteBatch.update",t._key,e);return this._mutations.push(e.toMutation(t._key,cs.exists(!0))),this},cg.prototype.delete=function(t){this._verifyNotCommitted();t=lg(t,this._firestore);return this._mutations=this._mutations.concat(new Cs(t._key,cs.none())),this},cg.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()},cg.prototype._verifyNotCommitted=function(){if(this._committed)throw new Wr(Hr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},cg);function cg(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Kp(t)}function hg(t){var e=this;return(e=sg.call(this)||this).firestore=t,e}function lg(t,e){if((t=t instanceof np?t._delegate:t).firestore!==e)throw new Wr(Hr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var fg,dg=(n(pg,fg=Te),pg.prototype.convertBytes=function(t){return new Np(t)},pg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new rp(this.firestore,null,t)},pg);function pg(t){var e=this;return(e=fg.call(this)||this).firestore=t,e}function yg(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Jd(t,rp);var o=Jd(t.firestore,wp),s=Kp(o);return vg(o,[("string"==typeof(e=e instanceof np?e._delegate:e)||e instanceof Ap?cy(s,"updateDoc",t._key,e,n,r):uy(s,"updateDoc",t._key,e)).toMutation(t._key,cs.exists(!0))])}function gg(e){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];e instanceof np&&(e=e._delegate);var r={includeMetadataChanges:!1},i=0;"object"!=typeof n[i]||vp(n[i])||(r=n[i],i++);var o,s,a,u,c,h,l={includeMetadataChanges:r.includeMetadataChanges};return vp(n[i])&&(o=n[i],n[i]=null===(r=o.next)||void 0===r?void 0:r.bind(o),n[i+1]=null===(r=o.error)||void 0===r?void 0:r.bind(o),n[i+2]=null===(r=o.complete)||void 0===r?void 0:r.bind(o)),e instanceof rp?(a=Jd(e.firestore,wp),u=bo(e._key.path),h={next:function(t){n[i]&&n[i](mg(a,e,t))},error:n[i+1],complete:n[i+2]}):(s=Jd(e,ip),a=Jd(s.firestore,wp),u=s._query,c=new dg(a),h={next:function(t){n[i]&&n[i](new xy(a,c,s,t))},error:n[i+1],complete:n[i+2]},Fy(e._query)),function(n,t,e){var r=this,i=new ld(h),o=new gf(t,i,e);return n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=df,[4,Cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})}),function(){i.Xo(),n.asyncQueue.enqueueAndForget(function(){return y(r,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=pf,[4,Cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),o])]}})})})}}(Ip(a),u,l)}function vg(t,e){return function(n,r){var t=this,i=new uu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Of,[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(Ip(t),e)}function mg(t,e,n){var r=n.docs.get(e._key),i=new dg(t);return new Cy(t,i,e._key,r,new Ny(n.hasPendingWrites,n.fromCache),e._converter)}var bg,wg=(Tg.prototype.get=function(t){var e=this,n=lg(t,this._firestore),r=new ag(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return xr();t=t[0];if(t instanceof ki)return new Ey(e._firestore,r,n._key,null,n._converter);if(t instanceof Ci)return new Ey(e._firestore,r,t.key,t,n._converter);throw xr()})},Tg.prototype.set=function(t,e,n){t=lg(t,this._firestore),e=og(t._converter,e,n),n=zp(this._dataReader,"Transaction.set",t._key,e,null!==t._converter,n);return this._transaction.set(t._key,n),this},Tg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=lg(t,this._firestore),e="string"==typeof(e=e instanceof np?e._delegate:e)||e instanceof Ap?cy(this._dataReader,"Transaction.update",t._key,e,n,r):uy(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this},Tg.prototype.delete=function(t){t=lg(t,this._firestore);return this._transaction.delete(t._key),this},n(Eg,bg=Tg),Eg.prototype.get=function(t){var e=this,n=lg(t,this._firestore),r=new dg(this._firestore);return bg.prototype.get.call(this,t).then(function(t){return new Cy(e._firestore,r,n._key,t._document,new Ny(!1,!1),n._converter)})},Eg);function Eg(t,e){var n=this;return(n=bg.call(this,t,e)||this)._firestore=t,n}function Tg(t,e){this._firestore=t,this._transaction=e,this._dataReader=Kp(t)}function Ig(){if("undefined"==typeof Uint8Array)throw new Wr(Hr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function _g(){if("undefined"==typeof atob)throw new Wr(Hr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Sg,Dg,Ag,Ng=(n(Pg,Ag=np),Pg.fromBase64String=function(t){return _g(),new Pg(Np.fromBase64String(t))},Pg.fromUint8Array=function(t){return Ig(),new Pg(Np.fromUint8Array(t))},Pg.prototype.toBase64=function(){return _g(),this._delegate.toBase64()},Pg.prototype.toUint8Array=function(){return Ig(),this._delegate.toUint8Array()},Pg.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},Pg.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Pg),Cg=(Og.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){Dp(t=Jd(t,wp));var n=Ip(t),r=t._freezeSettings(),t=new od;return Sp(n,t,new rd(t,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},Og.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){Dp(t=Jd(t,wp));var e=Ip(t),n=t._freezeSettings(),t=new od;return Sp(e,t,new id(t,n.cacheSizeBytes))}(t._delegate)},Og.prototype.clearIndexedDbPersistence=function(t){return function(n){var t=this;if(n._initialized&&!n._terminated)throw new Wr(Hr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var r=new uu;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return lu.At()?(e=n+"main",[4,lu.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}($c(n._databaseId,n._persistenceKey))];case 1:return t.sent(),r.resolve(),[3,3];case 2:return e=t.sent(),r.reject(e),[3,3];case 3:return[2]}})})}),r.promise}(t._delegate)},Og),kg=(n(Lg,Dg=np),Object.defineProperty(Lg.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),Lg.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},Lg.prototype.useEmulator=function(t,e){var n,r;n=this._delegate,r=t,t=e,"firestore.googleapis.com"!==(e=(n=Jd(n,ep))._getSettings()).host&&e.host!==r&&Cr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},e),{host:r+":"+t,ssl:!1}))},Lg.prototype.enableNetwork=function(){return function(i){var t=this;return i.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var n,r;return g(this,function(t){switch(t.label){case 0:return[4,Sd(i)];case 1:return n=t.sent(),[4,Ad(i)];case 2:return r=t.sent(),[2,(n.setNetworkEnabled(!0),(e=r).Qr.delete(0),Ml(e))]}var e})})})}(Ip(Jd(this._delegate,wp)))},Lg.prototype.disableNetwork=function(){return function(r){var t=this;return r.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e,n;return g(this,function(t){switch(t.label){case 0:return[4,Sd(r)];case 1:return e=t.sent(),[4,Ad(r)];case 2:return n=t.sent(),[2,(e.setNetworkEnabled(!1),function(n){return y(this,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return(e=n).Qr.add(0),[4,Fl(e)];case 1:return t.sent(),e.jr.set("Offline"),[2]}})})}(n))]}})})})}(Ip(Jd(this._delegate,wp)))},Lg.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Hd("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.na.enableMultiTabIndexedDbPersistence(this):this.na.enableIndexedDbPersistence(this,n)},Lg.prototype.clearPersistence=function(){return this.na.clearIndexedDbPersistence(this)},Lg.prototype.terminate=function(){return this.sa&&(this.sa._removeServiceInstance("firestore"),this.sa._removeServiceInstance("firestore-exp")),this._delegate._delete()},Lg.prototype.waitForPendingWrites=function(){return function(n){var t=this,r=new uu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=qf,[4,Nd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),r.promise}(Ip(Jd(this._delegate,wp)))},Lg.prototype.onSnapshotsInSync=function(t){return e=this._delegate,t=t,function(n,t){var e=this,r=new ld(t);return n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Zr.add(e),e.next()},[4,Cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})}),function(){r.Xo(),n.asyncQueue.enqueueAndForget(function(){return y(e,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){t.Zr.delete(e)},[4,Cd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}}(Ip(Jd(e,wp)),vp(t)?t:{next:t});var e},Object.defineProperty(Lg.prototype,"app",{get:function(){if(!this.sa)throw new Wr(Hr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.sa},enumerable:!1,configurable:!0}),Lg.prototype.collection=function(t){try{return new uv(this,lp(this._delegate,t))}catch(t){throw Wg(t,"collection()","Firestore.collection()")}},Lg.prototype.doc=function(t){try{return new Qg(this,fp(this._delegate,t))}catch(t){throw Wg(t,"doc()","Firestore.doc()")}},Lg.prototype.collectionGroup=function(t){try{return new ov(this,function(t,e){if(t=Jd(t,ep),zd("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new Wr(Hr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ip(t,null,(e=e,new vo(Yr.emptyPath(),e)))}(this._delegate,t))}catch(t){throw Wg(t,"collectionGroup()","Firestore.collectionGroup()")}},Lg.prototype.runTransaction=function(e){var n,r=this;return function(n,r){var t=this,i=new uu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return[4,_d(n).then(function(t){return t.datastore})];case 1:return e=t.sent(),new pd(n.asyncQueue,e,r,i).run(),[2]}})})}),i.promise}(Ip(n=this._delegate),function(t){return t=new wg(n,t),e(new Vg(r,t))})},Lg.prototype.batch=function(){var e=this;return Ip(this._delegate),new Ug(new ug(this._delegate,function(t){return vg(e._delegate,t)}))},Lg.prototype.loadBundle=function(t){throw new Wr(Hr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},Lg.prototype.namedQuery=function(t){throw new Wr(Hr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},Lg),xg=(n(Rg,Sg=Te),Rg.prototype.convertBytes=function(t){return new Ng(new Np(t))},Rg.prototype.convertReference=function(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return Qg.ia(t,this.firestore,null)},Rg);function Rg(t){var e=this;return(e=Sg.call(this)||this).firestore=t,e}function Lg(t,e,n){var r=this;return(r=Dg.call(this,e)||this).na=n,r.INTERNAL={delete:function(){return r.terminate()}},t instanceof Od||(r.sa=t),r}function Og(){}function Pg(){return null!==Ag&&Ag.apply(this,arguments)||this}var Mg,Fg,qg,Vg=(n(Kg,qg=np),Kg.prototype.get=function(t){var e=this,n=yv(t);return this._delegate.get(n).then(function(t){return new rv(e._firestore,new Cy(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))})},Kg.prototype.set=function(t,e,n){t=yv(t);return n?(Qd("Transaction.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Kg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=yv(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Kg.prototype.delete=function(t){t=yv(t);return this._delegate.delete(t),this},Kg),Ug=(n(Gg,Fg=np),Gg.prototype.set=function(t,e,n){t=yv(t);return n?(Qd("WriteBatch.set",n),this._delegate.set(t,e,n)):this._delegate.set(t,e),this},Gg.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o=yv(t);return 2===arguments.length?this._delegate.update(o,e):(t=this._delegate).update.apply(t,s([o,e,n],r)),this},Gg.prototype.delete=function(t){t=yv(t);return this._delegate.delete(t),this},Gg.prototype.commit=function(){return this._delegate.commit()},Gg),Bg=(n(jg,Mg=np),jg.prototype.fromFirestore=function(t,e){t=new ky(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new iv(this._firestore,t),null!=e?e:{})},jg.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},jg.ra=function(t,e){var n=jg.oa,r=n.get(t);r||(r=new WeakMap,n.set(t,r));n=r.get(e);return n||(n=new jg(t,new xg(t),e),r.set(e,n)),n},jg);function jg(t,e,n){var r=this;return(r=Mg.call(this,n)||this)._firestore=t,r._userDataWriter=e,r}function Gg(){return null!==Fg&&Fg.apply(this,arguments)||this}function Kg(t,e){var n=this;return(n=qg.call(this,e)||this)._firestore=t,n._userDataWriter=new xg(t),n}Bg.oa=new WeakMap;var zg,Qg=(n(Hg,zg=np),Hg.ca=function(t,e,n){if(t.length%2!=0)throw new Wr(Hr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new Hg(e,new rp(e._delegate,n,new $r(t)))},Hg.ia=function(t,e,n){return new Hg(e,new rp(e._delegate,n,t))},Object.defineProperty(Hg.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(Hg.prototype,"parent",{get:function(){return new uv(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(Hg.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Hg.prototype.collection=function(t){try{return new uv(this.firestore,lp(this._delegate,t))}catch(t){throw Wg(t,"collection()","DocumentReference.collection()")}},Hg.prototype.isEqual=function(t){return(t=t instanceof np?t._delegate:t)instanceof rp&&dp(this._delegate,t)},Hg.prototype.set=function(t,e){e=Qd("DocumentReference.set",e);try{return function(t,e,n){t=Jd(t,rp);var r=Jd(t.firestore,wp),e=og(t._converter,e,n);return vg(r,[zp(Kp(r),"setDoc",t._key,e,null!==t._converter,n).toMutation(t._key,cs.none())])}(this._delegate,t,e)}catch(t){throw Wg(t,"setDoc()","DocumentReference.set()")}},Hg.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?yg(this._delegate,t):yg.apply(void 0,s([this._delegate,t,e],n))}catch(t){throw Wg(t,"updateDoc()","DocumentReference.update()")}},Hg.prototype.delete=function(){return vg(Jd((t=this._delegate).firestore,wp),[new Cs(t._key,cs.none())]);var t},Hg.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Yg(t),i=Xg(t,function(t){return new rv(e.firestore,new Cy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))});return gg(this._delegate,r,i)},Hg.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Jd(e,rp);var n=Jd(e.firestore,wp),t=Ip(n),r=new dg(n);return function(n,r){var t=this,i=new uu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(o,s,a){return y(this,void 0,void 0,function(){var r,i;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=s,(n=o).persistence.runTransaction("read document","readonly",function(t){return n.Kn.In(t,e)}))];case 1:return(i=t.sent())instanceof Ci?a.resolve(i):i instanceof ki?a.resolve(null):a.reject(new Wr(Hr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=t.sent(),i=rf(r,"Failed to get document '"+s+" from cache"),a.reject(i),[3,3];case 3:return[2]}var e,n})})},[4,Dd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._key).then(function(t){return new Cy(n,r,e._key,t,new Ny(t instanceof Ci&&t.hasLocalMutations,!0),e._converter)})}:"server"===(null==t?void 0:t.source)?function(e){e=Jd(e,rp);var n=Jd(e.firestore,wp);return kd(Ip(n),e._key,{source:"server"}).then(function(t){return mg(n,e,t)})}:function(e){e=Jd(e,rp);var n=Jd(e.firestore,wp);return kd(Ip(n),e._key).then(function(t){return mg(n,e,t)})})(this._delegate).then(function(t){return new rv(e.firestore,new Cy(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))})},Hg.prototype.withConverter=function(t){return new Hg(this.firestore,t?this._delegate.withConverter(Bg.ra(this.firestore,t)):this._delegate.withConverter(null))},Hg);function Hg(t,e){var n=this;return(n=zg.call(this,e)||this).firestore=t,n._userDataWriter=new xg(t),n}function Wg(t,e,n){return t.message=t.message.replace(e,n),t}function Yg(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!vp(r))return r}return{}}function Xg(t,e){var n;return{next:function(t){n.next&&n.next(e(t))},error:null===(t=(n=vp(t[0])?t[0]:vp(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===t?void 0:t.bind(n),complete:null===(t=n.complete)||void 0===t?void 0:t.bind(n)}}var Jg,$g,Zg,tv,ev,nv,rv=(n(pv,nv=np),Object.defineProperty(pv.prototype,"ref",{get:function(){return new Qg(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(pv.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(pv.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(pv.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),pv.prototype.data=function(t){return this._delegate.data(t)},pv.prototype.get=function(t,e){return this._delegate.get(t,e)},pv.prototype.isEqual=function(t){return My(this._delegate,t._delegate)},pv),iv=(n(dv,ev=rv),dv.prototype.data=function(t){return this._delegate.data(t)},dv),ov=(n(fv,tv=np),fv.prototype.where=function(t,e,n){try{return new fv(this.firestore,qy(this._delegate,(r=n,i=e,o=Sy("where",t),new Ky(o,i,r))))}catch(t){throw Wg(t,/(orderBy|where)\(\)/,"Query.$1()")}var r,i,o},fv.prototype.orderBy=function(t,e){try{return new fv(this.firestore,qy(this._delegate,(n=void 0===e?"asc":e,r=Sy("orderBy",t),new zy(r,n))))}catch(t){throw Wg(t,/(orderBy|where)\(\)/,"Query.$1()")}var n,r},fv.prototype.limit=function(t){try{return new fv(this.firestore,qy(this._delegate,($d("limit",e=t),new Qy("limit",e,"F"))))}catch(t){throw Wg(t,"limit()","Query.limit()")}var e},fv.prototype.limitToLast=function(t){try{return new fv(this.firestore,qy(this._delegate,($d("limitToLast",e=t),new Qy("limitToLast",e,"L"))))}catch(t){throw Wg(t,"limitToLast()","Query.limitToLast()")}var e},fv.prototype.startAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new fv(this.firestore,qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hy("startAt",t,!0)}.apply(void 0,t)))}catch(t){throw Wg(t,"startAt()","Query.startAt()")}},fv.prototype.startAfter=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new fv(this.firestore,qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Hy("startAfter",t,!1)}.apply(void 0,t)))}catch(t){throw Wg(t,"startAfter()","Query.startAfter()")}},fv.prototype.endBefore=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new fv(this.firestore,qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wy("endBefore",t,!0)}.apply(void 0,t)))}catch(t){throw Wg(t,"endBefore()","Query.endBefore()")}},fv.prototype.endAt=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];try{return new fv(this.firestore,qy(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Wy("endAt",t,!1)}.apply(void 0,t)))}catch(t){throw Wg(t,"endAt()","Query.endAt()")}},fv.prototype.isEqual=function(t){return pp(this._delegate,t._delegate)},fv.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(e){e=Jd(e,ip);var n=Jd(e.firestore,wp),t=Ip(n),r=new dg(n);return function(n,r){var t=this,i=new uu;return n.asyncQueue.enqueueAndForget(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(i,o,s){return y(this,void 0,void 0,function(){var e,n,r;return g(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,gh(i,o,!0)];case 1:return r=t.sent(),e=new Af(o,r.jn),n=e.Io(r.documents),n=e.applyChanges(n,!1),s.resolve(n.snapshot),[3,3];case 2:return n=t.sent(),r=rf(n,"Failed to execute query '"+o+" against cache"),s.reject(r),[3,3];case 3:return[2]}})})},[4,Dd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r,i])]}})})}),i.promise}(t,e._query).then(function(t){return new xy(n,r,e,t)})}:"server"===(null==t?void 0:t.source)?function(e){e=Jd(e,ip);var n=Jd(e.firestore,wp),t=Ip(n),r=new dg(n);return xd(t,e._query,{source:"server"}).then(function(t){return new xy(n,r,e,t)})}:function(e){e=Jd(e,ip);var n=Jd(e.firestore,wp),t=Ip(n),r=new dg(n);return Fy(e._query),xd(t,e._query).then(function(t){return new xy(n,r,e,t)})})(this._delegate).then(function(t){return new av(e.firestore,new xy(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},fv.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Yg(t),i=Xg(t,function(t){return new av(e.firestore,new xy(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return gg(this._delegate,r,i)},fv.prototype.withConverter=function(t){return new fv(this.firestore,t?this._delegate.withConverter(Bg.ra(this.firestore,t)):this._delegate.withConverter(null))},fv),sv=(n(lv,Zg=np),Object.defineProperty(lv.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(lv.prototype,"doc",{get:function(){return new iv(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(lv.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(lv.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),lv),av=(n(hv,$g=np),Object.defineProperty(hv.prototype,"query",{get:function(){return new ov(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(hv.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(hv.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(hv.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(hv.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new iv(e._firestore,t)})},enumerable:!1,configurable:!0}),hv.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new sv(e._firestore,t)})},hv.prototype.forEach=function(e,n){var r=this;this._delegate.forEach(function(t){e.call(n,new iv(r._firestore,t))})},hv.prototype.isEqual=function(t){return My(this._delegate,t._delegate)},hv),uv=(n(cv,Jg=ov),Object.defineProperty(cv.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(cv.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(cv.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Qg(this.firestore,t):null},enumerable:!1,configurable:!0}),cv.prototype.doc=function(t){try{return new Qg(this.firestore,void 0===t?fp(this._delegate):fp(this._delegate,t))}catch(t){throw Wg(t,"doc()","CollectionReference.doc()")}},cv.prototype.add=function(t){var e,n,r,i=this;return e=this._delegate,n=t,t=Jd(e.firestore,wp),r=fp(e),n=og(e._converter,n),vg(t,[zp(Kp(e.firestore),"addDoc",r._key,n,null!==e._converter,{}).toMutation(r._key,cs.exists(!1))]).then(function(){return r}).then(function(t){return new Qg(i.firestore,t)})},cv.prototype.isEqual=function(t){return dp(this._delegate,t._delegate)},cv.prototype.withConverter=function(t){return new cv(this.firestore,t?this._delegate.withConverter(Bg.ra(this.firestore,t)):this._delegate.withConverter(null))},cv);function cv(t,e){var n=this;return(n=Jg.call(this,t,e)||this).firestore=t,n._delegate=e,n}function hv(t,e){var n=this;return(n=$g.call(this,e)||this)._firestore=t,n}function lv(t,e){var n=this;return(n=Zg.call(this,e)||this)._firestore=t,n}function fv(t,e){var n=this;return(n=tv.call(this,e)||this).firestore=t,n._userDataWriter=new xg(t),n}function dv(){return null!==ev&&ev.apply(this,arguments)||this}function pv(t,e){var n=this;return(n=nv.call(this,e)||this)._firestore=t,n}function yv(t){return Jd(t=t instanceof np?t._delegate:t,rp)}var gv,vv,c=(n(bv,vv=np),bv.documentId=function(){return new bv(Jr.keyField().canonicalString())},bv.prototype.isEqual=function(t){return(t=t instanceof np?t._delegate:t)instanceof Ap&&this._delegate._internalPath.isEqual(t._internalPath)},bv),Te=(n(mv,gv=np),mv.serverTimestamp=function(){var t=new ty("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new mv(t)},mv.delete=function(){var t=new Hp("deleteField");return t._methodName="FieldValue.delete",new mv(t)},mv.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ey("arrayUnion",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayUnion",new mv(n)},mv.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new ny("arrayRemove",t)}.apply(void 0,t);return n._methodName="FieldValue.arrayRemove",new mv(n)},mv.increment=function(t){t=new ry("increment",t);return t._methodName="FieldValue.increment",new mv(t)},mv.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},mv);function mv(){return null!==gv&&gv.apply(this,arguments)||this}function bv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return vv.call(this,new(Ap.bind.apply(Ap,s([void 0],t))))||this}function wv(t){return e=this._delegate,s=t,n=Ip(e=Jd(e,wp)),t=new bp,function(n,t,r){var e,i=this,o=(e=s,t=wl(t),e=function(t){if(t instanceof Uint8Array)return hd(t,void 0);if(t instanceof ArrayBuffer)return hd(new Uint8Array(t),void 0);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),new fd(e,t));n.asyncQueue.enqueueAndForget(function(){return y(i,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=Zf,[4,Nd(n)];case 1:return e.apply(void 0,[t.sent(),o,r]),[2]}})})})}(n,e._databaseId,t),t;var e,s,n}function Ev(t){var e=this,n=this._delegate,t=t;return function(n,r){var t=this;return n.asyncQueue.enqueue(function(){return y(t,void 0,void 0,function(){var e;return g(this,function(t){switch(t.label){case 0:return e=function(t,e){var n=t;return n.persistence.runTransaction("Get named query","readonly",function(t){return n.He.getNamedQuery(t,e)})},[4,Dd(n)];case 1:return[2,e.apply(void 0,[t.sent(),r])]}})})})}(Ip(n=Jd(n,wp)),t).then(function(t){return t?new ip(n,null,t.query):null}).then(function(t){return t?new ov(e,t):null})}var Tv=(Iv.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Iv.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Iv.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Iv);function Iv(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var _v,Sv,Dv={Firestore:kg,GeoPoint:kp,Timestamp:hi,Blob:Ng,Transaction:Vg,WriteBatch:Ug,DocumentReference:Qg,DocumentSnapshot:rv,Query:ov,QueryDocumentSnapshot:iv,QuerySnapshot:av,CollectionReference:uv,FieldPath:c,FieldValue:Te,setLogLevel:function(t){Sr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(_v=e.default).INTERNAL.registerComponent(new Tv("firestore",function(t){var e=t.getProvider("app").getImmediate();return e=e,t=t.getProvider("auth-internal"),new kg(e,new wp(e,t),new Cg)},"PUBLIC").setServiceProps(Object.assign({},Dv))),_v.registerVersion("@firebase/firestore","2.2.1"),(Sv=kg).prototype.loadBundle=wv,Sv.prototype.namedQuery=Ev}.apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
